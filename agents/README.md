# Агентная методология разработки ISP_Audit

Этот каталог содержит результаты работы специализированных агентов на каждом этапе разработки.

## Быстрый старт

**Начать новую задачу (интерактивный режим)**:
```
Упомяните @agents/task_owner/TASK_TEMPLATE.md и скажите:
"начинаем работать над новой задачей"

[PURPLE] LLM задаст вам 7 вопросов и создаст current_task.md
Затем запускайте агентов по порядку по цветовым маркерам
```

## Схема работы

**ВАЖНО**: Каждый агент (кроме Task Owner) работает в ОТДЕЛЬНОМ контексте (новый чат/сессия)!

**Это работает с любой LLM**: GPT-4, Claude, Gemini, Llama и другими

**Цветовая маркировка агентов**:
```
[PURPLE] - Task Owner (главный LLM в текущем контексте)
[RED]    - Research Agent (отдельный контекст)
[BLUE]   - Planning Agent (отдельный контекст)
[GREEN]  - Coding Agent (отдельный контекст)
[YELLOW] - QA Agent (отдельный контекст)
[CYAN]   - Delivery Agent (отдельный контекст)
```

**Поток работы**:
```
[0] [PURPLE] Task Owner            → Интерактивно: 7 вопросов → current_task.md
                                     (работает в текущем контексте)
                         ↓
[1] [RED]    Research Agent        → Исследование кода → findings.md (отдельный контекст)
                         ↓
[2] [BLUE]   Planning Agent        → Детальный план → plan.md (отдельный контекст)
                         ↓
[3] [GREEN]  Coding Agent          → Реализация (N раз, haiku, отдельный контекст)
                         ↓
[4] [YELLOW] QA Agent              → Тестирование → test_report.md (отдельный контекст)
                         ↓
[5] [CYAN]   Delivery Agent        → Коммит + changelog (отдельный контекст)
```

## Индикаторы работы агентов

При запуске агентов в новых контекстах используйте цветовые маркеры для ориентации:
```
[RED] Research Agent is working...    (глубокий анализ, тяжёлая модель)
[BLUE] Planning Agent is working...   (детальное планирование, тяжёлая модель)
[GREEN] Coding Agent is working...    (быстрая реализация, лёгкая модель)
[YELLOW] QA Agent is working...       (тестирование, средняя модель)
[CYAN] Delivery Agent is working...   (финализация, средняя модель)
```

## Принципы экономии API лимитов

**ВАЖНО**: Цель методологии - экономия **API лимитов** (rate limits, стоимость запросов), а не токенов контекста!

### Проблема линейной работы
- LLM держит весь контекст проекта (~80k+ токенов)
- Каждый ответ = полный контекст × стоимость запроса
- 10 ответов подряд = 10 × весь контекст = **быстрое исчерпание лимита**

### Решение: Агентная работа

#### Этап 1: Тяжёлые агенты (1 раз в начале)
- **Research Agent** (глубокий анализ): полный аудит проекта → `findings.md`
- **Planning Agent** (детальное планирование): приоритизация задач → `plan.md`
- **Стоимость**: ~20-30% лимита, но делается 1 раз

#### Этап 2: Лёгкие Coding агенты (основная работа)
- **Узкая задача**: "исправь файл X по плану Y"
- **Минимальный контекст**: агент читает только 1-2 файла
- **Быстрый результат**: patch или новый код
- **Стоимость**: ~2-5% лимита за задачу
- **Количество**: можно выполнить 10-15 задач за сессию

#### Этап 3: Финализация
- **Review/QA** (опционально): быстрая проверка
- **Delivery**: changelog + коммит

### Экономия
- **Без агентов**: 10 задач = 10 × 80k контекста = 70-80% лимита
- **С агентами**: 2 тяжёлых (30%) + 10 лёгких (30%) = 60% лимита + больше работы выполнено

## Правила использования агентов

1. **Research/Planning - СТРОГО 1 раз** в начале сессии
2. **Coding Agent - много раз**, каждый с узкой задачей:
   - ✅ "Исправь DNS Test: добавь retry для DoH (файл Tests/DnsTest.cs, строки 51-96)"
   - ❌ "Исправь все тесты" (слишком широко)
3. **Сохранять в файлы** только важные результаты (findings, plan, changelog)
4. **Не создавать** промежуточные файлы для каждой мелкой задачи

**Рекомендуемые модели**:
- Research/Planning: продвинутые модели (GPT-4, Claude Opus/Sonnet, Gemini Pro)
- Coding: быстрые модели (GPT-4o-mini, Claude Haiku, Gemini Flash)
- QA/Delivery: стандартные модели (GPT-4o, Claude Sonnet, Gemini Pro)

## Текущая задача

См. [task_owner/current_task.md](task_owner/current_task.md)

## История задач

См. [delivery_agent/changelog.md](delivery_agent/changelog.md)
