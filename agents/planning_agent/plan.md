# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ISP_Audit

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 01.12.2025  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–¥–∞—á–∏:** `ARCHITECTURE_CURRENT.md`  
**–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:** `agents/research_agent/findings_2025_12_01.md`  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

---

## –û–±–∑–æ—Ä

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:
1. **Bypass –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** ‚Äî pipeline —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç, –Ω–æ –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
2. **–î–µ—Ç–µ–∫—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è** ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã DPI (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
3. **~30% –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞** ‚Äî FixHistory, CLI, Output/
4. **Socket Layer –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** ‚Äî polling –≤–º–µ—Å—Ç–æ —Å–æ–±—ã—Ç–∏–π–Ω–æ–π –º–æ–¥–µ–ª–∏

---

## –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
–ü–æ–¥–∑–∞–¥–∞—á–∞ 1 (BypassCoordinator) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                      ‚îÇ
–ü–æ–¥–∑–∞–¥–∞—á–∞ 2 (FixHistory) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
                                  ‚ñº                   ‚îÇ
                        –ü–æ–¥–∑–∞–¥–∞—á–∞ 3 (CLI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
                                              ‚ñº       ‚îÇ
                                   –ü–æ–¥–∑–∞–¥–∞—á–∞ 4 (Output/)
                                                      ‚îÇ
–ü–æ–¥–∑–∞–¥–∞—á–∞ 5 (Socket Layer) ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚ñº
          –ü–æ–¥–∑–∞–¥–∞—á–∞ 6 (Flow cleanup)
                    ‚îÇ
                    ‚ñº
          –ü–æ–¥–∑–∞–¥–∞—á–∞ 7 (WinExe)
```

---

## –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è BypassCoordinator –≤ LiveTestingPipeline

- **–§–∞–π–ª—ã:** 
  - `Utils/LiveTestingPipeline.cs` (—Å—Ç—Ä–æ–∫–∏ 90-135 ‚Äî UiWorker)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –í `UiWorker` (—Å—Ç—Ä–æ–∫–∞ 113) –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è `_progress?.Report($"‚Üí –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: {blocked.BypassStrategy}")` –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ `BypassCoordinator.AutoFixLiveAsync()`
  2. –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä `BypassCoordinator` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π `_bypassManager`)
  3. –ü–æ—Å–ª–µ `ClassifierWorker` –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `HostBlocked` —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π != "NONE":
     ```csharp
     var coordinator = new BypassCoordinator(_bypassManager);
     var fixResult = await coordinator.AutoFixLiveAsync(
         blocked.TestResult,
         async (h) => await _tester.TestHostAsync(h.Host, ct),
         ct
     );
     ```
  4. –û–±–Ω–æ–≤–∏—Ç—å `_progress` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  5. **–í–ê–ñ–ù–û:** –ù–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å bypass –µ—Å–ª–∏ –æ–Ω —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ `_bypassManager.State`)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç
- **–†–∏—Å–∫–∏:** 
  - –ì–ª–æ–±–∞–ª—å–Ω—ã–π bypass –º–æ–∂–µ—Ç –ª–æ–º–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–º–∞—Ñ–æ—Ä/–æ—á–µ—Ä–µ–¥—å
  - `BypassCoordinator.AutoFixLiveAsync()` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É —Ä–µ—Ç–µ—Å—Ç–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ FixHistory (–º—ë—Ä—Ç–≤—ã–π –∫–æ–¥)

- **–§–∞–π–ª—ã:** 
  - `Models/FixHistory.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨ –í–ï–°–¨ –§–ê–ô–õ**
  - `ViewModels/MainViewModel.cs` (—Å—Ç—Ä–æ–∫–∏ 146-152, 586-608, 1079-1113, 1115-1175)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `Models/FixHistory.cs` –ø–æ–ª–Ω–æ—Å—Ç—å—é
  2. –í `MainViewModel.cs` —É–¥–∞–ª–∏—Ç—å:
     - –°–≤–æ–π—Å—Ç–≤–æ `ActiveFixes` (—Å—Ç—Ä–æ–∫–∞ 146): `public ObservableCollection<AppliedFix> ActiveFixes`
     - –°–≤–æ–π—Å—Ç–≤–æ `HasActiveFixes` (—Å—Ç—Ä–æ–∫–∞ 147): `public bool HasActiveFixes`
     - –°–≤–æ–π—Å—Ç–≤–æ `ActiveFixesMessage` (—Å—Ç—Ä–æ–∫–∞ 148): `public string ActiveFixesMessage`
     - –ö–æ–º–∞–Ω–¥—É `RollbackFixCommand` (—Å—Ç—Ä–æ–∫–∞ 160)
     - –ö–æ–º–∞–Ω–¥—É `RollbackAllCommand` (—Å—Ç—Ä–æ–∫–∞ 161)
     - –ú–µ—Ç–æ–¥ `LoadFixHistory()` (—Å—Ç—Ä–æ–∫–∏ 1079-1093)
     - –ú–µ—Ç–æ–¥ `RollbackFixAsync()` (—Å—Ç—Ä–æ–∫–∏ 1115-1158)
     - –ú–µ—Ç–æ–¥ `RollbackAllFixesAsync()` (—Å—Ç—Ä–æ–∫–∏ 1160-1175)
     - –£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤ `LoadFixHistory()` –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ (—Å—Ç—Ä–æ–∫–∞ 591)
  3. **–ù–û –û–°–¢–ê–í–ò–¢–¨:** `AppliedFix` –∏ `FixType` enum –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `ApplyFixAsync()` ‚Äî –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç
- **–†–∏—Å–∫–∏:** 
  - `AppliedFix` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
  - `FixHistoryManager` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ApplyFixAsync` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 3: –£–¥–∞–ª–µ–Ω–∏–µ CLI –∫–æ–¥–∞

- **–§–∞–π–ª—ã:**
  - `AuditRunner.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨ –í–ï–°–¨ –§–ê–ô–õ**
  - `Program.cs` (—Å—Ç—Ä–æ–∫–∏ 72-146 ‚Äî –º–µ—Ç–æ–¥ `RunCliAsync`)
  - `Config.cs` ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–º–µ—Ç–æ–¥ `ParseArgs` –∏ CLI-related –∫–æ–¥)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `AuditRunner.cs` –ø–æ–ª–Ω–æ—Å—Ç—å—é
     - **–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ `BypassCoordinator` (—Å—Ç—Ä–æ–∫–∏ 80-100) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–æ–¥–∑–∞–¥–∞—á–∏ 1
  2. –í `Program.cs`:
     - –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ `RunCliAsync()` (—Å—Ç—Ä–æ–∫–∏ 72-146)
     - –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ `RunAllChecksAsync()` (—Å—Ç—Ä–æ–∫–∏ 148-154)
     - –£–ø—Ä–æ—Å—Ç–∏—Ç—å `Main()` ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ GUI —Ä–µ–∂–∏–º
  3. –í `Config.cs`:
     - –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ `ParseArgs()` (~200 —Å—Ç—Ä–æ–∫)
     - –£–¥–∞–ª–∏—Ç—å `ToArgsArray()` –º–µ—Ç–æ–¥
     - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è GUI (—Ç–∞–π–º–∞—É—Ç—ã, –ø—Ä–æ—Ñ–∏–ª–∏)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ø–æ—Å–ª–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ 2 (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Ñ–∞–π–ª–∞–º–∏)
- **–†–∏—Å–∫–∏:**
  - `Config` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ GUI ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ —É–¥–∞–ª–µ–Ω—ã –Ω—É–∂–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
  - `AuditRunner` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–±–æ—á—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é `BypassCoordinator` ‚Äî —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 4: –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏ Output/

- **–§–∞–π–ª—ã:**
  - `Output/FirewallTestResult.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨**
  - `Output/IspTestResult.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨**
  - `Output/ReportWriter.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨**
  - `Output/RouterTestResult.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨**
  - `Output/SoftwareTestResult.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨**
  - `Output/UdpProbeResult.cs` ‚Äî **–£–î–ê–õ–ò–¢–¨**
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª—ã –∏–∑ `Output/` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ GUI –∫–æ–¥–µ
  2. –í—ã–ø–æ–ª–Ω–∏—Ç—å grep –ø–æ–∏—Å–∫ –ø–æ codebase: `using IspAudit.Output`
  3. –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω—É–∂–Ω—ã–µ –∫–ª–∞—Å—Å—ã –≤ `Core/Models/`
  4. –£–¥–∞–ª–∏—Ç—å –≤—Å—é –ø–∞–ø–∫—É `Output/`
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ø–æ—Å–ª–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ 3 (AuditRunner –±—ã–ª –≥–ª–∞–≤–Ω—ã–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º)
- **–†–∏—Å–∫–∏:**
  - `TargetReport` –∏ `RunReport` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `BypassCoordinator` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 5: –í–∫–ª—é—á–µ–Ω–∏–µ Socket Layer –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- **–§–∞–π–ª—ã:**
  - `Utils/FlowMonitorService.cs` (—Å—Ç—Ä–æ–∫–∏ 58-68)
  - `ViewModels/MainViewModel.cs` (—Å—Ç—Ä–æ–∫–∏ 1344-1352)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –í `FlowMonitorService.cs`:
     - –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É `StartAsync()` ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å Socket Layer –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–û —Å bypass (–Ω–µ –≤–º–µ—Å—Ç–æ)
     - Socket Layer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Sniff + RecvOnly` —Ñ–ª–∞–≥–∏ ‚Äî –ù–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å bypass `None`
     - –£–¥–∞–ª–∏—Ç—å —É—Å–ª–æ–≤–∏–µ `if (UseWatcherMode)` –∏ –í–°–ï–ì–î–ê –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–±–∞ —Ä–µ–∂–∏–º–∞
  2. –í `MainViewModel.cs`:
     - –£–±—Ä–∞—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ Watcher mode (—Å—Ç—Ä–æ–∫–∞ 1350):
       ```csharp
       // –ë–´–õ–û: _flowMonitor.UseWatcherMode = true;
       // –°–¢–ê–õ–û: –æ—Å—Ç–∞–≤–∏—Ç—å false –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, Socket Layer + Bypass —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
       ```
  3. **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ RST blocker –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å Socket Layer
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ø–æ—Å–ª–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ 1 (BypassCoordinator –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω)
- **–†–∏—Å–∫–∏:**
  - üî¥ –í–´–°–û–ö–ò–ô: –í–æ–∑–º–æ–∂–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç WinDivert handles ‚Äî –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ merge
  - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ: "RST blocker –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å TrafficAnalyzer Flow layer"

---

## –§–∞–∑–∞ 2: Cleanup (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ –§–∞–∑—ã 1)

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ Flow Layer –∫–æ–¥–∞

- **–§–∞–π–ª—ã:**
  - `Utils/FlowMonitorService.cs` (—Å—Ç—Ä–æ–∫–∏ 167-280 ‚Äî –º–µ—Ç–æ–¥ `RunMonitorLoop`)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∑–∞–¥–∞—á–∏ 5, –µ—Å–ª–∏ Socket Layer —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ:
     - –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ `RunMonitorLoop()` (Flow Layer) ‚Äî –∏–∑–±—ã—Ç–æ—á–µ–Ω –ø—Ä–∏ Socket Layer
     - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `RunSocketMonitorLoop()` –∏ `RunWatcherLoop()` –∫–∞–∫ fallback
  2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å `StartAsync()` ‚Äî —É–±—Ä–∞—Ç—å –≤–µ—Ç–≤–ª–µ–Ω–∏–µ –¥–ª—è Flow/Socket
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ø–æ—Å–ª–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ 5 + —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–†–∏—Å–∫–∏:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ‚Äî —ç—Ç–æ cleanup –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 7: OutputType=WinExe (UX polish)

- **–§–∞–π–ª—ã:**
  - `ISP_Audit.csproj` (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞)
- **–û–ø–∏—Å–∞–Ω–∏–µ:**
  1. –î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –≤ `.csproj`:
     ```xml
     <OutputType>WinExe</OutputType>
     ```
  2. –≠—Ç–æ —É–±–µ—Ä—ë—Ç –º–µ–ª—å–∫–∞–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ GUI
  3. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å `TryHideConsoleWindow()` –∏–∑ `Program.cs`
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ø–æ—Å–ª–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ 3 (CLI –∫–æ–¥ —É–¥–∞–ª—ë–Ω)
- **–†–∏—Å–∫–∏:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π

---

## –ò—Ç–æ–≥–æ

- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∑–∞–¥–∞—á:** 7 (5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö + 2 –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö polish)
- **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
  1. –ü–æ–¥–∑–∞–¥–∞—á–∞ 1 (BypassCoordinator) ‚Äî **–ù–ï–ó–ê–í–ò–°–ò–ú–û**
  2. –ü–æ–¥–∑–∞–¥–∞—á–∞ 2 (FixHistory) ‚Äî **–ù–ï–ó–ê–í–ò–°–ò–ú–û** (–º–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å 1)
  3. –ü–æ–¥–∑–∞–¥–∞—á–∞ 3 (CLI –∫–æ–¥) ‚Äî –ø–æ—Å–ª–µ 2
  4. –ü–æ–¥–∑–∞–¥–∞—á–∞ 4 (Output/) ‚Äî –ø–æ—Å–ª–µ 3
  5. –ü–æ–¥–∑–∞–¥–∞—á–∞ 5 (Socket Layer) ‚Äî –ø–æ—Å–ª–µ 1
  6. –ü–æ–¥–∑–∞–¥–∞—á–∞ 6 (Flow Layer cleanup) ‚Äî –ø–æ—Å–ª–µ 5 + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  7. –ü–æ–¥–∑–∞–¥–∞—á–∞ 7 (WinExe) ‚Äî –ø–æ—Å–ª–µ 3

**–ú–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:** –ü–æ–¥–∑–∞–¥–∞—á–∏ 1 –∏ 2 (—Ä–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã, –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:**
  1. üî¥ **–ì–ª–æ–±–∞–ª—å–Ω—ã–π bypass** –ª–æ–º–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Äî –Ω—É–∂–µ–Ω —Å–µ–º–∞—Ñ–æ—Ä –≤ –ø–æ–¥–∑–∞–¥–∞—á–µ 1
  2. üî¥ **WinDivert –∫–æ–Ω—Ñ–ª–∏–∫—Ç** Socket Layer vs RST blocker ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–¥–∑–∞–¥–∞—á–µ 5
  3. üü° **–ü–æ—Ç–µ—Ä—è –ª–æ–≥–∏–∫–∏** –∏–∑ `AuditRunner` ‚Äî —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é `BypassCoordinator` –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
  4. üü° **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Output/** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `TargetReport` –≤ GUI –∫–æ–¥–µ

---

## Checklist –¥–ª—è QA Agent

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–¥–∑–∞–¥–∞—á –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. [ ] YouTube/Discord/rutracker —Ä–∞–±–æ—Ç–∞—é—Ç —Å bypass
2. [ ] Bypass –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏  
3. [ ] GUI –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
4. [ ] –õ–æ–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ bypass
5. [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
6. [ ] –ù–µ—Ç –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ GUI
7. [ ] Socket Layer –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å RST blocker
8. [ ] –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è CLI –∫–æ–¥–∞
9. [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è Coding Agent

### Async –ø—Ä–∞–≤–∏–ª–∞ (–°–¢–†–û–ì–û)
```csharp
// ‚úÖ –í–°–ï–ì–î–ê ConfigureAwait(false) –≤ library/test –∫–æ–¥–µ
var result = await DoWorkAsync().ConfigureAwait(false);

// ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å async
var result = DoWorkAsync().Result; // DEADLOCK
```

### Progress reporting (GUI –∫–æ–Ω—Ç—Ä–∞–∫—Ç)
```csharp
progress?.Report($"[BYPASS] –ü—Ä–∏–º–µ–Ω—è—é {strategy} –¥–ª—è {host}...");
progress?.Report($"‚úì {strategy} bypass –∞–∫—Ç–∏–≤–µ–Ω");
progress?.Report($"‚úó {strategy} –Ω–µ –ø–æ–º–æ–≥");
```

### BypassCoordinator –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```csharp
var coordinator = new BypassCoordinator(_bypassManager);
var result = await coordinator.AutoFixLiveAsync(
    testedHost,
    async (h) => await _tester.TestHostAsync(h.Host, ct),
    ct
);
if (result.Success) {
    _progress.Report($"‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: {result.Strategy}");
}
```

---

## –ü—Ä–æ–º–ø—Ç –¥–ª—è Coding Agent

> Coding Agent. –í–æ–∑—å–º–∏ –ø–æ–¥–∑–∞–¥–∞—á—É **[N]** –∏–∑ `agents/planning_agent/plan.md` –∏ —Ä–µ–∞–ª–∏–∑—É–π –µ—ë **—Å—Ç—Ä–æ–≥–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–ø–∏—Å–∞–Ω–∏—è** (–±–µ–∑ –∑–∞—Ö–≤–∞—Ç–∞ –¥—Ä—É–≥–∏—Ö –ø–æ–¥–∑–∞–¥–∞—á).
> 
> 1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π —Ä–∞–∑–¥–µ–ª –ø–æ–¥–∑–∞–¥–∞—á–∏ (–û–ø–∏—Å–∞–Ω–∏–µ, –§–∞–π–ª—ã, –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –†–∏—Å–∫–∏).
> 2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —ç—Ç–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É.
> 3. –†–∞–±–æ—Ç–∞–π —ç–∫–æ–Ω–æ–º–Ω–æ:
>    - —á–∏—Ç–∞–π —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã;
>    - –º–µ–Ω—è–π —Ç–æ–ª—å–∫–æ —Ç–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã;
>    - —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º (ConfigureAwait(false), CancellationToken).
> 4. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
>    - –æ–±–Ω–æ–≤–∏ `agents/qa_agent/test_report.md` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–∞–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã;
>    - –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ –≤ `agents/task_owner/current_task.md` —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ;
>    - –Ω–µ —Ç—Ä–æ–≥–∞–π –¥—Ä—É–≥–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–π refactor –≤–Ω–µ —Ä–∞–º–æ–∫ –ø–ª–∞–Ω–∞.
