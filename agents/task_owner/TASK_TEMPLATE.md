# [PURPLE] Task Owner: [НАЗВАНИЕ ЗАДАЧИ]

> **Три способа начать работу:**
> Упомяните шаблон и скажите "начинаем работать над новой задачей" → LLM получает задачу и создает `current_task.md`


---

## [0] [PURPLE] Task Owner - Интерактивное формирование задачи

**Инструкция для LLM **:

Когда пользователь упоминает этот шаблон и говорит "начинаем работать над новой задачей":

Модель должна ответить на вопросы ниже исходя из текущего задания

```
ВОПРОС 1: Опишите проблему или задачу: что не работает, что нужно добавить, что нужно улучшить?

ВОПРОС 2: Как проявляется проблема? (шаги воспроизведения, скриншоты, логи, примеры)
          Если это новая функция - пропустите этот вопрос.

ВОПРОС 3: Кто столкнётся с этой проблемой? (игроки SC / техподдержка / разработчики)
          Насколько это критично? (CRITICAL / HIGH / MEDIUM / LOW)

ВОПРОС 4: Что должно получиться после выполнения задачи? Опишите желаемое поведение.

ВОПРОС 5: Как вы поймёте что задача выполнена успешно? Какие сценарии должны работать?

ВОПРОС 6: Есть ли технические ограничения или требования?
          Что точно НЕ нужно делать в рамках этой задачи?

ВОПРОС 7: Нужно ли сохранить обратную совместимость со старыми версиями? (да/нет)
```

2. После получения всех ответов: покажи пользователю ПОЛНЫЙ текст будущего `current_task.md`

3. Спроси подтверждение: "Всё верно? (да/нет/нужны правки)"

4. Если подтверждено - создай `agents/task_owner/current_task.md` 

5. Сообщи: "Задача готова! Следующий шаг: запустить [RED] Research Agent (см. секцию [1])"

---

## Проблема

**Краткое описание**:
[Что не работает или что нужно добавить? 1-2 предложения]

**Как проявляется** (для багов):
```
[Шаги воспроизведения, скриншоты, логи]
```

**Контекст**:
- Кто столкнётся: [игроки SC / техподдержка / разработчики]
- Критичность: [CRITICAL / HIGH / MEDIUM / LOW]

---

## Желаемый результат (Definition of Done)

После выполнения:
1. [Конкретный результат 1]
2. [Конкретный результат 2]
3. [Конкретный результат 3]

Критерии приёмки:
- [Как проверить выполнение]
- [Какие сценарии работают]
- [Нет регрессий]

---

## Ограничения

**Технические**:
- .NET 9, WPF + MaterialDesign
- Async/await + CancellationToken
- Обратная совместимость: [да/нет]

**Что НЕ делать**:
- [Список]

**Оценка**: SMALL (3-5 подзадач) / MEDIUM (6-10) / LARGE (10+)

**Рекомендуемые модели по размеру**:
- SMALL → все задачи на быстрой модели (GPT-4o-mini, Claude Haiku, Gemini Flash)
- MEDIUM → Research/Planning на стандартной (GPT-4o, Claude Sonnet), Coding на быстрой
- LARGE → Research/Planning на продвинутой (GPT-4, Claude Opus), Coding на стандартной

---

## Схема работы агентов

**ВАЖНО**: Каждый агент работает в ОТДЕЛЬНОМ контексте (новый чат/сессия)!
- Агенты НЕ видят друг друга
- Связь только через файлы: `current_task.md`, `findings.md`, `plan.md`, `test_report.md`, `changelog.md`
- Task Owner координирует работу, передавая результаты между агентами

**Это работает с любой LLM**: GPT-4, Claude, Gemini, Llama и другими

**Цветовая маркировка агентов**:
```
[PURPLE] - Task Formulation / Task Owner
[RED]    - Research Agent
[BLUE]   - Planning Agent
[GREEN]  - Coding Agent
[YELLOW] - QA Agent
[CYAN]   - Delivery Agent
```

**Поток работы**:
```
[0] [PURPLE] Task Owner            → Интерактивно: 7 вопросов → current_task.md
                                     Или ручное заполнение current_task.md
                         ↓ (сохранить current_task.md)
[1] [RED] Research Agent           → Исследование кода → findings.md
                         ↓ (прочитать findings.md)
[2] [BLUE] Planning Agent          → Детальный план → plan.md
                         ↓ (прочитать plan.md, выполнить подзадачи)
[3] [GREEN] Coding Agent           → Реализация (N раз, быстрая модель)
                         ↓ (прочитать current_task.md для критериев)
[4] [YELLOW] QA Agent              → Тестирование → test_report.md
                         ↓ (если OK, прочитать plan.md)
[5] [CYAN] Delivery Agent          → Коммит + changelog
```

---

## [1] [RED] Research Agent

**Статус**: [ ] TODO / [ ] IN PROGRESS / [ ] DONE

**Агент работает в отдельном контексте!** Он НЕ видит этот файл и предыдущую переписку.

**Входные файлы** (агент должен прочитать сам):
- `agents/task_owner/current_task.md` - полное описание задачи

**Выходной файл** (агент должен создать):
- `agents/research_agent/findings.md`

**Промпт для нового чата** (Task Owner сгенерирует и даст тебе):
```
Ты [RED] Research Agent. Работаешь в изолированном контексте.

Прочитай файл agents/task_owner/current_task.md и исследуй проблему:
1. Найди все затронутые файлы и компоненты
2. Изучи текущую реализацию
3. Выяви риски и зависимости
4. Пойми архитектуру релевантных частей

Создай файл agents/research_agent/findings.md со структурой:

## Затронутые файлы
[список с описанием что делает каждый]

## Текущая реализация
[как работает сейчас]

## Риски и зависимости
[что может сломаться, от чего зависит]

## Рекомендации для Planning Agent
[что важно учесть при планировании]
```

**После завершения**: Task Owner переходит к [2]

---

## [2] [BLUE] Planning Agent

**Статус**: [ ] TODO / [ ] IN PROGRESS / [ ] DONE

**Агент работает в отдельном контексте!**

**Входные файлы** (агент должен прочитать сам):
- `agents/task_owner/current_task.md` - описание задачи
- `agents/research_agent/findings.md` - результаты исследования от [RED] агента

**Выходной файл** (агент должен создать):
- `agents/planning_agent/plan.md`

**Промпт для нового чата** (Task Owner сгенерирует и даст тебе):
```
Ты [BLUE] Planning Agent. Работаешь в изолированном контексте.

Прочитай:
1. agents/task_owner/current_task.md (задача)
2. agents/research_agent/findings.md (результаты исследования)

Создай детальный план в agents/planning_agent/plan.md:

ВАЖНО: Оптимизируй для экономии API лимитов!
- Каждая подзадача = 1-2 файла максимум
- Группируй связанные изменения
- Минимизируй количество подзадач без потери качества

Формат каждой подзадачи:

## Подзадача N: [Название]
- Файлы: path/to/file.cs (строки X-Y если известно)
- Описание: [что именно изменить, какой код добавить/удалить/заменить]
- Зависимости: нет / после подзадачи M
- Риски: [если есть]
- Рекомендуемая модель: быстрая (GPT-4o-mini / Haiku / Flash)

В конце добавь секцию:

## Итого
- Количество подзадач: N
- Порядок выполнения: [последовательно / можно параллельно задачи X,Y,Z]
- Основные риски: [общие риски]
```

**После завершения**: Task Owner переходит к [3]

---

## [3] [GREEN] Coding Agent (повторить N раз)

**Статус по подзадачам**:
- [ ] Подзадача 1: [название]
- [ ] Подзадача 2: [название]
- [ ] Подзадача 3: [название]
- [ ] ...

**Каждый Coding Agent = новый контекст!** Они НЕ видят работу предыдущих Coding Agent.

**Входные файлы** (агент должен прочитать сам):
- `agents/planning_agent/plan.md` - читает только свою подзадачу N
- Файлы кода, указанные в подзадаче

**Выходной файл** (агент должен изменить):
- Файлы, указанные в подзадаче

**Промпт для каждой подзадачи N** (Task Owner сгенерирует и даст тебе):
```
Ты [GREEN] Coding Agent #N. Работаешь в изолированном контексте.

1. Прочитай agents/planning_agent/plan.md
2. Найди в нём подзадачу N: [НАЗВАНИЕ ПОДЗАДАЧИ]
3. Прочитай указанные файлы
4. Внеси изменения согласно описанию в подзадаче
5. Убедись что синтаксис правильный

НЕ создавай промежуточные файлы!
Результат: изменённый код, готовый к тестированию.
```

**Повторить для каждой подзадачи** из `plan.md`

**После завершения всех подзадач**: Task Owner переходит к [4]

---

## [4] [YELLOW] QA Agent

**Статус**: [ ] TODO / [ ] IN PROGRESS / [ ] DONE

**Агент работает в отдельном контексте!**

**Входные файлы** (агент должен прочитать сам):
- `agents/task_owner/current_task.md` - критерии приёмки из секции "Желаемый результат"
- Изменённые файлы кода (для проверки)

**Выходной файл** (агент должен создать):
- `agents/qa_agent/test_report.md`

**Промпт для нового чата** (Task Owner сгенерирует и даст тебе):
```
Ты [YELLOW] QA Agent. Работаешь в изолированном контексте.

1. Прочитай agents/task_owner/current_task.md (секция "Желаемый результат")
2. Запусти `dotnet build -c Debug` для проверки компиляции
3. Если есть GUI изменения: запусти `dotnet run` и проверь визуально
4. Проверь каждый критерий приёмки
5. Проверь на регрессии (старые сценарии работают)

Создай agents/qa_agent/test_report.md в формате:

## Результаты тестирования
[список проверенных критериев с PASS/FAIL]

## Найденные проблемы
[список проблем или 'Проблем не найдено']

## Рекомендации
[нужны ли фиксы, можно ли коммитить]
```

**Если есть проблемы**: Task Owner возвращается к [3] и создаёт Coding Agent для фиксов

**Если OK**: Task Owner переходит к [5]

---

## [5] [CYAN] Delivery Agent

**Статус**: [ ] TODO / [ ] IN PROGRESS / [ ] DONE

**Агент работает в отдельном контексте!**

**Входные файлы** (агент должен прочитать сам):
- `agents/task_owner/current_task.md` - название задачи
- `agents/planning_agent/plan.md` - все подзадачи для changelog

**Выходные файлы** (агент должен создать/изменить):
- `agents/delivery_agent/changelog.md` - добавить новую запись
- Git commit

**Промпт для нового чата** (Task Owner сгенерирует и даст тебе):
```
Ты [CYAN] Delivery Agent. Работаешь в изолированном контексте.

1. Прочитай agents/task_owner/current_task.md и agents/planning_agent/plan.md
2. Создай краткий changelog (что изменилось, зачем)
3. Добавь запись в agents/delivery_agent/changelog.md
4. Создай git commit с сообщением:

[Краткое название задачи]

[Описание изменений 2-3 предложения]

Основные изменения:
- [изменение 1]
- [изменение 2]
- [изменение 3]

Generated with AI Assistant

5. (Опционально) Обнови README.md если изменился функционал
```

**После завершения**: Задача готова!

---

## Заметки

[Любые дополнительные заметки, ссылки, идеи]
