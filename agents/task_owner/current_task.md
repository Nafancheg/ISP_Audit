# [PURPLE] Task Owner: TLS Fragment/Disorder — сверка плана с фактом и UX

## Проблема
**Краткое описание**: Пункт 2.6 TLS Fragment/Disorder в docs/phase2_plan.md не отражает фактический выполненный рефакторинг. Текущая реализация обхода не даёт ясного ответа пользователю «работает или нет» и «что делать», при этом UI перегружен карточками/логами и шумит при интенсивном тестировании (например, в браузере с несколькими вкладками).

**Как проявляется**:
- Документированная логика и статус 2.6 не соответствуют текущему коду/архитектуре.
- В обходе TLS нет чёткого пользовательского вердикта/next steps; интерфейс показывает много шума, грид карточек теряет информативность.
- Риск: критично для пользователя — непонятно, работает ли обход и как реагировать на сбои.

**Контекст**:
- Кто столкнётся: конечные пользователи (GUI) и поддержка.
- Критичность: CRITICAL.

## Желаемый результат (Definition of Done)
После выполнения:
1) Фактическая логика TLS Fragment/Disorder исследована и описана (архитектура, метрики, пресеты, автокоррекция), зафиксированы отклонения от целевой архитектуры.
2) docs/phase2_plan.md (пункт 2.6) обновлён и соответствует реальному состоянию/рефакторингу; при необходимости отражены отклонения в ARCHITECTURE_CURRENT.md и docs/full_repo_audit_v2.md.
3) Сформированы конкретные рекомендации по UI/UX для снижения шума и явного ответа пользователю «работает/не работает и что делать», без порчи уже работающего функционала.

Критерии приёмки:
- Есть список затронутых файлов/компонентов TLS bypass и описание текущей логики.
- Зафиксированы отклонения от плановой архитектуры и предложены шаги/варианты исправления.
- Пункт 2.6 в docs/phase2_plan.md обновлён под фактическое состояние; при необходимости отражены изменения в ARCHITECTURE_CURRENT.md и docs/full_repo_audit_v2.md.
- Есть набор UX-рекомендаций и метрик/сигналов, позволяющих пользователю понять статус обхода и действия при сбое.
- Подтверждена работоспособность по логам/метрикам на тестовой эксплуатации; учтён пользовательский фидбек по интерфейсу.

## Ограничения
**Технические**:
- .NET 9, WPF + MaterialDesign.
- Соблюдать async/await + CancellationToken, ConfigureAwait(false) в библиотечном коде/тестах.
- Архитектурные артефакты обновлять при изменении (ARCHITECTURE_CURRENT.md, docs/full_repo_audit_v2.md).
- Обратная совместимость: нет.

**Что НЕ делать**:
- Не ломать уже работающие сценарии обхода.
- Не упрощать UI ценой потери критичной информации для диагностики.

**Оценка**: MEDIUM (6–10 подзадач).

## Схема работы агентов
- [1] [RED] Research Agent: исследует код/логи/UI; создаёт agents/research_agent/findings.md.
- [2] [BLUE] Planning Agent: по findings формирует план в agents/planning_agent/plan.md (минимум подзадач, группировать по файлам).
- [3] [GREEN] Coding Agent: выполняет подзадачи из плана, не создаёт лишних файлов.
- [4] [YELLOW] QA Agent: проверяет критерии, dotnet build/run при необходимости; пишет agents/qa_agent/test_report.md.
- [5] [CYAN] Delivery Agent: changelog + git commit.

## [1] [RED] Research Agent
**Статус**: TODO

**Вход**: agents/task_owner/current_task.md

**Выход**: agents/research_agent/findings.md со структурой:
- Затронутые файлы: список + назначение.
- Текущая реализация: как работает TLS Fragment/Disorder сейчас (пресеты, метрики, автокоррекция, вердикты, UI связка, логи, RST ratio и т.д.).
- Риски и зависимости: что может сломаться, от чего зависит (профиль, UI, Metrics/Verdict, логирование, BypassController/TrafficEngine/TlsBypassService если есть).
- Рекомендации для Planning Agent: что учесть при правках (в т.ч. UX-шум, вердикт «работает/что делать», соответствие плану/архитектуре).

## [2] [BLUE] Planning Agent
**Статус**: TODO

**Вход**: current_task.md, findings.md

**Выход**: agents/planning_agent/plan.md — детальные подзадачи (1–2 файла на подзадачу, зависимости, риски, рекомендуемая модель), включить обновление документации (docs/phase2_plan.md п.2.6, при необходимости ARCHITECTURE_CURRENT.md, docs/full_repo_audit_v2.md) и UX-улучшения.

## [3] [GREEN] Coding Agent
**Статус**: TODO

**Задача**: выполнить подзадачу N из plan.md, править только указанные файлы, соблюдать async/await/ConfigureAwait(false), не ломать существующие сценарии обхода.

## [4] [YELLOW] QA Agent
**Статус**: TODO

**Задача**: проверить критерии приёмки (работоспособность обхода по логам/метрикам, обновлённая документация, UX-улучшения), dotnet build -c Debug; при GUI-изменениях — ручной прогон, тестовая эксплуатация, собрать фидбек; результат в agents/qa_agent/test_report.md.

## [5] [CYAN] Delivery Agent
**Статус**: TODO

**Задача**: обновить agents/delivery_agent/changelog.md, сделать git commit с итогами.

## Заметки
- Тестовая эксплуатация и пользовательский фидбек по UI — обязательная часть оценки.
- Особое внимание: шум карточек/логов при интенсивном трафике, явный ответ «работает/нет и что делать».
