<Application x:Class="IspAudit.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:IspAudit.Converters">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- Material Design Theme (переключается программно) -->
                <materialDesign:BundledTheme BaseTheme="Light" PrimaryColor="Blue" SecondaryColor="Cyan" />
                
                <!-- Material Design 3 Defaults -->
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesign3.Defaults.xaml" />
                <!-- Базовые стили контролов, чтобы гарантированно были ключи MaterialDesign* -->
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.TextBox.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Button.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.ToggleButton.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.ComboBox.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.RadioButton.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.DataGrid.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Converters -->
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
            <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
            <converters:EqualityConverter x:Key="EqualityConverter"/>
            <converters:StringToPackIconKindConverter x:Key="StringToPackIconKindConverter"/>

            <!-- Статусные цвета (фиксированные) -->
            <SolidColorBrush x:Key="PassBrush" Color="#4CAF50"/>
            <SolidColorBrush x:Key="FailBrush" Color="#F44336"/>
            <SolidColorBrush x:Key="WarnBrush" Color="#FF9800"/>
            <SolidColorBrush x:Key="IdleBrush" Color="#9E9E9E"/>
            <SolidColorBrush x:Key="RunningBrush" Color="#2196F3"/>

            <!-- 
                 Алиасы для совместимости со старым кодом.
                 ВАЖНО: MaterialDesignPaper, MaterialDesignBody и т.д. — это BRUSH-ы, а не Color!
                 Поэтому используем их напрямую через DynamicResource, без SolidColorBrush-обёртки.
            -->
            <!-- BgBrush и PanelBrush — фон окна/панелей -->
            <!-- TextBrush — основной текст -->
            <!-- MutedBrush — приглушённый текст -->
            <!-- BorderBrush — разделители -->
            <!-- PrimaryBrush — основной акцент -->
            
            <!-- Фиксированный светло-голубой для hover состояния -->
            <SolidColorBrush x:Key="Primary200" Color="#BBDEFB"/>

            <!-- Typography Styles (на базе MD) -->
            <Style x:Key="H1Style" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignHeadline4TextBlock}"/>

            <Style x:Key="H2Style" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignHeadline6TextBlock}"/>

            <Style x:Key="BodyStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignBody2TextBlock}"/>

            <Style x:Key="CaptionStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignCaptionTextBlock}"/>

            <!-- Алиасы кнопок для совместимости (используют стандартные MD стили) -->
            <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}"/>

            <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}"/>

            <!-- Safe Fallback for Icon Button -->
            <Style x:Key="ThemeToggleButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="4"/>
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource MaterialDesignSelection}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Card Style (используем MD Card через Border) -->
            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="#20000000" BlurRadius="8" ShadowDepth="2" Opacity="0.25"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- TextBox Style (MD Outlined) -->
            <Style x:Key="ModernTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignTextBox}">
                <Setter Property="materialDesign:HintAssist.IsFloating" Value="False"/>
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
                <Setter Property="CaretBrush" Value="{DynamicResource MaterialDesignBody}"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="Height" Value="Auto"/>
                <Setter Property="MinHeight" Value="42"/>
            </Style>

            <!-- 
                 Стиль Outlined ToggleButton для панели обхода блокировок
                 Аналог MaterialDesignOutlinedButton, но для ToggleButton
            -->
            <Style x:Key="BypassToggleButtonStyle" TargetType="ToggleButton">
                <Setter Property="Height" Value="40"/>
                <Setter Property="MinWidth" Value="110"/>
                <Setter Property="Margin" Value="2"/>
                <Setter Property="Padding" Value="16,0"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHueMidBrush}"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="materialDesign:RippleAssist.Feedback" Value="{DynamicResource PrimaryHueMidBrush}"/>
                <Setter Property="materialDesign:RippleAssist.RippleOnTop" Value="True"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToggleButton">
                            <Grid>
                                <Border x:Name="border"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        CornerRadius="4">
                                    <materialDesign:Ripple x:Name="ripple"
                                                           ContentTemplate="{TemplateBinding ContentTemplate}"
                                                           Content="{TemplateBinding Content}"
                                                           Padding="{TemplateBinding Padding}"
                                                           HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                           VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                                           Focusable="False"
                                                           SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                           Feedback="{TemplateBinding Foreground}"/>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <!-- Checked: голубой фон с тёмно-синим текстом -->
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#E3F2FD"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="#1976D2"/>
                                    <Setter Property="Foreground" Value="#1565C0"/>
                                    <Setter TargetName="ripple" Property="Feedback" Value="#1976D2"/>
                                </Trigger>
                                <!-- Hover (unchecked) -->
                                <MultiTrigger>
                                    <MultiTrigger.Conditions>
                                        <Condition Property="IsMouseOver" Value="True"/>
                                        <Condition Property="IsChecked" Value="False"/>
                                    </MultiTrigger.Conditions>
                                    <Setter TargetName="border" Property="Background" Value="#E3F2FD"/>
                                </MultiTrigger>
                                <!-- Hover (checked): более насыщенный голубой -->
                                <MultiTrigger>
                                    <MultiTrigger.Conditions>
                                        <Condition Property="IsMouseOver" Value="True"/>
                                        <Condition Property="IsChecked" Value="True"/>
                                    </MultiTrigger.Conditions>
                                    <Setter TargetName="border" Property="Background" Value="#BBDEFB"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryHueDarkBrush}"/>
                                    <Setter Property="Foreground" Value="#0D47A1"/>
                                </MultiTrigger>
                                <!-- Disabled -->
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Opacity" Value="0.38"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ComboBox Style (MD Outlined) -->
            <Style x:Key="ModernComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource MaterialDesignComboBox}"/>

            <!-- RadioButton Toggle Style -->
            <Style x:Key="ToggleRadioButtonStyle" TargetType="RadioButton" BasedOn="{StaticResource MaterialDesignRadioButton}"/>
        </ResourceDictionary>
    </Application.Resources>
</Application>
