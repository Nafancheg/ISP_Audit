<Window x:Class="IspAudit.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:IspAudit.Controls"
        xmlns:vm="clr-namespace:IspAudit.ViewModels"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="ISP Audit - Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° ÑÐµÑ‚Ð¸"
        Height="800" Width="1400"
        MinHeight="600" MinWidth="1200"
        WindowStartupLocation="Manual"
        Loaded="Window_Loaded"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="14"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto">

    <Window.DataContext>
        <vm:MainViewModelRefactored/>
    </Window.DataContext>

    <Window.Resources>
        <ContextMenu x:Key="RowContextMenu">
            <MenuItem Header="ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Host" Click="CopyHost_Click"/>
            <MenuItem Header="ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Fallback IP" Click="CopyFallbackIp_Click"
                      Visibility="{Binding Target.FallbackIp, Converter={StaticResource StringToVisibilityConverter}}"/>
        </ContextMenu>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="480" MinWidth="450"/>
            <ColumnDefinition Width="8"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT PANEL: Controls -->
        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="16">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel>
                    <!-- Scenario Selector - ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ -->
                    <Grid Margin="0,0,0,12">
                        <TextBlock Text="ðŸŽ® Ð—Ð°Ð¿ÑƒÑÐº Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸" Style="{StaticResource H2Style}" VerticalAlignment="Center"/>
                        <Button Style="{StaticResource ThemeToggleButtonStyle}"
                                Command="{Binding ToggleThemeCommand}"
                                HorizontalAlignment="Right"
                                ToolTip="ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ"
                                Height="24" Width="24">
                            <materialDesign:PackIcon Kind="ThemeLightDark" Width="20" Height="20"/>
                        </Button>
                    </Grid>
                    
                    <TextBox Style="{StaticResource ModernTextBoxStyle}" 
                             Text="{Binding ExePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             IsEnabled="{Binding IsBasicTestMode, Converter={StaticResource InverseBoolConverter}}"
                             Margin="0,0,0,8" Height="36"
                             materialDesign:HintAssist.Hint="ÐŸÑƒÑ‚ÑŒ Ðº exe Ñ„Ð°Ð¹Ð»Ñƒ Ð¸Ð³Ñ€Ñ‹ Ð¸Ð»Ð¸ Ð»Ð°ÑƒÐ½Ñ‡ÐµÑ€Ð°"
                             ToolTip="ÐŸÑƒÑ‚ÑŒ Ðº exe Ñ„Ð°Ð¹Ð»Ñƒ Ð¸Ð³Ñ€Ñ‹ Ð¸Ð»Ð¸ Ð»Ð°ÑƒÐ½Ñ‡ÐµÑ€Ð°"/>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0" Content="ÐžÐ±Ð·Ð¾Ñ€..." 
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding BrowseExeCommand}"
                                IsEnabled="{Binding IsBasicTestMode, Converter={StaticResource InverseBoolConverter}}"
                                Margin="0,0,8,0" Height="36"/>
                        
                        <Button Grid.Column="1"
                                Content="{Binding StartButtonText}" 
                                Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding StartLiveTestingCommand}"
                                Height="36" MinWidth="100"/>
                    </Grid>

                    <!-- Checkboxes - ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¾ -->
                    <StackPanel Margin="0,0,0,16">
                        <CheckBox Content="Ð¢ÐµÑÑ‚ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² (Google, YouTube, Discord)"
                                  IsChecked="{Binding IsBasicTestMode}"
                                  IsEnabled="{Binding IsStart}"
                                  Margin="0,0,0,4" FontSize="12"/>
                        <CheckBox Content="Ð‘ÐµÐ· Ð»Ð¸Ð¼Ð¸Ñ‚Ð° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸"
                                  IsChecked="{Binding IsUnlimitedTime}"
                                  IsEnabled="{Binding IsStart}"
                                  Margin="0,0,0,4" FontSize="12"/>
                        <CheckBox Content="Ð§Ð¸ÑÑ‚Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ (Ð±ÐµÐ· Ð¾Ð±Ñ…Ð¾Ð´Ð°)"
                                  IsChecked="{Binding EnableAutoBypass, Converter={StaticResource InverseBoolConverter}}"
                                  IsEnabled="{Binding IsStart}"
                                  Margin="0,0,0,4" FontSize="12"/>
                        <CheckBox Content="Ð ÐµÐ¶Ð¸Ð¼ Steam"
                                  IsChecked="{Binding IsSteamMode}"
                                  IsEnabled="{Binding IsStart}"
                                  FontSize="12"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,16"/>

                    <!-- Bypass Control - Ð’ÐºÐ»Ð°Ð´ÐºÐ¸ Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð´Ð½Ð¾Ð¹ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸ -->
                    <Border Background="{DynamicResource MaterialDesignPaper}" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1" CornerRadius="8" 
                            Padding="12"
                            Visibility="{Binding ShowBypassPanel, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <!-- Header -->
                            <Grid Margin="0,0,0,8">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Tune" Width="20" Height="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Bypass Control" FontWeight="Bold" FontSize="13" VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <!-- Status Badge -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Border Background="#DCFCE7" CornerRadius="4" Padding="6,2"
                                            Visibility="{Binding IsBypassActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="{Binding CurrentBypassStrategy}" FontWeight="SemiBold" FontSize="10" Foreground="#166534"/>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <!-- Recommendations -->
                            <Border Background="#EBF5FF" BorderBrush="#BFDBFE" BorderThickness="1" CornerRadius="4"
                                    Padding="10" Margin="0,0,0,8"
                                    Visibility="{Binding HasRecommendations, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <materialDesign:PackIcon Kind="LightbulbOutline" Width="16" Height="16" Margin="0,0,6,0" Foreground="#1E40AF"/>
                                        <TextBlock Text="Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸" FontWeight="SemiBold" FontSize="14" Foreground="#1E40AF"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding RecommendedStrategiesText}" FontSize="13" TextWrapping="Wrap" Margin="0,0,0,6"/>
                                    <Button Content="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ" Command="{Binding ApplyRecommendationsCommand}"
                                            Style="{StaticResource PrimaryButtonStyle}" Padding="12,6" FontSize="13" HorizontalAlignment="Left" Height="32"/>
                                </StackPanel>
                            </Border>

                            <!-- Tabs for Bypass Options -->
                            <TabControl Margin="0,0,0,8">
                                <TabItem Header="Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð² Ð´Ð²Ðµ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ -->
                                        <UniformGrid Columns="2" Rows="3" HorizontalAlignment="Stretch">
                                            <ToggleButton IsChecked="{Binding IsFragmentEnabled, Mode=TwoWay}"
                                                          Content="TLS Fragment"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="TLS Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ ClientHello"
                                                          Margin="0,0,4,4"/>

                                            <ToggleButton IsChecked="{Binding IsDisorderEnabled, Mode=TwoWay}"
                                                          Content="TLS Disorder"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ñ‹ Ð² Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ"
                                                          Margin="4,0,0,4"/>

                                            <ToggleButton IsChecked="{Binding IsFakeEnabled, Mode=TwoWay}"
                                                          Content="TLS Fake"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Fake TTL Ð¿Ð°ÐºÐµÑ‚"
                                                          Margin="0,0,4,4"/>

                                            <ToggleButton IsChecked="{Binding IsDropRstEnabled, Mode=TwoWay}"
                                                          Content="Drop RST"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° TCP RST Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²"
                                                          Margin="4,0,0,4"/>

                                            <ToggleButton IsChecked="{Binding IsDoHEnabled, Mode=TwoWay}"
                                                          Content="ðŸ”’ DoH"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="DNS-over-HTTPS (ÐŸÐšÐœ Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð°)"
                                                          Margin="0,0,4,0">
                                                <ToggleButton.ContextMenu>
                                                    <ContextMenu ItemsSource="{Binding Bypass.AvailableDnsPresets}">
                                                        <ContextMenu.ItemContainerStyle>
                                                            <Style TargetType="MenuItem">
                                                                <Setter Property="Header" Value="{Binding}"/>
                                                                <Setter Property="Command" Value="{Binding DataContext.Bypass.SetDnsPresetCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                                <Setter Property="CommandParameter" Value="{Binding}"/>
                                                            </Style>
                                                        </ContextMenu.ItemContainerStyle>
                                                    </ContextMenu>
                                                </ToggleButton.ContextMenu>
                                            </ToggleButton>

                                            <Button Command="{Binding DisableAllBypassCommand}" Height="36" FontSize="12" Margin="4,0,0,0"
                                                    ToolTip="ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÑ‘">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                                        <Setter Property="Content" Value="âœ• Ð’Ñ‹ÐºÐ»"/>
                                                        <Setter Property="Background" Value="#FEE2E2"/>
                                                        <Setter Property="Foreground" Value="#DC2626"/>
                                                        <Setter Property="BorderBrush" Value="#FECACA"/>
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#FECACA"/>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </UniformGrid>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <TextBlock Text="ÐŸÑ€ÐµÑÐµÑ‚ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,4"/>
                                        <ComboBox ItemsSource="{Binding FragmentPresets}"
                                                  SelectedItem="{Binding SelectedFragmentPreset, Mode=TwoWay}"
                                                  DisplayMemberPath="Name"
                                                  Style="{StaticResource ModernComboBoxStyle}"
                                                  Height="36" FontSize="13"/>
                                        <TextBlock Text="{Binding SelectedFragmentPresetLabel}" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,4,0,0"/>
                                        
                                        <CheckBox Content="ÐÐ²Ñ‚Ð¾ÐºÐ¾Ñ€Ñ€ÐµÐºÑ†Ð¸Ñ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ñ€ÐµÑÐµÑ‚Ð°" Margin="0,12,0,0" FontSize="13"
                                                  IsChecked="{Binding IsAutoAdjustAggressive}"
                                                  ToolTip="Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð´ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¾Ð²"/>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <Border Background="{Binding BypassVerdictBrush}" CornerRadius="4" Padding="10">
                                            <StackPanel>
                                                <TextBlock Text="âš¡ ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,6"/>
                                                <TextBlock Text="{Binding TrafficEngineLatencyText}" FontSize="12" Margin="0,0,0,4"/>
                                                
                                                <TextBlock Text="ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° bypass" FontWeight="SemiBold" FontSize="13" Margin="0,8,0,6"/>
                                                <TextBlock Text="{Binding BypassMetricsText}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,4"/>
                                                <TextBlock Text="{Binding BypassVerdictText}" FontSize="12" FontWeight="SemiBold" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </TabItem>
                            </TabControl>
                        </StackPanel>
                    </Border>

                    <!-- Running Status - ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ -->
                    <Border Background="#EFF6FF" BorderBrush="#BFDBFE" BorderThickness="1" CornerRadius="6" 
                            Padding="12,10" Margin="0,16,0,0"
                            Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="âš™ï¸ Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ..." FontWeight="Bold" FontSize="14" Margin="0,0,0,6"/>
                            <TextBlock Text="{Binding CurrentAction}" FontSize="13" Foreground="#4B5563" TextWrapping="Wrap" Margin="0,0,0,6"/>
                            <ProgressBar IsIndeterminate="True" Height="3" BorderThickness="0"/>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="{Binding ConnectionsDiscovered, StringFormat='Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹: {0}'}" FontSize="12" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding FlowEventsCount, StringFormat='Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ: {0}'}" FontSize="12"/>
                            </StackPanel>

                            <Border Background="{Binding AutoBypassStatusBrush}" CornerRadius="4" Padding="8" Margin="0,8,0,0"
                                    Visibility="{Binding AutoBypassStatus, Converter={StaticResource StringToVisibilityConverter}}">
                                <TextBlock Text="{Binding AutoBypassStatus}" FontSize="12" FontWeight="SemiBold" TextWrapping="Wrap"/>
                            </Border>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1" Width="8" HorizontalAlignment="Stretch" Background="Transparent"/>

        <!-- RIGHT PANEL: Results -->
        <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- VPN Warning Banner -->
                <Border Grid.Row="0" Background="#FEF3C7" BorderBrush="#FCD34D" BorderThickness="0,0,0,1"
                        Padding="16,10"
                        Visibility="{Binding IsVpnDetected, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Alert" Width="20" Height="20" Margin="0,0,8,0" Foreground="#92400E" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding VpnWarningText}" FontSize="13" Foreground="#92400E" TextWrapping="Wrap" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Start State -->
                <StackPanel Grid.Row="1" Grid.RowSpan="2"
                            Visibility="{Binding IsStart, Converter={StaticResource BoolToVisibilityConverter}}"
                            VerticalAlignment="Center" HorizontalAlignment="Center" Margin="16">
                    <materialDesign:PackIcon Kind="ChartBar" Width="48" Height="48" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,0,0,16"/>
                    <TextBlock Text="ðŸ“Š Ð“Ð¾Ñ‚Ð¾Ð² Ðº Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐµ" Style="{StaticResource H2Style}" 
                               Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                    <TextBlock Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ 'ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ'" 
                               Style="{StaticResource BodyStyle}" Foreground="{DynamicResource MaterialDesignBodyLight}"
                               TextAlignment="Center" Margin="0,8,0,0"/>
                </StackPanel>

                <!-- Results Header -->
                <Grid Grid.Row="1" Margin="16,16,16,8"
                      Visibility="{Binding IsStart, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‹ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ" Style="{StaticResource H2Style}"/>
                        <Border Background="#DCFCE7" CornerRadius="4" Padding="6,2" Margin="12,0,0,0" VerticalAlignment="Center"
                                Visibility="{Binding IsBypassActive, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="ðŸ›¡ï¸ Bypass Active" Foreground="#166534" FontWeight="SemiBold" FontSize="11"/>
                        </Border>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                Visibility="{Binding IsDone, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Button Content="ðŸ“„ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚" Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding ReportCommand}" Margin="0,0,8,0" Padding="10,4" FontSize="12"/>
                        <Button Content="ðŸ”„ ÐÐ¾Ð²Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°" Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding SetStateCommand}" CommandParameter="start" Padding="10,4" FontSize="12"/>
                    </StackPanel>
                </Grid>

                <!-- DataGrid -->
                <DataGrid Grid.Row="2" x:Name="ResultsGrid"
                          ItemsSource="{Binding TestResults}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeRows="False"
                          IsReadOnly="True"
                          SelectionMode="Extended"
                          SelectionUnit="FullRow"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="{DynamicResource MaterialDesignDivider}"
                          Background="{DynamicResource MaterialDesignPaper}"
                          BorderThickness="0"
                          RowBackground="{DynamicResource MaterialDesignPaper}"
                          AlternatingRowBackground="{DynamicResource MaterialDesignPaper}"
                          FontSize="13"
                          Visibility="{Binding IsStart, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                    <DataGrid.Resources>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="{DynamicResource Primary200}"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>

                        <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                            <Setter Property="Padding" Value="8,6"/>
                            <Setter Property="Background" Value="{DynamicResource MaterialDesignPaper}"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </Style>

                        <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                            <Setter Property="MinHeight" Value="36"/>
                            <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick"/>
                            <Setter Property="ContextMenu" Value="{StaticResource RowContextMenu}"/>
                        </Style>

                        <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                            <Setter Property="Padding" Value="8,4"/>
                            <Setter Property="BorderThickness" Value="0"/>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Ð¡ÐµÑ€Ð²Ð¸Ñ" Binding="{Binding Target.Name}" Width="1.2*" FontWeight="SemiBold"/>
                        <DataGridTextColumn Header="Ð¥Ð¾ÑÑ‚ / IP" Binding="{Binding Target.Host}" Width="1*"/>
                        
                        <DataGridTemplateColumn Header="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ" Width="0.8*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <local:StatusDot Status="{Binding Status}" Margin="0,0,6,0"/>
                                        <TextBlock Text="{Binding StatusText}" FontWeight="Medium" FontSize="12"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <DataGridTextColumn Header="Ð”ÐµÑ‚Ð°Ð»Ð¸" Binding="{Binding Details}" Width="2*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="TextWrapping" Value="Wrap"/>
                                    <Setter Property="FontSize" Value="11"/>
                                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        
                        <DataGridTextColumn Header="Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ" Binding="{Binding BypassStrategy}" Width="1*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Setter Property="FontSize" Value="11"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Footer -->
                <Border Grid.Row="3" Background="{DynamicResource MaterialDesignPaper}" Padding="12,8" Margin="0,8,0,0" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="InformationOutline" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding UserMessage}" FontWeight="Medium" Foreground="{DynamicResource MaterialDesignBody}" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
