<Window x:Class="IspAudit.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:IspAudit"
        Title="ISP Audit для Star Citizen"
        Height="600" Width="800"
        MinHeight="500" MinWidth="700"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{materialDesign:MaterialDesignFont}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}">

    <Window.Resources>
        <local:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </Window.Resources>

    <materialDesign:DialogHost>
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок -->
            <TextBlock Grid.Row="0"
                       Text="ISP Audit"
                       Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                       Margin="0,0,0,12"/>

            <!-- Вердикт под заголовком -->
            <TextBlock Grid.Row="1"
                       x:Name="PlayableText"
                       Text="Играбельно: —"
                       Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                       Margin="0,0,0,8"/>

            <!-- Информация о профиле и смена профиля -->
            <Grid Grid.Row="2" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0"
                           Text="Профиль:"
                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox Grid.Column="1"
                          x:Name="ProfileComboBox"
                          Width="150"
                          Margin="0,0,8,0"
                          materialDesign:HintAssist.Hint="Выберите профиль"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                          SelectionChanged="ProfileComboBox_SelectionChanged"/>
                <Button Grid.Column="2"
                        x:Name="ApplyProfileButton"
                        Content="Применить"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Click="ApplyProfileButton_Click"
                        IsEnabled="False"
                        Margin="0,0,16,0"/>
                <TextBlock Grid.Column="4"
                           x:Name="ProfileNameText"
                           Text="Активный профиль: Не загружен"
                           Style="{StaticResource MaterialDesignCaptionTextBlock}"
                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"/>
            </Grid>

            <!-- Поля профиля (временно отключены) -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,12">
                <TextBox x:Name="TestHostTextBox"
                         materialDesign:HintAssist.Hint="Тест хоста"
                         IsEnabled="False"
                         Width="200"
                         Margin="0,0,8,0"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                <TextBox x:Name="GameExeTextBox"
                         materialDesign:HintAssist.Hint="EXE файл игры"
                         IsEnabled="False"
                         Width="300"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
            </StackPanel>

            <!-- VPN Information Banner -->
            <materialDesign:Card x:Name="VpnInfoCard"
                                 Grid.Row="4"
                                 Margin="0,0,0,12"
                                 Visibility="Collapsed"
                                 Background="#E3F2FD"
                                 Padding="12">
                <StackPanel Margin="12,4">
                    <TextBlock Text="ℹ VPN обнаружен"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="#1976D2"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="Тестирование адаптировано для работы через VPN. Увеличены таймауты и смягчены критерии для DNS-проверок."
                               FontSize="12"
                               TextWrapping="Wrap"
                               Foreground="#424242"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка с предупреждением (показывается при проблемах) -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="12"
                                 Margin="0,0,0,12"
                                 x:Name="WarningCard"
                                 Visibility="Collapsed"
                                 Background="#F44336">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                        <materialDesign:PackIcon Kind="AlertCircle"
                                                Foreground="White"
                                                Width="20" Height="20"
                                                Margin="0,0,6,0"/>
                        <TextBlock Text="Обнаружены проблемы с подключением"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="14"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="WarningText"
                              Text=""
                              Foreground="White"
                              TextWrapping="Wrap"
                              FontSize="13"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка с успехом (показывается при успехе) -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="12"
                                 Margin="0,0,0,12"
                                 x:Name="SuccessCard"
                                 Visibility="Collapsed"
                                 Background="#4CAF50">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="CheckCircle"
                                            Foreground="White"
                                            Width="20" Height="20"
                                            Margin="0,0,6,0"/>
                    <TextBlock Text="Всё работает! Star Citizen готов к запуску"
                              Foreground="White"
                              FontWeight="Bold"
                              FontSize="14"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка Firewall проблемы -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="12"
                                 Margin="0,0,0,12"
                                 x:Name="FirewallCard"
                                 Visibility="Collapsed"
                                 Background="#FF9800">
                <StackPanel Margin="12,4">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <materialDesign:PackIcon Kind="Shield"
                                                Foreground="White"
                                                Width="20" Height="20"
                                                Margin="0,0,6,0"/>
                        <TextBlock Text="Проблемы с Firewall"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="14"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="FirewallText"
                              Text=""
                              Foreground="White"
                              TextWrapping="Wrap"
                              FontSize="12"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка ISP проблемы -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="12"
                                 Margin="0,0,0,12"
                                 x:Name="IspCard"
                                 Visibility="Collapsed"
                                 Background="#FF5722">
                <StackPanel Margin="12,4">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <materialDesign:PackIcon Kind="Web"
                                                Foreground="White"
                                                Width="20" Height="20"
                                                Margin="0,0,6,0"/>
                        <TextBlock Text="Проблемы с провайдером (ISP)"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="14"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="IspText"
                              Text=""
                              Foreground="White"
                              TextWrapping="Wrap"
                              FontSize="12"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка Router проблемы -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="12"
                                 Margin="0,0,0,12"
                                 x:Name="RouterCard"
                                 Visibility="Collapsed"
                                 Background="#FF9800">
                <StackPanel Margin="12,4">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <materialDesign:PackIcon Kind="Router"
                                                Foreground="White"
                                                Width="20" Height="20"
                                                Margin="0,0,6,0"/>
                        <TextBlock Text="Проблемы с роутером"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="14"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="RouterText"
                              Text=""
                              Foreground="White"
                              TextWrapping="Wrap"
                              FontSize="12"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка Software проблемы -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="12"
                                 Margin="0,0,0,12"
                                 x:Name="SoftwareCard"
                                 Visibility="Collapsed"
                                 Background="#9C27B0">
                <StackPanel Margin="12,4">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <materialDesign:PackIcon Kind="Application"
                                                Foreground="White"
                                                Width="20" Height="20"
                                                Margin="0,0,6,0"/>
                        <TextBlock Text="Конфликты ПО"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="14"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="SoftwareText"
                              Text=""
                              Foreground="White"
                              TextWrapping="Wrap"
                              FontSize="12"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Карточка Итоговый вердикт -->
            <materialDesign:Card Grid.Row="5"
                                 Padding="16"
                                 Margin="0,0,0,12"
                                 x:Name="VerdictCard"
                                 Visibility="Collapsed"
                                 Background="#2196F3">
                <StackPanel Margin="12,4">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <materialDesign:PackIcon Kind="Information"
                                                Foreground="White"
                                                Width="24" Height="24"
                                                Margin="0,0,8,0"/>
                        <TextBlock Text="Итоговый вердикт"
                                  Foreground="White"
                                  FontWeight="Bold"
                                  FontSize="16"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="VerdictText"
                              Text=""
                              Foreground="White"
                              TextWrapping="Wrap"
                              FontSize="13"
                              LineHeight="20"
                              FontFamily="Segoe UI"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Кнопки DNS Fix/Reset -->
            <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,12,0,12" HorizontalAlignment="Left">
                <Button x:Name="FixDnsButton"
                        Content="🔧 ИСПРАВИТЬ DNS"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Height="40"
                        FontSize="14"
                        Padding="16,0"
                        Click="FixDnsButton_Click"
                        Visibility="Collapsed"
                        materialDesign:ButtonAssist.CornerRadius="4"
                        Background="#FF9800"
                        Foreground="White"
                        Margin="0,0,12,0"/>
                <Button x:Name="ResetDnsButton"
                        Content="↩️ ВЕРНУТЬ DNS"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Height="40"
                        FontSize="14"
                        Padding="16,0"
                        Click="ResetDnsButton_Click"
                        Visibility="Collapsed"
                        materialDesign:ButtonAssist.CornerRadius="4"
                        Background="#757575"
                        Foreground="White"/>
            </StackPanel>

            <!-- Основная кнопка действия -->

            <!-- Кнопка запуска проверки -->
                        <Grid Grid.Row="5" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button Grid.Column="0"
                        x:Name="RunButton"
                        Content="���������"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Height="42"
                        FontSize="15"
                        FontWeight="Bold"
                        Click="RunButton_Click"
                        materialDesign:ButtonAssist.CornerRadius="4"
                        Background="#2196F3"
                        Foreground="White"
                        Margin="0,0,8,0">
                    <Button.Effect>
                        <DropShadowEffect Color="#2196F3"
                                         BlurRadius="8"
                                         ShadowDepth="2"
                                         Opacity="0.25"/>
                    </Button.Effect>
                </Button>
                <Button Grid.Column="1"
                        x:Name="SaveButton"
                        Content="СОХРАНИТЬ ОТЧЁТ"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Height="42"
                        FontSize="13"
                        Click="SaveReport_Click"
                        IsEnabled="False"
                        materialDesign:ButtonAssist.CornerRadius="4"/>
            </Grid>

            <!-- Список сервисов -->
            <materialDesign:Card Grid.Row="6" Padding="12">
                <DockPanel>
                    <TextBlock Text="Проверка сервисов Star Citizen"
                              Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                              DockPanel.Dock="Top"
                              Margin="0,0,0,12"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="ServicesPanel">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="{DynamicResource MaterialDesignDivider}"
                                           BorderThickness="0,0,0,1"
                                           Padding="6"
                                           Margin="0,2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding ServiceName}"
                                                          FontWeight="SemiBold"
                                                          FontSize="13"/>
                                                <TextBlock Text="{Binding Details}"
                                                          Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                          FontSize="12"
                                                          Margin="0,2,0,0"/>
                                                <TextBlock Text="{Binding DetailedMessage}"
                                                          FontSize="11"
                                                          Foreground="#616161"
                                                          TextWrapping="Wrap"
                                                          Margin="0,4,0,0"
                                                          Visibility="{Binding DetailedMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1"
                                                       Orientation="Horizontal"
                                                       VerticalAlignment="Center">
                                                <!-- Прогресс-индикатор -->
                                                <ProgressBar Width="20" Height="20"
                                                            Margin="0,0,6,0"
                                                            IsIndeterminate="True"
                                                            Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                            Visibility="{Binding RunningVisibility}"/>

                                                <!-- Иконка статуса -->
                                                <materialDesign:PackIcon Kind="{Binding StatusIcon}"
                                                                        Width="20" Height="20"
                                                                        Foreground="{Binding StatusColor}"
                                                                        Visibility="{Binding CompletedVisibility}"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </materialDesign:Card>

            <!-- Прогресс-бар и статус -->
            <StackPanel Grid.Row="7" Margin="0,12,0,0">
                <ProgressBar x:Name="ProgressBar"
                            Height="4"
                            Minimum="0"
                            Maximum="100"
                            Value="0"
                            materialDesign:TransitionAssist.DisableTransitions="False"/>
                <TextBlock x:Name="StatusText"
                          Text="Готов к проверке"
                          Margin="0,6,0,0"
                          FontSize="12"
                          Foreground="{DynamicResource MaterialDesignBodyLight}"/>
            </StackPanel>
        </Grid>
    </materialDesign:DialogHost>
</Window>

