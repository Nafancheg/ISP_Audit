<Window x:Class="IspAudit.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:IspAudit.Controls"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="ISP Audit - Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° ÑÐµÑ‚Ð¸"
        Height="800" Width="1400"
        MinHeight="600" MinWidth="1200"
        WindowStartupLocation="Manual"
        Loaded="Window_Loaded"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="14"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto">

    <Window.Resources>
        <ContextMenu x:Key="RowContextMenu">
            <MenuItem Header="ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Host" Click="CopyHost_Click"/>
            <MenuItem Header="ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Fallback IP" Click="CopyFallbackIp_Click"
                      Visibility="{Binding Target.FallbackIp, Converter={StaticResource StringToVisibilityConverter}}"/>
            <Separator/>
            <MenuItem Header="ðŸ“Œ Ð—Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ/Ð¾Ñ‚ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð´Ð¾Ð¼ÐµÐ½" Click="TogglePinDomain_Click"
                      ToolTip="ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð·Ð°ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ðµ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð³Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ð° Ð´Ð»Ñ ÑÑ‚Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ (ÑƒÑÐºÐ¾Ñ€ÑÐµÑ‚ auto-suggest Ð´Ð¾Ð¼ÐµÐ½Ð½Ñ‹Ñ… ÑÐµÐ¼ÐµÐ¹ÑÑ‚Ð²)."/>
        </ContextMenu>
    </Window.Resources>

    <materialDesign:DrawerHost Margin="12"
                              OpenMode="Standard"
                              IsLeftDrawerOpen="{Binding IsLeftPanelOpen, Mode=TwoWay}">
        <materialDesign:DrawerHost.LeftDrawerContent>
            <!-- LEFT PANEL: Controls (Drawer) -->
            <Border Style="{StaticResource CardStyle}" Padding="16" Width="480" MinWidth="450">
                <ScrollViewer VerticalScrollBarVisibility="Hidden" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel>
                    <!-- Scenario Selector - ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ -->
                    <Grid Margin="0,0,0,12">
                        <TextBlock Text="ðŸŽ® Ð—Ð°Ð¿ÑƒÑÐº Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸" Style="{StaticResource H2Style}" VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="â† ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Click="ReturnToOperator_Click"
                                    ToolTip="Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ÑÐºÐ¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼"
                                    Height="24" Padding="10,0" Margin="0,0,6,0"/>
                            <ToggleButton IsChecked="{Binding IsLeftPanelPinned, Mode=TwoWay}"
                                          Width="24" Height="24" Margin="0,0,6,0"
                                          ToolTip="Ð—Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð»ÐµÐ²ÑƒÑŽ Ð¿Ð°Ð½ÐµÐ»ÑŒ (PIN)"
                                          Background="Transparent"
                                          BorderBrush="Transparent"
                                          BorderThickness="0"
                                          Padding="4">
                                <TextBlock Text="ðŸ“Œ" FontSize="14" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </ToggleButton>
                            <Button Style="{StaticResource ThemeToggleButtonStyle}"
                                    Command="{Binding ToggleThemeCommand}"
                                    ToolTip="ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ"
                                    Height="24" Width="24">
                                <materialDesign:PackIcon Kind="ThemeLightDark" Width="20" Height="20"/>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <TextBox Style="{StaticResource ModernTextBoxStyle}"
                             Text="{Binding ExePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             IsEnabled="{Binding IsBasicTestMode, Converter={StaticResource InverseBoolConverter}}"
                             Margin="0,0,0,8" Height="36"
                             materialDesign:HintAssist.Hint="ÐŸÑƒÑ‚ÑŒ Ðº exe Ñ„Ð°Ð¹Ð»Ñƒ Ð¸Ð³Ñ€Ñ‹ Ð¸Ð»Ð¸ Ð»Ð°ÑƒÐ½Ñ‡ÐµÑ€Ð°"
                             ToolTip="ÐŸÑƒÑ‚ÑŒ Ðº exe Ñ„Ð°Ð¹Ð»Ñƒ Ð¸Ð³Ñ€Ñ‹ Ð¸Ð»Ð¸ Ð»Ð°ÑƒÐ½Ñ‡ÐµÑ€Ð°"/>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0" Content="ÐžÐ±Ð·Ð¾Ñ€..."
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding BrowseExeCommand}"
                                IsEnabled="{Binding IsBasicTestMode, Converter={StaticResource InverseBoolConverter}}"
                                Margin="0,0,8,0" Height="36"/>

                        <Button Grid.Column="1"
                                Content="{Binding StartButtonText}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding StartLiveTestingCommand}"
                                Height="36" MinWidth="100"/>
                    </Grid>

                    <!-- Checkboxes - ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¾ -->
                    <StackPanel Margin="0,0,0,16">
                        <CheckBox Content="Ð¢ÐµÑÑ‚ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² (Google, YouTube, Discord)"
                                  IsChecked="{Binding IsBasicTestMode}"
                                  IsEnabled="{Binding IsStart}"
                                  Margin="0,0,0,4" FontSize="12"/>
                        <CheckBox Content="Ð‘ÐµÐ· Ð»Ð¸Ð¼Ð¸Ñ‚Ð° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸"
                                  IsChecked="{Binding IsUnlimitedTime}"
                                  IsEnabled="{Binding IsStart}"
                                  Margin="0,0,0,4" FontSize="12"/>
                        <CheckBox Content="Ð§Ð¸ÑÑ‚Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ (Ð±ÐµÐ· Ð¾Ð±Ñ…Ð¾Ð´Ð°)"
                                  IsChecked="{Binding EnableAutoBypass, Converter={StaticResource InverseBoolConverter}}"
                                  IsEnabled="{Binding IsStart}"
                                  Margin="0,0,0,4" FontSize="12"/>
                        <CheckBox Content="Ð ÐµÐ¶Ð¸Ð¼ Steam"
                                  IsChecked="{Binding IsSteamMode}"
                                  IsEnabled="{Binding IsStart}"
                                  FontSize="12"/>
                    </StackPanel>

                    <Separator Margin="0,0,0,16"/>

                    <!-- P1.4: Post-crash Ð´Ð¸Ð°Ð³Ð½Ð¾Ð·Ñ‹ (crash-reports) -->
                    <Border Background="{DynamicResource MaterialDesignPaper}" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1" CornerRadius="4"
                            Padding="10" Margin="0,0,0,16"
                            Visibility="{Binding IsCrashReportsPromptVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                <materialDesign:PackIcon Kind="AlertCircleOutline" Width="16" Height="16" Margin="0,0,6,0"/>
                                <TextBlock Text="ÐžÑ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð¾ Ð¿Ð°Ð´ÐµÐ½Ð¸Ð¸" FontWeight="SemiBold" FontSize="14"/>
                            </StackPanel>

                            <TextBlock Text="{Binding CrashReportsPromptText}" FontSize="13" TextWrapping="Wrap" Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <Button Content="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð°Ð¿ÐºÑƒ" Command="{Binding CrashReportsOpenFolderCommand}"
                                        Style="{StaticResource PrimaryButtonStyle}" Padding="12,6" FontSize="13" Height="32" Margin="0,0,6,0"/>
                                <Button Content="Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ" Command="{Binding CrashReportsDismissCommand}"
                                        Style="{StaticResource SecondaryButtonStyle}" Padding="12,6" FontSize="13" Height="32"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Bypass Control - Ð’ÐºÐ»Ð°Ð´ÐºÐ¸ Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð´Ð½Ð¾Ð¹ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¿Ð°Ð½ÐµÐ»Ð¸ -->
                    <Border Background="{DynamicResource MaterialDesignPaper}" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1" CornerRadius="8"
                            Padding="12"
                            Visibility="{Binding ShowBypassPanel, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <!-- Header -->
                            <Grid Margin="0,0,0,8">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Tune" Width="20" Height="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Bypass Control" FontWeight="Bold" FontSize="13" VerticalAlignment="Center"/>
                                    </StackPanel>

                                    <TextBlock Text="{Binding BypassSemanticGroupsSummaryText}" FontSize="11" TextWrapping="Wrap" Margin="28,2,0,0"
                                               Foreground="{DynamicResource MaterialDesignBodyLight}"
                                               Visibility="{Binding BypassSemanticGroupsSummaryText, Converter={StaticResource StringToVisibilityConverter}}"/>
                                </StackPanel>

                                <!-- Status Badge -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Border Background="#DCFCE7" CornerRadius="4" Padding="6,2"
                                            Visibility="{Binding IsBypassActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="{Binding CurrentBypassStrategy}" FontWeight="SemiBold" FontSize="10" Foreground="#166534"/>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <!-- P0.6: Ð¡Ð¼ÐµÐ½Ð° ÑÐµÑ‚Ð¸ â†’ staged revalidation (Ð±ÐµÐ· Ð°Ð²Ñ‚Ð¾Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ) -->
                            <Border Background="{DynamicResource MaterialDesignPaper}" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1" CornerRadius="4"
                                    Padding="10" Margin="0,0,0,8"
                                    Visibility="{Binding IsNetworkChangePromptVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <materialDesign:PackIcon Kind="Tune" Width="16" Height="16" Margin="0,0,6,0"/>
                                        <TextBlock Text="Ð¡Ð¼ÐµÐ½Ð° ÑÐµÑ‚Ð¸" FontWeight="SemiBold" FontSize="14"/>
                                    </StackPanel>

                                    <TextBlock Text="{Binding NetworkChangePromptText}" FontSize="13" TextWrapping="Wrap" Margin="0,0,0,8"/>

                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ" Command="{Binding NetworkRevalidateCommand}"
                                                Style="{StaticResource PrimaryButtonStyle}" Padding="12,6" FontSize="13" Height="32" Margin="0,0,6,0"/>
                                        <Button Content="ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ" Command="{Binding NetworkDisableBypassCommand}"
                                                Style="{StaticResource SecondaryButtonStyle}" Padding="12,6" FontSize="13" Height="32" Margin="0,0,6,0"/>
                                        <Button Content="Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ" Command="{Binding NetworkIgnoreCommand}"
                                                Style="{StaticResource SecondaryButtonStyle}" Padding="12,6" FontSize="13" Height="32"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Recommendations -->
                            <Border Background="#EBF5FF" BorderBrush="#BFDBFE" BorderThickness="1" CornerRadius="4"
                                    Padding="8" Margin="0,0,0,8"
                                    ToolTip="{Binding RecommendationHintText}"
                                    Visibility="{Binding HasAnyRecommendations, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                        <materialDesign:PackIcon Kind="LightbulbOutline" Width="16" Height="16" Margin="0,0,6,0" Foreground="#1E40AF"/>
                                        <TextBlock Text="Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸" FontWeight="SemiBold" FontSize="13" Foreground="#1E40AF"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding RecommendedStrategiesText}" FontSize="12" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="0,0,0,4"/>
                                    <TextBlock Text="{Binding ManualRecommendationsText}" FontSize="12" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="0,0,0,4"
                                               Visibility="{Binding ManualRecommendationsText, Converter={StaticResource StringToVisibilityConverter}}"/>

                                         <ProgressBar Height="3" IsIndeterminate="True" Margin="0,2,0,6"
                                           Visibility="{Binding IsApplyRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                         <TextBlock Text="{Binding ApplyStatusText}" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,6" Foreground="#1E40AF"
                                             Visibility="{Binding ApplyStatusText, Converter={StaticResource StringToVisibilityConverter}}"/>

                                        <ProgressBar Height="3" IsIndeterminate="True" Margin="0,2,0,6"
                                             Visibility="{Binding IsPostApplyRetestRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <TextBlock Text="{Binding PostApplyRetestStatus}" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,6" Foreground="#1E40AF"
                                               Visibility="{Binding PostApplyRetestStatus, Converter={StaticResource StringToVisibilityConverter}}"/>

                                             <TextBlock Text="{Binding EndpointBlockStatus}" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,6" Foreground="#1E40AF"
                                                 Visibility="{Binding EndpointBlockStatus, Converter={StaticResource StringToVisibilityConverter}}"/>

                                        <Button Content="{Binding ApplyRecommendationsButtonText}" Command="{Binding ApplyRecommendationsCommand}"
                                            ToolTip="{Binding ApplyRecommendationsHintText}"
                                            Style="{StaticResource PrimaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30"/>

                                        <Button Content="Ð ÐµÑÑ‚Ð°Ñ€Ñ‚ ÐºÐ¾Ð½Ð½ÐµÐºÑ‚Ð°" Command="{Binding RestartConnectionCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30" Margin="0,6,0,0"
                                            ToolTip="ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾ Ð´Ñ€Ð¾Ð¿Ð°ÐµÑ‚ Ñ‚Ñ€Ð°Ñ„Ð¸Ðº Ðº Ñ†ÐµÐ»ÐµÐ²Ñ‹Ð¼ IP:443, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ð»Ð¾ÑÑŒ ÑƒÐ¶Ðµ Ð¿Ð¾Ð´ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ñ‘Ð½Ð½Ñ‹Ð¼ Ð¾Ð±Ñ…Ð¾Ð´Ð¾Ð¼."/>

                                        <Button Content="{Binding ApplyDomainButtonText}" Command="{Binding ApplyDomainRecommendationsCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30" Margin="0,6,0,0"
                                            ToolTip="{Binding DomainSuggestionHintText}"
                                            Visibility="{Binding HasDomainSuggestion, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                        <Button Content="{Binding ApplyDomainGroupButtonText}" Command="{Binding ApplyDomainGroupRecommendationsCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30" Margin="0,6,0,0"
                                            ToolTip="{Binding DomainGroupSuggestionHintText}"
                                            Visibility="{Binding HasDomainGroupSuggestion, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                        <Button Content="{Binding PromoteDomainGroupSuggestionButtonText}" Command="{Binding PromoteDomainGroupSuggestionCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30" Margin="0,6,0,0"
                                            ToolTip="{Binding PromoteDomainGroupSuggestionHintText}"
                                            Visibility="{Binding HasLearnedDomainGroupSuggestion, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                        <Button Content="{Binding IgnoreDomainGroupSuggestionButtonText}" Command="{Binding IgnoreDomainGroupSuggestionCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30" Margin="0,6,0,0"
                                            ToolTip="{Binding IgnoreDomainGroupSuggestionHintText}"
                                            Visibility="{Binding HasLearnedDomainGroupSuggestion, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                        <Button Content="{Binding ToggleDomainPinButtonText}" Command="{Binding TogglePinDomainFromResultCommand}"
                                            CommandParameter="{Binding SelectedTestResult}"
                                            Style="{StaticResource SecondaryButtonStyle}" Padding="10,5" FontSize="12" HorizontalAlignment="Left" Height="30" Margin="0,6,0,0"
                                            ToolTip="Ð—Ð°ÐºÑ€ÐµÐ¿Ð»ÑÐµÑ‚ Ð´Ð¾Ð¼ÐµÐ½ Ð² ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ðµ (state/domain_families.json), Ñ‡Ñ‚Ð¾Ð±Ñ‹ auto-suggest Ð²ÐºÐ»ÑŽÑ‡Ð°Ð»ÑÑ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ."
                                            Visibility="{Binding HasDomainSuggestion, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                </StackPanel>
                            </Border>

                            <!-- Tabs for Bypass Options -->
                            <TabControl Margin="0,0,0,8">
                                <TabItem Header="Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð² Ð´Ð²Ðµ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ -->
                                        <UniformGrid Columns="2" Rows="4" HorizontalAlignment="Stretch">
                                            <ToggleButton IsChecked="{Binding IsFragmentEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ TLS ClientHello (ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ñ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ Ð¿Ð¾ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ)"
                                                          Margin="0,0,4,4">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="âœ‚ï¸" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="Frag"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                            </ToggleButton>

                                            <ToggleButton IsChecked="{Binding IsDisorderEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ TLS ClientHello + Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ð² Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ"
                                                          Margin="4,0,0,4">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="ðŸ”€" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="Frag+Rev"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                            </ToggleButton>

                                            <ToggleButton IsChecked="{Binding IsFakeEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Fake TTL Ð¿Ð°ÐºÐµÑ‚"
                                                          Margin="0,0,4,4">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="ðŸŽ­" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="TLS Fake"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                            </ToggleButton>

                                            <ToggleButton IsChecked="{Binding IsDropRstEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° TCP RST Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²"
                                                          Margin="4,0,0,4">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="ðŸ›¡ï¸" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="Drop RST"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                            </ToggleButton>

                                            <ToggleButton IsChecked="{Binding IsQuicFallbackEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="QUIC fallback: Ð³Ð»ÑƒÑˆÐ¸Ñ‚ÑŒ UDP/443, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ð»ÑÑ Ð½Ð° TCP/HTTPS"
                                                          Margin="0,0,4,4">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="â¬‡ï¸" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="QUICâ†’TCP"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                                <ToggleButton.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="Ð¡ÐµÐ»ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ (Ð¿Ð¾ Ñ†ÐµÐ»Ð¸)"
                                                                  IsCheckable="True"
                                                                  IsChecked="{Binding IsQuicFallbackGlobal, Converter={StaticResource InverseBoolConverter}}"
                                                                  Command="{Binding DataContext.Bypass.SetQuicFallbackScopeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                                  CommandParameter="Selective"/>
                                                        <MenuItem Header="Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾ (Ð²ÐµÑÑŒ UDP/443)"
                                                                  IsCheckable="True"
                                                                  IsChecked="{Binding IsQuicFallbackGlobal}"
                                                                  Command="{Binding DataContext.Bypass.SetQuicFallbackScopeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                                  CommandParameter="Global"/>
                                                    </ContextMenu>
                                                </ToggleButton.ContextMenu>
                                            </ToggleButton>

                                            <ToggleButton IsChecked="{Binding IsAllowNoSniEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="Ð Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð¾Ð±Ñ…Ð¾Ð´ Ð´Ð°Ð¶Ðµ ÐºÐ¾Ð³Ð´Ð° SNI Ð½Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð½/Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ (ECH/ESNI/ÑÐµÐ³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ)"
                                                          Margin="4,0,0,4">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="ðŸ•¶ï¸" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="No SNI"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                            </ToggleButton>

                                            <ToggleButton IsChecked="{Binding IsDoHEnabled, Mode=TwoWay}"
                                                          Style="{StaticResource BypassToggleButtonStyle}"
                                                          ToolTip="DNS-over-HTTPS (ÐŸÐšÐœ Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð°)"
                                                          Margin="0,0,4,0">
                                                <ToggleButton.Content>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="ðŸ”’" FontSize="14" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="DoH"/>
                                                    </StackPanel>
                                                </ToggleButton.Content>
                                                <ToggleButton.ContextMenu>
                                                    <ContextMenu ItemsSource="{Binding Bypass.AvailableDnsPresets}">
                                                        <ContextMenu.ItemContainerStyle>
                                                            <Style TargetType="MenuItem">
                                                                <Setter Property="Header" Value="{Binding}"/>
                                                                <Setter Property="Command" Value="{Binding DataContext.Bypass.SetDnsPresetCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                                <Setter Property="CommandParameter" Value="{Binding}"/>
                                                            </Style>
                                                        </ContextMenu.ItemContainerStyle>
                                                    </ContextMenu>
                                                </ToggleButton.ContextMenu>
                                            </ToggleButton>

                                            <Button Command="{Binding DisableAllBypassCommand}" Height="36" FontSize="12" Margin="4,0,0,0"
                                                    ToolTip="ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÑ‘">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                                        <Setter Property="Content" Value="âœ• Ð’Ñ‹ÐºÐ»"/>
                                                        <Setter Property="Background" Value="#FEE2E2"/>
                                                        <Setter Property="Foreground" Value="#DC2626"/>
                                                        <Setter Property="BorderBrush" Value="#FECACA"/>
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#FECACA"/>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </UniformGrid>

                                        <Button Content="Ð¡Ð½ÑÑ‚ÑŒ Ð²ÑÑ‘ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ñ€ÑƒÑ‡Ð½Ð¾Ðµ)" Command="{Binding EngineerResetAllBypassCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}" Height="34" FontSize="12" Margin="0,8,0,0"
                                            ToolTip="ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð¾Ñ‚ÐºÐ°Ñ‚: Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ…Ð¾Ð´ Ð¸ (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð» backup) Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ DNS/DoH"/>

                                        <TextBlock Text="ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Â«Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑÂ» Ð¸ Â«Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ + Ð±ÐµÑÐ¿Ð¾Ñ€ÑÐ´Ð¾ÐºÂ» â€” Ð²Ð·Ð°Ð¸Ð¼Ð½Ð¾ Ð¸ÑÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‰Ð¸Ðµ Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹ (Ð½ÐµÐ»ÑŒÐ·Ñ Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾)."
                                                   FontSize="12"
                                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                   Margin="0,6,0,0"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <TextBlock Text="ÐŸÑ€ÐµÑÐµÑ‚ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,4"/>
                                        <ComboBox ItemsSource="{Binding FragmentPresets}"
                                                  SelectedItem="{Binding SelectedFragmentPreset, Mode=TwoWay}"
                                                  DisplayMemberPath="Name"
                                                  Style="{StaticResource ModernComboBoxStyle}"
                                                  Height="36" FontSize="13"/>
                                        <TextBlock Text="{Binding SelectedFragmentPresetLabel}" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,4,0,0"/>

                                        <CheckBox Content="ÐÐ²Ñ‚Ð¾ÐºÐ¾Ñ€Ñ€ÐµÐºÑ†Ð¸Ñ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ñ€ÐµÑÐµÑ‚Ð°" Margin="0,12,0,0" FontSize="13"
                                                  IsChecked="{Binding IsAutoAdjustAggressive}"
                                                  ToolTip="Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð´ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¾Ð²"/>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <Border Background="{Binding BypassVerdictBrush}" CornerRadius="4" Padding="10">
                                            <StackPanel>
                                                <TextBlock Text="âš¡ ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,6"/>
                                                <TextBlock Text="{Binding TrafficEngineLatencyText}" FontSize="12" Margin="0,0,0,4"/>

                                                <TextBlock Text="ðŸ§­ QUICâ†’TCP (Ð½Ð°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ)" FontWeight="SemiBold" FontSize="13" Margin="0,10,0,6"/>
                                                <TextBlock Text="{Binding Bypass.QuicModeText}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,6"/>
                                                <TextBlock Text="{Binding Bypass.QuicDropTargetsText}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,6"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           Visibility="{Binding Bypass.QuicDropTargetsText, Converter={StaticResource StringToVisibilityConverter}}"/>

                                                <Border Background="{Binding Bypass.QuicRuntimeStatusBrush}" CornerRadius="4" Padding="8" Margin="0,0,0,6">
                                                    <TextBlock Text="{Binding Bypass.QuicRuntimeStatusText}" FontSize="12" TextWrapping="Wrap"/>
                                                </Border>

                                                <Button Content="ðŸ” Outcome-check ÑÐµÐ¹Ñ‡Ð°Ñ" Command="{Binding Bypass.RunOutcomeProbeNowCommand}"
                                                        IsEnabled="{Binding Bypass.IsOutcomeProbeRunning, Converter={StaticResource InverseBoolConverter}}"
                                                        Height="32" FontSize="12" HorizontalAlignment="Left"
                                                        ToolTip="Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ HTTPS probe Ðº Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ñ†ÐµÐ»Ð¸ outcome (ÐµÑÐ»Ð¸ Ñ†ÐµÐ»ÑŒ Ð·Ð°Ð´Ð°Ð½Ð°)"/>
                                                <TextBlock Text="{Binding Bypass.OutcomeProbeStatusText}" FontSize="12" TextWrapping="Wrap" Margin="0,6,0,0"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           Visibility="{Binding Bypass.OutcomeProbeStatusText, Converter={StaticResource StringToVisibilityConverter}}"/>

                                                <TextBlock Text="ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° bypass" FontWeight="SemiBold" FontSize="13" Margin="0,8,0,6"/>
                                                <TextBlock Text="{Binding BypassMetricsText}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,4"/>
                                                <TextBlock Text="{Binding BypassSemanticGroupsText}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,4"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           Visibility="{Binding BypassSemanticGroupsText, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                <TextBlock Text="{Binding BypassVerdictText}" FontSize="12" FontWeight="SemiBold" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="ÐŸÐ¾Ð»Ð¸Ñ‚Ð¸ÐºÐ¸" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Button Content="ðŸ’¾ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ snapshot" Command="{Binding Bypass.ExportPolicySnapshotCommand}"
                                                    Height="32" FontSize="12" HorizontalAlignment="Left"
                                                    ToolTip="Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ decision graph snapshot Ð² JSON Ð¸ ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÑ‚ Ð² Ð±ÑƒÑ„ÐµÑ€"/>
                                            <TextBlock Text="{Binding Bypass.PolicyExportStatusText}" FontSize="12"
                                                       Margin="10,0,0,0" VerticalAlignment="Center"
                                                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                       TextWrapping="Wrap"
                                                       Visibility="{Binding Bypass.PolicyExportStatusText, Converter={StaticResource StringToVisibilityConverter}}"/>
                                        </StackPanel>

                                        <DataGrid ItemsSource="{Binding Bypass.ActivePolicies}"
                                                  AutoGenerateColumns="False"
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  IsReadOnly="True"
                                                  HeadersVisibility="Column"
                                                  GridLinesVisibility="None"
                                                  FontSize="12"
                                                  RowBackground="{DynamicResource MaterialDesignPaper}"
                                                  AlternatingRowBackground="{DynamicResource MaterialDesignPaper}">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="*"/>
                                                <DataGridTextColumn Header="Scope" Binding="{Binding Scope}" Width="90"/>
                                                <DataGridTextColumn Header="Prio" Binding="{Binding Priority}" Width="60"/>
                                                <DataGridTextColumn Header="Match" Binding="{Binding Match}" Width="2*"/>
                                                <DataGridTextColumn Header="Action" Binding="{Binding Action}" Width="160"/>
                                                <DataGridTextColumn Header="Matched" Binding="{Binding MatchedCount}" Width="80"/>
                                                <DataGridTextColumn Header="Applied" Binding="{Binding AppliedCount}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Button Content="ðŸ’¾ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸" Command="{Binding Bypass.ExportSelectedApplyTransactionCommand}"
                                                    Height="32" FontSize="12" HorizontalAlignment="Left"
                                                    ToolTip="Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ JSON Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¾Ð±Ñ…Ð¾Ð´Ð° Ð¸ ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÑ‚ Ð² Ð±ÑƒÑ„ÐµÑ€"/>
                                            <Button Content="ðŸ§¹ ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ" Command="{Binding Bypass.ClearApplyTransactionsCommand}"
                                                    Height="32" FontSize="12" Margin="8,0,0,0" HorizontalAlignment="Left"
                                                    ToolTip="ÐžÑ‡Ð¸Ñ‰Ð°ÐµÑ‚ Ð¶ÑƒÑ€Ð½Ð°Ð» Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² UI)"/>
                                            <TextBlock Text="{Binding Bypass.ApplyTransactionsExportStatusText}" FontSize="12"
                                                       Margin="10,0,0,0" VerticalAlignment="Center"
                                                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                       TextWrapping="Wrap"
                                                       Visibility="{Binding Bypass.ApplyTransactionsExportStatusText, Converter={StaticResource StringToVisibilityConverter}}"/>
                                        </StackPanel>

                                        <DataGrid ItemsSource="{Binding Bypass.ApplyTransactions}"
                                                  SelectedItem="{Binding Bypass.SelectedApplyTransaction, Mode=TwoWay}"
                                                  AutoGenerateColumns="False"
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  IsReadOnly="True"
                                                  HeadersVisibility="Column"
                                                  GridLinesVisibility="None"
                                                  FontSize="12"
                                                  Height="220"
                                                  RowBackground="{DynamicResource MaterialDesignPaper}"
                                                  AlternatingRowBackground="{DynamicResource MaterialDesignPaper}">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Time (UTC)" Binding="{Binding CreatedAtUtc}" Width="150"/>
                                                <DataGridTextColumn Header="Host" Binding="{Binding InitiatorHostKey}" Width="*"/>
                                                <DataGridTextColumn Header="Group" Binding="{Binding GroupKey}" Width="160"/>
                                                <DataGridTextColumn Header="Ã—" Binding="{Binding RepeatCountText}" Width="40"/>
                                                <DataGridTextColumn Header="IPs" Binding="{Binding CandidateIpEndpoints.Count}" Width="50"/>
                                                <DataGridTextColumn Header="Applied" Binding="{Binding AppliedStrategyText}" Width="200"/>
                                                <DataGridTextColumn Header="Plan" Binding="{Binding PlanText}" Width="260"/>
                                                <DataGridTextColumn Header="ACT" Binding="{Binding ActivationStatusText}" Width="110"/>
                                            </DataGrid.Columns>
                                        </DataGrid>

                                        <TextBlock Text="Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸"
                                                   FontWeight="SemiBold"
                                                   FontSize="13"
                                                   Margin="0,10,0,6"/>

                                        <DataGrid ItemsSource="{Binding Bypass.SelectedApplyTransaction.TransactionHistory}"
                                                  AutoGenerateColumns="False"
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  IsReadOnly="True"
                                                  HeadersVisibility="Column"
                                                  GridLinesVisibility="None"
                                                  FontSize="12"
                                                  Height="170"
                                                  RowBackground="{DynamicResource MaterialDesignPaper}"
                                                  AlternatingRowBackground="{DynamicResource MaterialDesignPaper}">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Time (UTC)" Binding="{Binding CreatedAtUtc}" Width="150"/>
                                                <DataGridTextColumn Header="Host" Binding="{Binding InitiatorHostKey}" Width="*"/>
                                                <DataGridTextColumn Header="Group" Binding="{Binding GroupKey}" Width="160"/>
                                                <DataGridTextColumn Header="Applied" Binding="{Binding AppliedStrategyText}" Width="200"/>
                                                <DataGridTextColumn Header="Plan" Binding="{Binding PlanText}" Width="220"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding Result.Status}" Width="100"/>
                                            </DataGrid.Columns>
                                        </DataGrid>

                                        <TextBlock Text="JSON Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (Ð´Ð»Ñ Ñ€ÐµÐ¿Ð¾Ñ€Ñ‚Ð°)" FontWeight="SemiBold" FontSize="13" Margin="0,10,0,6"/>

                                        <TextBox Style="{StaticResource ModernTextBoxStyle}"
                                                 Text="{Binding Bypass.SelectedApplyTransactionJson, Mode=OneWay}"
                                                 IsReadOnly="True"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 VerticalScrollBarVisibility="Auto"
                                                 Height="200"
                                                 materialDesign:HintAssist.Hint="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð²Ñ‹ÑˆÐµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ JSON"/>
                                    </StackPanel>
                                </TabItem>

                                <TabItem Header="Hostlist" FontSize="13">
                                    <StackPanel Margin="0,8,0,0">
                                        <CheckBox Content="ÐÐ²Ñ‚Ð¾-hostlist (Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ð¾Ð²)"
                                                  IsChecked="{Binding Bypass.IsAutoHostlistEnabled}"
                                                  FontSize="13"/>

                                        <TextBlock Text="{Binding Bypass.AutoHostlistCount, StringFormat='ÐšÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ð¾Ð²: {0}'}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                   Margin="0,6,0,6"/>

                                        <TextBox Style="{StaticResource ModernTextBoxStyle}"
                                                 Text="{Binding Bypass.AutoHostlistText, Mode=OneWay}"
                                                 IsReadOnly="True"
                                                 IsEnabled="{Binding Bypass.IsAutoHostlistEnabled}"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 VerticalScrollBarVisibility="Auto"
                                                 Height="140"
                                                 materialDesign:HintAssist.Hint="ÐšÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ñ‹ hostnames (Ð¸Ð· ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº)"/>
                                    </StackPanel>
                                </TabItem>
                            </TabControl>
                        </StackPanel>
                    </Border>

                    <!-- Running Status - ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ -->
                    <Border Background="#EFF6FF" BorderBrush="#BFDBFE" BorderThickness="1" CornerRadius="6"
                            Padding="12,10" Margin="0,16,0,0"
                            Visibility="Collapsed">
                        <StackPanel>
                            <TextBlock Text="âš™ï¸ Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ..." FontWeight="Bold" FontSize="14" Margin="0,0,0,6"/>
                            <TextBlock Text="{Binding CurrentAction}" FontSize="13" Foreground="#4B5563" TextWrapping="Wrap" Margin="0,0,0,6"/>
                            <ProgressBar IsIndeterminate="True" Height="3" BorderThickness="0"/>

                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="{Binding ConnectionsDiscovered, StringFormat='Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹: {0}'}" FontSize="12" Margin="0,0,12,0"/>
                                <TextBlock Text="{Binding FlowEventsCount, StringFormat='Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ: {0}'}" FontSize="12"/>
                            </StackPanel>

                            <Border Background="{Binding AutoBypassStatusBrush}" CornerRadius="4" Padding="8" Margin="0,8,0,0"
                                    Visibility="{Binding AutoBypassStatus, Converter={StaticResource StringToVisibilityConverter}}">
                                <TextBlock Text="{Binding AutoBypassStatus}" FontSize="12" FontWeight="SemiBold" TextWrapping="Wrap"/>
                            </Border>
                        </StackPanel>
                    </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </materialDesign:DrawerHost.LeftDrawerContent>

        <!-- RIGHT PANEL: Results -->
        <Border Style="{StaticResource CardStyle}" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð»ÐµÐ²Ð¾Ð¹ Ð¿Ð°Ð½ÐµÐ»ÑŒÑŽ (ÑÑ‚Ñ€ÐµÐ»ÐºÐ¸) -->
                <Button Grid.Row="1"
                        Panel.ZIndex="10"
                        Style="{StaticResource ThemeToggleButtonStyle}"
                        Command="{Binding ToggleLeftPanelCommand}"
                        ToolTip="Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ/Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð»ÐµÐ²ÑƒÑŽ Ð¿Ð°Ð½ÐµÐ»ÑŒ"
                        Height="32" Width="32"
                        Margin="16,16,0,0"
                        HorizontalAlignment="Left" VerticalAlignment="Top">
                    <TextBlock FontSize="18" FontFamily="Segoe UI Symbol" Foreground="#22C55E" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑÐ²ÐµÑ€Ð½ÑƒÑ‚Ð°: Ð·ÐµÐ»Ñ‘Ð½Ð°Ñ ÑÑ‚Ñ€ÐµÐ»ÐºÐ° Ð²Ð¿Ñ€Ð°Ð²Ð¾ -->
                                <Setter Property="Text" Value="â–¶"/>
                                <Style.Triggers>
                                    <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚Ð°: Ð·ÐµÐ»Ñ‘Ð½Ð°Ñ ÑÑ‚Ñ€ÐµÐ»ÐºÐ° Ð²Ð»ÐµÐ²Ð¾ -->
                                    <DataTrigger Binding="{Binding IsLeftPanelOpen}" Value="True">
                                        <Setter Property="Text" Value="â—€"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Button>

                <!-- VPN Warning Banner -->
                <Border Grid.Row="0" Background="#FEF3C7" BorderBrush="#FCD34D" BorderThickness="0,0,0,1"
                        Padding="16,10"
                        Visibility="{Binding IsVpnDetected, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Alert" Width="20" Height="20" Margin="0,0,8,0" Foreground="#92400E" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding VpnWarningText}" FontSize="13" Foreground="#92400E" TextWrapping="Wrap" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Start State -->
                <StackPanel Grid.Row="1" Grid.RowSpan="2"
                            Visibility="{Binding IsStart, Converter={StaticResource BoolToVisibilityConverter}}"
                            VerticalAlignment="Center" HorizontalAlignment="Center" Margin="16">
                    <materialDesign:PackIcon Kind="ChartBar" Width="48" Height="48" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,0,0,16"/>
                    <TextBlock Text="ðŸ“Š Ð“Ð¾Ñ‚Ð¾Ð² Ðº Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐµ" Style="{StaticResource H2Style}"
                               Foreground="{DynamicResource MaterialDesignBodyLight}" TextAlignment="Center"/>
                    <TextBlock Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ 'ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ'"
                               Style="{StaticResource BodyStyle}" Foreground="{DynamicResource MaterialDesignBodyLight}"
                               TextAlignment="Center" Margin="0,8,0,0"/>
                </StackPanel>

                <!-- Results Header -->
                <Grid Grid.Row="1" Margin="56,16,16,8"
                      Visibility="{Binding IsStart, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="ðŸ“‹" Style="{StaticResource H2Style}" FontFamily="Segoe UI Emoji" Margin="0,0,6,0"/>
                            <TextBlock Text="Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ" Style="{StaticResource H2Style}"/>
                        </StackPanel>
                        <Border Background="#DCFCE7" CornerRadius="4" Padding="6,2" Margin="12,0,0,0" VerticalAlignment="Center"
                                Visibility="{Binding IsBypassActive, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="ðŸ›¡ï¸ Bypass Active" Foreground="#166534" FontWeight="SemiBold" FontSize="11"/>
                        </Border>
                    </StackPanel>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right">
                        <CheckBox Content="Ð¤Ð¾ÐºÑƒÑ"
                                  IsChecked="{Binding IsResultsFocusMode}"
                                  Margin="0,0,12,0"
                                  VerticalAlignment="Center"
                                  FontSize="12"
                                  ToolTip="Ð¤Ð¾ÐºÑƒÑ: Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð½Ñ‹Ðµ/Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ/Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ñ‘Ð½Ð½Ñ‹Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸"/>

                        <Button Content="ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ" Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding StartLiveTestingCommand}"
                                Padding="10,4" FontSize="12" Margin="0,0,8,0"
                                Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <Button Content="ðŸ“„ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚" Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding ReportCommand}" Margin="0,0,8,0" Padding="10,4" FontSize="12"
                                Visibility="{Binding IsDone, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <Button Content="ðŸ”„ ÐÐ¾Ð²Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°" Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding SetStateCommand}" CommandParameter="start" Padding="10,4" FontSize="12"
                                Visibility="{Binding IsDone, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Margin="0,6,0,0">
                        <TextBlock Text="{Binding ActiveApplySummaryText}"
                                   FontSize="12"
                                   Foreground="#6B7280"
                                   TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding Bypass.OutcomeProbeStatusText}"
                                   FontSize="12"
                                   Foreground="#6B7280"
                                   TextWrapping="Wrap"
                                   Visibility="{Binding Bypass.OutcomeProbeStatusText, Converter={StaticResource StringToVisibilityConverter}}"/>
                    </StackPanel>
                </Grid>

                <!-- DataGrid -->
                <DataGrid Grid.Row="2" x:Name="ResultsGrid"
                          ItemsSource="{Binding ResultsView}"
                          SelectedItem="{Binding SelectedTestResult, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeRows="False"
                          IsReadOnly="True"
                          SelectionMode="Extended"
                          SelectionUnit="FullRow"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="{DynamicResource MaterialDesignDivider}"
                          Background="{DynamicResource MaterialDesignPaper}"
                          BorderThickness="0"
                          RowBackground="{DynamicResource MaterialDesignPaper}"
                          AlternatingRowBackground="{DynamicResource MaterialDesignPaper}"
                          FontSize="13"
                          Visibility="{Binding IsStart, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                    <DataGrid.Resources>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="{DynamicResource Primary200}"/>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>

                        <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                            <Setter Property="Padding" Value="8,6"/>
                            <Setter Property="Background" Value="{DynamicResource MaterialDesignPaper}"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </Style>

                        <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                            <Setter Property="MinHeight" Value="36"/>
                            <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick"/>
                            <Setter Property="ContextMenu" Value="{StaticResource RowContextMenu}"/>
                            <Setter Property="DetailsVisibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsAggregatedMembersExpanded}" Value="True">
                                    <Setter Property="DetailsVisibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>

                        <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                            <Setter Property="Padding" Value="8,4"/>
                            <Setter Property="BorderThickness" Value="0"/>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.RowDetailsTemplate>
                        <DataTemplate>
                            <Border Padding="8,6" Margin="56,0,8,6" Background="{DynamicResource MaterialDesignPaper}">
                                <ItemsControl ItemsSource="{Binding AggregatedMembers}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Foreground="{DynamicResource MaterialDesignBody}" FontSize="12" TextWrapping="Wrap">
                                                <Run Text="â€¢ "/>
                                                <Run Text="{Binding DisplayHost, Mode=OneWay}"/>
                                            </TextBlock>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </DataTemplate>
                    </DataGrid.RowDetailsTemplate>

                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="" Width="56" CanUserResize="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border ToolTip="{Binding StatusText}" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <local:StatusDot Status="{Binding Status}"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="SNI / Ð”Ð¾Ð¼ÐµÐ½" Width="*" CanUserResize="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding DisplayHost, Mode=OneWay}" FontWeight="SemiBold"/>
                                        <Border Background="#DBEAFE" CornerRadius="4" Padding="6,2" Margin="8,0,0,0"
                                                Cursor="Hand" MouseLeftButtonUp="AggregatedMemberBadge_MouseLeftButtonUp"
                                                VerticalAlignment="Center"
                                                Visibility="{Binding ShowAggregatedMemberBadge, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <TextBlock Text="{Binding AggregatedMemberBadgeText}" Foreground="#1D4ED8" FontWeight="SemiBold" FontSize="10"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Ð“Ñ€ÑƒÐ¿Ð¿Ð°" Width="180" CanUserResize="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Margin="0,0,8,0" Foreground="{DynamicResource MaterialDesignBody}">
                                            <TextBlock.Text>
                                                <MultiBinding Converter="{StaticResource TestResultToGroupKeyConverter}">
                                                    <Binding />
                                                    <Binding Path="DataContext.Results.SuggestedDomainSuffix" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>

                                        <Border Background="#DCFCE7" CornerRadius="4" Padding="6,2" VerticalAlignment="Center" Visibility="Collapsed">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Value="True">
                                                            <DataTrigger.Binding>
                                                                <MultiBinding Converter="{StaticResource TestResultIsInActiveGroupConverter}">
                                                                    <Binding />
                                                                    <Binding Path="DataContext.Results.SuggestedDomainSuffix" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                    <Binding Path="DataContext.ActiveApplyGroupKey" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                    <Binding Path="DataContext.Bypass.IsBypassActive" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                </MultiBinding>
                                                            </DataTrigger.Binding>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="ACTIVE" Foreground="#166534" FontWeight="SemiBold" FontSize="10"/>
                                        </Border>

                                        <Border Background="#DBEAFE" CornerRadius="4" Padding="6,2" Margin="6,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsAppliedBypassTarget}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="APPLIED" Foreground="#1D4ED8" FontWeight="SemiBold" FontSize="10"/>
                                        </Border>

                                        <Border Background="#FEF3C7" CornerRadius="4" Padding="6,2" Margin="6,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Converter={StaticResource TestResultIsExcludedNoiseHostConverter}}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="EXCLUDED" Foreground="#92400E" FontWeight="SemiBold" FontSize="10"/>
                                        </Border>

                                        <Border Background="#FEE2E2" CornerRadius="4" Padding="6,2" Margin="6,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsManuallyExcludedFromApplyGroup}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="OUT" Foreground="#991B1B" FontWeight="SemiBold" FontSize="10"/>
                                        </Border>

                                        <Border Background="#DCFCE7" CornerRadius="4" Padding="6,2" Margin="6,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding IsManuallyExcludedFromApplyGroup}" Value="False"/>
                                                                <Condition Binding="{Binding Converter={StaticResource TestResultIsExcludedNoiseHostConverter}}" Value="False"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </MultiDataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="IN" Foreground="#166534" FontWeight="SemiBold" FontSize="10"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ" Width="120" CanUserResize="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ItemsControl ItemsSource="{Binding StrategyIconNames}" ToolTip="{Binding StrategyIconHint}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding .}" FontSize="16" FontFamily="Segoe UI Emoji" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ" Width="190" CanUserResize="False">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Style="{StaticResource PrimaryButtonStyle}"
                                                Padding="8,4"
                                                FontSize="12"
                                                ToolTip="{Binding StrategyIconHint}"
                                                Command="{Binding DataContext.ConnectFromResultCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Visibility="{Binding ShowConnectButton, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Width="16" Height="16" Margin="0,0,6,0">
                                                    <materialDesign:PackIcon.Style>
                                                        <Style TargetType="materialDesign:PackIcon">
                                                            <Setter Property="Kind" Value="LanConnect"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAppliedBypassTarget}" Value="True">
                                                                    <Setter Property="Kind" Value="Refresh"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </materialDesign:PackIcon.Style>
                                                </materialDesign:PackIcon>

                                                <TextBlock>
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsAppliedBypassTarget}" Value="True">
                                                                    <Setter Property="Text" Value="ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </Button>

                                        <Button Padding="8,4"
                                                FontSize="12"
                                                Margin="8,0,0,0"
                                                ToolTip="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÑŽ Ð´Ð»Ñ Ð´Ð¾Ð¼ÐµÐ½Ð°: ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ° ÑÐµÐ¼ÐµÐ¹ÑÑ‚Ð²Ð° â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐµÑ‘; Ð¸Ð½Ð°Ñ‡Ðµ Ð±ÐµÑ€Ñ‘Ð¼ Ð´Ð¾Ð¼ÐµÐ½ ÑÑ‚Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸"
                                                Command="{Binding DataContext.ConnectDomainFromResultCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}">
                                            <Button.Style>
                                                <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Value="True">
                                                            <DataTrigger.Binding>
                                                                <MultiBinding Converter="{StaticResource TestResultHasDomainSuggestionConverter}">
                                                                    <Binding />
                                                                    <Binding Path="DataContext.Results.SuggestedDomainSuffix" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                    <Binding Path="DataContext.Results.CanSuggestDomainAggregation" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                                </MultiBinding>
                                                            </DataTrigger.Binding>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                            <TextBlock Text="ðŸŒ Ð”Ð¾Ð¼ÐµÐ½" FontFamily="Segoe UI Emoji"/>
                                        </Button>

                                        <Button Style="{StaticResource SecondaryButtonStyle}"
                                                Padding="8,4"
                                                FontSize="12"
                                                Margin="8,0,0,0"
                                                ToolTip="Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ñ€ÐµÑ‚ÐµÑÑ‚ Ñ†ÐµÐ»Ð¸ (Ð¸Ð»Ð¸ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ, ÐµÑÐ»Ð¸ Ð¸Ð´Ñ‘Ñ‚ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°)"
                                                Command="{Binding DataContext.RetestFromResultCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}">
                                            <TextBlock Text="ðŸ”„ Ð ÐµÑ‚ÐµÑÑ‚" FontFamily="Segoe UI Emoji"/>
                                        </Button>

                                        <Button Style="{StaticResource SecondaryButtonStyle}"
                                                Padding="8,4"
                                                FontSize="12"
                                                Margin="8,0,0,0"
                                                ToolTip="ÐŸÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ (TTL-block Ð´Ð»Ñ endpoint-Ð¾Ð²) Ð¸ Ð·Ð°Ñ‚ÐµÐ¼ Ñ€ÐµÑ‚ÐµÑÑ‚"
                                                Command="{Binding DataContext.ReconnectFromResultCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}">
                                            <TextBlock Text="â†»" FontSize="14"/>
                                        </Button>

                                        <Button Style="{StaticResource SecondaryButtonStyle}"
                                                Padding="8,4"
                                                FontSize="12"
                                                Margin="8,0,0,0"
                                                ToolTip="Ð˜ÑÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ/Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð¸Ð· ÑÐ¾ÑÑ‚Ð°Ð²Ð° Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ (P0.1 participation)"
                                                Command="{Binding DataContext.ToggleParticipationFromResultCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}">
                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value="ðŸš«"/>
                                                        <Setter Property="FontFamily" Value="Segoe UI Emoji"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsManuallyExcludedFromApplyGroup}" Value="True">
                                                                <Setter Property="Text" Value="â†©"/>
                                                                <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Button>
                                    </StackPanel>

                                    <TextBlock Text="{Binding ActionStatusText}"
                                               FontSize="11"
                                               Foreground="#6B7280"
                                               Margin="0,4,0,0"
                                               TextWrapping="Wrap"
                                               Visibility="{Binding ShowActionStatusText, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                    <TextBlock Text="{Binding LastApplyTransactionText}"
                                               FontSize="11"
                                               Foreground="#6B7280"
                                               Margin="0,2,0,0"
                                               TextWrapping="Wrap"
                                               Visibility="{Binding ShowLastApplyTransactionText, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                    <TextBlock Text="{Binding BundleSummaryText}"
                                               FontSize="11"
                                               Foreground="#6B7280"
                                               Margin="0,2,0,0"
                                               TextWrapping="Wrap"
                                               Visibility="{Binding ShowBundleSummaryText, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Footer -->
                <Border Grid.Row="3" Background="{DynamicResource MaterialDesignPaper}" Padding="12,8" Margin="0,8,0,0" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="InformationOutline" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding UserMessage}" FontWeight="Medium" Foreground="{DynamicResource MaterialDesignBody}" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </materialDesign:DrawerHost>
</Window>
