# ISP_Audit ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (v3.0 Extended)

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 16.01.2026
**–í–µ—Ä—Å–∏—è:** 3.0 (Comprehensive)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** .NET 9, WPF, WinDivert 2.2.0

---

## 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

**ISP_Audit** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–µ—Ç–µ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (ISP). –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —É—Ç–∏–ª–∏—Ç (ping/tracert), ISP_Audit —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –ø–∞–∫–µ—Ç–æ–≤ (DPI), –∞–Ω–∞–ª–∏–∑–∏—Ä—É—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ TCP/UDP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

–°–º–µ–∂–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –Ω–∞–±—Ä–æ—Å–æ–∫ (draft): –º–æ–¥–µ–ª—å ¬´—Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è¬ª –∏ –ø–æ–¥—Ö–æ–¥ –∫ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã QUIC‚ÜíTCP –Ω–µ –ª–æ–º–∞–ª –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è): —Å–º. `docs/network_portrait_architecture.md`.

### –ö–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏
1.  **–ü–∞—Å—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ó–∞—Ö–≤–∞—Ç –∏—Å—Ö–æ–¥—è—â–∏—Ö SYN-–ø–∞–∫–µ—Ç–æ–≤ (TCP) –∏ –ø–µ—Ä–≤—ã—Ö –¥–∞—Ç–∞–≥—Ä–∞–º–º (UDP) –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
2.  **–ê–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–æ–∫–µ—Ç—ã (DNS, TCP Handshake, TLS ClientHello).
3.  **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (DNS Spoofing, TCP RST Injection, HTTP Redirect, Packet Drop).
4.  **–û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (Bypass)**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (Fragmentation, Disorder, Fake TTL) –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –∫–æ–Ω–≤–µ–π–µ—Ä–∞ (Pipeline), –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–∏—é —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤.

```mermaid
graph TD
    User[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> UI[WPF UI (MainWindow)]
    UI --> VM[MainViewModel]

    subgraph Orchestration [Orchestration Layer]
        VM --> Orchestrator[DiagnosticOrchestrator]
        Orchestrator --> Pipeline[LiveTestingPipeline]
    end

    subgraph Core [Core Logic]
        Pipeline --> ConnectionMonitor[ConnectionMonitorService]
        ConnectionMonitor --> Sniffer[TrafficCollector]
        Sniffer --> NoiseFilter[NoiseHostFilter]
        NoiseFilter --> Tester[StandardHostTester]
        Tester --> Classifier[SignalsAdapterV2 + StandardDiagnosisEngineV2 + StandardStrategySelectorV2]
        Classifier --> StateStore[InMemoryBlockageStateStore]
    end

    subgraph Inspection [Inspection Services]
        StateStore --> RstInspector[RstInspectionService]
        StateStore --> UdpInspector[UdpInspectionService]
        StateStore --> RetransTracker[TcpRetransmissionTracker]
        StateStore --> RedirectDetector[HttpRedirectDetector]
    end

    subgraph Network [Network Layer]
        Sniffer --> WinDivert[WinDivert Driver]
        Tester --> NetworkStack[OS Network Stack]
        VM --> BypassCtrl[BypassController]
        BypassCtrl --> BypassState[BypassStateManager]
        BypassState --> TlsSvc[TlsBypassService]
        BypassState --> TrafficEngine[TrafficEngine]
    end

    TrafficEngine --> WinDivert
```

---

## 3. –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 3.1 UI Layer (WPF)

*   **`MainWindow.xaml`**: –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `MaterialDesignInXaml` –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏.
    *   –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ drawer (`DrawerHost`) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è (PIN) –∏ –∞–≤—Ç–æ—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ–º –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
    *   –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —É–ø—Ä–æ—â–µ–Ω–∞ –¥–æ 5 –∫–æ–ª–æ–Ω–æ–∫ (—Å—Ç–∞—Ç—É—Å-–∏–∫–æ–Ω–∫–∞ / SNI-–¥–æ–º–µ–Ω / GroupKey (+ ACTIVE –¥–ª—è —Ç–µ–∫—É—â–µ–π –≥—Ä—É–ø–ø—ã) / –∏–∫–æ–Ω–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ / –¥–µ–π—Å—Ç–≤–∏–µ). –î–µ—Ç–∞–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ double-click –ø–æ —Å—Ç—Ä–æ–∫–µ.
    *   –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±—Ö–æ–¥–∞ ("–ü–æ–¥–∫–ª—é—á–∏—Ç—å"/Apply) UI –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—É—é** —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –≥—Ä—É–ø–ø—ã/—Å—Ç—Ä–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø–æ–≤–µ—Ä—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π) + –∫—Ä–∞—Ç–∫–∏–π **Bundle summary** (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è+—Ñ–ª–∞–≥–∏+endpoints/policies). –ü–æ–º–µ—Ç–∫–∞ **APPLIED** —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–∫–∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ: –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–º–µ—á–µ–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –°–æ—Å—Ç–æ—è–Ω–∏–µ —É—á–∞—Å—Ç–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –≥—Ä—É–ø–ø–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–π–¥–∂–∞–º–∏ **IN/OUT/EXCLUDED**.
    *   Manual participation: –±–µ–π–¥–∂ **OUT** –∏ –∫–Ω–æ–ø–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è/–≤–æ–∑–≤—Ä–∞—Ç–∞. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `%LocalAppData%\\ISP_Audit\\group_participation.json` –∏ –≤–ª–∏—è–µ—Ç –Ω–∞ UI-–º–∞—Ä–∫–µ—Ä—ã (–∏—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –ø–æ–º–µ—á–∞—é—Ç—Å—è APPLIED –∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç AppliedBypassStrategy).
    *   –î–æ–º–µ–Ω–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø—Ä—è–º–æ –≤ —Å—Ç—Ä–æ–∫–µ (–∫–Ω–æ–ø–∫–∞ "üåê –î–æ–º–µ–Ω" –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏). ¬´–î–µ—Ç–∞–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±—Ö–æ–¥–∞¬ª –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –æ–∫–Ω–µ –¥–µ—Ç–∞–ª–µ–π –ø–æ double-click: JSON –ø–æ—Å–ª–µ–¥–Ω–µ–π apply-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥—Ä—É–ø–ø—ã (–ø–ª—é—Å participation snapshot) –∏ –∫–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.
    *   UX (P0.1 Step 10, MVP): –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π v2 –≤ bypass-–ø–∞–Ω–µ–ª–∏ —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–ª–µ–≤—É—é –≥—Ä—É–ø–ø—É/—Ü–µ–ª—å (–∏ tooltip —Å Target/GroupKey), —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—â—É—â–µ–Ω–∏–µ ¬´–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è¬ª.
*   **`MainViewModel`**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è ViewModel.
    *   –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º UI (–∑–∞–≥—Ä—É–∑–∫–∞, –æ—à–∏–±–∫–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã).
    *   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `DiagnosticOrchestrator`.
    *   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Start/Stop, Open Report).
    *   **P0.6 –°–º–µ–Ω–∞ —Å–µ—Ç–∏ (staged revalidation):** –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —Å–µ—Ç–∏ (—á–µ—Ä–µ–∑ `NetworkChangeMonitor`) –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å/–û—Ç–∫–ª—é—á–∏—Ç—å/–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å¬ª. ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å¬ª –∑–∞–ø—É—Å–∫–∞–µ—Ç staged-–ø—Ä–æ–≤–µ—Ä–∫—É `Activation ‚Üí Outcome` –∏ –∑–∞—Ç–µ–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (–±–µ–∑ auto-apply).
    *   –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π shutdown: –æ—Ç–º–µ–Ω—è–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, –æ—Ç–∫–ª—é—á–∞–µ—Ç bypass –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç DNS/DoH (–µ—Å–ª–∏ –±—ã–ª –≤–∫–ª—é—á—ë–Ω —á–µ—Ä–µ–∑ `FixService` –∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç backup –≤ `%LocalAppData%\ISP_Audit\dns_backup.json`). –í–∞–∂–Ω–æ: `App.OnExit` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è `ShutdownAsync`, —á—Ç–æ–±—ã –æ—Ç–∫–∞—Ç —É—Å–ø–µ–ª –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞.
    *   Crash-recovery: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `BypassController.InitializeOnStartupAsync` –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å DNS –∏–∑ backup, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–ª—Å—è –æ—Ç –ø—Ä–æ—à–ª–æ–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞).
*   **`BypassController`**: ViewModel, –æ—Ç–≤–µ—á–∞—é—â–∞—è –∑–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ö–æ–¥–∞.
    *   –°–≤—è–∑—ã–≤–∞–µ—Ç UI-—Ç—É–º–±–ª–µ—Ä—ã (Fragment/Disorder/Fake/Drop RST/DoH + assist-—Ñ–ª–∞–≥–∏ `QUIC‚ÜíTCP` –∏ `No SNI`) —Å `TlsBypassService` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º).
    *   –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–µ—Å–µ—Ç/–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é –∏ assist-—Ñ–ª–∞–≥–∏ –∏–∑ `bypass_profile.json`; —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ—Å–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ (–æ–±–Ω–æ–≤–ª—è—è —Ç–æ–ª—å–∫–æ –ø–æ–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏) –∏ assist-—Ñ–ª–∞–≥–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ TTL/redirect rules).
    *   –ü—Ä–µ—Å–µ—Ç—ã —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç/—É–º–µ—Ä–µ–Ω–Ω—ã–π/–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π/–ø—Ä–æ—Ñ–∏–ª—å) –∏ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –∂–∏–≤—É—Ç –≤ —Å–µ—Ä–≤–∏—Å–µ, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ª–∏—à—å –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä –±–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞.
    *   –ú–µ—Ç—Ä–∏–∫–∏/–≤–µ—Ä–¥–∏–∫—Ç –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ —Å–æ–±—ã—Ç–∏–π `TlsBypassService` (`MetricsUpdated/VerdictChanged/StateChanged`): UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–∞–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, —Ç–∞–π–º—Å—Ç–∞–º–ø –Ω–∞—á–∞–ª–∞ –º–µ—Ç—Ä–∏–∫, –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–µ—Å–µ—Ç/–º–∏–Ω. —á–∞–Ω–∫ –∏ –Ω–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–∏ —Å–µ—Ä—ã—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö ¬´–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö/–Ω–µ 443¬ª.
    *   P0.1 (MVP, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å): –≤–µ–¥—ë—Ç –∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ¬´–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±—Ö–æ–¥–∞¬ª (hostKey + groupKey + candidate IP endpoints + applied strategy + activation + policy snapshot + expectedEffects/warnings) –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ –≤ UI (–≤–∫–ª–∞–¥–∫–∞ ¬´–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ¬ª) —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º JSON –≤ `artifacts/` –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –±—É—Ñ–µ—Ä. –ü–æ—Å–ª–µ–¥–Ω–∏–µ K —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `%LocalAppData%\ISP_Audit\apply_transactions.json` –∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ.
    *   P0.2 Stage 6 (–Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å): UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∞–∫—Ç–∏–≤–Ω—ã—Ö FlowPolicy (matched/applied per-policy) –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π policy snapshot –≤ JSON –¥–ª—è —Ä–µ–ø–æ—Ä—Ç–∞.

–í–∞–∂–Ω–æ (runtime): QUIC fallback –∏ —Ä–µ–∂–∏–º allow-no-SNI ‚Äî —ç—Ç–æ —è–≤–Ω—ã–µ —Ñ–ª–∞–≥–∏ –ø—Ä–æ—Ñ–∏–ª—è/–æ–ø—Ü–∏–π, –∞ –Ω–µ ¬´–ø—Ä–µ—Å–µ—Ç¬ª.

- `DropUdp443` (—Ç—É–º–±–ª–µ—Ä `QUIC‚ÜíTCP`) –≤–∫–ª—é—á–∞–µ—Ç –æ—Ç–∫–∞—Ç —Å QUIC/HTTP3 (UDP/443) –Ω–∞ TCP/HTTPS.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ **—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π** —Ä–µ–∂–∏–º: `BypassStateManager` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç observed IPv4 –∞–¥—Ä–µ—Å–∞ —Ü–µ–ª–∏ (TTL/cap, cold-start —á–µ—Ä–µ–∑ DNS resolve host) –∏ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç –∏—Ö –≤ `TlsBypassService`, –∞ `BypassFilter` –≥–ª—É—à–∏—Ç UDP/443 (`Udp443Dropped++`) **—Ç–æ–ª—å–∫–æ** –¥–ª—è –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —ç—Ç–∏ IP ‚Äî —Ç–∞–∫ —É–º–µ–Ω—å—à–∞—é—Ç—Å—è –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/—Å–µ—Ä–≤–∏—Å—ã.
- `DropUdp443Global` –≤–∫–ª—é—á–∞–µ—Ç **–≥–ª–æ–±–∞–ª—å–Ω—ã–π** —Ä–µ–∂–∏–º (–¥—Ä–æ–ø–∞—Ç—å –≤–µ—Å—å UDP/443 –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ü–µ–ª–∏). –≠—Ç–æ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –∏ –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ QUIC/HTTP3.
- –î–ª—è IPv6 —Ç—Ä–∞—Ñ–∏–∫–∞ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–∞–¥—Ä–µ—Å–∞ –Ω–µ –ø–∞—Ä—Å—è—Ç—Å—è), –ø–æ—ç—Ç–æ–º—É —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ drop –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `DropUdp443`.

–ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `AllowNoSni` –æ–±—Ö–æ–¥ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ SNI –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω/–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (ECH/ESNI/—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è ClientHello).

*   **`BypassStateManager`**: –µ–¥–∏–Ω—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—Ö–æ–¥–∞ (SSoT) –¥–ª—è `TrafficEngine` –∏ `TlsBypassService`.
    *   **Fail-safe (Lite Watchdog + crash recovery):**
        *   –í–µ–¥—ë—Ç –∂—É—Ä–Ω–∞–ª —Å–µ—Å—Å–∏–∏ bypass (LocalAppData) —Å —Ñ–ª–∞–≥–∞–º–∏ `CleanShutdown`/`WasBypassActive`.
        *   –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, –µ—Å–ª–∏ –ø—Ä–æ—à–ª—ã–π shutdown –±—ã–ª –Ω–µ clean –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º bypass ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π `Disable`.
        *   –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º bypass –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ heartbeat/–º–µ—Ç—Ä–∏–∫ –¥–æ–ª—å—à–µ –æ–∫–Ω–∞ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≤—Ç–æ-`Disable`.
    *   **Activation Detection (–ø–æ –º–µ—Ç—Ä–∏–∫–∞–º):**
        *   –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: `ENGINE_DEAD / NOT_ACTIVATED / ACTIVATED / NO_TRAFFIC / UNKNOWN`.
        *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ (–≤ UI –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ `ACT: ...`).
    *   **Outcome Check (HTTPS):**
        *   –û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç activation –≤—ã—á–∏—Å–ª—è–µ—Ç outcome `SUCCESS / FAILED / UNKNOWN`.
        *   –î–ª—è HTTPS outcome –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ **–∞–∫—Ç–∏–≤–Ω–æ–º tagged probe** (TCP+TLS+HTTP –∫ —Ü–µ–ª–∏) –∏ –Ω–µ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ø–∞—Å—Å–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ HTTPS.
        *   Probe-–ø–æ—Ç–æ–∫ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫ bypass (—á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—É—é ¬´–∞–∫—Ç–∏–≤–∞—Ü–∏—é¬ª —Ç–æ–ª—å–∫–æ –∏–∑-–∑–∞ probe).
    *   –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ `Apply/Disable` –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º `TrafficEngine` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ `BypassController` –∏ `DiagnosticOrchestrator`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–æ–Ω–æ–∫/—Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π.
    *   –í–∫–ª—é—á–∞–µ—Ç guard: –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–∑—ã–≤–∞—Ç—å `TrafficEngine.*`/`TlsBypassService.*` –≤–Ω–µ manager-scope –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –º–æ–≥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –æ—à–∏–±–∫–æ–π –≤ smoke.

#### –ú–æ–¥–µ–ª—å B (Design target): Policy‚ÄëDriven Group Model (–≥—Ä—É–ø–ø–∞ = –ø–∞–∫–µ—Ç –ø–æ–ª–∏—Ç–∏–∫)

–ö–ª—é—á–µ–≤–æ–π —Ç–µ–∑–∏—Å (Design, 15.01.2026): **–æ–±—Ö–æ–¥ ‚Äî —ç—Ç–æ –Ω–µ ¬´—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã¬ª, –∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç –ø–∞–∫–µ—Ç–∞**. –ù–∞ —É—Ä–æ–≤–Ω–µ WinDivert –º—ã –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–∞–∫–µ—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (IP/–ø–æ—Ä—Ç/–ø—Ä–æ—Ç–æ–∫–æ–ª/–º–∞—Ä–∫–µ—Ä—ã), –ø–æ—ç—Ç–æ–º—É –ª—é–±—ã–µ ¬´—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ¬ª –ø–æ–Ω—è—Ç–∏—è (—Å–µ—Ä–≤–∏—Å, –≥—Ä—É–ø–ø–∞, –∫–∞—Ä—Ç–æ—á–∫–∞) –¥–æ–ª–∂–Ω—ã –≤ –∏—Ç–æ–≥–µ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø–∞–∫–µ—Ç–∞.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ (–∫–∞–∫ ¬´–∑–∞–∫–æ–Ω—ã –ø—Ä–∏—Ä–æ–¥—ã¬ª, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π):
- –ø–∞–∫–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Ç—Ä–µ–±—É–µ—Ç –æ–¥–Ω–æ–≥–æ –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (PASS/BLOCK/MODIFY);
- —Ñ–∏–ª—å—Ç—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –∑–Ω–∞—é—Ç ¬´YouTube/Steam¬ª, –æ–Ω–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–∞–∫–µ—Ç–∞;
- —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–º–∏ (–Ω–µ–ª—å–∑—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ ¬´–¥—Ä–æ–ø¬ª, –∏ ¬´–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é¬ª –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –ø–æ—Ç–æ–∫–∞);
- —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–æ–º–µ–Ω–æ–≤/—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–û—Ç—Å—é–¥–∞ —Ü–µ–ª–µ–≤–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è (–º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è):
- **Semantic Layer (UI/–≥—Ä—É–ø–ø—ã/–∫–∞—Ä—Ç–æ—á–∫–∏)**: —Ç–æ, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Service Group, –≤–∫–ª–∞–¥ –∫–∞—Ä—Ç–æ—á–∫–∏).
- **Policy Layer (FlowPolicy)**: –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ ¬´–µ—Å–ª–∏ match ‚Üí action¬ª.
- **Decision Graph (Snapshot)**: –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π lookup —Ä–µ—à–µ–Ω–∏—è –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º –ø–∞–∫–µ—Ç–∞.
- **Execution Plane (WinDivert handlers/filters)**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞ + –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –¥–ª—è ISP_Audit: –¥–∞–∂–µ –µ—Å–ª–∏ –¥–≤–∏–∂–æ–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ–¥–∏–Ω –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω—ã –∫–∞–∫ ¬´–Ω–∞–±–æ—Ä –ø–æ–ª–∏—Ç–∏–∫¬ª, –∞ –Ω–µ –∫–∞–∫ ¬´–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏¬ª. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è policy-driven –º–æ–¥–µ–ª–∏ ‚Äî –≤ `docs/TODO.md` (P0.2).

–ö–æ–Ω—Ç–µ–∫—Å—Ç: —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (YouTube/Steam/–∏ —Ç.–ø.) —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤/—Ö–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ **–¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**. –ï—Å–ª–∏ —Å—á–∏—Ç–∞—Ç—å ¬´–æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ = –æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è¬ª, –ø–æ–ª—É—á–∞–µ–º UX-–ø–æ–ª–æ–º–∫—É: –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –æ–±—Ö–æ–¥ –∫ CDN ‚Üí ¬´–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å¬ª —Å—Ç–∞–ª INACTIVE, —Ö–æ—Ç—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å.

–ü–æ—ç—Ç–æ–º—É –±–∞–∑–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ö–æ–¥–æ–º ‚Äî **–≥—Ä—É–ø–ø–∞ —Ü–µ–ª–µ–π (Service Group)**, –∞ –∫–∞—Ä—Ç–æ—á–∫–∏/hostKey —è–≤–ª—è—é—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã.
–¶–µ–ª–µ–≤–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞: **–≥—Ä—É–ø–ø–∞ = –ø–∞–∫–µ—Ç –ø–æ–ª–∏—Ç–∏–∫ (per-domain/per-endpoint)**, –≥–¥–µ —Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ ¬´–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –æ–±—Ö–æ–¥–∞¬ª –≤ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏:
- –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –≥—Ä—É–ø–ø–µ –∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ-–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä—É;
- –∞–∫–∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ—Å—Ç—å (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ü–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—É –Ω–µ –≤—ã–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ);
- —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–±–µ–∑ –≥–æ–Ω–æ–∫ –∏ —á–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π);
- –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (–≤–∏–¥–Ω–æ —Å–æ—Å—Ç–∞–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –≤–∫–ª–∞–¥ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏).

–í–∞–∂–Ω–æ: –∞–∫–∫—É–º—É–ª—è—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–∫ endpoints/—Ñ–ª–∞–≥–∞–º/–ø–æ–ª–∏—Ç–∏–∫–∞–º**, –Ω–æ –Ω–µ –æ–±—è–∑–∞–Ω–∞ –æ–∑–Ω–∞—á–∞—Ç—å ¬´–æ–¥–Ω–∞ –æ–±—â–∞—è TLS‚Äë—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ –≤—Å–µ—Ö¬ª. –î–ª—è TCP/443 –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ –º–æ–¥–µ–ª—å policy‚Äë–≤—ã–±–æ—Ä–∞: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç –ø–∞–∫–µ—Ç–∞ (dst_ip/proto/port/tls_stage).

##### –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

- –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Å—Ç–∞—ë—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º: WinDivert/TrafficEngine –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ ‚Äî —ç—Ç–æ –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞, –≤–ª–∞–¥–µ–ª–µ—Ü –∫–æ—Ç–æ—Ä–æ–≥–æ `BypassStateManager`.
- UX/—Å–µ–º–∞–Ω—Ç–∏–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ¬´per-group¬ª: –≥—Ä—É–ø–ø–∞ —Ö—Ä–∞–Ω–∏—Ç **–Ω–∞–±–æ—Ä attachments** (–≤–∫–ª–∞–¥–æ–≤) –æ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫/hostKey –∏ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
- –ö–∞–∂–¥–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ö—Ä–∞–Ω–∏—Ç:
    - –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ –≥—Ä—É–ø–ø–µ (GroupKey),
    - —Å–≤–æ–π –≤–∫–ª–∞–¥ (Attachment) –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≥—Ä—É–ø–ø—ã,
    - —Å—Ç–∞—Ç—É—Å —Å–≤–æ–µ–≥–æ —Ä–µ—Ç–µ—Å—Ç–∞/–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è,
    - —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≥—Ä—É–ø–ø—ã, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–∞ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∞.

##### –ü—Ä–∞–≤–∏–ª–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (–∫–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç single-owner)

–ì—Ä—É–ø–ø–∞ —Ü–µ–ª–µ–π –¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –≤–∫–ª–∞–¥–æ–≤ (attachments), –Ω–æ –∏—Ç–æ–≥–æ–≤–∞—è ¬´—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è¬ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫:
- **Policy bundle** (–Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –≤—ã–±–∏—Ä–∞—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø–∞–∫–µ—Ç–∞);
- –ø–ª—é—Å –∞–∫–∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —á–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, endpoints –¥–ª—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–≥–æ QUIC‚ÜíTCP –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫).

–ü—Ä–∏–º–µ—Ä (YouTube):
- –ì—Ä—É–ø–ø–∞: `YouTube.com`.
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏): `youtube.com`, `googlevideo.com`, `ytimg.com`, `gstatic.com`, ‚Ä¶
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç –æ–±—Ö–æ–¥ –∫ `googlevideo.com` ‚Üí —ç—Ç–æ **–¥–æ–±–∞–≤–ª—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–∫–ª–∞–¥** –≤ –≥—Ä—É–ø–ø—É, –Ω–µ –≤—ã–∫–ª—é—á–∞—è `youtube.com`.

–ü—Ä–∞–≤–∏–ª–∞ –º–µ—Ä–∂–∞ (—Ü–µ–ª–µ–≤—ã–µ, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ ¬´—Ö–∞–æ—Å–∞¬ª):
- Endpoints: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ (union) endpoint-–Ω–∞–±–æ—Ä–æ–≤ (IPv4/IPv6) –ø–æ –≤—Å–µ–º attachments –≥—Ä—É–ø–ø—ã, —Å TTL/cap –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º (DNS/SNI/resolve/observed).
- Assist-—Ñ–ª–∞–≥–∏: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ (OR). –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É –Ω—É–∂–µ–Ω `QUIC‚ÜíTCP`, –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø—ã.
- TLS‚Äë—Å—Ç—Ä–∞—Ç–µ–≥–∏—è: **–Ω–µ –æ–¥–Ω–∞ –Ω–∞ –≥—Ä—É–ø–ø—É**, –∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è policy‚Äë–¥–≤–∏–∂–∫–æ–º –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º –ø–∞–∫–µ—Ç–∞ (dst_ip/proto/port/tls_stage) ‚Äî —Ç–∞–∫ —Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–í–∞–∂–Ω–æ: –¥–∞–∂–µ –µ—Å–ª–∏ –¥–≤–∏–∂–æ–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ–¥–∏–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ, –≤ UI —ç—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ ¬´–∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã¬ª, –∞ –Ω–µ ¬´–∞–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–∫–∞ X¬ª.

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏): –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø –∏ —ç—Ç–æ —è–≤–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ blast radius.

##### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ¬´–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±—Ö–æ–¥–∞¬ª (—á—Ç–æ –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

–ö–∞–∂–¥–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∏ —Å–Ω–∏–º–∫–æ–º:
- Request: GroupKey, –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä (hostKey –∫–∞—Ä—Ç–æ—á–∫–∏ + —Ç–∏–ø: —Ä—É—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ / –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ), –ø—Ä–∏—á–∏–Ω–∞, —Ç–∞–π–º–∞—É—Ç/–æ—Ç–º–µ–Ω–∞.
- Snapshot:
    - EffectiveGroupConfig: –∏—Ç–æ–≥–æ–≤—ã–µ —Ñ–ª–∞–≥–∏/endpoint-–Ω–∞–±–æ—Ä—ã/—Ü–µ–ª—å outcome.
    - PolicyBundle: —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (per-domain/per-port) –∏ –∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã.
    - Contributions: —Å–ø–∏—Å–æ–∫ –≤–∫–ª–∞–¥–æ–≤ (–∫–∞–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏/hostKey —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏, –∫–∞–∫–æ–π endpoint-–Ω–∞–±–æ—Ä/—Ñ–ª–∞–≥–∏/–ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–Ω–µ—Å–ª–∏).
    - FiltersActive: –∫–∞–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã (–∏–º—è + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) –∏ –ø–æ—á–µ–º—É.
    - InputFacts: –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (DNS/SNI/resolve/observed), –≤–æ–∑—Ä–∞—Å—Ç/TTL, –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏—è –ø–æ cap/ttl.
- Result: Applied/Failed/RolledBack + –æ—à–∏–±–∫–∞ + —Ç–∞–π–º–∏–Ω–≥–∏.

##### –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≤ UI/–ª–æ–≥–∞—Ö

- –í –∫–∞—Ä—Ç–æ—á–∫–µ: –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ ¬´–≤ –≥—Ä—É–ø–ø–µ <GroupKey>¬ª, —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥—Ä—É–ø–ø—ã, –∏ ‚ÄúEffectiveGroupConfig‚Äù (–≤ 1 —Å—Ç—Ä–æ–∫—É: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è + —Ñ–ª–∞–≥–∏ + endpoints=N).
- –í –¥–µ—Ç–∞–ª—è—Ö (–ø–∞–Ω–µ–ª—å/expander): –ø–æ–ª–Ω—ã–π —Å–Ω–∏–º–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∫–Ω–æ–ø–∫–∞ ¬´–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å¬ª (–¥–ª—è —Ä–µ–ø–æ—Ä—Ç–∞).
- –í –ª–æ–≥–µ: –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (TransactionId + GroupKey + initiatorHostKey + strategy + flags + endpoint-count) –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ –¥–µ—Ç–∞–ª–µ–π.
*   **`TestResultsManager`**: –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`ObservableCollection<TestResult>`). –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –ø–æ—Ç–æ–∫–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞. –ü–æ—Å–ª–µ P0.3 –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ partial-—Ñ–∞–π–ª—ã –ø–æ –∑–æ–Ω–∞–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (—Å—á—ë—Ç—á–∏–∫–∏/–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/–ø–∞—Ä—Å–∏–Ω–≥ –ø–∞–π–ø–ª–∞–π–Ω–∞/DNS/—ç–≤—Ä–∏—Å—Ç–∏–∫–∏/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã).

Dev-–ø—Ä–æ–≤–µ—Ä–∫–∞ (smoke): –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ UI –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ GUI –µ—Å—Ç—å —Ä–µ–∂–∏–º `--ui-reducer-smoke` –≤ `TestNetworkApp` (–ø—Ä–æ–≥–æ–Ω —Ç–∏–ø–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞ —á–µ—Ä–µ–∑ `TestResultsManager.ParsePipelineMessage`).

–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ (analyzers/–ª–∏–Ω—Ç):
* –í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `Directory.Build.props` –∏ `.editorconfig`.
* –í–∫–ª—é—á–µ–Ω—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ .NET analyzers (`EnableNETAnalyzers=true`), –±–µ–∑ —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è `AnalysisMode/AnalysisLevel` (–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç—ã SDK, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å —à—É–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π).
* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è analyzers –∏–º–µ—é—Ç —É—Ä–æ–≤–µ–Ω—å `suggestion` (—á—Ç–æ–±—ã –Ω–µ —Ç–æ–Ω—É—Ç—å –≤ —à—É–º–µ).
* –î–ª—è non-UI —Å–ª–æ—ë–≤ (`Core/`, `Bypass/`, `Utils/`, `TestNetworkApp/`, `SmokeLauncher/`) –ø–æ–¥–Ω—è—Ç—ã –¥–æ `warning` –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:
    * `CA2000` (dispose –æ–±—ä–µ–∫—Ç–æ–≤)
    * `CA2200` (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π rethrow)
    * `CA2007` (ConfigureAwait) –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ `suggestion` (–ø–æ–¥—Å–∫–∞–∑–∫–∞, –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è)

–ü—Ä–∞–≤–∏–ª–æ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ (code health):
* –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–∑—Ä–∞—Å—Ç–∞–µ—Ç—Å—è –¥–æ **500‚Äì700+ —Å—Ç—Ä–æ–∫**, —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –∫ –≤—ã–Ω–æ—Å—É: —Å–Ω–∞—á–∞–ª–∞ `partial` (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ API), –∑–∞—Ç–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã/—Å–µ—Ä–≤–∏—Å—ã.
* –ù–µ —Å–º–µ—à–∏–≤–∞–µ–º —Å–ª–æ–∏: `ViewModels/` –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É bypass/–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –∞ `Core/` –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç WPF.
* –õ—é–±–æ–µ –≤—ã–Ω–µ—Å–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫—É –∏ –Ω–µ –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫).

–°—Ç–∞—Ç—É—Å (P0.3): `BypassController` –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ partial-—Ñ–∞–π–ª—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è): [ViewModels/BypassController.Internal.cs](ViewModels/BypassController.Internal.cs), [ViewModels/BypassController.Metrics.cs](ViewModels/BypassController.Metrics.cs), [ViewModels/BypassController.Startup.cs](ViewModels/BypassController.Startup.cs), [ViewModels/BypassController.Core.cs](ViewModels/BypassController.Core.cs), [ViewModels/BypassController.DnsDoh.cs](ViewModels/BypassController.DnsDoh.cs), [ViewModels/BypassController.Observability.cs](ViewModels/BypassController.Observability.cs), [ViewModels/BypassController.V2.cs](ViewModels/BypassController.V2.cs).

–°—Ç–∞—Ç—É—Å (P0.3): `BypassStateManager` –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ partial-—Ñ–∞–π–ª—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è): [Bypass/BypassStateManager.cs](Bypass/BypassStateManager.cs), [Bypass/BypassStateManager.ObservedIpCache.cs](Bypass/BypassStateManager.ObservedIpCache.cs), [Bypass/BypassStateManager.SessionJournal.cs](Bypass/BypassStateManager.SessionJournal.cs), [Bypass/BypassStateManager.Watchdog.cs](Bypass/BypassStateManager.Watchdog.cs), [Bypass/BypassStateManager.Activation.cs](Bypass/BypassStateManager.Activation.cs), [Bypass/BypassStateManager.Outcome.cs](Bypass/BypassStateManager.Outcome.cs).

–°—Ç–∞—Ç—É—Å (P0.3): `DiagnosticOrchestrator` –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ partial-—Ñ–∞–π–ª—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è): [ViewModels/DiagnosticOrchestrator.cs](ViewModels/DiagnosticOrchestrator.cs), [ViewModels/DiagnosticOrchestrator.Core.cs](ViewModels/DiagnosticOrchestrator.Core.cs), [ViewModels/DiagnosticOrchestrator.Monitoring.cs](ViewModels/DiagnosticOrchestrator.Monitoring.cs), [ViewModels/DiagnosticOrchestrator.Recommendations.cs](ViewModels/DiagnosticOrchestrator.Recommendations.cs), [ViewModels/DiagnosticOrchestrator.Recommendations.Apply.cs](ViewModels/DiagnosticOrchestrator.Recommendations.Apply.cs), [ViewModels/DiagnosticOrchestrator.System.cs](ViewModels/DiagnosticOrchestrator.System.cs), [ViewModels/DiagnosticOrchestrator.Private.cs](ViewModels/DiagnosticOrchestrator.Private.cs).

–°—Ç–∞—Ç—É—Å (4.3, –Ω–∞—á–∞–ª–æ): –º–æ–¥–µ–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è `DiagnosticOrchestrator` –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤—ã–Ω–æ—Å—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∏–ø—ã –≤ [ViewModels/OrchestratorState/](ViewModels/OrchestratorState/). –ü–µ—Ä–≤—ã–π –≤—ã–Ω–µ—Å–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚Äî [ViewModels/OrchestratorState/PostApplyRetestState.cs](ViewModels/OrchestratorState/PostApplyRetestState.cs) (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å—Ç-Apply —Ä–µ—Ç–µ—Å—Ç–∞).

–°—Ç–∞—Ç—É—Å (P0.2, –≠—Ç–∞–ø 0): –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞—Ä–∫–∞—Å policy-driven —Å–ª–æ—è –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ runtime: –º–æ–¥–µ–ª—å –ø–æ–ª–∏—Ç–∏–∫ [Core/Models/FlowPolicy.cs](Core/Models/FlowPolicy.cs) + [Core/Models/MatchCondition.cs](Core/Models/MatchCondition.cs) + [Core/Models/PolicyAction.cs](Core/Models/PolicyAction.cs), snapshot [Core/Models/DecisionGraphSnapshot.cs](Core/Models/DecisionGraphSnapshot.cs) –∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ [Core/Bypass/PolicySetCompiler.cs](Core/Bypass/PolicySetCompiler.cs). Gate smoke: `DPI2-040`.

–°—Ç–∞—Ç—É—Å (P0.2, –≠—Ç–∞–ø 1): UDP/443 (QUIC‚ÜíTCP) –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ policy-driven execution plane –ø–æ–¥ feature-gate `ISP_AUDIT_POLICY_DRIVEN_UDP443=1` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ): `BypassStateManager` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç `DecisionGraphSnapshot` (LOCAL/GLOBAL), `TlsBypassService` —Ö—Ä–∞–Ω–∏—Ç snapshot –∏ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç –µ–≥–æ –≤ `BypassFilter`, –∞ `BypassFilter` –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ lookup –≤ –≥—Ä–∞—Ñ–µ (—Å fallback –Ω–∞ legacy –ª–æ–≥–∏–∫—É –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º gate). –î–æ–±–∞–≤–ª–µ–Ω–∞ runtime-–Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å per-policy (internal snapshot —Å—á—ë—Ç—á–∏–∫–æ–≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π) –∏ smoke-gate `DPI2-041`.

–°—Ç–∞—Ç—É—Å (P0.2, –≠—Ç–∞–ø 2): TTL endpoint block (reconnect-nudge) –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ policy-driven execution plane –ø–æ–¥ feature-gate `ISP_AUDIT_POLICY_DRIVEN_TTLBLOCK=1` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ): –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ endpoint (–ø–æ—Ä—Ç 443) –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ TTL-–ø–æ–ª–∏—Ç–∏–∫–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (TTL ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –∏—Å—Ç–µ—á–µ–Ω–∏—è –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏). –î–æ–±–∞–≤–ª–µ–Ω UI —Å—Ç–∞—Ç—É—Å `EndpointBlockStatus` (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´Endpoint –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ ‚Ä¶¬ª) –∏ smoke-gate `DPI2-042`.

–°—Ç–∞—Ç—É—Å (P0.2, –≠—Ç–∞–ø 3): TCP/80 HTTP Host tricks –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ policy-driven execution plane –ø–æ–¥ feature-gate `ISP_AUDIT_POLICY_DRIVEN_TCP80=1` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ): –¥–µ–π—Å—Ç–≤–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ strategy (`PolicyAction.HttpHostTricks`, `StrategyId=http_host_tricks`), `BypassStateManager` –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–æ–ª–∏—Ç–∏–∫—É –≤ `DecisionGraphSnapshot`, –∞ `BypassFilter` –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–µ—Ö–Ω–∏–∫—É (—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è `Host:` –∏ drop –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞) —á–µ—Ä–µ–∑ lookup –≤ –≥—Ä–∞—Ñ–µ, —Å fallback –Ω–∞ legacy-–≤–µ—Ç–∫—É –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º gate. Smoke-gate `DPI2-043`.

–°—Ç–∞—Ç—É—Å (P0.2, –≠—Ç–∞–ø 4): TCP/443 TLS ClientHello –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ policy-driven execution plane –ø–æ–¥ feature-gate `ISP_AUDIT_POLICY_DRIVEN_TCP443=1` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ): –≤—ã–±–æ—Ä effective TLS —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ lookup –≤ `DecisionGraphSnapshot` (action strategy `PolicyAction.TlsBypassStrategy`, `StrategyId=tls_bypass_strategy`, –ø–∞—Ä–∞–º–µ—Ç—Ä `tls_strategy`), —Å fallback –Ω–∞ legacy `BypassProfile.TlsStrategy` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ policy –∏–ª–∏ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º gate. –î–æ–±–∞–≤–ª–µ–Ω—ã per-policy —Å—á—ë—Ç—á–∏–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π –∏ smoke-gate `DPI2-044`.

–°—Ç–∞—Ç—É—Å (P0.2, –≠—Ç–∞–ø 5): –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞—Ä–∫–∞—Å Semantic Groups –∫–∞–∫ ¬´–ø–∞–∫–µ—Ç –ø–æ–ª–∏—Ç–∏–∫¬ª –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≥—Ä—É–ø–ø—ã –ø–æ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–º policy-–º–µ—Ç—Ä–∏–∫–∞–º: –≤–≤–µ–¥–µ–Ω–∞ –º–æ–¥–µ–ª—å [Core/Models/SemanticGroup.cs](Core/Models/SemanticGroup.cs) –∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ [Core/Bypass/SemanticGroupEvaluator.cs](Core/Bypass/SemanticGroupEvaluator.cs), –∞ –≤ `BypassFilter` —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ observability per-policy –º–µ—Ç—Ä–∏–∫–∞–º–∏ `matched_count` (–≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ `applied_count`). Smoke-gate `DPI2-045` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã `NO_TRAFFIC / PARTIAL / ENABLED` –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–º —Ç—Ä–∞—Ñ–∏–∫–µ. MVP UI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: `TlsBypassService` –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–∑ `DecisionGraphSnapshot` + matched-counts; –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ —à–∞–ø–∫–µ bypass-–ø–∞–Ω–µ–ª–∏, –∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ ‚Äî –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ú–µ—Ç—Ä–∏–∫–∏¬ª.

–°—Ç–∞—Ç—É—Å (P0.3): `TestResultsManager` –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ partial-—Ñ–∞–π–ª—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è): [ViewModels/TestResultsManager.cs](ViewModels/TestResultsManager.cs) (63), [ViewModels/TestResultsManager.Counters.cs](ViewModels/TestResultsManager.Counters.cs) (35), [ViewModels/TestResultsManager.Initialization.cs](ViewModels/TestResultsManager.Initialization.cs) (46), [ViewModels/TestResultsManager.Update.cs](ViewModels/TestResultsManager.Update.cs) (136), [ViewModels/TestResultsManager.PipelineParsing.cs](ViewModels/TestResultsManager.PipelineParsing.cs) (14), [ViewModels/TestResultsManager.PipelineMessageParser.cs](ViewModels/TestResultsManager.PipelineMessageParser.cs) (73), [ViewModels/TestResultsManager.Tokens.cs](ViewModels/TestResultsManager.Tokens.cs) (31), [ViewModels/TestResultsManager.DnsResolution.cs](ViewModels/TestResultsManager.DnsResolution.cs) (89), [ViewModels/TestResultsManager.Heuristics.cs](ViewModels/TestResultsManager.Heuristics.cs) (71), [ViewModels/TestResultsManager.Private.cs](ViewModels/TestResultsManager.Private.cs) (327).

–°—Ç–∞—Ç—É—Å (P0.3): –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫ pipeline –≤—ã–Ω–µ—Å–µ–Ω –≤ top-level —Å–µ—Ä–≤–∏—Å [ViewModels/PipelineMessageParser.cs](ViewModels/PipelineMessageParser.cs) (593) —Å —è–≤–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (`IPipelineMessageParserContext`).

UI-–≥–µ–π—Ç –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º (v2-only): UI –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏/—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ö–æ–¥–∞ —Ç–æ–ª—å–∫–æ –∏–∑ —Å—Ç—Ä–æ–∫ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[V2]`. –õ—é–±—ã–µ legacy —Å—Ç—Ä–æ–∫–∏ –º–æ–≥—É—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ª–æ–≥–µ, –Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç `BypassStrategy` –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ø–∞–Ω–µ–ª—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (UX —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π): –±–ª–æ–∫ ¬´–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏¬ª –≤ bypass-–ø–∞–Ω–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ `HasAnyRecommendations` (–µ—Å—Ç—å v2-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ **–∏–ª–∏** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã ¬´—Ä—É—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è¬ª), –∞ –∫–Ω–æ–ø–∫–∞ apply —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `HasRecommendations` (–µ—Å—Ç—å –æ–±—ä–µ–∫—Ç–Ω—ã–π `BypassPlan` –∏ –µ—Å—Ç—å —á—Ç–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å). –ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤—Ä—É—á–Ω—É—é, –æ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ ¬´—Ä—É—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ¬ª, —á—Ç–æ–±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ ¬´–ø—Ä–æ–ø–∞–¥–∞–ª–∏¬ª.

–í–∞–∂–Ω–æ: bypass-–ø–∞–Ω–µ–ª—å (–∏ –∫–Ω–æ–ø–∫–∞ apply –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

Guard –Ω–∞ legacy –≤ v2 –ø—É—Ç–∏: smoke-—Ç–µ—Å—Ç `DPI2-025` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤ v2 runtime-–ø—É—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç `GetSignals(...)`, `legacySignals.*` –∏ –ª—é–±—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `BlockageSignals` (grep/regex –ø–æ `Core/IntelligenceV2/*` –∏ –∫–ª—é—á–µ–≤—ã–º runtime-—Ñ–∞–π–ª–∞–º).

Smoke-—Ä–∞–Ω–Ω–µ—Ä (CLI): –≤ `TestNetworkApp` –µ—Å—Ç—å —Ä–µ–∂–∏–º `--smoke [all|infra|pipe|insp|ui|bypass|dpi2|orch|cfg|err|e2e|perf|reg]`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ –ø–ª–∞–Ω–∞ —Å–º–æ–∫–æ–≤ (–±–µ–∑ GUI). –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –ø–ª–∞–Ω–∞ smoke runner –ø—Ä–æ–≥–æ–Ω—è–µ—Ç **–≤—Å–µ** Test ID –∏–∑ `TestNetworkApp/smoke_tests_plan.md`; –µ—Å–ª–∏ —Ç–µ—Å—Ç –∏–∑ –ø–ª–∞–Ω–∞ –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `FAIL` —Å –ø—Ä–∏—á–∏–Ω–æ–π (—ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ, —á—Ç–æ–±—ã –±—ã–ª–æ 97/97 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –±–µ–∑ "SKIP"). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–∞—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–æ–∫, –∑–∞–≤—è–∑–∞–Ω–Ω—ã—Ö –Ω–∞ WinDivert/—Å—Ä–µ–¥—É, –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –∏–ª–∏ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `SKIP` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫ –Ω–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞). –î–ª—è ¬´–∂—ë—Å—Ç–∫–æ–≥–æ¬ª –ø—Ä–æ–≥–æ–Ω–∞ –±–µ–∑ `SKIP` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--smoke ... --no-skip` (–∞–ª–∏–∞—Å `--strict`): –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ª—é–±—ã–µ `SKIP` —Å—á–∏—Ç–∞—é—Ç—Å—è `FAIL`. –î–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω `--json <path>`. –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ —Ä–∞–∑–Ω–µ—Å–µ–Ω—ã –ø–æ —Ñ–∞–π–ª–∞–º `TestNetworkApp/Smoke/SmokeTests.*.cs`, –∞ –∫–∞—Ä–∫–∞—Å —Ä–∞–Ω–Ω–µ—Ä–∞/–ø–ª–∞–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ `TestNetworkApp/Smoke/SmokeRunner.cs`.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è `dpi2` (DPI Intelligence v2) –ø–æ–∫—Ä—ã—Ç–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ smoke-—Ç–µ—Å—Ç–∞–º–∏ `DPI2-001..024` –≤ `TestNetworkApp/Smoke/SmokeTests.Dpi2.cs`: –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è legacy —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ TTL-store, –æ—á–∏—Å—Ç–∫–∞ –ø–æ TTL, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –æ–∫–Ω–∞–º 30s/60s, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∏–∞–≥–Ω–æ–∑–∞, –∂—ë—Å—Ç–∫–∏–µ –∑–∞—â–∏—Ç—ã —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ (confidence/risk/unimplemented), Gate-–º–∞—Ä–∫–µ—Ä—ã `[V2][GATE1]`, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[V2]`, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ auto-apply (MVP), –∞ —Ç–∞–∫–∂–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä—É—á–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è v2-–ø–ª–∞–Ω–∞ (TlsFragment params + e2e selector‚Üíplan‚Üímanual apply).

–ö–∞—Ç–µ–≥–æ—Ä–∏—è `insp` (Inspection Services) –ø–æ–∫—Ä—ã—Ç–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ smoke-—Ç–µ—Å—Ç–∞–º–∏ `INSP-001..005` –≤ `TestNetworkApp/Smoke/SmokeTests.Insp.cs`: RST-–∏–Ω–∂–µ–∫—Ü–∏—è –ø–æ TTL –∏ –ø–æ IPID, –¥–µ—Ç–µ–∫—Ç QUIC Initial –∏ —Å–∏–≥–Ω–∞–ª ¬´–Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤¬ª, –ø–æ–¥—Å—á—ë—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π –∏ —Å–∏–≥–Ω–∞–ª ¬´–ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ Drop¬ª –ø—Ä–∏ –¥–æ–ª–µ >10%, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ host –∏–∑ HTTP 3xx Location. –î–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ IPv4/TCP/UDP –ø–∞–∫–µ—Ç—ã –∏–∑ `TestNetworkApp/Smoke/SmokeTests.Packets.cs`.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è `bypass` (TLS bypass) —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ smoke-—Ç–µ—Å—Ç–∞–º–∏ `BYPASS-003..015` –≤ `TestNetworkApp/Smoke/SmokeTests.Bypass.cs`: —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `MetricsUpdated`, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–µ—Ä–¥–∏–∫—Ç–∞ —á–µ—Ä–µ–∑ `VerdictChanged` –ø–æ –ø–æ—Ä–æ–≥–∞–º ratio RST/—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ `BypassFilter` (—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è/–¥–∏–∑–æ—Ä–¥–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–æ–≤, TTL Trick, Drop RST, –≥–µ–π—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ 443+SNI –∏ –ø–æ—Ä–æ–≥ threshold –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö ClientHello), –∞ —Ç–∞–∫–∂–µ –∞–≤—Ç–æ-–ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ (AutoTTL –∏ AutoAdjustAggressive –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º). –î–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `BypassFilter` + —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ TCP –ø–∞–∫–µ—Ç—ã (ClientHello/RST) –∏ –∑–∞—Ö–≤–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π sender, –∞ `TlsBypassService` –ø–æ–ª—É—á–∞–µ—Ç internal-—Ö—É–∫–∏/—Å—Ü–µ–Ω–∞—Ä–∏–∏ smoke –¥–ª—è –ø—Ä–æ–≥–æ–Ω–∞ –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ WinDivert.

–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫–∞—Ç–æ—Ä `SmokeLauncher` —Å–∞–º –∑–∞–ø—Ä–æ—Å–∏—Ç UAC elevation, –≤—ã–ø–æ–ª–Ω–∏—Ç `--smoke all --strict` (–∞–ª–∏–∞—Å `--no-skip`) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç JSON –≤ `artifacts/`.

- –ó–∞–ø—É—Å–∫ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤: `dotnet run -c Debug --project SmokeLauncher/SmokeLauncher.csproj`
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ EXE: `dotnet publish -c Release -r win-x64 -p:PublishSingleFile=true -p:SelfContained=false --project SmokeLauncher/SmokeLauncher.csproj`

### 3.2 Orchestration Layer

*   **`DiagnosticOrchestrator`**: "–î–∏—Ä–∏–∂–µ—Ä" –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
    *   –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `LiveTestingPipeline`.
    *   –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ñ–æ–Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (`TrafficEngine`, `ConnectionMonitor`).
    *   –°–ª–µ–¥–∏—Ç –∑–∞ —Ü–µ–ª–µ–≤—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω —Ñ–∏–ª—å—Ç—Ä –ø–æ PID).
    *   –í–∞–∂–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: —Å–æ–±—ã—Ç–∏—è SNI –∏–∑ `DnsParserService` **–≥–µ–π—Ç—è—Ç—Å—è –ø–æ PID**. –¢–∞–∫ –∫–∞–∫ WinDivert Network Layer –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç PID, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç SNI —Å —Å–æ–±—ã—Ç–∏—è–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π `ConnectionMonitorService` (remote endpoint ‚Üí PID) –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤ –ø–∞–π–ø–ª–∞–π–Ω —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ `PidTrackerService.TrackedPids`.
        *   –î–ª—è Steam/attach –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∏–π –±—É—Ñ–µ—Ä (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥), —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —Ä–∞–Ω–Ω–∏–π SNI –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è PID.
    *   –í–∞–∂–Ω–æ: SNI –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ `NoiseHostFilter` –Ω–∞ –≤—Ö–æ–¥–µ (—ç—Ç–æ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ). –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ¬´—à—É–º–∞¬ª –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∞–ø–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
    *   –ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è QUIC‚ÜíTCP: –ø—Ä–∏ –¥–µ—Ç–µ–∫—Ç–µ UDP/QUIC –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`UdpInspectionService.OnBlockageDetected`) –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ª—å outcome (–ø–æ SNI/DNS –∫–µ—à—É, —Å fallback –Ω–∞ IP), —á—Ç–æ–±—ã —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π `DropUdp443` –Ω–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è ¬´–≤–∫–ª—é—á—ë–Ω, –Ω–æ –±–µ–∑ —Ü–µ–ª–∏¬ª.
    *   UX: –æ—Ç–¥–µ–ª—å–Ω–æ–µ –æ–≤–µ—Ä–ª–µ–π-–æ–∫–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω–æ (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–≤–µ—Ä—Ö —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞).
*   **`LiveTestingPipeline`** (`Utils/LiveTestingPipeline.*.cs`): –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –Ω–∞ –±–∞–∑–µ `System.Threading.Channels`.
    *   –°–≤—è–∑—ã–≤–∞–µ—Ç —ç—Ç–∞–ø—ã: Sniffing ‚Üí Testing ‚Üí Classification ‚Üí Reporting.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `UnifiedTrafficFilter` –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (loopback) –∏ –ø—Ä–∞–≤–∏–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å UI ¬´—É—Å–ø–µ—à–Ω—ã–º–∏¬ª —Ü–µ–ª—è–º–∏).
    *   –í—ã–ø–æ–ª–Ω—è–µ—Ç –≥–µ–π—Ç–∏–Ω–≥ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ `IBlockageStateStore.TryBeginHostTest(...)` (–∫—É–ª–¥–∞—É–Ω + –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫), —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å —Å–µ—Ç—å, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –¥–∞—Ç—å V2 –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π (SignalSequence) –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º/–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ö–æ—Å—Ç–∞–º.
    *   –í–∞–∂–Ω–æ: `TrafficCollector` –¥–µ–¥—É–ø–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ `RemoteIp:RemotePort:Protocol`, –Ω–æ –≤ runtime –¥–æ–ø—É—Å–∫–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ ¬´–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è¬ª —ç—Ç–æ–π –∂–µ —Ü–µ–ª–∏ —Å –∫—É–ª–¥–∞—É–Ω–æ–º/–ª–∏–º–∏—Ç–æ–º ‚Äî –∏–Ω–∞—á–µ —Ä–µ—Ç–µ—Å—Ç—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –¥–æ–π–¥—É—Ç –¥–æ pipeline.
    *   –ü—É–±–ª–∏–∫—É–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π `[PipelineHealth]` –ª–æ–≥ —Å–æ —Å—á—ë—Ç—á–∏–∫–∞–º–∏ —ç—Ç–∞–ø–æ–≤ (enqueue/test/classify/ui), —á—Ç–æ–±—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –∏ ¬´–∑–∞—Ç—ã–∫–∏¬ª –æ—á–µ—Ä–µ–¥–µ–π –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å—Ü–µ–Ω–∞—Ä–∏—è–º.
    *   –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ö–æ—Å—Ç–æ–≤.
    *   –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `AutoHostlistService`: –Ω–∞ —ç—Ç–∞–ø–µ Classification –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Ö–æ—Å—Ç–æ–≤ –≤ –∞–≤—Ç–æ-hostlist (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä—É—á–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è). Auto-hostlist –ø–∏—Ç–∞–µ—Ç—Å—è `InspectionSignalsSnapshot` (v2-only). –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ —Ö–æ—Å—Ç —Å—Ç–∞–ª –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º, —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –≤ v2 —Ö–≤–æ—Å—Ç (evidence/notes) –∫–∞–∫ –∫–æ—Ä–æ—Ç–∫–∞—è –Ω–æ—Ç–∞ `autoHL hits=‚Ä¶ score=‚Ä¶`.
    *   v2 UX-–≥–µ–π—Ç: —Å–æ–±—ã—Ç–∏–µ `OnV2PlanBuilt` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ—à–ª–∏ —Ñ–∏–ª—å—Ç—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º–∞ (`FilterAction.Process`), —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ apply –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞ –ø–ª–∞–Ω, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ —à—É–º–æ–≤–æ–º—É/—É—Å–ø–µ—à–Ω–æ–º—É —Ö–æ—Å—Ç—É.

Smoke-—Ö–µ–ª–ø–µ—Ä—ã (–¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–µ–∑ WinDivert/—Ä–µ–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏):
* `DnsParserService.TryExtractSniFromTlsClientHelloPayload(...)` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ SNI –∏–∑ TLS payload.
* `DnsParserService.TryFeedTlsClientHelloFragmentForSmoke(...)` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞—Å—Å–µ–º–±–ª–∏–Ω–≥–∞ SNI –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö ClientHello.

### 3.2.1 DPI Intelligence v2

–°—Ç–∞—Ç—É—Å: —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.
* –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π —Å–ª–æ–π v2: `Core/IntelligenceV2/Contracts`.
* Step 1 (Signals): –≤ runtime –ø–æ–¥–∫–ª—é—á—ë–Ω —Å–±–æ—Ä —Ñ–∞–∫—Ç–æ–≤ –≤ TTL-store —á–µ—Ä–µ–∑ `SignalsAdapterV2` (–≤ `LiveTestingPipeline`, —ç—Ç–∞–ø Classification). –§–∞–∫—Ç—ã –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ —Å–Ω–∏–º–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `IInspectionSignalsProvider` –≤ –≤–∏–¥–µ `InspectionSignalsSnapshot` (v2-only).
    * –ì–µ–π—Ç–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ü–µ–ª–∏: `InMemoryBlockageStateStore.TryBeginHostTest(...)` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—É–ª–¥–∞—É–Ω –∏ –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫, —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å —Å–µ—Ç—å, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –¥–∞—Ç—å V2 –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π (SignalSequence) –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º/–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ö–æ—Å—Ç–∞–º.
* Step 2 (Diagnosis): –≤ runtime –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∏–∞–≥–Ω–æ–∑–∞ —á–µ—Ä–µ–∑ `StandardDiagnosisEngineV2` –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Å—Ä–µ–∑—É `BlockageSignalsV2`.
* Step 3 (Selector/Plan): –≤ runtime –ø–æ–¥–∫–ª—é—á—ë–Ω `StandardStrategySelectorV2`, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∏—Ç `BypassPlan` —Å—Ç—Ä–æ–≥–æ –ø–æ `DiagnosisResult` (id + confidence) –∏ –æ—Ç–¥–∞—ë—Ç –∫—Ä–∞—Ç–∫—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –¥–ª—è UI (–±–µ–∑ auto-apply).
    * –ü–ª–∞–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `DeferredStrategies` ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ (–µ—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ/—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏). –í —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Phase 3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ `HttpHostTricks`, `QuicObfuscation` –∏ `BadChecksum` —Å—á–∏—Ç–∞—é—Ç—Å—è **implemented** –∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ `plan.Strategies`.
* Step 4 (ExecutorMvp): –¥–æ–±–∞–≤–ª–µ–Ω `Core/IntelligenceV2/Execution/BypassExecutorMvp.cs` ‚Äî **—Ç–æ–ª—å–∫–æ** —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–∏–∞–≥–Ω–æ–∑ + —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å + –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ + —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π), –±–µ–∑ –≤—ã–∑–æ–≤–∞ `TrafficEngine`/`BypassController` –∏ –±–µ–∑ –∞–≤—Ç–æ-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
* –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ v2 –ø–ª–∞–Ω–∞ (–±–µ–∑ auto-apply): `LiveTestingPipeline` –ø—É–±–ª–∏–∫—É–µ—Ç –æ–±—ä–µ–∫—Ç–Ω—ã–π `BypassPlan` —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `OnV2PlanBuilt`, `DiagnosticOrchestrator` —Ö—Ä–∞–Ω–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–ª–∞–Ω –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `BypassController.ApplyV2PlanAsync(...)` (—Ç–∞–π–º–∞—É—Ç/–æ—Ç–º–µ–Ω–∞/–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–∫–∞—Ç).
    * –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –ø–ª–∞–Ω–∞: `DiagnosticOrchestrator.ApplyRecommendationsAsync(...)` –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–ª–∞–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `planHostKey` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π v2-—Ü–µ–ª—å—é, –∏–∑–≤–ª–µ—á—ë–Ω–Ω–æ–π –∏–∑ UI‚Äë–¥–∏–∞–≥–Ω–æ–∑–∞ (–∏–Ω–∞—á–µ ‚Äî SKIP –≤ –ª–æ–≥).
    * –ì–∏–±—Ä–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (MVP, –æ–±—â–∏–π): `TestResultsManager` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–µ–º–µ–π—Å—Ç–≤ (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞ CDN), —á—Ç–æ–±—ã –Ω–∞ –ª–µ—Ç—É –∑–∞–º–µ—á–∞—Ç—å –¥–æ–º–µ–Ω—ã —Å –±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ—Å—Ç–æ–≤ (—Ç–∏–ø–∏—á–Ω—ã–π –∫–µ–π—Å: CDN/—à–∞—Ä–¥–∏–Ω–≥).
        * –ü—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –Ω–∞–±–ª—é–¥–µ–Ω–∏—è—Ö UI –º–æ–∂–µ—Ç —Å—Ö–ª–æ–ø—ã–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–¥—Ö–æ—Å—Ç–æ–≤ –≤ –æ–¥–Ω—É –¥–æ–º–µ–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É (–∫–ª—é—á = –¥–æ–º–µ–Ω–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å).
        * –í –ø–∞–Ω–µ–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å (–¥–æ–º–µ–Ω: <suffix>)¬ª.
        * –ö–æ–º–∞–Ω–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `DiagnosticOrchestrator.ApplyRecommendationsForDomainAsync(..., suffix)`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–º–µ–Ω–∏–º—ã–π v2-–ø–ª–∞–Ω –∏–∑ –ø–æ–¥—Ö–æ—Å—Ç–æ–≤, –Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `OutcomeTargetHost = suffix`.
        * –ö–∞—Ç–∞–ª–æ–≥ –¥–æ–º–µ–Ω–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–µ–º JSON (`%LocalAppData%\ISP_Audit\domain_families.json`): –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å –¥–æ–º–µ–Ω—ã (pinned), –∞ —Ç–∞–∫–∂–µ —Å–º–æ—Ç—Ä–µ—Ç—å/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—É—á–µ–Ω–Ω—ã–µ (learned).
        * –≠—Ç–æ **–Ω–µ** wildcard-–º—ç—Ç—á–∏–Ω–≥ –≤ `BypassFilter`: –¥–æ–º–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ UX-—Ü–µ–ª—å/—Ü–µ–ª—å outcome (–∏ –∫–∞–∫ –≤—Ö–æ–¥ –¥–ª—è —Ä–µ–∑–æ–ª–≤–∞ IP –≤ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–º `DropUdp443`).
    * –û—Ç–º–µ–Ω–∞: –∫–æ–º–∞–Ω–¥–∞ `Cancel` –æ—Ç–º–µ–Ω—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, –Ω–æ –∏ —Ç–µ–∫—É—â–∏–π —Ä—É—á–Ω–æ–π apply (—á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π CTS).
* Step 5 (Feedback/Rerank): –¥–æ–±–∞–≤–ª–µ–Ω —Å–ª–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ `Core/IntelligenceV2/Feedback/*` (MVP: in-memory + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π JSON persist). `StandardStrategySelectorV2` —É–º–µ–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏, **–ø–æ–≤–µ—Ä—Ö** hardcoded `BasePriority`.

---

## 3.2.2 DPI Intelligence v2 ‚Äî –∫–∞—Ä—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (As‚ÄëIs / Target / Roadmap)

–≠—Ç–∞ —Å–µ–∫—Ü–∏—è ‚Äî ¬´–∫–æ–º–ø–∞—Å¬ª, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å: —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å –≤ –∫–æ–¥–µ —Å–µ–π—á–∞—Å, –∫–∞–∫–æ–µ —Ü–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º—ã —Å—á–∏—Ç–∞–µ–º –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º, –∏ –∫–∞–∫–∏–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ª–æ–≥–∏—á–Ω–æ –¥–µ–ª–∞—Ç—å.

### As‚ÄëIs (—á—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–Ω—Ç–∞–π–º–µ)

1) **Signals ‚Üí Diagnosis ‚Üí Selector ‚Üí Plan**
- `SignalsAdapterV2` –ø–∏—à–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ TTL-store (`InMemorySignalSequenceStore`).
- `StandardDiagnosisEngineV2` —Å—Ç–∞–≤–∏—Ç –¥–∏–∞–≥–Ω–æ–∑ –ø–æ `BlockageSignalsV2` –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç–æ–ª–æ–≥–∏—á–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ.
- –í–≤–µ–¥—ë–Ω –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑ `TlsInterference` –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –Ω–∞–±–ª—é–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ TLS-–ø—Ä–æ–±–ª–µ–º—ã (timeout/auth failure/reset) –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ª–∏–∫ ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å TLS-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (manual apply).
- `StandardStrategySelectorV2` —Å—Ç—Ä–æ–∏—Ç `BypassPlan` –ø–æ `DiagnosisId + Confidence` (—Å –∑–∞—â–∏—Ç–∞–º–∏ confidence/risk/unimplemented) –∏ –º–æ–∂–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å feedback.

2) **–ù–µ—Ç auto-apply (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/–∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)**
- `BypassExecutorMvp` —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç/–ª–æ–≥–∏—Ä—É–µ—Ç.
- –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ v2-–ø–ª–∞–Ω–∞: `LiveTestingPipeline.OnV2PlanBuilt` ‚Üí `DiagnosticOrchestrator` —Ö—Ä–∞–Ω–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π `BypassPlan` ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç ¬´–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ v2¬ª ‚Üí `BypassController.ApplyV2PlanAsync(...)`.

3) **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å v2 (—Ä–µ–∞–ª—å–Ω—ã–π apply —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –æ—Ç–∫–∞—Ç–æ–º)**
- `BypassController.ApplyV2PlanAsync` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç/–æ—Ç–º–µ–Ω—É –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π rollback –Ω–∞ snapshot —Å–æ—Å—Ç–æ—è–Ω–∏—è.
 - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç ¬´–Ω–µ —Ç–æ—Ç¬ª –ø–ª–∞–Ω: –µ—Å–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –∏ `hostKey` –∏–∑–º–µ–Ω–∏–ª—Å—è, apply –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.
 - `StrategyId.AggressiveFragment` –ø—Ä–∏ —Ä—É—á–Ω–æ–º apply –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–µ—Å–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ ¬´–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π¬ª –∏ –≤–∫–ª—é—á–∞–µ—Ç `AutoAdjustAggressive`.
 - `StrategyId.TlsFragment` –º–æ–∂–µ—Ç –Ω–µ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TlsFragmentSizes`, `PresetName`, `AutoAdjustAggressive`). –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω –≤ `Core/IntelligenceV2/Execution/TlsFragmentPlanParamsParser.cs`, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `BypassController.ApplyV2PlanAsync`.
 - –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º: `StandardStrategySelectorV2` –∑–∞–ø–æ–ª–Ω—è–µ—Ç `TlsFragmentSizes` –≤ –ø–ª–∞–Ω–µ, —á—Ç–æ–±—ã executor –Ω–µ –∑–∞–≤–∏—Å–µ–ª –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è UI-–ø–∞–Ω–µ–ª–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤.
 - Assist-—Ñ–ª–∞–≥–∏ v2: `BypassPlan` —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å `DropUdp443` (QUIC‚ÜíTCP) –∏ `AllowNoSni` (No SNI), –≤—ã—Å—Ç–∞–≤–ª—è–µ–º—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º –ø–æ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–º —Å–∏–≥–Ω–∞–ª–∞–º (UDP unanswered + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è SNI). –ü—Ä–∏ —Ä—É—á–Ω–æ–º apply –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–∫–ª—é—á–∞–µ—Ç —ç—Ç–∏ —Ñ–ª–∞–≥–∏ –≤–º–µ—Å—Ç–µ —Å–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏.
 - Phase 3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
     - `QuicObfuscation` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–∞–∫ –≤–∫–ª—é—á–µ–Ω–∏–µ `DropUdp443` (—á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç —É—à—ë–ª —Å QUIC/HTTP3 –Ω–∞ TCP/HTTPS).
     - `HttpHostTricks` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `BypassFilter` –¥–ª—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ HTTP (TCP/80): —Ä–∞–∑—Ä–µ–∑–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Host:` –Ω–∞ –¥–≤–∞ TCP —Å–µ–≥–º–µ–Ω—Ç–∞ –∏ –¥—Ä–æ–ø–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç.
     - `BadChecksum` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è —Ñ–µ–π–∫–æ–≤—ã—Ö TCP –ø–∞–∫–µ—Ç–æ–≤: –∏–Ω–∂–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π send-–ø—É—Ç—å –±–µ–∑ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ checksum –∏ —Å–æ —Å–±—Ä–æ—Å–æ–º checksum-—Ñ–ª–∞–≥–æ–≤ –∞–¥—Ä–µ—Å–∞.
 - Smoke: `DPI2-022` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ `BypassPlan`, `DPI2-023` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–ª–∞–¥—ë—Ç `TlsFragmentSizes` (–∏ PresetName) –≤ –ø–ª–∞–Ω, `DPI2-024` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç e2e —Ü–µ–ø–æ—á–∫—É `selector ‚Üí plan ‚Üí ApplyV2PlanAsync` (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–ª–∞–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è).

4) **–í–∞–∂–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ TLS-–æ–±—Ö–æ–¥–∞ (–ø–æ—á–µ–º—É ‚ÄúDisorder vs Fragment‚Äù –Ω–µ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ —Å—É–º–º–∞)**
- –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω —Ä–µ–∂–∏–º TLS (`TlsStrategy`) –∏ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ —Ü–µ–ø–æ—á–∫–µ `if/else if`.
- –ü—Ä–∏ —ç—Ç–æ–º `Disorder` –≤ –Ω–∞—à–µ–º –¥–≤–∏–∂–∫–µ **—É–∂–µ –æ–∑–Ω–∞—á–∞–µ—Ç ‚Äú—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä—É–µ–º ClientHello –∏ –º–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏‚Äù** (—Ç.–µ. —ç—Ç–æ ¬´—É—Å–∏–ª–µ–Ω–Ω–∞—è¬ª –≤–µ—Ä—Å–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å ‚ÄúFragment only‚Äù).

### Target (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Ü–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –±–µ–∑ —Ñ–∞–Ω—Ç–∞–∑–∏–π)

–¶–µ–ª—å v2 –≤ –ø—Ä–æ–µ–∫—Ç–µ ISP_Audit ‚Äî –Ω–µ ¬´–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–µ—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç¬ª, –∞ –¥–∞—Ç—å:
- **–û–±—ä—è—Å–Ω–∏–º—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É** (—Ñ–∞–∫—Ç—ã ‚Üí –¥–∏–∞–≥–Ω–æ–∑ + —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å).
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** (–±–µ–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π; —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ TLS-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ —Ä–∞–∑).
- **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (manual apply; –ø–æ–Ω—è—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞; –ø–æ–Ω—è—Ç–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å).
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** (cancellation/timeout + rollback, –Ω–∏–∫–∞–∫–∏—Ö —á–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π).

–í —Ç–µ—Ä–º–∏–Ω–∞—Ö –ª—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
- Facts/Signals ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
- Diagnosis ‚Äî —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è.
- Selector/Plan ‚Äî —Ç–æ–ª—å–∫–æ –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –µ—Å–ª–∏ –µ—Å—Ç—å).
- Executor/Apply ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (idempotent + rollback), –±–µ–∑ ‚Äú—É–º–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π‚Äù.

### Roadmap (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –∫ Target, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

1) **–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å UX-—Å–º—ã—Å–ª —Å—Ç—Ä–∞—Ç–µ–≥–∏–π**
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≥–ª–æ—Å—Å–∞—Ä–∏–π –≤ –∫–æ–¥–µ/–ª–æ–≥–∞—Ö: —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç `TLS_FRAGMENT` –∏ `TLS_DISORDER` (–≤ –Ω–∞—à–µ–º –¥–≤–∏–∂–∫–µ).
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–µ –≤—ã–¥–∞—ë—Ç –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ TLS-—Ä–µ–∂–∏–º—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (—Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ TLS-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤ –ø–ª–∞–Ω–µ).

2) **–°–¥–µ–ª–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é ‚Äú–ø—Ä–∏–º–µ–Ω–∏–º–æ–π‚Äù –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–π –≤ UI**
- –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ –Ω–∞ apply –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å: –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑, –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ –æ–ø—Ü–∏–∏ (fragment/disorder/drop rst/doh).
- –ü–æ—Å–ª–µ apply –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äú—á—Ç–æ —Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ‚Äù (—É–∂–µ –µ—Å—Ç—å –º–µ—Ç—Ä–∏–∫–∏/—Å—Ç–∞—Ç—É—Å—ã –≤ bypass-–ø–∞–Ω–µ–ª–∏ ‚Äî —É–¥–µ—Ä–∂–∏–≤–∞–µ–º —ç—Ç–æ –∫–∞–∫ –≥–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏).

3) **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π ‚Äî —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–≤–∏–∂–∫–æ–º**
- –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è ¬´Fragment+Disorder —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏¬ª ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è —è–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ –Ω–µ ‚Äú–≤–∫–ª—é—á–∏–º –¥–≤–∞ —Ç—É–º–±–ª–µ—Ä–∞‚Äù.

### –ì–ª–æ—Å—Å–∞—Ä–∏–π (—á—Ç–æ–±—ã –Ω–µ —Ä–∞—Å–ø–æ–ª–∑–∞–ª–∏—Å—å —Å–º—ã—Å–ª—ã)

- **TLS_FRAGMENT**: —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è ClientHello –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º, –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
- **TLS_DISORDER**: —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è ClientHello + –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–≤ —Ç–µ–∫—É—â–µ–º –¥–≤–∏–∂–∫–µ —ç—Ç–æ –æ–¥–∏–Ω —Ä–µ–∂–∏–º TLS-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏).
- **DROP_RST**: –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö TCP RST (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö) –≤ —Ñ–∏–ª—å—Ç—Ä–µ.
- **Manual Apply v2**: –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ö–æ–¥–∞ —Ç–æ–ª—å–∫–æ –ø–æ –¥–µ–π—Å—Ç–≤–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è; –ø–∞–π–ø–ª–∞–π–Ω –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –æ–±—Ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ (–≤–∞–∂–Ω–æ): Diagnosis Engine v2 **–Ω–µ –∑–Ω–∞–µ—Ç** –ø—Ä–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏/–æ–±—Ö–æ–¥ (–Ω–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ StrategyId/Bypass/TlsBypassService/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã) –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ—è—Å–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑ –Ω–∞–±–ª—é–¥–∞–µ–º—ã—Ö —Ñ–∞–∫—Ç–æ–≤ (timeout, DNS fail, retx-rate, HTTP redirect).

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ RST-—É–ª–∏–∫–∞–º (v2):
* `SignalsAdapterV2.BuildSnapshot(...)` –∏–∑–≤–ª–µ–∫–∞–µ—Ç `RstTtlDelta` –∏–∑ `InspectionSignalsSnapshot.SuspiciousRstDetails` (—Ñ–æ—Ä–º–∞—Ç—ã `TTL=.. (–æ–±—ã—á–Ω—ã–π=min-max)`/`expected min-max`).
* `SignalsAdapterV2.BuildSnapshot(...)` –∏–∑–≤–ª–µ–∫–∞–µ—Ç `RstIpIdDelta` –∏–∑ `InspectionSignalsSnapshot.SuspiciousRstDetails` (—Ñ–æ—Ä–º–∞—Ç `IPID=.. (–æ–±—ã—á–Ω—ã–π=min-max, last=..)` / `expected ...`).
* `SuspiciousRstCount` ‚Äî —á–∏—Å–ª–æ —Å–æ–±—ã—Ç–∏–π `SuspiciousRstObserved` –≤ –æ–∫–Ω–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (–µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ ¬´–ø–æ—Å–ª–µ–¥–Ω–µ–º —Å–Ω–∏–º–∫–µ¬ª, —Ñ–æ–ª–±—ç–∫ –¥–∞—ë—Ç –º–∏–Ω–∏–º—É–º 1).
* `RstLatency` –±–µ—Ä—ë—Ç—Å—è –∫–∞–∫ –ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∏–∑ `HostTested.TcpLatencyMs` –¥–ª—è —Å–ª—É—á–∞—è `TCP_CONNECTION_RESET`.
* `StandardDiagnosisEngineV2` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –ø–æ–ª—è, —á—Ç–æ–±—ã –≤—ã–¥–∞–≤–∞—Ç—å `ActiveDpiEdge` (–±—ã—Å—Ç—Ä—ã–π RST) –∏–ª–∏ `StatefulDpi` (–º–µ–¥–ª–µ–Ω–Ω—ã–π RST) –≤–º–µ—Å—Ç–æ `Unknown`, –Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ ¬´—É—Å—Ç–æ–π—á–∏–≤—ã—Ö —É–ª–∏–∫–∞—Ö¬ª (`SuspiciousRstCount >= 2`).

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
*   –ú–µ–∂–¥—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –∏ –æ–±—Ö–æ–¥–æ–º –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–ª–æ–π ‚Äú–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞‚Äù (Signals ‚Üí Diagnosis ‚Üí Selector ‚Üí Plan).
*   Signals –≤ v2 —Å—Ç—Ä–æ—è—Ç—Å—è –∫–∞–∫ **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ —Å–æ–±—ã—Ç–∏–π** (SignalEvent/SignalSequence), –∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –æ–∫–Ω–∞.
*   –í MVP –∑–∞–ø—Ä–µ—â—ë–Ω auto-apply: –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ö–æ–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Ä—É—á–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (one-click apply –¥–æ–ø—É—Å—Ç–∏–º).

–ñ—ë—Å—Ç–∫–∏–µ –∑–∞—â–∏—Ç—ã —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ):
*   `confidence < 50` ‚Üí –ø—É—Å—Ç–æ–π –ø–ª–∞–Ω.
*   `RiskLevel.High` –∑–∞–ø—Ä–µ—â—ë–Ω –ø—Ä–∏ `confidence < 70`.
*   –ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–µ –ª–æ–º–∞—é—Ç –ø–∞–π–ø–ª–∞–π–Ω: –≤—ã–≤–æ–¥–∏—Ç—Å—è warning –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
*   –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ feedback-–¥–∞–Ω–Ω—ã—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ MVP (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ `BasePriority/Risk/Id`).

–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã v2 (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ):
*   –û–∫–Ω–æ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏: 30 —Å–µ–∫—É–Ω–¥ (default) –∏ 60 —Å–µ–∫—É–Ω–¥ (extended).
*   TTL —Å–æ–±—ã—Ç–∏–π: 10 –º–∏–Ω—É—Ç (–æ—á–∏—Å—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ Append –≤ —Å—Ç–æ—Ä–µ).

–¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç):
* `LiveTestingPipeline.ClassifierWorker`: v2-–≤–µ—Ç–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `SignalsAdapterV2.Observe(...)` —Å `InspectionSignalsSnapshot` (–∏–∑ `IInspectionSignalsProvider`, —Å —Ñ–æ–ª–±—ç–∫–æ–º `Empty`).
* –ó–∞—Ç–µ–º —Å—Ç—Ä–æ–∏—Ç—Å—è `BlockageSignalsV2` (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –æ–∫–Ω—É) –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `StandardDiagnosisEngineV2.Diagnose(...)`. –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ ¬´—Ö–≤–æ—Å—Ç–∞ —Ñ–∞–∫—Ç–æ–≤¬ª –≤ UI-–ª–æ–≥–µ.
* –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `StandardStrategySelectorV2.Select(diagnosis, ...)`, –∞ Step 4 —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤—ã–≤–æ–¥ (1‚Äì2 —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Ö–æ—Å—Ç, –±–µ–∑ —Å–ø–∞–º–∞) –∏ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è –ø–∞–Ω–µ–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
* –î–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ Gate 1‚Üí2 –≤ UI-–ª–æ–≥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[V2][GATE1]`.

–ú–∞—Ä–∫–µ—Ä v2-–≤—ã–≤–æ–¥–∞ (–∫–∞–∫ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç legacy): –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π v2 –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞ `[V2]`.

### 3.3 Core Modules (`IspAudit.Core`)

*   **`BlockageCode` (`Core/Diagnostics/BlockageCode.cs`)**:
    *   –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–æ–≤ –ø—Ä–æ–±–ª–µ–º (`BlockageType`): –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ ¬´—Ñ–∞–∫—Ç–æ–≤—ã–µ¬ª –∫–æ–¥—ã + legacy –∞–ª–∏–∞—Å—ã.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ legacy (–Ω–∞–ø—Ä–∏–º–µ—Ä, `StandardBlockageClassifier`, `StrategyMapping`, UI-–ø–∞—Ä—Å–∏–Ω–≥) –∏ –≤ v2 (`SignalsAdapterV2`), —á—Ç–æ–±—ã –∞–ª–∏–∞—Å—ã –Ω–µ ¬´—Ä–∞–∑–º–∞–∑—ã–≤–∞–ª–∏—Å—å¬ª –ø–æ —Å–ª–æ—è–º.

*   **`PipelineContract` (`Core/Diagnostics/PipelineContract.cs`)**:
    *   –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `BypassNone`/`BypassUnknown`).
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–ª–æ—è—Ö legacy/v2/UI, —á—Ç–æ–±—ã –Ω–µ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å ¬´–º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏¬ª (`"NONE"`, `"UNKNOWN"`) –Ω–∞–ø—Ä—è–º—É—é.

*   **`TrafficCollector` (`Utils/TrafficCollector.cs`)**:
    *   –°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç `ConnectionMonitorService` (–∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `DiagnosticOrchestrator`).
    *   –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –ø–æ PID —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—á–µ—Ä–µ–∑ `PidTrackerService`).
    *   –î–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è/–ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ UI –ø—Ä–∏–º–µ–Ω—è–µ—Ç `UnifiedTrafficFilter` (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ: loopback), —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å ¬´–≤–µ—á–Ω—ã–µ¬ª –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∑–∞–≤–µ–¥–æ–º–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ü–µ–ª–µ–π.
    *   –ü–µ—Ä–µ–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ `(IP, Hostname)` –≤ –ø–∞–π–ø–ª–∞–π–Ω.
    *   –í UI –∫–ª—é—á –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—á–µ–ª–æ–≤–µ–∫–æ‚Äë–ø–æ–Ω—è—Ç–Ω—ã–º**: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ SNI/hostname (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω). IP —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏/–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –Ω–æ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–ª–∞–≤–Ω—ã–º ¬´–ª–∏—Ü–æ–º¬ª –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   **`StandardHostTester` (`Core/Modules/StandardHostTester.cs`)**:
    *   –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞:
        1.  **DNS**: –†–µ–∑–æ–ª–≤ –¥–æ–º–µ–Ω–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π DNS.
        2.  **TCP**: –ü–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (Syn -> SynAck).
        3.  **TLS**: –û—Ç–ø—Ä–∞–≤–∫–∞ ClientHello –∏ –æ–∂–∏–¥–∞–Ω–∏–µ ServerHello (–ø—Ä–æ–≤–µ—Ä–∫–∞ SNI-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫).
        4.  **rDNS (PTR)**: –ö–æ—Ä–æ—Ç–∫–∞—è –ø–æ–ø—ã—Ç–∫–∞ reverse DNS –¥–ª—è IP (–∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –≤ UI).
*   **`StandardBlockageClassifier` (`Core/Modules/StandardBlockageClassifier.cs`)**:
    *   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (`HostTested`) –∏ –≤—ã–Ω–æ—Å–∏—Ç –≤–µ—Ä–¥–∏–∫—Ç.
    *   –õ–æ–≥–∏–∫–∞:
        *   DNS –æ—à–∏–±–∫–∞ ‚Üí `DNS_BLOCKED`.
        *   TCP Timeout ‚Üí `TCP_CONNECT_TIMEOUT` (legacy: `TCP_TIMEOUT`) (–≤–æ–∑–º–æ–∂–Ω–æ Drop).
        *   TCP Reset ‚Üí `TCP_RESET` (–∞–∫—Ç–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞).
        *   TLS Timeout/Reset ‚Üí `DPI_FILTER`.
        *   `198.18.0.0/15` ‚Üí `FAKE_IP` (—á–∞—Å—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç/–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä/—à–ª—é–∑), —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è `ROUTER_REDIRECT` (–Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ, –µ—Å–ª–∏ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞).
*   **`InMemoryBlockageStateStore` (`Core/Modules/InMemoryBlockageStateStore.cs`)**:
    *   –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é.
    *   –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —Ö–æ—Å—Ç–æ–≤ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è).
    *   –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç `IInspectionSignalsProvider`, —á—Ç–æ–±—ã v2-–∫–æ–Ω—Ç—É—Ä –º–æ–≥ —Å–Ω–∏–º–∞—Ç—å –∏–Ω—Å–ø–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã –±–µ–∑ legacy —Ç–∏–ø–æ–≤.

### 3.4 Inspection Services (–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑)

–≠—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø–∞–π–ø–ª–∞–π–Ω–æ–º –∏ —É—Ç–æ—á–Ω—è—é—Ç –¥–∏–∞–≥–Ω–æ–∑.

*   **`RstInspectionService`**:
    *   –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ TCP RST –ø–∞–∫–µ—Ç—ã.
    *   –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç TTL –∏ IP Identification –ø–∞–∫–µ—Ç–∞ —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.
    *   –ï—Å–ª–∏ TTL —Ä–µ–∑–∫–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å —ç—Ç–æ–≥–æ —Ö–æ—Å—Ç–∞ ‚Üí **RST Injection** (DPI).
*   **`UdpInspectionService`**:
    *   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç UDP —Ç—Ä–∞—Ñ–∏–∫ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º QUIC –∏ DNS).
    *   –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ QUIC (—á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è HTTP/TLS, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥—á–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å).
*   **`TcpRetransmissionTracker`**:
    *   –°—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ (Retransmissions) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
    *   –í—ã—Å–æ–∫–∏–π % —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π (>10%) –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ RST —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ **Packet Drop** (—Ç–∏—Ö–∏–π –¥—Ä–æ–ø –ø–∞–∫–µ—Ç–æ–≤).
*   **`HttpRedirectDetector`**:
    *   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç HTTP-–æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∫–æ–¥–æ–≤ 301/302/307.
    *   –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç URL —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (blockpage).

### 3.5 Bypass Layer (`IspAudit.Bypass`)

*   **`TrafficEngine` (`Core/Traffic/TrafficEngine.cs`)**:
    *   –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ –¥—Ä–∞–π–≤–µ—Ä–æ–º WinDivert.
    *   –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –∏–Ω—ä–µ–∫—Ü–∏–µ–π –ø–∞–∫–µ—Ç–æ–≤.
    *   –í–∞–∂–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: –ø–∞—Å—Å–∏–≤–Ω—ã–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä `TrafficMonitorFilter` –¥–ª—è DNS/SNI/–∏–Ω—Å–ø–µ–∫—Ü–∏–π) –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **—Ä–∞–Ω—å—à–µ** –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (`BypassFilter`), —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π (–Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–π) —Ç—Ä–∞—Ñ–∏–∫.
*   **`BypassStateManager` (`Bypass/BypassStateManager.*.cs`)**:
    *   Single source of truth (SSoT) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `TrafficEngine` –∏ `TlsBypassService`.
    *   –î–µ—Ä–∂–∏—Ç watchdog/crash recovery, observed IP cache –¥–ª—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–≥–æ `DropUdp443`, –∞ —Ç–∞–∫–∂–µ activation/outcome snapshots.
    *   –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç `Apply/Disable` –∏ –≤–∫–ª—é—á–∞–µ—Ç guard –Ω–∞ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `TrafficEngine`/`TlsBypassService` –≤–Ω–µ manager-scope.
*   **`TlsBypassService` (`Bypass/TlsBypassService.*.cs`)**:
    *   –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è TLS –æ–±—Ö–æ–¥–∞: –ø—Ä–∏–º–µ–Ω—è–µ—Ç –æ–ø—Ü–∏–∏, –¥–µ—Ä–∂–∏—Ç –ø—Ä–µ—Å–µ—Ç—ã –∏ –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é, —Å–∞–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç/—É–¥–∞–ª—è–µ—Ç `BypassFilter` –≤ `TrafficEngine`.
    *   –î–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ partial-—Ñ–∞–π–ª—ã (refactor-only): `TlsBypassService.Engine.cs` (Apply/Disable), `TlsBypassService.Metrics.cs` (–º–µ—Ç—Ä–∏–∫–∏/–≤–µ—Ä–¥–∏–∫—Ç), `TlsBypassService.Udp443.cs` (—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π UDP/443 + probe flows), `TlsBypassService.Models.cs` (DTO), `TlsBypassService.AutoAdjust.cs` (AutoAdjust/AutoTTL).
    *   –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞: —Å–∫–æ–ª—å–∫–æ ClientHello —É–≤–∏–¥–µ–Ω–æ/–∫–æ—Ä–æ—Ç–∫–∏—Ö/–Ω–µ 443, —Å–∫–æ–ª—å–∫–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ RST, –ø–ª–∞–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–µ—Å–µ—Ç, –ø–æ—Ä–æ–≥/–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —á–∞–Ω–∫, –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–±–æ—Ä–∞.
    *   –í—ã—á–∏—Å–ª—è–µ—Ç –≤–µ—Ä–¥–∏–∫—Ç—ã: –Ω–µ—Ç TLS 443 –≤ —Ç—Ä–∞—Ñ–∏–∫–µ, TLS –∏–¥—ë—Ç –Ω–µ –Ω–∞ 443, ClientHello –∫–æ—Ä–æ—á–µ –ø–æ—Ä–æ–≥–∞ (—Å–æ–≤–µ—Ç —Å–Ω–∏–∑–∏—Ç—å threshold/–≤–∑—è—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø—Ä–µ—Å–µ—Ç), –æ–±—Ö–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—ë–Ω, –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö, ratio RST/—Ñ—Ä–∞–≥–º >4 (–∫—Ä–∞—Å–Ω—ã–π) –∏–ª–∏ >1.5 (–∂—ë–ª—Ç—ã–π), –∏–Ω–∞—á–µ –∑–µ–ª—ë–Ω—ã–π; –ø—É–±–ª–∏–∫—É–µ—Ç `MetricsUpdated/VerdictChanged/StateChanged` –¥–ª—è UI/–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
    *   –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ—Å–µ—Ç–∞ ¬´–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π¬ª —Å —Ñ–ª–∞–≥–æ–º `AutoAdjustAggressive`: –ø—Ä–∏ —Ä–∞–Ω–Ω–µ–º –≤—Å–ø–ª–µ—Å–∫–µ RST —É–∂–∏–º–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —á–∞–Ω–∫ –¥–æ 4, –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º –∑–µ–ª—ë–Ω–æ–º >30—Å —Å–ª–µ–≥–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —á–∞–Ω–∫ (–Ω–µ –Ω–∏–∂–µ 4) –∏ –ø–µ—Ä–µ–ø—Ä–∏–º–µ–Ω—è–µ—Ç –æ–ø—Ü–∏–∏.
    *   TTL Trick —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è runtime-–æ–ø—Ü–∏—è–º–∏ (`TtlTrickEnabled/TtlTrickValue`); –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º `AutoTtlEnabled` —Å–µ—Ä–≤–∏—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –ø–æ–¥–±–æ—Ä TTL (–º–∞–ª—ã–π –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π) –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º bypass –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª—É—á—à–∏–π TTL –æ–±—Ä–∞—Ç–Ω–æ –≤ `bypass_profile.json`.
*   **`BypassFilter` (`Core/Traffic/Filters/BypassFilter.*.cs`)**:
    *   –†–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–±—Ö–æ–¥–∞:
        *   **Fragmentation**: –†–∞–∑–±–∏–µ–Ω–∏–µ ClientHello –Ω–∞ 2+ TCP-—Å–µ–≥–º–µ–Ω—Ç–∞ –ø–æ —Å–ø–∏—Å–∫—É —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑ `TlsFragmentSizes`.
        *   **Disorder**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö seq/len, —á—Ç–æ–±—ã —Å–±–∏—Ç—å DPI.
        *   **Fake TTL**: –û—Ç–ø—Ä–∞–≤–∫–∞ "—Ñ–µ–π–∫–æ–≤–æ–≥–æ" –ø–∞–∫–µ—Ç–∞ —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–π–¥–µ—Ç –¥–æ DPI, –Ω–æ –Ω–µ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.
    *   –°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ TLS ClientHello, —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, —Å–±—Ä–æ—à–µ–Ω–Ω—ã–µ RST, –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–ª–∞–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤) –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –≤ UI; –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ ClientHello –Ω–∞ 443 —Å SNI –∏ –¥–ª–∏–Ω–æ–π ‚â• threshold, –∫–æ—Ä–æ—Ç–∫–∏–µ/–Ω–µ443 —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## 4. –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Data Flow)

1.  **–ó–∞—Ö–≤–∞—Ç (Capture)**: `ConnectionMonitorService` (—É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º) —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è/—Å–Ω–∏–º–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (Socket Layer WinDivert –∏–ª–∏ polling —á–µ—Ä–µ–∑ IP Helper API).
2.  **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Identify)**: `PidTrackerService` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å (PID) –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
3.  **–ü–∞—Ä—Å–∏–Ω–≥ (Parse)**: `DnsParserService` –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–∏–∑ DNS-–∫—ç—à–∞ –∏–ª–∏ SNI).
    *   –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ SNI –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ –∏—Å—Ö–æ–¥—è—â–µ–º—É TLS ClientHello –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ–≥–¥–∞ ClientHello —Ä–∞–∑–±–∏—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ TCP-—Å–µ–≥–º–µ–Ω—Ç–æ–≤ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∞—Å—Å–µ–º–±–ª–∏–Ω–≥ –ø–µ—Ä–≤—ã—Ö –±–∞–π—Ç –ø–æ—Ç–æ–∫–∞).
    *   –í–∞–∂–Ω–æ: SNI —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ü–µ–ª–µ–≤–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É. –í –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–µ SNI-—Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ PID —á–µ—Ä–µ–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é remote endpoint ‚Üí PID.
    *   –í–∞–∂–Ω–æ (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å): SNI-–∫–µ—à –≤–µ–¥—ë—Ç—Å—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **first-wins**, —á—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–æ–≤ –Ω–µ ¬´–ø–ª–∞–≤–∞–ª¬ª (youtube.com ‚Üí youtube-ui.l.google.com ‚Üí ‚Ä¶) –∏–∑-–∑–∞ –≥–æ–Ω–æ–∫. –†–∞–∑—Ä–µ—à–µ–Ω–∞ –∑–∞–º–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ **—à—É–º ‚Üí –Ω–µ —à—É–º** –ø–æ `NoiseHostFilter`.
4.  **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (Filter)**: `UnifiedTrafficFilter` –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ–¥–æ–º–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ (loopback).
5.  **–û—á–µ—Ä–µ–¥—å (Queue)**: –•–æ—Å—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –≤—Ö–æ–¥–Ω—É—é –æ—á–µ—Ä–µ–¥—å `LiveTestingPipeline`.
6.  **–í–∞–ª–∏–¥–∞—Ü–∏—è (Validate)**: –•–æ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–µ—Å—Ç–µ—Ä–æ–º (DNS/TCP/TLS) –±–µ–∑ pre-check —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ¬´—à—É–º–∞¬ª, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —Å–∏–≥–Ω–∞–ª –Ω–∞ –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö/CDN-—Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
7.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Test)**: `StandardHostTester` –∑–∞–±–∏—Ä–∞–µ—Ç —Ö–æ—Å—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç —Å–µ—Ä–∏—é —Ç–µ—Å—Ç–æ–≤ (DNS, TCP, TLS).
    *   –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (VPN): –ø—Ä–∏ `BypassController.IsVpnDetected=true` –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `PipelineConfig.TestTimeout`, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ TCP/TLS —Ç–∞–π–º–∞—É—Ç—ã –Ω–∞ VPN –∏ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ–ª–µ–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–º–∏.
8.  **–ò–Ω—Å–ø–µ–∫—Ü–∏—è (Inspect)**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ `RstInspectionService` –∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Å–ª–µ–¥—è—Ç –∑–∞ –ø–∞–∫–µ—Ç–∞–º–∏ —ç—Ç–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
9.  **–ê–≥—Ä–µ–≥–∞—Ü–∏—è (Aggregate)**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –∏ –∏–Ω—Å–ø–µ–∫—Ü–∏–π —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ `HostTested` –º–æ–¥–µ–ª—å.
10. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (Classify)**: `StandardBlockageClassifier` –≤—ã–Ω–æ—Å–∏—Ç –≤–µ—Ä–¥–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DPI_REDIRECT`).
11. **–û—Ç—á–µ—Ç (Report)**: –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ UI —á–µ—Ä–µ–∑ `TestResultsManager`.
    *   –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: `NoiseHostFilter` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å UI ¬´—É—Å–ø–µ—à–Ω—ã–º–∏¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (Status OK), –Ω–æ –Ω–µ —Å–∫—Ä—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.
12. **–†–µ–∞–∫—Ü–∏—è (React)**: –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ-–æ–±—Ö–æ–¥, `DiagnosticOrchestrator` –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–µ–º–ø—Ç–∏–≤–Ω—ã–π TLS bypass —á–µ—Ä–µ–∑ `BypassController.TlsService.ApplyPreemptiveAsync` (–æ–±—ã—á–Ω–æ `TLS_DISORDER + DROP_RST`); —Å–∞–º `TlsBypassService` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç/—É–¥–∞–ª—è–µ—Ç `BypassFilter` –≤ `TrafficEngine` –∏ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è –æ—Ç–¥–∞—ë—Ç –ø–ª–∞–Ω/–º–µ—Ç—Ä–∏–∫–∏/–≤–µ—Ä–¥–∏–∫—Ç –≤ UI –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É.
    *   –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–ø—Ä–∞–∫—Ç–∏–∫–∞): –ø–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ `Apply` –≤ UI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∏–π **–ø–æ—Å—Ç-Apply —Ä–µ—Ç–µ—Å—Ç** (—á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —É–≤–∏–¥–µ—Ç—å —ç—Ñ—Ñ–µ–∫—Ç), –∞ —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ **¬´–†–µ—Å—Ç–∞—Ä—Ç –∫–æ–Ω–Ω–µ–∫—Ç–∞¬ª** ‚Äî –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π drop —Ç—Ä–∞—Ñ–∏–∫–∞ –∫ —Ü–µ–ª–µ–≤—ã–º IP:443, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏–ª–æ—Å—å —É–∂–µ –ø–æ–¥ –Ω–æ–≤—ã–º —Ä–µ–∂–∏–º–æ–º.

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ISP_Audit/
‚îú‚îÄ‚îÄ Program.cs                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WPF, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è CodePages –¥–ª—è OEM866)
‚îú‚îÄ‚îÄ App.xaml                    # –†–µ—Å—É—Ä—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ MainWindow.xaml             # –†–∞–∑–º–µ—Ç–∫–∞ UI
‚îú‚îÄ‚îÄ Config.cs                   # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Singleton-like)
‚îÇ
‚îú‚îÄ‚îÄ Core/                       # –Ø–î–†–û –°–ò–°–¢–ï–ú–´
‚îÇ   ‚îú‚îÄ‚îÄ Interfaces/             # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (IHostTester, IBlockageClassifier)
‚îÇ   ‚îú‚îÄ‚îÄ IntelligenceV2/          # DPI Intelligence v2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Contracts/           # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã v2 (Signals/Diagnosis/Strategy), –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ UI/Bypass/WinDivert
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Diagnosis/            # DiagnosisEngine v2 (StandardDiagnosisEngineV2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Execution/            # ExecutorMvp (BypassExecutorMvp)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Signals/              # SignalsAdapterV2 + TTL store
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Strategies/           # Selector/Plan (StandardStrategySelectorV2)
‚îÇ   ‚îú‚îÄ‚îÄ Models/                 # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (HostDiscovered, TestResult)
‚îÇ   ‚îú‚îÄ‚îÄ Modules/                # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StandardHostTester.cs          # –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StandardBlockageClassifier.cs  # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InMemoryBlockageStateStore.cs  # –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RstInspectionService.cs        # –ê–Ω–∞–ª–∏–∑ RST
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ Traffic/                # –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ç—å—é
‚îÇ       ‚îú‚îÄ‚îÄ TrafficEngine.cs    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WinDivert
‚îÇ       ‚îî‚îÄ‚îÄ Filters/            # –õ–æ–≥–∏–∫–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ ViewModels/                 # MVVM (UI Logic)
‚îÇ   ‚îú‚îÄ‚îÄ MainViewModel.*.cs              # MainViewModel (partial): Constructor/Commands/State/Handlers/etc.
‚îÇ   ‚îú‚îÄ‚îÄ DiagnosticOrchestrator.*.cs
‚îÇ   ‚îú‚îÄ‚îÄ OrchestratorState/
‚îÇ   ‚îú‚îÄ‚îÄ BypassController.*.cs
‚îÇ   ‚îî‚îÄ‚îÄ TestResultsManager*.cs
‚îÇ
‚îú‚îÄ‚îÄ Utils/                      # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ LiveTestingPipeline.*.cs  # –ö–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ (partial)
‚îÇ   ‚îú‚îÄ‚îÄ TrafficCollector.cs     # –°–Ω–∏—Ñ—Ñ–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ ConnectionMonitorService.cs
‚îÇ   ‚îú‚îÄ‚îÄ DnsSnifferService.cs    # —Å–æ–¥–µ—Ä–∂–∏—Ç DnsParserService (DNS + SNI)
‚îÇ   ‚îú‚îÄ‚îÄ PidTrackerService.cs
‚îÇ   ‚îî‚îÄ‚îÄ FixService.cs           # –°–∏—Å—Ç–µ–º–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (DNS)
‚îÇ
‚îú‚îÄ‚îÄ Bypass/                     # –õ–æ–≥–∏–∫–∞ –æ–±—Ö–æ–¥–∞ (Legacy & Helpers)
‚îÇ   ‚îú‚îÄ‚îÄ StrategyMapping.cs      # –ü–æ–¥–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ WinDivertNative.cs      # P/Invoke –æ–±–µ—Ä—Ç–∫–∞

‚îú‚îÄ‚îÄ native/                     # –ù–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏/–ø—Ä–æ—Ç–æ—Ç–∏–ø—ã (Windows)
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # –ö–∞–∫ –ø–æ–ª–æ–∂–∏—Ç—å WinDivert.dll/WinDivert64.sys
‚îÇ   ‚îî‚îÄ‚îÄ isp_audit_native/       # Rust cdylib (–∑–∞–≥–æ—Ç–æ–≤–∫–∞ WinDivert proxy)
‚îÇ
‚îî‚îÄ‚îÄ docs/                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ ARCHITECTURE_CURRENT.md # –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îú‚îÄ‚îÄ WORK_PLAN.md            # –ü–ª–∞–Ω —Ä–∞–±–æ—Ç
    ‚îî‚îÄ‚îÄ full_repo_audit_v2.md   # –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∫–æ–¥–∞
```

---

–ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è (Dev, 16.01.2026): –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞—Ç–∏–≤–Ω–æ–π Rust DLL
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: [native/isp_audit_native/](native/isp_audit_native/)
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: `isp_audit_native.dll` –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã –≤ `WinDivert.dll` —á–µ—Ä–µ–∑ C ABI (–ø–æ–¥ –±—É–¥—É—â–∏–π –±–µ—Å—à–æ–≤–Ω—ã–π —Å–≤–∏—Ç—á P/Invoke)
- –í–∞–∂–Ω–æ: –Ω–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ .NET —Ä–∞–Ω—Ç–∞–π–º –Ω–µ –∏–∑–º–µ–Ω—ë–Ω; –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ feature-flag'–æ–º

## 6. –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (Known Issues)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
|-----------|-------------|-------------------------|
| **WinDivert** | –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ UAC elevation. |
| **VPN** | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å TAP/TUN –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏ | –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º VPN —Ç—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç –∏–¥—Ç–∏ –≤ –æ–±—Ö–æ–¥ WinDivert –∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è. –í–æ–∑–º–æ–∂–Ω—ã –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è. |
| **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** | CP866 (OEM) –≤ –∫–æ–Ω—Å–æ–ª–∏ | `tracert.exe` –≤ —Ä—É—Å—Å–∫–æ–π Windows –≤—ã–¥–∞–µ—Ç –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É 866. |
| **–†–∞–∑–º–µ—Ä** | Single-file ~160MB | –ò–∑-–∑–∞ –≤–∫–ª—é—á–µ–Ω–∏—è .NET Runtime –∏ WPF –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª. |
| **DNS** | DoH (DNS over HTTPS) | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ —É–º–µ–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å DoH —Ç—Ä–∞—Ñ–∏–∫ –±—Ä–∞—É–∑–µ—Ä–æ–≤. |

---

## 7. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ (Technical Debt)

1.  **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤ `Config.ActiveProfile` –∏ `Program.Targets` –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —Ö—Ä—É–ø–∫–∏–º –∏ —Å–ª–æ–∂–Ω—ã–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    *   Singleton `NoiseHostFilter.Instance` —Å–æ–∑–¥–∞–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏.
2.  **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ DI**:
    *   –ì—Ä–∞—Ñ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é –≤–Ω—É—Ç—Ä–∏ `MainViewModel` (DataContext —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ XAML). –≠—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∑–∞–º–µ–Ω—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –º–æ–∫-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è).
3.  **–ñ–µ—Å—Ç–∫–∏–µ –ø—É—Ç–∏**:
    *   –ü—É—Ç–∏ –∫ –ª–æ–≥–∞–º –∏ –ø—Ä–æ—Ñ–∏–ª—è–º –∏–Ω–æ–≥–¥–∞ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π —Å—Ç—Ä–æ–∫, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö –û–°.
4.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
    *   –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö `async void` –º–µ—Ç–æ–¥–∞—Ö (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å—Ç–∞—Ä—ã—Ö ViewModel) –∏—Å–∫–ª—é—á–µ–Ω–∏—è –º–æ–≥—É—Ç "–ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—Ç—å—Å—è".

---

## 8. –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è (Roadmap)

### Phase 4: Refactoring (Q1 2026)
*   [ ] **–í–Ω–µ–¥—Ä–µ–Ω–∏–µ DI Container**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `Microsoft.Extensions.DependencyInjection` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
*   [ ] **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `Config` –∏ `Program` –≤ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã `IConfigurationService`.
*   [ ] **Unit Tests**: –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏ (`StandardBlockageClassifier`, `BypassFilter`).

### Phase 5: Advanced Bypass
*   [ ] **Geneva Strategy**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤ Geneva (TCP Window manipulation).
*   [ ] **Auto-Tune**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (TTL, —Ä–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–∫—Ü–∏–∏ DPI.

### Phase 6: UI/UX Improvements
*   [ ] **Real-time Graphs**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –ø–æ—Ç–µ—Ä—å –ø–∞–∫–µ—Ç–æ–≤.
*   [ ] **History Export**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ PDF/HTML –æ—Ç—á–µ—Ç.
