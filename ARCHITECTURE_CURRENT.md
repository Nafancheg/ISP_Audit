# ISP_Audit ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ü–ª–∞–Ω –†–∞–±–æ—Ç

**–î–∞—Ç–∞:** 02.12.2025  
**–¶–µ–ª—å:** –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (DPI, DNS-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, TCP RST injection)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–∞ (MainViewModel ‚Üí –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞). TrafficCollector + LiveTestingPipeline —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

### –ß–∞—Å—Ç—å I: –ß–¢–û –ß–ò–ù–ò–¢–¨ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)
1. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#1-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
2. [–ü–ª–∞–Ω —Ä–∞–±–æ—Ç (–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)](#2-–ø–ª–∞–Ω-—Ä–∞–±–æ—Ç)
3. [–ü—Ä–∏–Ω—è—Ç—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#3-–ø—Ä–∏–Ω—è—Ç—ã–µ-—Ä–µ—à–µ–Ω–∏—è)

### –ß–∞—Å—Ç—å II: –ö–ê–ö –£–°–¢–†–û–ï–ù–û (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
4. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#4-–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
5. [Bypass —Å–∏—Å—Ç–µ–º–∞](#5-bypass-—Å–∏—Å—Ç–µ–º–∞)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–µ—Ç–µ–∫—Ü–∏—è](#6-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–¥–µ—Ç–µ–∫—Ü–∏—è)
7. [UI –∏ ViewModel](#7-ui-–∏-viewmodel)
8. [–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥](#8-—Ñ–∞–π–ª–æ–≤–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

---

# –ß–∞—Å—Ç—å I: –ß–¢–û –ß–ò–ù–ò–¢–¨

## 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ –†–ï–®–ï–ù–û: Bypass —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

**–ë—ã–ª–æ:** Pipeline —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Ö–æ—Å—Ç—ã, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –Ω–æ –ù–ï –ø—Ä–∏–º–µ–Ω—è–ª bypass —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

**–°—Ç–∞–ª–æ:** `BypassCoordinator` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `LiveTestingPipeline.UiWorker`. –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
1. Coordinator –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
2. –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
3. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–µ–ª–∞–µ—Ç —Ä–µ—Ç–µ—Å—Ç
4. –ö–µ—à–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è —Ö–æ—Å—Ç–∞

```
–¢–µ–∫—É—â–∏–π flow:
HostDiscovered ‚Üí TesterWorker ‚Üí ClassifierWorker ‚Üí UiWorker
                                                      ‚Üì
                                            BypassCoordinator.AutoFixLiveAsync()
                                                      ‚Üì
                                            –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ü–†–ò–ú–ï–ù–Ø–ï–¢–°–Ø + —Ä–µ—Ç–µ—Å—Ç!
```

---

### üî¥ –ü–†–û–ë–õ–ï–ú–ê #2: –î–µ—Ç–µ–∫—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ ‚Äî –ù–ê –ê–í–û–°–¨

**–°—É—Ç—å:** ISP_Audit –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞—è –≥–ª–∞–≤–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã DPI.

| –ú–µ—Ç–æ–¥ –¥–µ—Ç–µ–∫—Ü–∏–∏ | ISP_Audit | Zapret | –í–∞–∂–Ω–æ—Å—Ç—å |
|----------------|-----------|--------|----------|
| **TCP Retransmissions** | ‚ùå | ‚úÖ | üî¥ **–ì–õ–ê–í–ù–´–ô** |
| **HTTP redirect detect** | ‚ùå | ‚úÖ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| **RST packet inspection** | ‚ùå | ‚úÖ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| **Fail counter + time window** | ‚ùå | ‚úÖ | üü° –°—Ä–µ–¥–Ω—è—è |
| TCP RST (socket error) | ‚úÖ | ‚úÖ | ‚úÖ |
| TLS handshake fail | ‚úÖ | ‚úÖ | ‚úÖ |

**–ö–∞–∫ ISP_Audit –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç (StandardHostTester.cs):**
```csharp
// –¢–æ–ª—å–∫–æ socket exceptions –∏ fixed timeout 3—Å–µ–∫
catch (SocketException ex) {
    if (ex.SocketErrorCode == ConnectionReset) blockageType = "TCP_RST";
}
var completedTask = await Task.WhenAny(connectTask, Task.Delay(3000));
```

**–ö–∞–∫ Zapret –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç (–≥–ª–∞–≤–Ω–æ–µ):**
```c
// Retransmissions ‚Äî –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å = DPI –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª
if (ctrack->req_retrans_counter >= threshold) auto_hostlist_failed(hostname);
// HTTP redirect –Ω–∞ –¥—Ä—É–≥–æ–π –¥–æ–º–µ–Ω = DPI –∑–∞–≥–ª—É—à–∫–∞
if (HttpReplyLooksLikeDPIRedirect(payload, hostname)) bFail = true;
```

**–†–µ—à–µ–Ω–∏–µ:** –°–º. –ü–ª–∞–Ω —Ä–∞–±–æ—Ç #3

---

### üî¥ –ü–†–û–ë–õ–ï–ú–ê #3: –ú–µ—Ç–æ–¥—ã –æ–±—Ö–æ–¥–∞ ‚Äî 20% –æ—Ç Zapret

**–°—É—Ç—å:** ISP_Audit —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–∏–Ω–∏–º—É–º –º–µ—Ç–æ–¥–æ–≤ –æ–±—Ö–æ–¥–∞.

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | ISP_Audit | GoodbyeDPI/Zapret |
|-----------|-----------|-------------------|
| TCP RST drop | ‚úÖ | ‚úÖ |
| TLS Fragment/Disorder | ‚úÖ | ‚úÖ |
| Fake TTL | ‚úÖ –±–∞–∑–æ–≤–æ | ‚úÖ —Å autottl |
| Bad checksum/seq | ‚ùå | ‚úÖ |
| HTTP Host tricks | ‚ùå | ‚úÖ |
| QUIC obfuscation | ‚ùå | ‚úÖ |
| Hostlist —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è | ‚ùå | ‚úÖ |
| Auto-hostlist | ‚ùå | ‚úÖ |

**–†–µ—à–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GoodbyeDPI/Zapret –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ WinDivertBypassManager (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî —Å–Ω–∞—á–∞–ª–∞ –ø–æ—á–∏–Ω–∏—Ç—å —Ç–æ —á—Ç–æ –µ—Å—Ç—å)

---

### ‚úÖ –†–ï–®–ï–ù–û: –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥ —É–¥–∞–ª—ë–Ω

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| `BypassCoordinator` | ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ LiveTestingPipeline |
| `WinDivertBypassEnforcer` | ‚úÖ –£–¥–∞–ª—ë–Ω (–∑–∞–º–µ–Ω—ë–Ω –Ω–∞ BypassCoordinator) |
| `IBypassEnforcer` | ‚úÖ –£–¥–∞–ª—ë–Ω (–Ω–µ –Ω—É–∂–µ–Ω) |
| `FixHistory` + UI –æ—Ç–∫–∞—Ç | ‚úÖ –£–¥–∞–ª—ë–Ω |
| `AuditRunner.cs` | ‚úÖ –£–¥–∞–ª—ë–Ω |
| `Output/` –ø–∞–ø–∫–∞ | ‚úÖ –£–¥–∞–ª–µ–Ω–∞ |
| Flow/Socket WinDivert layers | ‚úÖ Socket Layer –≤–∫–ª—é—á—ë–Ω |
| `TrafficAnalyzer.cs` | ‚ö†Ô∏è DEPRECATED (–∑–∞–º–µ–Ω—ë–Ω –Ω–∞ TrafficCollector) |
| `TrafficAnalyzerDualLayer.cs` | üóëÔ∏è –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |

---

## 2. –ü–ª–∞–Ω —Ä–∞–±–æ—Ç

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–ë–õ–û–ö–ï–†)

#### ‚úÖ #1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è BypassCoordinator ‚Äî –ì–û–¢–û–í–û
**–¶–µ–ª—å:** Bypass –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- [x] `LiveTestingPipeline` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `BypassCoordinator`
- [x] –í `UiWorker` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `BypassCoordinator.AutoFixLiveAsync()`
- [x] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –ø—Ä–æ–±—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫–µ—à–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â–∏–µ
- [ ] –¢–µ—Å—Ç—ã: YouTube, Discord, rutracker (—Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

### üéØ –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û 02.12.2025)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     MainViewModelRefactored ‚úÖ NEW                           ‚îÇ
‚îÇ                      (–¢–æ–Ω–∫–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, ~430 —Å—Ç—Ä–æ–∫)                        ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–æ–∫—Å–∏-—Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è UI binding                                           ‚îÇ
‚îÇ  ‚Ä¢ –ö–æ–º–∞–Ω–¥—ã                                                                  ‚îÇ
‚îÇ  ‚Ä¢ –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                              ‚îÇ                              ‚îÇ
       ‚ñº                              ‚ñº                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  BypassController  ‚îÇ    ‚îÇDiagnosticOrchestra-‚îÇ    ‚îÇ TestResultsManager ‚îÇ
‚îÇ     ‚úÖ NEW         ‚îÇ    ‚îÇ    tor ‚úÖ NEW      ‚îÇ    ‚îÇ      ‚úÖ NEW        ‚îÇ
‚îÇ   (~510 —Å—Ç—Ä–æ–∫)     ‚îÇ    ‚îÇ   (~560 —Å—Ç—Ä–æ–∫)     ‚îÇ    ‚îÇ   (~490 —Å—Ç—Ä–æ–∫)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                         ‚îÇ
          ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ              ‚îÇ                     ‚îÇ
          ‚ñº              ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ WinDivertBypass- ‚îÇ  ‚îÇ TrafficCollector ‚îÇ  ‚îÇ    LiveTestingPipeline       ‚îÇ
‚îÇ     Manager      ‚îÇ  ‚îÇ    ‚úÖ NEW        ‚îÇ  ‚îÇ        (~216 —Å—Ç—Ä–æ–∫)          ‚îÇ
‚îÇ  (–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å)   ‚îÇ  ‚îÇ  (~290 —Å—Ç—Ä–æ–∫)    ‚îÇ  ‚îÇ                              ‚îÇ
‚îÇ                  ‚îÇ  ‚îÇ                  ‚îÇ  ‚îÇ TesterWorker ‚Üí Classifier ‚Üí  ‚îÇ
‚îÇ ‚Ä¢ RST Blocker    ‚îÇ  ‚îÇ ‚Ä¢ IAsyncEnum     ‚îÇ  ‚îÇ ‚Üí UiWorker + BypassCoord     ‚îÇ
‚îÇ ‚Ä¢ TLS Fragment   ‚îÇ  ‚îÇ ‚Ä¢ –°–±–æ—Ä —Ç—Ä–∞—Ñ–∏–∫–∞   ‚îÇ  ‚îÇ                              ‚îÇ
‚îÇ ‚Ä¢ Fake TTL       ‚îÇ  ‚îÇ ‚Ä¢ –°–æ–±—ã—Ç–∏—è        ‚îÇ  ‚îÇ –ü–æ–ª—É—á–∞–µ—Ç —Ö–æ—Å—Ç—ã –æ—Ç Collector  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ                          ‚îÇ
                               ‚îÇ    HostDiscovered        ‚îÇ
                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
```

**–ö–ª—é—á–µ–≤–æ–π flow:**
```
DiagnosticOrchestrator.RunAsync()
    ‚îÇ
    ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞—ë—Ç TrafficCollector
    ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞—ë—Ç LiveTestingPipeline
    ‚îÇ
    ‚îî‚îÄ‚îÄ await foreach (host in TrafficCollector.CollectAsync())
            ‚îÇ
            ‚îî‚îÄ‚îÄ await LiveTestingPipeline.EnqueueHostAsync(host)
```

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:** TrafficAnalyzer ‚Üí TrafficCollector
- –†–∞–Ω—å—à–µ: TrafficAnalyzer —Å–æ–∑–¥–∞–≤–∞–ª LiveTestingPipeline –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è (–∏–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- –¢–µ–ø–µ—Ä—å: DiagnosticOrchestrator –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –æ–±–∞ **—Ä–∞–≤–Ω–æ–ø—Ä–∞–≤–Ω—ã—Ö** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–°—Ç–∞—Ç—É—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
| –ú–æ–¥—É–ª—å | –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –°—Ç–∞—Ç—É—Å |
|--------|------|-------|--------|
| MainViewModelRefactored | `ViewModels/MainViewModelRefactored.cs` | ~430 | ‚úÖ –°–æ–∑–¥–∞–Ω |
| BypassController | `ViewModels/BypassController.cs` | ~510 | ‚úÖ –°–æ–∑–¥–∞–Ω |
| DiagnosticOrchestrator | `ViewModels/DiagnosticOrchestrator.cs` | ~560 | ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω |
| TestResultsManager | `ViewModels/TestResultsManager.cs` | ~490 | ‚úÖ –°–æ–∑–¥–∞–Ω |
| TrafficCollector | `Utils/TrafficCollector.cs` | ~290 | ‚úÖ NEW |
| LiveTestingPipeline | `Utils/LiveTestingPipeline.cs` | ~216 | ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä—ë–Ω |
| TrafficAnalyzer | `Utils/TrafficAnalyzer.cs` | ~1034 | ‚ö†Ô∏è DEPRECATED |
| TrafficAnalyzerDualLayer | `Utils/TrafficAnalyzerDualLayer.cs` | ~752 | üóëÔ∏è –£–¥–∞–ª–∏—Ç—å |
| MainWindow –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ | `MainWindow.xaml.cs` | ‚è≥ TODO |

**–ö–∞–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:**
```csharp
// MainWindow.xaml.cs ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å:
DataContext = new MainViewModel();
// –ù–∞:
DataContext = new MainViewModelRefactored();
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**
1. **Single Responsibility** ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ
2. **Dependency Inversion** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ
3. **Event-driven** ‚Äî —Å–≤—è–∑—å —á–µ—Ä–µ–∑ `OnHostDiscovered`, `OnBlockageDetected`

---

#### ‚úÖ #2 –£–¥–∞–ª–µ–Ω–∏–µ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ ‚Äî –ì–û–¢–û–í–û
**–¶–µ–ª—å:** –ß–∏—Å—Ç–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞, –º–µ–Ω—å—à–µ –ø—É—Ç–∞–Ω–∏—Ü—ã

**–£–¥–∞–ª–µ–Ω–æ:**
- [x] `Models/FixHistory.cs`
- [x] `AuditRunner.cs`
- [x] `Output/` –ø–∞–ø–∫–∞
- [x] `WinDivertBypassEnforcer.cs` + `IBypassEnforcer.cs`
- [x] `OutputType` ‚Üí `WinExe` (—É–±—Ä–∞–Ω–æ –º–µ–ª—å–∫–∞–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏)

---

#### ‚úÖ #3 –í–∫–ª—é—á–∏—Ç—å Socket Layer –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî –ì–û–¢–û–í–û
**–¶–µ–ª—å:** –°–æ–±—ã—Ç–∏–π–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–º–µ—Å—Ç–æ polling (—Ç–æ—á–Ω–µ–µ + –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- [x] `DiagnosticOrchestrator` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `UseWatcherMode = false`
- [x] `FlowMonitorService.RunSocketMonitorLoop()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç WinDivert Socket Layer
- [x] Socket Layer (Sniff+RecvOnly) –ù–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å bypass (None)
- [x] Watcher mode –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ fallback

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```csharp
// DiagnosticOrchestrator.cs
_flowMonitor.UseWatcherMode = false;  // Socket Layer (WinDivert)
// FlowMonitorService.cs
if (!UseWatcherMode)
    _socketMonitorTask = Task.Run(() => RunSocketMonitorLoop(...));
```

---

### –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ (–í–ê–ñ–ù–û)

#### #4 Retransmission tracking ‚è±Ô∏è 4-6—á
**–¶–µ–ª—å:** –ì–ª–∞–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä DPI ‚Äî –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–ó–∞–¥–∞—á–∏:**
- [ ] –ß–µ—Ä–µ–∑ WinDivert Sniff layer –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å TCP seq numbers
- [ ] –°—á—ë—Ç—á–∏–∫ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π per-host
- [ ] –ü–æ—Ä–æ–≥ (3 —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏) ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `StandardBlockageClassifier`

---

#### #5 HTTP redirect detection ‚è±Ô∏è 2-3—á
**–¶–µ–ª—å:** –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å DPI –∑–∞–≥–ª—É—à–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–ó–∞–¥–∞—á–∏:**
- [ ] –ê–Ω–∞–ª–∏–∑ HTTP –æ—Ç–≤–µ—Ç–æ–≤ (Location header)
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º
- [ ] –ï—Å–ª–∏ SLD –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è ‚Üí DPI redirect
- [ ] BlockageType = "HTTP_REDIRECT"

---

#### #6 Fail counter —Å time window ‚è±Ô∏è 1—á
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç false positives

**–ó–∞–¥–∞—á–∏:**
- [ ] N —Ñ–µ–π–ª–æ–≤ –∑–∞ M —Å–µ–∫—É–Ω–¥ = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (default: 3/60)
- [ ] –°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

---

### –§–∞–∑–∞ 3: UX –∏ polish (–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

#### #7 UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ bypass ‚è±Ô∏è 1—á
- [ ] –°–æ—Å—Ç–æ—è–Ω–∏–µ `Faulted` –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ UI (–∫—Ä–∞—Å–Ω—ã–π –±–µ–π–¥–∂)
- [ ] Tooltip —Å –ø—Ä–∏—á–∏–Ω–æ–π –æ—à–∏–±–∫–∏

#### #8 OutputType=WinExe ‚è±Ô∏è 5–º–∏–Ω
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –≤ `.csproj` ‚Äî —É–±—Ä–∞—Ç—å –º–µ–ª—å–∫–∞–Ω–∏–µ –∫–æ–Ω—Å–æ–ª–∏

#### #9 Global exception handler ‚è±Ô∏è 30–º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `App.xaml.cs`
- [ ] MessageBox —Å –æ—à–∏–±–∫–æ–π –≤–º–µ—Å—Ç–æ –∫—Ä—ç—à–∞

#### #10 –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±–µ–∑ –∞–¥–º–∏–Ω –ø—Ä–∞–≤ ‚è±Ô∏è 30–º–∏–Ω
- [ ] –Ø–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"

---

## 3. –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –†–ï–®–ï–ù–ò–ï: Flow/Socket –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
**–í–∞—Ä–∏–∞–Ω—Ç C: –í–∫–ª—é—á–∏—Ç—å Socket Layer –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å bypass**
- Socket Layer (Sniff+RecvOnly) –ù–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å BypassManager (None)
- –°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å —Ç–æ—á–Ω–µ–µ polling
- Flow Layer —É–¥–∞–ª–∏—Ç—å ‚Äî –∏–∑–±—ã—Ç–æ—á–µ–Ω –ø—Ä–∏ Socket

### ‚úÖ –†–ï–®–ï–ù–ò–ï: GameProfile
**–£–¥–∞–ª–∏—Ç—å** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥

### ‚úÖ –†–ï–®–ï–ù–ò–ï: BypassCoordinator
**–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å** ‚Äî —É–∂–µ –Ω–∞–ø–∏—Å–∞–Ω, —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—É—é –ª–æ–≥–∏–∫—É:
- –ü—Ä–æ–±—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏
- –ö–µ—à–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –¥–ª—è —Ö–æ—Å—Ç–æ–≤
- –†–µ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ –†–ï–®–ï–ù–ò–ï: LiveTestingPipeline
**–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å** ‚Äî —É–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ pipeline –≤–Ω—É—Ç—Ä–∏ TrafficAnalyzer:
- TrafficAnalyzer ‚Üí —Ç–æ–ª—å–∫–æ `IAsyncEnumerable<HostDiscovered>`
- BypassCoordinator –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç
- Pipeline —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è helper –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

# –ß–∞—Å—Ç—å II: –ö–ê–ö –£–°–¢–†–û–ï–ù–û (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

## 4. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```
Program.Main()
‚îî‚îÄ‚îÄ GUI Mode ‚Üí new App().Run() ‚Üí MainWindow ‚Üí MainViewModelRefactored
```

### –û—Å–Ω–æ–≤–Ω–æ–π flow –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
```
MainViewModelRefactored
    ‚îÇ
    ‚îú‚îÄ‚îÄ BypassController         ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ bypass –∫–Ω–æ–ø–∫–∞–º–∏
    ‚îú‚îÄ‚îÄ DiagnosticOrchestrator   ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    ‚îÇ       ‚îÇ
    ‚îÇ       ‚îú‚îÄ‚îÄ TrafficCollector      ‚Äî —Å–±–æ—Ä —Ö–æ—Å—Ç–æ–≤ (IAsyncEnumerable)
    ‚îÇ       ‚îî‚îÄ‚îÄ LiveTestingPipeline   ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + bypass
    ‚îÇ               ‚îÇ
    ‚îÇ               ‚îî‚îÄ‚îÄ BypassCoordinator ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
    ‚îÇ
    ‚îî‚îÄ‚îÄ TestResultsManager       ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏
```

### Flow –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```
DiagnosticOrchestrator.RunAsync()
‚îÇ
‚îú‚îÄ‚îÄ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
‚îú‚îÄ‚îÄ 2. DNS flush
‚îú‚îÄ‚îÄ 3. –°–æ–∑–¥–∞–Ω–∏–µ OverlayWindow
‚îú‚îÄ‚îÄ 4. –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (FlowMonitor, NetworkMonitor, DnsParser, PidTracker)
‚îú‚îÄ‚îÄ 5. –ó–∞–ø—É—Å–∫ —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
‚îú‚îÄ‚îÄ 6. Bypass –≤–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ BypassController
‚îú‚îÄ‚îÄ 7. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:
‚îÇ       ‚îú‚îÄ‚îÄ TrafficCollector.CollectAsync() ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç —Ö–æ—Å—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ LiveTestingPipeline ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç bypass
‚îú‚îÄ‚îÄ 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–∏—à–∏–Ω—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚îú‚îÄ‚îÄ 9. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è
‚îî‚îÄ‚îÄ 10. –ó–∞–∫—Ä—ã—Ç–∏–µ overlay
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è UI
```
"start"   ‚Üí –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
"running" ‚Üí –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–¥—ë—Ç (+ OverlayWindow)
"done"    ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

---

## 5. Bypass —Å–∏—Å—Ç–µ–º–∞

### WinDivertBypassManager

**–°–æ—Å—Ç–æ—è–Ω–∏—è:** `Disabled ‚Üí Enabling ‚Üí Enabled ‚Üí Disabling ‚Üí Disabled` (+ `Faulted`)

**TLS —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| Fragment | –§—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ 1‚Üí2 |
| Disorder | –§—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ 2‚Üí1 (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ) |
| Fake | Fake –ø–∞–∫–µ—Ç —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL |
| FakeFragment | Fake + Fragment |
| FakeDisorder | Fake + Disorder |

**Worker'—ã:**
| Worker | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|--------|-----------|------------|
| RstBlocker | 0 (–≤—ã—Å–æ–∫–∏–π) | –î—Ä–æ–ø–∞–µ—Ç TCP RST –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| TlsFragmenter | 200 (–Ω–∏–∑–∫–∏–π) | –§—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä—É–µ—Ç TLS ClientHello |

**–§–∏–ª—å—Ç—Ä:** –°–µ–π—á–∞—Å –≥–ª–æ–±–∞–ª—å–Ω—ã–π `tcp.DstPort == 443` ‚Äî –≤–ª–∏—è–µ—Ç –Ω–∞ –í–°–ï HTTPS.

### BypassCoordinator (‚úÖ –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù)

**–†–æ–ª—å:** –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π "–º–æ–∑–≥" —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è bypass-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏.

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `AutoFixLiveAsync()` ‚Äî –≥–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è live-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `AutoFixAsync()` ‚Äî –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `SuggestFixes()` ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è —Ö–æ—Å—Ç–∞
2. –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç `StrategyMapping.GetStrategiesFor(result).Applicable`
3. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–µ–ª–∞–µ—Ç —Ä–µ—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ callback
4. –ö–µ—à–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
5. –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π ‚Äî `DisableAsync()`

---

## 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–µ—Ç–µ–∫—Ü–∏—è

### WinDivert Layers

| Layer | Flags | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-------|------------|
| Network + Sniff | –¢–æ–ª—å–∫–æ –∫–æ–ø–∏—Ä—É–µ—Ç | DNS –∑–∞—Ö–≤–∞—Ç (NetworkMonitor) |
| Flow + Sniff+RecvOnly | –¢–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç | –°–æ–±—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø) |
| Socket + Sniff+RecvOnly | –¢–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç | –°–æ–±—ã—Ç–∏—è connect (–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø) |
| Network + None | –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç | RST blocker, TLS fragmenter |

**–ö–ª—é—á–µ–≤–æ–µ:** `Sniff` –ù–ï –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å `None` ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!

### FlowMonitorService

**–î–≤–∞ —Ä–µ–∂–∏–º–∞:**
1. **WinDivert Socket Layer** ‚Äî —Å–æ–±—ã—Ç–∏–π–Ω—ã–π, —Ç–æ—á–Ω—ã–π ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø
2. **IP Helper API polling** ‚Äî fallback –¥–ª—è —Å–∏—Å—Ç–µ–º –±–µ–∑ WinDivert

**–¢–µ–∫—É—â–µ–µ:** `DiagnosticOrchestrator` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `UseWatcherMode = false` ‚Üí Socket Layer –∞–∫—Ç–∏–≤–µ–Ω.

### –î–µ—Ç–µ–∫—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (StandardHostTester + StandardBlockageClassifier)

**BlockageType:**
- `TCP_RST` ‚Äî SocketError.ConnectionReset
- `TCP_TIMEOUT` ‚Äî Task.Delay(3000) –≤—ã–∏–≥—Ä–∞–ª
- `TLS_DPI` ‚Äî AuthenticationException
- `PORT_CLOSED` ‚Äî SocketError.ConnectionRefused
- `FAKE_IP` ‚Äî IP –≤ 198.18.x.x –¥–∏–∞–ø–∞–∑–æ–Ω–µ

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ (StrategyMapping):**
```
DNS_FILTERED/DNS_BOGUS ‚Üí DOH (—Ä—É—á–Ω–æ–µ)
TcpOk && !TlsOk ‚Üí DROP_RST, TLS_FRAGMENT, TLS_FAKE
!TcpOk && –±—ã—Å—Ç—Ä–æ (<200ms) ‚Üí DROP_RST (RST injection)
!TcpOk && –º–µ–¥–ª–µ–Ω–Ω–æ (>2000ms) ‚Üí PROXY (—Ä—É—á–Ω–æ–µ)
```

---

## 7. UI –∏ ViewModel

### –ù–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (02.12.2025)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–æ–∫ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|-----------|-------|----------------|
| `MainViewModelRefactored` | ~430 | –¢–æ–Ω–∫–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –ø—Ä–æ–∫—Å–∏-—Å–≤–æ–π—Å—Ç–≤–∞ |
| `BypassController` | ~510 | Toggle –∫–Ω–æ–ø–∫–∏, VPN, DoH, WinDivertBypassManager |
| `DiagnosticOrchestrator` | ~560 | Lifecycle, TrafficCollector + Pipeline |
| `TestResultsManager` | ~490 | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–∞—Ä—Å–∏–Ω–≥, —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ |

### MainViewModelRefactored

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```csharp
MainViewModelRefactored()
‚îú‚îÄ‚îÄ new BypassController()           // Bypass –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ new DiagnosticOrchestrator()     // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ new TestResultsManager()         // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ (–¥–µ–ª–µ–≥–∏—Ä—É—é—Ç –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã)
‚îî‚îÄ‚îÄ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
```

**–ê–≤—Ç–æ-bypass –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (—á–µ—Ä–µ–∑ BypassController):**
```csharp
await Bypass.InitializeOnStartupAsync();
// –í–Ω—É—Ç—Ä–∏: Fragment + DropRst + DoH –≤–∫–ª—é—á–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### Bypass Control Panel

| –ö–Ω–æ–ø–∫–∞ | –°–≤–æ–π—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| Fragment | IsFragmentEnabled | TLS —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è 1‚Üí2 |
| Disorder | IsDisorderEnabled | TLS —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è 2‚Üí1 |
| Fake | IsFakeEnabled | Fake TTL –ø–∞–∫–µ—Ç |
| DROP RST | IsDropRstEnabled | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ TCP RST |
| DoH | IsDoHEnabled | DNS-over-HTTPS |

**Fragment –∏ Disorder –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ** ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç –¥—Ä—É–≥–æ–µ.

---

## 8. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ 02.12.2025)
```
ISP_Audit/
‚îú‚îÄ‚îÄ Program.cs                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (GUI only)
‚îú‚îÄ‚îÄ App.xaml(.cs)                 # WPF Application
‚îú‚îÄ‚îÄ MainWindow.xaml(.cs)          # –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ
‚îÇ
‚îú‚îÄ‚îÄ ViewModels/
‚îÇ   ‚îú‚îÄ‚îÄ MainViewModel.cs              # ‚ö†Ô∏è DEPRECATED (—Å—Ç–∞—Ä—ã–π God Object)
‚îÇ   ‚îú‚îÄ‚îÄ MainViewModelRefactored.cs    # ‚úÖ NEW: —Ç–æ–Ω–∫–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ BypassController.cs           # ‚úÖ NEW: bypass toggle, VPN, DoH
‚îÇ   ‚îú‚îÄ‚îÄ DiagnosticOrchestrator.cs     # ‚úÖ NEW: lifecycle, Collector+Pipeline
‚îÇ   ‚îî‚îÄ‚îÄ TestResultsManager.cs         # ‚úÖ NEW: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —ç–≤—Ä–∏—Å—Ç–∏–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ Bypass/
‚îÇ   ‚îú‚îÄ‚îÄ WinDivertBypassManager.cs # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WinDivert
‚îÇ   ‚îú‚îÄ‚îÄ BypassProfile.cs          # –ü—Ä–æ—Ñ–∏–ª—å bypass
‚îÇ   ‚îú‚îÄ‚îÄ BypassCoordinator.cs      # ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–∑–≥ bypass
‚îÇ   ‚îú‚îÄ‚îÄ StrategyMapping.cs        # –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ WinDivertNative.cs        # P/Invoke
‚îÇ
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ Interfaces/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IHostTester.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IBlockageClassifier.cs
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îî‚îÄ‚îÄ Modules/
‚îÇ       ‚îú‚îÄ‚îÄ StandardHostTester.cs
‚îÇ       ‚îî‚îÄ‚îÄ StandardBlockageClassifier.cs
‚îÇ
‚îú‚îÄ‚îÄ Utils/
‚îÇ   ‚îú‚îÄ‚îÄ TrafficCollector.cs       # ‚úÖ NEW: —á–∏—Å—Ç—ã–π —Å–±–æ—Ä—â–∏–∫ (IAsyncEnumerable)
‚îÇ   ‚îú‚îÄ‚îÄ TrafficAnalyzer.cs        # ‚ö†Ô∏è DEPRECATED
‚îÇ   ‚îú‚îÄ‚îÄ TrafficAnalyzerDualLayer.cs # üóëÔ∏è –£–¥–∞–ª–∏—Ç—å (–º—ë—Ä—Ç–≤—ã–π –∫–æ–¥)
‚îÇ   ‚îú‚îÄ‚îÄ LiveTestingPipeline.cs    # ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + BypassCoordinator
‚îÇ   ‚îú‚îÄ‚îÄ FlowMonitorService.cs     # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îú‚îÄ‚îÄ Target.cs
‚îÇ   ‚îî‚îÄ‚îÄ TestResult.cs
‚îÇ
‚îú‚îÄ‚îÄ Profiles/
‚îÇ   ‚îî‚îÄ‚îÄ Default.json
‚îÇ
‚îú‚îÄ‚îÄ native/
‚îÇ   ‚îú‚îÄ‚îÄ WinDivert64.sys
‚îÇ   ‚îî‚îÄ‚îÄ WinDivert.dll
‚îÇ
‚îî‚îÄ‚îÄ TestNetworkApp/               # –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (TODO)
- [ ] –í–∫–ª—é—á–∏—Ç—å Socket Layer –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Å–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å)
- [ ] –£–ª—É—á—à–∏—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é: TCP Retransmissions, HTTP redirects
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: YouTube, Discord, rutracker

---

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- **–¢—Ä–µ–±—É—é—Ç—Å—è** ‚Äî `app.manifest` —Å–æ–¥–µ—Ä–∂–∏—Ç `requireAdministrator`
- WinDivert –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∞–¥–º–∏–Ω –ø—Ä–∞–≤
- –ë–µ–∑ –∞–¥–º–∏–Ω–∞: bypass –æ—Ç–∫–ª—é—á—ë–Ω, –∫–Ω–æ–ø–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã

### VPN –¥–µ—Ç–µ–∫—Ü–∏—è
```csharp
// NetUtils.LikelyVpnActive() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
// - TAP/TUN –∞–¥–∞–ø—Ç–µ—Ä—ã
// - WireGuard, OpenVPN, IKEv2
// - –ò–º–µ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "vpn"
```

### WinDivert
- –î—Ä–∞–π–≤–µ—Ä `WinDivert64.sys` –≤ `native/`
- –£–¥–∞–ª–µ–Ω–∏–µ: `sc delete WinDivert`

---

## Changelog –¥–æ–∫—É–º–µ–Ω—Ç–∞

| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| 02.12.2025 | **TrafficCollector:** TrafficAnalyzer –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ TrafficCollector (SRP, IAsyncEnumerable). DiagnosticOrchestrator —Ç–µ–ø–µ—Ä—å –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç Collector + Pipeline. TrafficAnalyzer –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ DEPRECATED |
| 02.12.2025 | **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MainViewModel:** –¥–æ–±–∞–≤–ª–µ–Ω—ã BypassController, DiagnosticOrchestrator, TestResultsManager, MainViewModelRefactored. –î–∏–∞–≥—Ä–∞–º–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø–æ–º–µ—Ç–∫–∞–º–∏ ‚úÖ NEW |
| 01.12.2025 | **–¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (TrafficAnalyzer –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å Pipeline) |
| 01.12.2025 | **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:** BypassCoordinator –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω, WinDivertBypassEnforcer/IBypassEnforcer —É–¥–∞–ª–µ–Ω—ã, –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ –æ—á–∏—â–µ–Ω |
| 01.12.2025 | –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –Ω–∞—á–∞–ª–æ, –ø–ª–∞–Ω —Ä–∞–±–æ—Ç, –ø—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è |
| 27.11.2025 | –î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å Zapret |
| 27.11.2025 | –î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ bypass –º–µ—Ç–æ–¥–æ–≤ —Å GoodbyeDPI/Zapret |
| 27.11.2025 | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã |
