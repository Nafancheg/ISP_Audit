# TODO: –£–ª—É—á—à–µ–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (—Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥)

## 1. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ (–ø–æ –∫–æ–¥—É)

### 1.1. StandardHostTester (`Core/Modules/StandardHostTester.cs`)

- **DNS:**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ reverse DNS —á–µ—Ä–µ–∑ `Dns.GetHostEntryAsync(ip)` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 2 —Å–µ–∫—É–Ω–¥—ã.
  - –†–µ–∑—É–ª—å—Ç–∞—Ç DNS **–Ω–µ –≤–ª–∏—è–µ—Ç** –Ω–∞ —Å—Ç–∞—Ç—É—Å `dnsOk` –∏ `dnsStatus` ‚Äî –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã (`dnsOk = true`, `dnsStatus = "OK"`).
  - `_dnsCache` (–∏–∑ `DnsParserService.DnsCache`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –±—ã—Å—Ç—Ä—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ hostname, –Ω–æ **–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç** –≤ –ª–æ–≥–∏–∫–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

- **TCP:**
  - –°–æ–∑–¥–∞—ë—Ç—Å—è `TcpClient`, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `host.RemoteIp:host.RemotePort` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 3 —Å–µ–∫—É–Ω–¥—ã —á–µ—Ä–µ–∑ `CancellationTokenSource.CancelAfter(3000)`.
  - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º `ConnectAsync`:
    - `tcpOk = true`.
    - `tcpLatencyMs` = –≤—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞ `Stopwatch`.
  - –ü—Ä–∏ `OperationCanceledException`:
    - `blockageType = "TCP_TIMEOUT"`.
  - –ü—Ä–∏ `SocketException`:
    - `ConnectionRefused` ‚Üí `blockageType = "PORT_CLOSED"`, `tcpOk = false`.
    - `ConnectionReset` ‚Üí `blockageType = "TCP_RST"`, `tcpOk = false`.
    - –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ ‚Üí `blockageType = "TCP_ERROR"`, `tcpOk = false`.

- **TLS:**
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Ä—Ç–∞ 443** –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `tcpOk == true` –∏ –µ—Å—Ç—å `hostname`.
  - –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π `TcpClient`, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ `ConnectAsync` –Ω–∞ 443 —Å —Ç–∞–π–º–∞—É—Ç–æ–º 3 —Å–µ–∫—É–Ω–¥—ã.
  - –°–æ–∑–¥–∞—ë—Ç—Å—è `SslStream` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `AuthenticateAsClientAsync` —Å `Tls12|Tls13` –∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Ç–∑—ã–≤–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.
  - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: `tlsOk = true`.
  - –ü—Ä–∏ `OperationCanceledException`: `blockageType = "TLS_TIMEOUT"`.
  - –ü—Ä–∏ `AuthenticationException`: `tlsOk = false`, `blockageType = "TLS_DPI"`.
  - –ü—Ä–∏ –ª—é–±–æ–º –¥—Ä—É–≥–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–∏: `tlsOk = false`, `blockageType = blockageType ?? "TLS_ERROR"` (–Ω–µ –ø–µ—Ä–µ—Ç–∏—Ä–∞–µ—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `blockageType`, –µ—Å–ª–∏ –æ–Ω –±—ã–ª).
  - –ï—Å–ª–∏ –ø–æ—Ä—Ç 443, –Ω–æ hostname –Ω–µ—Ç ‚Üí `tlsOk = tcpOk` (TLS –ø–æ —Å—É—Ç–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è).
  - –î–ª—è –Ω–µ-HTTPS (`RemotePort != 443`) ‚Üí `tlsOk = tcpOk`.

- **–ò—Ç–æ–≥:**
  - –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `HostTested` —Å–æ–¥–µ—Ä–∂–∏—Ç:
    - `DnsOk` (–≤—Å–µ–≥–¥–∞ true), `DnsStatus` (–≤—Å–µ–≥–¥–∞ "OK").
    - `TcpOk`, `TlsOk`.
    - `BlockageType` (–æ–¥–Ω–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø–æ–ª–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `TCP_TIMEOUT`, `TCP_RST`, `PORT_CLOSED`, `TLS_DPI`, `TLS_ERROR`, `TLS_TIMEOUT`, `TCP_ERROR`).
    - –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ `DateTime.UtcNow`.
  - –ù–∏–∫–∞–∫–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤, –æ–∫–æ–Ω –≤—Ä–µ–º–µ–Ω–∏, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è—Ö, HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç–∞—Ö –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–µ RST –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–∞–∫–µ—Ç–æ–≤ –∑–¥–µ—Å—å **–Ω–µ—Ç**.

### 1.2. StandardBlockageClassifier (`Core/Modules/StandardBlockageClassifier.cs`)

- –ù–∞ –≤—Ö–æ–¥ –ø–æ–ª—É—á–∞–µ—Ç –æ–¥–∏–Ω `HostTested`.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `StrategyMapping.GetStrategiesFor(tested)` –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö bypass-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –Ω–æ —ç—Ç–æ **—É–∂–µ —É—Ä–æ–≤–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**, –Ω–µ –¥–µ—Ç–µ–∫—Ü–∏–∏.
- –î–µ—Ç–µ–∫—Ü–∏—è/–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
  - –ï—Å–ª–∏ IP –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ `198.18.0.0/15` –∏–ª–∏ hostname == `openwrt.lan` ‚Üí
    - –°—á–∏—Ç–∞–µ—Ç—Å—è `ROUTER_REDIRECT`.
    - –í `HostTested` –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è `BlockageType = "FAKE_IP"`.
  - –ï—Å–ª–∏ `BlockageType == "PORT_CLOSED"` ‚Üí
    - –°—á–∏—Ç–∞–µ—Ç—Å—è "–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø—Ä–æ—Å—Ç–æ —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω".
    - –°—Ç—Ä–∞—Ç–µ–≥–∏—è `NONE`, —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –ø–æ—Ä—Ç–∞.
  - –ï—Å–ª–∏ `DnsOk && TcpOk && TlsOk` ‚Üí
    - –°—Ç—Ä–∞—Ç–µ–≥–∏—è `NONE`, `action = "OK"`.
  - –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö:
    - –ï—Å–ª–∏ –µ—Å—Ç—å `rec.Applicable` (–ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–∑ `StrategyMapping`) ‚Üí –±–µ—Ä—ë—Ç—Å—è –ø–µ—Ä–≤–∞—è, `action = "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: ..."`.
    - –ò–Ω–∞—á–µ –µ—Å–ª–∏ –µ—Å—Ç—å `rec.Manual` ‚Üí –ø–µ—Ä–≤–∞—è, `action = "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ: ..."`.
    - –ò–Ω–∞—á–µ ‚Üí —Å—Ç—Ä–∞—Ç–µ–≥–∏—è `UNKNOWN`, `action = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ..."`.
- –í–ê–ñ–ù–û: –∫–ª–∞—Å—Å **–Ω–µ –≤–µ–¥—ë—Ç –Ω–∏–∫–∞–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è** –≤–æ –≤—Ä–µ–º–µ–Ω–∏:
  - –ù–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Ö–æ—Å—Ç—É,
  - –ù–µ—Ç —Å—á—ë—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫,
  - –ù–µ—Ç —É—á—ë—Ç–∞ –æ–∫–æ–Ω –≤—Ä–µ–º–µ–Ω–∏,
  - –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è "—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏" –∏–ª–∏ `DpiSuspicionScore`.
- –í—Å—è –ª–æ–≥–∏–∫–∞ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ **–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç `HostTested`** –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π `StrategyMapping`.

### 1.3. ConnectionMonitorService (`Utils/ConnectionMonitorService.cs`)

- –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**.
- –î–≤–∞ —Ä–µ–∂–∏–º–∞:
  - `UsePollingMode = true` ‚Üí polling —á–µ—Ä–µ–∑ `TcpConnectionWatcher` (IP Helper API).
  - `UsePollingMode = false` (–æ—Å–Ω–æ–≤–Ω–æ–π) ‚Üí WinDivert Socket Layer (`Layer.Socket`, `Sniff+RecvOnly`).
- –°–æ–±—ã—Ç–∏–µ `OnConnectionEvent` –¥–∞—ë—Ç:
  - `eventCount` (–æ–±—â–∏–π —Å—á—ë—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π),
  - `pid` –ø—Ä–æ—Ü–µ—Å—Å–∞,
  - `protocol` (TCP/UDP),
  - `remoteIp`, `remotePort`, `localPort`.
- –í–Ω—É—Ç—Ä–∏ `RunSocketLoop`:
  - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è WinDivert —Å —Ñ–∏–ª—å—Ç—Ä–æ–º `"true"` –Ω–∞ Socket Layer, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç -1000, —Ñ–ª–∞–≥–∏ `Sniff | RecvOnly`.
  - –¶–∏–∫–ª —á–∏—Ç–∞–µ—Ç `WinDivertRecv`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `addr.Event == WINDIVERT_EVENT_SOCKET_CONNECT`.
  - –§–∏–ª—å—Ç—Ä—É–µ—Ç loopback.
  - –°—á–∏—Ç–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π `_totalEventsCount`, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `MonitorStartedUtc` –∏ `FirstEventUtc`.
  - –ü–æ–¥–Ω–∏–º–∞–µ—Ç `OnConnectionEvent`.
- –í–ê–ñ–ù–û: —Å–µ—Ä–≤–∏—Å **–Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∞–º–∏ TCP-–ø–∞–∫–µ—Ç—ã**, —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è connect:
  - –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ `seq/ack`.
  - –ù–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤ –æ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è—Ö.
  - –ù–µ—Ç RST-–∏–Ω—Å–ø–µ–∫—Ü–∏–∏.
  - –ù–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º `HostTested` (–∫—Ä–æ–º–µ —Ç–æ–≥–æ, —á—Ç–æ –æ–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–±—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏).

### 1.4. NetworkMonitorService (`Utils/NetworkMonitorService.cs`)

- –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ WinDivert Network Layer (–æ–±—ã—á–Ω–æ `Layer.Network`, `Sniff`).
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç WinDivert —Å –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º (`_filter`) –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (`_priority`).
- –í —Ü–∏–∫–ª–µ:
  - –î–µ–ª–∞–µ—Ç `WinDivertRecv` –≤ –±—É—Ñ–µ—Ä 1500 –±–∞–π—Ç.
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞:
    - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `PacketsCount`.
    - –î–µ–ª–∞–µ—Ç –∫–æ–ø–∏—é –±—É—Ñ–µ—Ä–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏—è.
    - –í—ã–∑—ã–≤–∞–µ—Ç `OnPacketReceived(PacketData)` —Å –ø–æ–ª—è–º–∏:
      - `PacketNumber`,
      - `Buffer` (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ),
      - `Length`,
      - `IsOutbound`,
      - `IsLoopback`.
- –°–µ—Ä–≤–∏—Å **–ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞** TCP/UDP/HTTP/DNS:
  - –ù–µ—Ç —Ä–∞–∑–±–æ—Ä–∞ TCP-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.
  - –ù–µ—Ç –ø–æ–¥—Å—á—ë—Ç–∞ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π.
  - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ HTTP-–æ—Ç–≤–µ—Ç–æ–≤/—Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤.
  - –û–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º.

### 1.5. LiveTestingPipeline (`Utils/LiveTestingPipeline.cs`)

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ: `Sniffer ‚Üí Tester ‚Üí Classifier ‚Üí Bypass ‚Üí UI`.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç:
  - `IHostTester` ‚Üí –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ `StandardHostTester`.
  - `IBlockageClassifier` ‚Üí `StandardBlockageClassifier`.
  - `DnsParserService` (–¥–ª—è –∫–µ—à–∞ DNS –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è hostname).
  - `ITrafficFilter` (`UnifiedTrafficFilter`) –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏/—à—É–º–æ–≤—ã—Ö —Ö–æ—Å—Ç–æ–≤.
- –ü–æ—Ç–æ–∫–∏:
  - `_snifferQueue: Channel<HostDiscovered>` ‚Äî –≤—Ö–æ–¥ –æ—Ç `TrafficCollector`.
  - `_testerQueue: Channel<HostTested>` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–µ—Ä–∞.
  - `_bypassQueue: Channel<HostBlocked>` ‚Äî –¥–ª—è UI.

- **TesterWorker:**
  - –ó–∞–±–∏—Ä–∞–µ—Ç `HostDiscovered` –∏–∑ `_snifferQueue`.
  - –ë–µ—Ä—ë—Ç hostname –∏–∑ `_dnsParser?.DnsCache` (–µ—Å–ª–∏ –µ—Å—Ç—å) —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
  - –ß–µ—Ä–µ–∑ `_filter.ShouldTest(host, hostname)` —Ä–µ—à–∞–µ—Ç, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–∏.
  - –í—ã–∑—ã–≤–∞–µ—Ç `_tester.TestHostAsync(host, ct)` ‚Üí `HostTested`.
  - –ö–ª–∞–¥—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `_testerQueue`.

- **ClassifierWorker:**
  - –ó–∞–±–∏—Ä–∞–µ—Ç `HostTested`.
  - –í—ã–∑—ã–≤–∞–µ—Ç `_classifier.ClassifyBlockage(tested)` ‚Üí `HostBlocked`.
  - –ß–µ—Ä–µ–∑ `_filter.ShouldDisplay(blocked)` —Ä–µ—à–∞–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
  - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç hostname –∏–∑ DNS-–∫–µ—à–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —à—É–º (`NoiseHostFilter`).
  - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å ‚Üí –∫–ª–∞–¥—ë—Ç –≤ `_bypassQueue`.

- **UiWorker:**
  - –ó–∞–±–∏—Ä–∞–µ—Ç `HostBlocked`.
  - –§–æ—Ä–º–∏—Ä—É–µ—Ç —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
    - `host:port (latency) | DNS/TCP/TLS —Ñ–ª–∞–≥–∏ | BlockageType`.
    - –ï—Å–ª–∏ `BypassStrategy` != `NONE/UNKNOWN` ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é.
- –í–ê–ñ–ù–û: Pipeline **–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã—Ö –¥–µ—Ç–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤**, –æ–Ω —Ç–æ–ª—å–∫–æ:
  - –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ö–æ—Å—Ç—ã —á–µ—Ä–µ–∑ `StandardHostTester`,
  - –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ `StandardBlockageClassifier`,
  - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç/–ª–æ–≥–∏—Ä—É–µ—Ç/–ø–µ—Ä–µ–¥–∞—ë—Ç –≤ UI.

---

## 2. –í—ã–≤–æ–¥—ã –ø–æ —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –¥–µ—Ç–µ–∫—Ü–∏–π

1. **TCP Retransmissions ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é:**
   - –ù–∏ –æ–¥–∏–Ω –º–æ–¥—É–ª—å –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `seq/ack` TCP-–ø–∞–∫–µ—Ç–æ–≤.
   - `ConnectionMonitorService` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Socket Layer –∏ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è connect.
   - `NetworkMonitorService` –æ—Ç–¥–∞—ë—Ç —Å—ã—Ä—ã–µ –ø–∞–∫–µ—Ç—ã, –Ω–æ **–Ω–µ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è**, –∫–æ—Ç–æ—Ä—ã–π –±—ã —Å—á–∏—Ç–∞–ª —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏.

2. **HTTP redirect detect ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
   - –ù–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ HTTP-–æ—Ç–≤–µ—Ç–æ–≤ (`Status-Code`, `Location`).
   - –ù–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ö–æ—Å—Ç–æ–º.
   - `StandardHostTester` –≤–æ–æ–±—â–µ –Ω–µ –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã, —Ç–æ–ª—å–∫–æ TCP connect + TLS handshake.

3. **RST packet inspection ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
   - RST —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ `SocketException.ConnectionReset` –≤ TCP connect.
   - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ RST-–ø–∞–∫–µ—Ç–æ–≤ –≤ Network Layer (TTL, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Å–∏–≥–Ω–∞—Ç—É—Ä—ã DPI).
   - –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ RST –≤ `ConnectionMonitorService`.

4. **Fail counter + time window ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
   - `StandardBlockageClassifier` –∏ `LiveTestingPipeline` —Ä–∞–±–æ—Ç–∞—é—Ç **–Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** (`HostTested`).
   - –ù–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è per-host/per-IP/per-domain.
   - –ù–µ—Ç –æ–∫–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3 —Ñ–µ–π–ª–∞ –∑–∞ 60 —Å–µ–∫—É–Ω–¥).
   - `TestResultsManager` (–ø–æ –¥—Ä—É–≥–∏–º —Ñ–∞–π–ª–∞–º) —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –Ω–æ –≤ —Ç–µ–∫—É—â–µ–º –∞–Ω–∞–ª–∏–∑–µ –æ–Ω **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –¥–µ—Ç–µ–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ `StandardBlockageClassifier`.

5. **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã:**
   - `TCP_RST` ‚Äî –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `SocketError.ConnectionReset` –ø—Ä–∏ TCP connect.
   - `TCP_TIMEOUT` ‚Äî —á–µ—Ä–µ–∑ `OperationCanceledException` –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ 3—Å —Ç–∞–π–º–∞—É—Ç–∞.
   - `TLS_DPI` ‚Äî —á–µ—Ä–µ–∑ `AuthenticationException` –ø—Ä–∏ TLS handshake.
   - `TLS_TIMEOUT` ‚Äî —á–µ—Ä–µ–∑ `OperationCanceledException` –≤ TLS.
   - `PORT_CLOSED` ‚Äî —á–µ—Ä–µ–∑ `SocketError.ConnectionRefused`.
   - `FAKE_IP` ‚Äî —á–µ—Ä–µ–∑ –¥–∏–∞–ø–∞–∑–æ–Ω `198.18.0.0/15` –∏ hostname `openwrt.lan`.

6. **–°–≤—è–∑–∫–∞ —Å bypass-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏:**
   - –ß–µ—Ä–µ–∑ `StrategyMapping.GetStrategiesFor(tested)` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–µ–π `DnsOk/TcpOk/TlsOk/BlockageType`.
   - –¢–∞–∫ –∫–∞–∫ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å–∏–≥–Ω–∞–ª—ã (retransmissions/HTTP redirect/RST-inspection/fail counter) –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, `StrategyMapping` –≤—ã–Ω—É–∂–¥–µ–Ω –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Üí —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

---

## 3. –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏–Ω–≤–∞–∑–∏–≤–Ω—ã–π)

> –¶–µ–ª—å: –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã **–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –ª–æ–º–∞—Ç—å** —Ç–µ–∫—É—â–∏–π —Ä–∞–±–æ—á–∏–π –ø–∞–π–ø–ª–∞–π–Ω (`StandardHostTester` ‚Üí `StandardBlockageClassifier` ‚Üí `LiveTestingPipeline`), —Ä–∞—Å—à–∏—Ä—è—è –µ–≥–æ, –∞ –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è —Å –Ω—É–ª—è.

### 3.1. Fail counter + time window

**–°—Ç–∞—Ç—É—Å:** –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ **—Å–¥–µ–ª–∞–Ω—ã**.

- [x] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–æ–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä `HostBlockageState` (`Core/Models`):
  - `HostKey` (IP + –ø–æ—Ä—Ç –∏/–∏–ª–∏ hostname).
  - `List<FailureEvent>` —Å `Timestamp`, `BlockageType`, —Ñ–ª–∞–≥–∞–º–∏ (`IsHardFail`, `IsTimeout`, `IsTls`, –∏ —Ç.–ø.).
  - –†–∞—Å—á—ë—Ç–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞: `FailCountLastWindow(TimeSpan window)`, `HasRecentHardFails`, –∏ —Ç.–ø.

- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å—Ç–æ—Ä –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä `IBlockageStateStore` + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏):
  - –ú–µ—Ç–æ–¥—ã –≤–∏–¥–∞ `RegisterResult(HostTested result)` –∏ –≤—ã–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ–∫–Ω—É (`FailWindowStats`).

- [x] –†–∞—Å—à–∏—Ä–∏—Ç—å `StandardBlockageClassifier` —Ç–∞–∫, —á—Ç–æ–±—ã:
  - –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–ª—Å—è `IBlockageStateStore` (—á–µ—Ä–µ–∑ DI –∏–ª–∏ —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π).
  - –í `ClassifyBlockage` –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–µ–π–ª–æ–≤ –∑–∞ –æ–∫–Ω–æ –∏ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Ö–æ—Ç—è –±—ã –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–π —á–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ("—Ñ–µ–π–ª–æ–≤ –∑–∞ 60—Å: N").

- [x] –í `LiveTestingPipeline` –∑–∞–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ `new StandardBlockageClassifier()` –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
  - –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ–±—â–∏–π `IBlockageStateStore`.

- [x] –†–∞–∑–≤–∏—Ç—å —Å—Ç–æ—Ä –¥–æ –ø–µ—Ä–≤–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:
  - –í–≤–µ—Å—Ç–∏ DTO `BlockageSignals` (fail-count, hard-fail-count, –æ–∫–Ω–æ, retranmission-count).
  - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `GetSignals(HostTested, TimeSpan)` –≤ `IBlockageStateStore` –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ `InMemoryBlockageStateStore`.
  - –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ `StandardBlockageClassifier` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `BlockageSignals` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–π —á–∞—Å—Ç–∏ –∏ –º—è–≥–∫–æ–π —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ `TCP_RETRY_HEAVY`.

- [x] –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:
  - –†–∞—Å—à–∏—Ä–∏—Ç—å `BlockageSignals` –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (RST, HTTP-redirect, TLS-auth-fails) –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤.
  - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–¥–µ–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π `IBlockageSignalsProvider`, –æ—Å—Ç–∞–≤–∏–≤ `IBlockageStateStore` —Ç–æ–Ω–∫–æ–π –æ–±—ë—Ä—Ç–∫–æ–π –Ω–∞–¥ –∏—Å—Ç–æ—Ä–∏–µ–π `HostTested`.

**–ü–ª—é—Å—ã:**
- –ù–µ –ª–æ–º–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IBlockageClassifier` –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã `ClassifyBlockage`.
- –í—Å—è –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å—Ç–æ—Ä–µ –∏ –Ω–µ–º–Ω–æ–≥–æ –≤ `StandardBlockageClassifier`.

### 3.2. TCP Retransmissions –Ω–∞ –±–∞–∑–µ NetworkMonitorService

**–°—Ç–∞—Ç—É—Å:** –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π **—Å–¥–µ–ª–∞–Ω–∞**, —Å–∏–≥–Ω–∞–ª —É–∂–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä **–∏ UI**.
- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `TcpRetransmissionTracker` (`Core/Modules/TcpRetransmissionTracker.cs`):
  - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `NetworkMonitorService.OnPacketReceived`.
  - –ü–∞—Ä—Å–∏—Ç IPv4+TCP-–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ `PacketData.Buffer`.
  - –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏ –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É `TcpFlowKey` (src/dst IP+–ø–æ—Ä—Ç, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–æ).
  - –°—á–∏—Ç–∞–µ—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏ –ø–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–º—É—Å—è `seq`.

- [x] –í–µ—Å—Ç–∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ per-host:
  - `TcpRetransmissionTracker.GetRetransmissionCountForIp(IPAddress ip)` —Å—É–º–º–∏—Ä—É–µ—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏ –ø–æ –≤—Å–µ–º –ø–æ—Ç–æ–∫–∞–º —Å —ç—Ç–∏–º IP.

- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–æ—Ä–æ–º –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º:
  - `InMemoryBlockageStateStore` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `TcpRetransmissionTracker` –∏ –≤–∫–ª—é—á–∞–µ—Ç `RetransmissionCount` –≤ `BlockageSignals`.
  - `DiagnosticOrchestrator` —Å–æ–∑–¥–∞—ë—Ç `TcpRetransmissionTracker`, –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –µ–≥–æ –Ω–∞ `NetworkMonitorService` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ `LiveTestingPipeline` —á–µ—Ä–µ–∑ `InMemoryBlockageStateStore`.
  - `StandardBlockageClassifier` –¥–æ–±–∞–≤–ª—è–µ—Ç `—Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π: N` –≤ —Ç–µ–∫—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ –ø—Ä–∏ `HasSignificantRetransmissions` + –ø—É—Å—Ç–æ–º `BlockageType` –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –º—è–≥–∫–∏–π —Ç–∏–ø `TCP_RETRY_HEAVY`.
  - `LiveTestingPipeline.UiWorker` –≤ live-—Å—Ç—Ä–æ–∫–µ (`‚ùå host | ‚Ä¶ | BlockageType (‚Ä¶)`) –ø–æ–¥–º–µ—à–∏–≤–∞–µ—Ç —Ö–≤–æ—Å—Ç –∏–∑ `HostBlocked.RecommendedAction`, —Ç–∞–∫ —á—Ç–æ –≤ UI –≤–∏–¥–Ω–æ `—Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π: N` (–∏ –¥—Ä—É–≥–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã).

**–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ –ø–æ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è–º:**

- [ ] –£—Ç–æ—á–Ω–∏—Ç—å —ç–≤—Ä–∏—Å—Ç–∏–∫—É `HasSignificantRetransmissions` (–ø–æ—Ä–æ–≥–∏, —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –ø–æ –æ–∫–Ω—É, –≤–æ–∑–º–æ–∂–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–∞–∫–µ—Ç–æ–≤).
- [ ] –°–≤—è–∑–∞—Ç—å —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Ñ–µ–π–ª–æ–≤ (`TCP_TIMEOUT`, `TCP_RST`) –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å–∏–ª–µ–Ω–∏–µ DPI-–ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è –ø—Ä–∏ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –≤—ã—Å–æ–∫–æ–≥–æ —á–∏—Å–ª–∞ —Ä–µ—Ç—Ä–∞–Ω—Å–æ–≤).

**–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –≤—Ç–æ—Ä–∂–µ–Ω–∏–π:**
- –ù–µ –º–µ–Ω—è–µ–º `StandardHostTester`.
- –ù–µ –ª–æ–º–∞–µ–º `ConnectionMonitorService`.
- –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –∫ `NetworkMonitorService` –∏ –º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é.

### 3.3. HTTP redirect detection

**–°—Ç–∞—Ç—É—Å:** –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä –∏ –ø—Ä–æ—Ç—è–∂–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –≤ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä **—Å–¥–µ–ª–∞–Ω—ã**, —Å–∏–≥–Ω–∞–ª —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–µ –∏ –≤–∏–¥–µ–Ω –≤ live-–ª–æ–≥–µ UI.

- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `HttpRedirectDetector` (`Core/Modules/HttpRedirectDetector.cs`):
  - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `NetworkMonitorService.OnPacketReceived` —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `Attach`.
  - –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ TCP-–æ—Ç–≤–µ—Ç–∞—Ö —Å –ø–æ—Ä—Ç–∞ 80 (—Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç).
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ TCP-–ø–æ—Ç–æ–∫–∞ (–ø–æ `TcpFlowKey`) –∞–∫–∫—É–º—É–ª–∏—Ä—É–µ—Ç –¥–æ 2 –ö–ë –ø–µ—Ä–≤—ã—Ö –±–∞–π—Ç –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.
  - –ì—Ä—É–±—ã–º ASCII-–ø–∞—Ä—Å–µ—Ä–æ–º –∏—â–µ—Ç HTTP-–æ—Ç–≤–µ—Ç—ã `HTTP/1.x 3xx` –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Location`.
  - –ß–µ—Ä–µ–∑ `Uri.TryCreate` –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π `Host` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç per-IP (`ConcurrentDictionary<IPAddress, RedirectInfo>`).

- [x] –•—Ä–∞–Ω–∏—Ç—å per-host —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–µ —Å–∏–≥–Ω–∞–ª–æ–≤:
  - `InMemoryBlockageStateStore` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `HttpRedirectDetector`.
  - –í `GetSignals` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ IP –∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `TryGetRedirectHost`.
  - –í `BlockageSignals` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `HasHttpRedirectDpi` –∏ `RedirectToHost`.

- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–º:
  - `DiagnosticOrchestrator` —Å–æ–∑–¥–∞—ë—Ç `HttpRedirectDetector`, –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –µ–≥–æ –Ω–∞ `NetworkMonitorService` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ `LiveTestingPipeline` —á–µ—Ä–µ–∑ `InMemoryBlockageStateStore`.
  - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–∞–π–ø–ª–∞–π–Ω–∞ –Ω–µ –º–µ–Ω—è–ª–∏—Å—å, —Å–∏–≥–Ω–∞–ª –∏–¥—ë—Ç —á–µ—Ä–µ–∑ —É–∂–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Å–ª–æ–π `BlockageSignals`.
  - `StandardBlockageClassifier` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `HasHttpRedirectDpi/RedirectToHost` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º—è–≥–∫–æ–≥–æ `BlockageType = "HTTP_REDIRECT_DPI"` (–µ—Å–ª–∏ —Ç–∏–ø –µ—â—ë –Ω–µ –∑–∞–¥–∞–Ω) –∏ –¥–æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–µ–∫—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ¬´HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ {RedirectToHost}¬ª. `UiWorker` –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ö–≤–æ—Å—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ –≤ live-—Å—Ç—Ä–æ–∫–µ.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**

- [x] –í `DnsParserService` (`Utils/DnsSnifferService.cs`) —Ñ–æ–Ω–æ–≤–æ–π —Ü–∏–∫–ª —Ç–∞–π–º–∞—É—Ç–æ–≤ (`CleanupPendingRequestsLoop`) –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ `CancellationToken`, `Dispose` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≥–∞—Å–∏—Ç —Ç–∞—Å–∫; –≤–∞—Ä–Ω–∏–Ω–≥–∏ CS0162 –ø–æ —ç—Ç–æ–º—É —Ñ–∞–π–ª—É —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø–æ DNS-—Å–Ω–∏—Ñ—Ñ–µ—Ä—É.

- [x] –õ–æ–≥–∏–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ (—Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏):
  - –ò–º–µ—è –∏—Å—Ö–æ–¥–Ω—ã–π hostname (–∏–∑ DNS/TrafficCollector/TestResult) –∏ `RedirectToHost` –∏–∑ `BlockageSignals`:
    - –í—ã–¥–µ–ª—è—Ç—å SLD (second-level domain) –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏ —Ü–µ–ª–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω–æ–≤.
    - –ï—Å–ª–∏ SLD —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `youtube.com` ‚Üí `provider-portal.ru`), –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–ª–∞–≥ `IsDpiRedirect = true` –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.

- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∏ UI:
  - –í `StandardBlockageClassifier` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `HasHttpRedirectDpi/RedirectToHost` –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–µ —è–≤–Ω—É—é –ø–æ–º–µ—Ç–∫—É –ø—Ä–æ ¬´HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ {RedirectToHost} (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ä—Ç–∞–ª –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ / DPI)¬ª.
  - –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –≤–≤–µ—Å—Ç–∏ –º—è–≥–∫–∏–π `BlockageType`, –Ω–∞–ø—Ä–∏–º–µ—Ä `HTTP_REDIRECT_DPI`, –Ω–µ –ª–æ–º–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã.
  - –í UI/–ª–æ–≥–∞—Ö —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É/–±–µ–π–¥–∂ –¥–ª—è HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç–∞, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –≤–∏–¥–µ–ª, —á—Ç–æ —Ç—Ä–∞—Ñ–∏–∫ —É–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π –¥–æ–º–µ–Ω.

### 3.4. RST packet inspection

**–ò–¥–µ—è:** —Ä—è–¥–æ–º —Å RST Blocker (–∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –µ—Å—Ç—å –≤ `WinDivertBypassManager`) –∏–ª–∏ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π `NetworkMonitorService`-–ø–æ–¥–ø–∏—Å—á–∏–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å RST-–ø–∞–∫–µ—Ç—ã –∏ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.

- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `RstInspectionService`:
  - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `NetworkMonitorService.OnPacketReceived` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä WinDivert (`tcp.Rst == 1`).
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ RST-–ø–∞–∫–µ—Ç–∞:
    - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç `(srcIp, dstIp, srcPort, dstPort)`.
    - –ò–∑–≤–ª–µ–∫–∞–µ—Ç TTL –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è.
  - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç TTL RST —Å TTL –æ–±—ã—á–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∂–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ per-flow/per-host).

- [x] –≠–≤—Ä–∏—Å—Ç–∏–∫–∞:
  - –ï—Å–ª–∏ TTL RST –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–∏–ø–∏—á–Ω–æ–≥–æ TTL —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞,
  - –∏ —Ç–∞–∫–∏–µ RST –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–∞—Ö TLS/HTTP –∫ –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ —Ö–æ—Å—Ç—É,
  - –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–ª–∞–≥ `SuspiciousRst` / `HasDpiRst`.

- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
  - –ö–∞–∫ –∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—É–Ω–∫—Ç–∞—Ö, —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ per-host –∏ –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GetRstSuspicionScore(HostKey)`).
  - `StandardBlockageClassifier` –ª–∏–±–æ –Ω–æ–≤—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –±—É–¥–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª –ø—Ä–∏ –≤—ã–±–æ—Ä–µ `BlockageType` –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

---

## 4. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏

- **–ù–µ –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Å—Ç—Ä–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
  - `IHostTester`, `IBlockageClassifier` –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∏—Ö –º–µ—Ç–æ–¥–æ–≤ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–∂–Ω–∏–º–∏.
  - –ù–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ –¥–æ–ø. —Å–µ—Ä–≤–∏—Å—ã/—Å—Ç–æ—Ä—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ DI –∏–ª–∏ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞–º, –∞ –Ω–µ —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `HostTested` —Å—Ä–∞–∑—É –Ω–∞ –ø–µ—Ä–≤–æ–º —à–∞–≥–µ.

- **–î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –∫–∞–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å–µ—Ä–≤–∏—Å–∞–º**:
  - `NetworkMonitorService` —É–∂–µ –¥–∞—ë—Ç –ø–æ—Ç–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–¥ –Ω–∏–º `TcpRetransmissionTracker`, `HttpRedirectDetector`, `RstInspectionService`.
  - `ConnectionMonitorService` –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–æ–Ω –¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏—è connect, –Ω–æ –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π DPI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏).

- **–ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π:**
  - –í–≤–µ—Å—Ç–∏ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `BlockageSignalAggregator`/`IBlockageStateStore`, –∫–æ—Ç–æ—Ä—ã–π:
    - —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã (–∏–∑ —Ç–µ—Å—Ç–æ–≤ –∏ —Å–Ω–∏—Ñ—Ñ–µ—Ä–æ–≤),
    - —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ per-host –≤–æ –≤—Ä–µ–º–µ–Ω–∏,
    - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è `StandardBlockageClassifier` –∏ `StrategyMapping`.

- **–ü–æ—à–∞–≥–æ–≤–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ:**
  1. –°–Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Fail counter + time window` (–Ω–∞ –±–∞–∑–µ —Ç–æ–ª—å–∫–æ `HostTested`), —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –≤ WinDivert.
  2. –ó–∞—Ç–µ–º –¥–æ–±–∞–≤–∏—Ç—å `TcpRetransmissionTracker` (–ø–æ–¥–ø–∏—Å—á–∏–∫ –∫ `NetworkMonitorService`).
  3. –ü–æ—Ç–æ–º `HttpRedirectDetector`.
  4. –ò –≤ –∫–æ–Ω—Ü–µ ‚Äî `RstInspectionService`.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –∏–º–µ—Ç—å —Ä–∞–±–æ—á–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ—ç—Ç–∞–ø–Ω–æ —É–ª—É—á—à–∞—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é –±–µ–∑ –±–æ–ª—å—à–∏—Ö –ª–æ–º–æ–∫ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

---

## 5. –†–∏—Å–∫–∏ —Ä–∞–∑–¥—É–≤–∞–Ω–∏—è (god objects) –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

### 5.1. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ —Ä–∞–∑–¥—É–≤–∞–Ω–∏—è

- `StandardHostTester`:
  - –£–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–º–∞–ª–æ –ª–æ–≥–∏–∫–∏ (reverse DNS, TCP connect, TLS handshake).
  - –†–∏—Å–∫: –µ—Å–ª–∏ —Å—é–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã, –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–æ–≤, —Å—á—ë—Ç—á–∏–∫–∏, –æ–∫–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏, –∞–Ω–∞–ª–∏–∑ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π –∏ —Ç.–ø., –∫–ª–∞—Å—Å –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤ "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä" –≤–º–µ—Å—Ç–æ —É–∑–∫–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–µ—Ä–∞.
  - –†–µ—à–µ–Ω–∏–µ: –¥–µ—Ä–∂–∞—Ç—å –µ–≥–æ –∑–æ–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –∑–∞ **–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** (DNS/TCP/TLS) –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å DPI-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏.

- `StandardBlockageClassifier`:
  - –°–µ–π—á–∞—Å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π: –Ω–µ—Å–∫–æ–ª—å–∫–æ `if` –ø–æ `BlockageType` + –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —á–µ—Ä–µ–∑ `StrategyMapping`.
  - –†–∏—Å–∫: –ø—Ä–∏ –Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞—Ö–æ—Ç–µ—Ç—å –¥–æ–±–∞–≤–∏—Ç—å —Å—é–¥–∞:
    - fail-counter,
    - —É—á—ë—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π,
    - HTTP redirect DPI,
    - RST-–∏–Ω—Å–ø–µ–∫—Ü–∏—é,
    - —Ä–∞—Å—á—ë—Ç `DpiSuspicionScore` –∏ –¥—Ä.
  - –í —Ç–∞–∫–æ–º –≤–∏–¥–µ –æ–Ω —Å—Ç–∞–Ω–µ—Ç god object-–æ–º –ø–æ —á–∞—Å—Ç–∏ "–¥–µ—Ç–µ–∫—Ü–∏—è + –∞–≥—Ä–µ–≥–∞—Ü–∏—è + —Å—Ç—Ä–∞—Ç–µ–≥–∏—è".
  - –†–µ—à–µ–Ω–∏–µ: –≤—ã–Ω–µ—Å—Ç–∏ —Å–±–æ—Ä –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å (`BlockageSignalAggregator` / `IBlockageSignalsProvider`), –∞ `StandardBlockageClassifier` –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–Ω–∫–∏–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º —ç—Ç–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.

- `ConnectionMonitorService` –∏ `NetworkMonitorService`:
  - –°–µ–π—á–∞—Å –æ—Ç–≤–µ—á–∞—é—Ç —Ç–æ–ª—å–∫–æ –∑–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (Socket —Å–æ–±—ã—Ç–∏—è –∏ stream –ø–∞–∫–µ—Ç–æ–≤).
  - –†–∏—Å–∫: –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä—å –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–∞–∑–±–æ—Ä TCP/HTTP, –ø–æ–¥—Å—á—ë—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–π, DPI-—ç–≤—Ä–∏—Å—Ç–∏–∫–∏ ‚Äî –æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏.
  - –†–µ—à–µ–Ω–∏–µ: –æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö **—á–∏—Å—Ç—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ —Å–æ–±—ã—Ç–∏–π**, –∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∫–∞–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (`TcpRetransmissionTracker`, `HttpRedirectDetector`, `RstInspectionService`).

- `LiveTestingPipeline`:
  - –£–∂–µ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –æ—á–µ—Ä–µ–¥–∏ –∏ –º–æ–¥—É–ª–∏ (`Tester`, `Classifier`, —Ñ–∏–ª—å—Ç—Ä—ã, UI).
  - –†–∏—Å–∫: –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ —Ü–µ–Ω—Ç—Ä –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ (state-store, –∞–Ω–∞–ª–∏–∑ –ø–∞–∫–µ—Ç–æ–≤, DPI-—ç–≤—Ä–∏—Å—Ç–∏–∫–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ bypass –∏ —Ç.–ø.).
  - –†–µ—à–µ–Ω–∏–µ: pipeline –¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ **–æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å** –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã, –Ω–µ —Ö—Ä–∞–Ω—è –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–∂–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏.

### 5.2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –ø–æ —Å–ª–æ—è–º

- –°–ª–æ–π "—Å—ã—Ä—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤" (–ø–æ–¥–ø–∏—Å—á–∏–∫–∏):
  - `TcpRetransmissionTracker` ‚Äî —Å—á–∏—Ç–∞–µ—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏ –ø–æ TCP.
  - `HttpRedirectDetector` ‚Äî –ø–∞—Ä—Å–∏—Ç HTTP-–æ—Ç–≤–µ—Ç—ã –∏ –∏—â–µ—Ç DPI-—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã.
  - `RstInspectionService` ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç RST-–ø–∞–∫–µ—Ç—ã (TTL, –ø–∞—Ç—Ç–µ—Ä–Ω—ã).
  - `FailCounterStore` / `BlockageStateStore` ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é `HostTested` –∏ —Å—á–∏—Ç–∞–µ—Ç N —Ñ–µ–π–ª–æ–≤ –∑–∞ –æ–∫–Ω–æ.

- –°–ª–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:
  - `BlockageSignalAggregator` / `IBlockageSignalsProvider` —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π DTO `BlockageSignals` (`HasTcpRetransmissions`, `HasHttpRedirectDpi`, `HasSuspiciousRst`, `FailCount`, `WindowSeconds`, `DpiSuspicionScore` –∏ —Ç.–¥.).
  - `StandardBlockageClassifier` –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ `HostTested` + `BlockageSignals` –∏ —Ä–µ—à–∞–µ—Ç `BlockageType`/severity, –Ω–µ –∑–Ω–∞—è –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤.

- –°–ª–æ–π —Ä–µ—à–µ–Ω–∏—è (—Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—Ö–æ–¥–∞):
  - `StrategyMapping` –∏ `BypassCoordinator` —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å —É–∂–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (`HostTested`, `HostBlocked`, `BlockageSignals`), –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º —Å–µ—Ä–≤–∏—Å–∞–º (`NetworkMonitorService`, `TcpRetransmissionTracker` –∏ –¥—Ä.).

### 5.3. –ü—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç —è–≤–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–µ

- –ù–µ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏ (—Ç–µ—Å—Ç–µ—Ä —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç, –º–æ–Ω–∏—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç).
- –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∞–Ω–∞–ª–∏–∑ TCP/HTTP/TTL –∏ —Å–ª–æ–∂–Ω—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `StandardHostTester`, `StandardBlockageClassifier`, `ConnectionMonitorService` –∏–ª–∏ `LiveTestingPipeline`.
- –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ—Ñ–æ—Ä–º–ª—è—Ç—å:
  - –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º,
  - —Å —É–∑–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º,
  - –ø–æ–¥–∫–ª—é—á–∞—è –µ–≥–æ —á–µ—Ä–µ–∑ DI/–ø–æ–¥–ø–∏—Å–∫—É, –∞ –Ω–µ —á–µ—Ä–µ–∑ –∂—ë—Å—Ç–∫–∏–µ –∑–∞–≤–∏—Å–∏–º—ã–µ –≤—ã–∑–æ–≤—ã –∏–∑ —Ü–µ–Ω—Ç—Ä–∞.

---

## 6. –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (Next Steps)

### 6.1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ UI
- [x] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (`TCP_RST_INJECTION`, `HTTP_REDIRECT_DPI`) –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ª–æ–≥–∞ –≤ –∫—Ä–∞—Å–∏–≤—ã–µ –±–µ–π–¥–∂–∏/–∏–∫–æ–Ω–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö `TestCard.xaml`.
- [x] –î–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫/–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–∑–¥–æ—Ä–æ–≤—å—è" —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (fail rate –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É).

### 6.2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UDP/QUIC
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `UdpInspectionService` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ UDP (DTLS handshake drops), –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Star Citizen.
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É QUIC (–∞–Ω–∞–ª–∏–∑ Initial –ø–∞–∫–µ—Ç–æ–≤).

### 6.3. –ê–≤—Ç–æ-—Ç—é–Ω–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- [ ] –ï—Å–ª–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω `TCP_RST_INJECTION`, –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é "–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º" —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–∫–ª—é—á–µ–Ω–∏–µ–º `DROP_RST`.
- [ ] –ï—Å–ª–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω `HTTP_REDIRECT_DPI`, –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å `FAKE_REQUEST` –∏–ª–∏ `TTL_TRICK`.

### 6.4. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- [x] –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Ñ–ª–∞–≥–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ RST, Redirect, Packet Loss, UDP) –≤ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã–π JSON-–æ—Ç—á–µ—Ç –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–∞–Ω–∞–ª–∏–∑–∞.

### 6.5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º (Bug Fixes)
- [x] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è `0.0.0.0` –≤ `TrafficCollector` (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –±–∏–Ω–¥–∏–Ω–≥-—Å–æ–∫–µ—Ç–æ–≤).
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ UI: –ø–∞—Ä—Å–∏–Ω–≥ "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:" –≤ `TestResultsManager` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–∞ "–°—Ç—Ä–∞—Ç–µ–≥–∏—è".
- [x] (Low Priority) –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è `www.` —Ö–æ—Å—Ç–æ–≤ (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ `youtube.com` –∏ `www.youtube.com`).
- [x] (Investigation) Facebook "OK" –Ω–æ –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è: –≤–µ—Ä–æ—è—Ç–Ω–æ QUIC –∏–ª–∏ HTTP-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø. 6.2).

–§–∏–∫—Å–∞—Ü–∏—è —ç—Ç–∏—Ö —Ä–∏—Å–∫–æ–≤ –≤ –ø–ª–∞–Ω–∞—Ö –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é —á–∏—Å—Ç–æ—Ç—É –ø—Ä–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤ DPI.