# –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞: –£–ª—É—á—à–µ–Ω–∏–µ UX –¥–ª—è Exe-—Å—Ü–µ–Ω–∞—Ä–∏—è

## –°—Ç–∞—Ç—É—Å
‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ** - –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Stage1 –¥–ª—è Exe-—Å—Ü–µ–Ω–∞—Ä–∏—è

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### üéØ UX —É–ª—É—á—à–µ–Ω–∏–µ (20.11.2025)
‚úÖ –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–ª—è Exe-—Å—Ü–µ–Ω–∞—Ä–∏—è:
  - –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" —Ç–µ–ø–µ—Ä—å **—Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç Stage1** (–∞–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞)
  - –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑" —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
  - Workflow —É–ø—Ä–æ—â—ë–Ω: –≤—ã–±—Ä–∞–ª exe ‚Üí –Ω–∞–∂–∞–ª "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" ‚Üí Stage1‚Üí2‚Üí3 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã UI —Ç–µ—Å—Ç—ã (ISP_Audit.UITests):
  - Test01-05: –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞–∂–∞—Ç–∏–µ AnalyzeButton –Ω–∞ StartButton
  - –¢–µ—Å—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –Ω–æ–≤—ã–π workflow
  - RunSimplifiedFlow() –æ–±–Ω–æ–≤–ª—ë–Ω

### üìã –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç ISP_Audit.UITests —Å FlaUI 5.0.0 + xUnit 2.9.2
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 5 —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ docs/e2e_test_checklist.md:
  - Test01_FullFlow_Stage1To3_Automatic - –ø–æ–ª–Ω—ã–π workflow Stage1‚Üí2‚Üí3
  - Test02_ResetButton_ClearsState - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ Reset
  - Test03_ButtonBlocking_DuringOperation - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫
  - Test04_ProfileScenario_NotAffected - –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å Profile scenario
  - Test05_ZeroConnections_ShowsWarning - edge case —Å notepad.exe

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 47+ AutomationId –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤–æ –≤—Å–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã MainWindow.xaml
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω ExePathTextBox (—É–±—Ä–∞–Ω IsEnabled="False", –¥–æ–±–∞–≤–ª–µ–Ω TwoWay binding)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ 10-—Å–µ–∫—É–Ω–¥–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è UAC –∫–Ω–æ–ø–∫–∏
‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç Stage1 —Å 35 –¥–æ 70 —Å–µ–∫—É–Ω–¥ (–∑–∞—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ ~60 —Å–µ–∫)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**ViewModels/MainViewModel.cs**:
```csharp
StartCommand = new RelayCommand(async _ => 
{
    if (IsExeScenario)
    {
        // –î–ª—è Exe-—Å—Ü–µ–Ω–∞—Ä–∏—è —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º Stage1
        await RunStage1AnalyzeTrafficAsync();
    }
    else
    {
        // –î–ª—è Profile/Host - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow
        await RunAuditAsync();
    }
});

// –ö–Ω–æ–ø–∫–∞ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑" –∞–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ Stage1 –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω
AnalyzeTrafficCommand = new RelayCommand(
    async _ => await RunStage1AnalyzeTrafficAsync(), 
    _ => !string.IsNullOrEmpty(ExePath) && !IsRunning && !Stage1Complete
);
```

### Workflow –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π
1. –í—ã–±—Ä–∞—Ç—å "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å –∫ exe
2. –ù–∞–∂–∞—Ç—å "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" ‚Üí **–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è UI —Å 3 —ç—Ç–∞–ø–∞–º–∏**
3. –ù–∞–∂–∞—Ç—å "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑" ‚Üí Stage1 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è ‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ!**

### Workflow –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
1. –í—ã–±—Ä–∞—Ç—å "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å –∫ exe
2. –ù–∞–∂–∞—Ç—å "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" ‚Üí **Stage1 –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É** ‚úÖ
3. Stage1‚Üí2‚Üí3 –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

‚ö†Ô∏è **–¢—Ä–µ–±—É—é—Ç—Å—è admin –ø—Ä–∞–≤–∞** (WinDivert kernel driver)

### –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```powershell
# PowerShell –æ—Ç –∞–¥–º–∏–Ω–∞
dotnet test ISP_Audit.UITests/ISP_Audit.UITests.csproj --filter "FullyQualifiedName~Test01" -v normal
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```powershell
dotnet test ISP_Audit.UITests/ISP_Audit.UITests.csproj -v normal
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ ~~–£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" –¥–ª—è Exe-scenario ‚Üí –∞–≤—Ç–æ-—Å—Ç–∞—Ä—Ç~~ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ**: —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Stage1

2. ‚ùå **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ**: –ó–∞–º–µ–Ω–∏—Ç—å ProgressBar –Ω–∞ Spinner (–∫–∞–∫ –≤ Profile scenario) ‚Üí –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ UI
   - –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç.–∫. ProgressBar –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞—Ö–≤–∞—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞

3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ 5 —Ç–µ—Å—Ç–æ–≤ —Å admin –ø—Ä–∞–≤–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. ‚ö†Ô∏è **Admin –ø—Ä–∞–≤–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** - –±–µ–∑ –Ω–∏—Ö —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å–∞—é—Ç –Ω–∞ UAC modal
2. ‚ö†Ô∏è **TestNetworkApp.exe** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω:
   ```powershell
   dotnet build TestNetworkApp/TestNetworkApp.csproj -c Release
   ```
3. ‚ö†Ô∏è **ISP_Audit.exe** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω –≤ Release:
   ```powershell
   dotnet build -c Release
   ```

## –ö–æ–º–º–∏—Ç—ã
- `[PENDING]` - Remove duplicate "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑" button: auto-start Stage1 on "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É"
- `efce19b` - Add 47+ AutomationId attributes for UI testing
- `8be73a3` - Fix UI tests: use AutomationId and enable ExePathTextBox
- `64125cd` - Fix UI tests: add 10s delay for UAC and increase Stage1 timeout to 70s

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —á–∞—Ç–∞

–ü—Ä–æ–µ–∫—Ç ISP_Audit - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–µ—Ç–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º (DNS filtering, DPI, TCP RST injection).

**Tech stack**: .NET 9, WPF, MaterialDesignInXaml 5.1.0, WinDivert 2.2.0

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π**: Exe-scenario (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) - 3 —ç—Ç–∞–ø–∞:
- Stage1: –ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (WinDivert packet capture, ~60 —Å–µ–∫)
- Stage2: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º (DNS/TCP/HTTP —Ç–µ—Å—Ç—ã, ~30 —Å–µ–∫)
- Stage3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (bypass rules, ~20 —Å–µ–∫)

**–ö—Ä–∏—Ç–∏—á–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: WinDivert —Ç—Ä–µ–±—É–µ—Ç kernel-level –¥–æ—Å—Ç—É–ø (admin –ø—Ä–∞–≤–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ driver).

**–¶–µ–ª—å**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —É—á–∞—Å—Ç–∏—è.

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ**: –£–ø—Ä–æ—â—ë–Ω UX –¥–ª—è Exe-—Å—Ü–µ–Ω–∞—Ä–∏—è - –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É" —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç Stage1.
