# Runtime Incident Checklist

Цель: единый шаблон разбора зависаний/крашей с минимально достаточным контекстом для targeted fix.

---

## 1) Карточка инцидента

- IncidentId:
- Дата/время (UTC):
- Источник: (`GUI` / `smoke infra` / `smoke strict` / `prod run`)
- Версия/коммит:
- Автор разбора:

## 2) Симптом

- Тип: (`hang` / `crash` / `timeout` / `flaky fail`)
- Наблюдаемое поведение (1–3 строки):
- Воспроизводимость: (`stable` / `intermittent` / `once`)
- Impact: (`локальный` / `pipeline` / `strict gate` / `prod risk`)

## 3) Сбор контекста (обязательно ±100 строк)

### 3.1 Логовый фрагмент

- Файл лога:
- Точка якоря (сообщение/тест/exception):
- Диапазон строк: `L(anchor-100) … L(anchor+100)`
- Ключевые строки (до 10):

### 3.2 Дополнительные артефакты (по необходимости)

- `artifacts/*.json` (smoke отчёт)
- `state/apply_transactions.json`
- `state/crash_reports/*`
- связанный `runId/scopeKey/planSig` (если есть)

## 4) Классификация фазы

Выбрать одну основную фазу:

- `STARTUP`
- `DIAGNOSTIC_RUN`
- `APPLY`
- `POST_APPLY_RETEST`
- `PIPELINE_QUEUE`
- `SHUTDOWN`
- `UNKNOWN`

Указать подфазу (например: `POST_APPLY_LOCAL_RETEST_FLUSH`).

## 5) Гипотеза первопричины

- Механизм сбоя (конкретно):
- Почему проявляется именно в этой фазе:
- Почему это не ложный сигнал/шум:

## 6) Targeted timeout fix (если применимо)

- Целевой узел таймаута/ожидания:
- Текущие параметры (до):
- Изменение (после):
- Почему изменение минимальное и безопасное:
- Условие отката:

## 7) Решение

- Изменённые файлы:
- Что изменено по сути:
- Почему это root-cause fix, а не симптом:

## 8) Валидация

- `dotnet build`
- `dotnet test` (если есть тесты)
- `smoke infra (non-admin)`
- `smoke strict (SmokeLauncher)`
- Регрессии рядом с местом фикса (перечень):

## 9) Итог

- Статус: (`resolved` / `mitigated` / `open`)
- Риск остатка:
- Follow-up задачи (если есть):

---

## Критерии качества разбора

- Есть `±100` строк вокруг якоря.
- Фаза и подфаза выбраны однозначно.
- Изменение ограничено конкретным узлом (без широкого рефакторинга).
- Валидация покрывает как минимум build/test/smoke.
