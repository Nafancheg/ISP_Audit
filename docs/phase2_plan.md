# DPI Intelligence v2 โ ะะปะฐะฝ ะฒะฝะตะดัะตะฝะธั

**ะะฐัะฐ:** 16.12.2025  
**ะกัะฐััั:** MVP ัะตะฐะปะธะทะพะฒะฐะฝ ะฒ ะบะพะดะต (v2 ะบะพะฝััั ะฟะพะดะบะปัััะฝ), ะดะฐะปัะฝะตะนัะธะต ัะปัััะตะฝะธั โ ะฒ ัะฐะทะดะตะปะต ยซะงัะพ ะดะฐะปััะตยป  
**ะฆะตะปั:** ะะฐะผะตะฝะธัั ัะฐะพัะธัะฝัะต ัะฒัะธััะธะบะธ ะฝะฐ ัะบัะฟะตััะฝัั ัะธััะตะผั ั ะพะฑัััะฝะธะผัะผะธ ัะตัะตะฝะธัะผะธ (Signals โ Diagnosis โ Strategy โ Executor)

ะัะธะผะตัะฐะฝะธะต: ััะพั ะดะพะบัะผะตะฝั ะฑัะป ะฝะฐัะฐะปัะฝะพ ะฝะฐะฟะธัะฐะฝ ะบะฐะบ design-ัะตัะฝะพะฒะธะบ. ะกะตะนัะฐั ะพะฝ ะฐะบััะฐะปะธะทะธัะพะฒะฐะฝ ะฟะพะด ัะฐะบัะธัะตัะบัั ัะตะฐะปะธะทะฐัะธั ะฒ ัะตะฟะพะทะธัะพัะธะธ (ัะผ. ะฟััะธ `Core/IntelligenceV2/*`).

---

## ๐ฏ ะัะพะฑะปะตะผะฐ

ะกะตะนัะฐั ะฑะฐะนะฟะฐั ัะฐะฑะพัะฐะตั ะฒัะปะตะฟัั:
- `TlsBypassService` ะฟัะพะฑัะตั ัะตัะฝะธะบะธ ะธ ัะผะพััะธั ะฝะฐ ะผะตััะธะบะธ RST
- Legacy-ะดะธะฐะณะฝะพััะธะบะฐ (`StandardBlockageClassifier`) ะทะฝะฐะตั ะงะขะ ัะปะพะผะฐะฝะพ, ะฝะพ ะฝะต ะฒะปะธัะตั ะฝะฐ ะฒัะฑะพั ัััะฐัะตะณะธะธ
- ะะฒะฐ ะผะธัะฐ ะธะทะพะปะธัะพะฒะฐะฝั โ ะฝะตัััะตะบัะธะฒะฝัะน ะฟะพะดะฑะพั ัััะฐัะตะณะธะน

**ะะตัะตะฝะธะต:** ะกะพะทะดะฐัั intelligence layer ะผะตะถะดั ะดะธะฐะณะฝะพััะธะบะพะน ะธ ะพะฑัะพะดะพะผ.

---

## ๐ ะััะธัะตะบัััะฐ (ะบะพะฝััะฐะบั)

### ะกะปะพะธ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Sensors (ัะตะบััะธะต ัะตัะฒะธัั)                   โ
โ - RstInspectionService                      โ
โ - TcpRetransmissionTracker                  โ
โ - (ะพะฟัะธะพะฝะฐะปัะฝะพ) StandardBlockageClassifier  โ
โ   *ัะพะปัะบะพ legacy-ะฒัะฒะพะด ะดะปั UI, ะฝะต source-of-truth ะดะปั Signals*โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Signals Adapter (ัะตะฐะปะธะทะพะฒะฐะฝะพ)               โ
โ ะกะพะฑะธัะฐะตั ัะฐะบัั โ BlockageSignalsV2          โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Diagnosis Engine (ัะตะฐะปะธะทะพะฒะฐะฝะพ)              โ
โ ะะฝัะตัะฟัะตัะธััะตั ัะธะณะฝะฐะปั โ DiagnosisResult    โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Strategy Selector (ัะตะฐะปะธะทะพะฒะฐะฝะพ)             โ
โ ะัะฑะธัะฐะตั ัะตัะฝะธะบะธ โ BypassPlan               โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Executor (MVP, ัะตะฐะปะธะทะพะฒะฐะฝะพ)                 โ
โ ะคะพัะผะฐัะธััะตั/ะปะพะณะธััะตั ะฟะปะฐะฝ, ะฐะฒัะพ-ะฟัะธะผะตะฝะตะฝะธั ะฝะตั โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Feedback Store (ะฟะปะฐะฝะธััะตััั)                โ
โ ะะฐะฟะพะผะธะฝะฐะตั ัะตะทัะปััะฐัั, ัะฐะฝะถะธััะตั ัััะฐัะตะณะธะธ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะขะตะบััะธะต ัะตะฐะปะธะทะฐัะธะธ ะฒ ัะตะฟะพะทะธัะพัะธะธ:
- `Core/IntelligenceV2/Signals/SignalsAdapterV2.cs` (+ `InMemorySignalSequenceStore.cs`)
- `Core/IntelligenceV2/Diagnosis/StandardDiagnosisEngineV2.cs`
- `Core/IntelligenceV2/Strategies/StandardStrategySelectorV2.cs`
- `Core/IntelligenceV2/Execution/BypassExecutorMvp.cs`
- ะะฝัะตะณัะฐัะธั ะฒ ัะฐะฝัะฐะนะผ: `Utils/LiveTestingPipeline.cs` (ะบะพะฝะฒะตะนะตั) + `ViewModels/DiagnosticOrchestrator.cs` (UI-ะฐะณัะตะณะฐัะธั/ะปะพะณ)

### ะัััะบะธะต ะณัะฐะฝะธัั (ััะพ ะทะฐะฟัะตัะตะฝะพ)

โ **Diagnosis Engine** ะฝะต ะดะพะปะถะตะฝ ะทะฝะฐัั ะฟัะพ:
- ะคัะฐะณะผะตะฝัะฐัะธั, TTL, ะฟะพััะดะพะบ ัะฐะฝะบะพะฒ
- ะะพะฝะบัะตัะฝัะต ะฟะฐัะฐะผะตััั ัััะฐัะตะณะธะน

โ **Strategy Selector** ะฝะต ะดะพะปะถะตะฝ ัะผะพััะตัั ะฝะฐ:
- TTL, ัะตััะฐะฝัะผะธััะธะธ, ัะฐะนะผะธะฝะณะธ ะฟะฐะบะตัะพะฒ
- ะะฐะฟััะผัั ะฝะฐ Sensors

โ **Feedback** ะฝะต ะผะพะถะตั:
- ะะตะฝััั ะดะธะฐะณะฝะพะท ะฝะฐะฟััะผัั
- ะะตะฝััั mapping (Diagnosis โ Strategy) ะธะปะธ ัะดะฐะปััั ัััะฐัะตะณะธะธ (ัะพะปัะบะพ ะฒะตัะฐ/ัะฐะฝะถะธัะพะฒะฐะฝะธะต)

โ **Executor** ะฝะต ะดะพะปะถะตะฝ:
- ะะพะดะฑะธัะฐัั/ะพะฟัะธะผะธะทะธัะพะฒะฐัั ะฟะฐัะฐะผะตััั ัััะฐัะตะณะธะน (ะฟะฐัะฐะผะตััั ะทะฐะดะฐัั Selector)
- ะัะธะฝะธะผะฐัั ัััะฐัะตะณะธัะตัะบะธะต ัะตัะตะฝะธั โะบะฐะบัั ัะตัะฝะธะบั ะฟัะธะผะตะฝัััโ (ััะพ ะทะพะฝะฐ Selector)

โ **ะะฐะทัะตัะตะฝะพ:**
- `HostContext` (auto-hostlist) ะธัะฟะพะปัะทะพะฒะฐัั ะดะปั UI/ะปะพะณะพะฒ
- ะะพ ะะ ะดะปั ะฒััะธัะปะตะฝะธั ะดะธะฐะณะฝะพะทะฐ

---

## ๐ ะะพะดะตะปะธ ะดะฐะฝะฝัั (ะบะพะฝััะฐะบั)

### SignalEvent / SignalSequence (ะฒัะตะผะตะฝะฝัะต ัะตะฟะพัะบะธ โ ะฟะตัะฒะธัะฝัะน ะธััะพัะฝะธะบ ะฟัะฐะฒะดั)

ะะปััะตะฒะฐั ะฟะพะฟัะฐะฒะบะฐ: ะฑะปะพะบะธัะพะฒะบะฐ โ ััะพ **ัะตะฟะพัะบะฐ ัะพะฑััะธะน ะฒะพ ะฒัะตะผะตะฝะธ**, ะฐ ะฝะต ะพะดะธะฝ ัะฝะธะผะพะบ.

ะ v2 `Signals Adapter` ะพะฑัะทะฐะฝ ัะพะฑะธัะฐัั **ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ัะพะฑััะธะน** (stream), ะฐ ัะถะต ะทะฐัะตะผ (ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ) ะฐะณัะตะณะธัะพะฒะฐัั ะตั ะฒ ะฟัะพะธะทะฒะพะดะฝัะต ะฟัะธะทะฝะฐะบะธ.

```csharp
public enum SignalEventType
{
    HostTested,             // ัะฐะบั ะทะฐะฒะตััะตะฝะธั ะฐะบัะธะฒะฝะพะน ะฟัะพะฒะตัะบะธ (DNS/TCP/TLS)
    TcpRetransStats,        // ะพะฑะฝะพะฒะปะตะฝะธะต ัััััะธะบะพะฒ ัะตััะฐะฝัะผะธััะธะน/ะฟะฐะบะตัะพะฒ
    SuspiciousRstObserved,  // ะฟะพะดะพะทัะธัะตะปัะฝัะน RST (ะธะท ะธะฝัะฟะตะบัะพัะฐ)
    HttpRedirectObserved,   // DPI-ะฟะพะดะพะฑะฝัะน HTTP redirect
    UdpHandshakeUnanswered, // (ะตัะปะธ ะฝัะถะฝะพ) ะฑะตะทะพัะฒะตัะฝัะต UDP ััะบะพะฟะพะถะฐัะธั
}

public sealed class SignalEvent
{
    public required string HostKey { get; init; }  // ััะฐะฑะธะปัะฝัะน ัะตัะฝะธัะตัะบะธะน ะบะปัั (ะฝะฐะฟัะธะผะตั: IP:port:proto), ะฝะต UI-ะปะตะนะฑะป
    public required SignalEventType Type { get; init; }
    public object? Value { get; init; }
    public required DateTimeOffset ObservedAtUtc { get; init; }
    public required string Source { get; init; }   // "HostTester", "RstInspectionService", ...
    public string? Reason { get; init; }
    public IReadOnlyDictionary<string, string>? Metadata { get; init; }
}

public sealed class SignalSequence
{
    public required string HostKey { get; init; }
    public List<SignalEvent> Events { get; } = new();
    public required DateTimeOffset FirstSeenUtc { get; init; }
    public DateTimeOffset LastUpdatedUtc { get; set; }
}
```

ะัะธะผะตัะฐะฝะธะต:
- `SignalSequence` โ ััะพ ัะปะพะน **ัะฐะบัะพะฒ**. ะะธะบะฐะบะพะน ะธะฝัะตัะฟัะตัะฐัะธะธ ะธ ะฝะธะบะฐะบะธั ัััะฐัะตะณะธะน ะฒะฝัััะธ.
- ะะปั ะดะธะฐะณะฝะพััะธะบะธ ัะดะพะฑะฝะพ ะธะผะตัั ะฟัะพะธะทะฒะพะดะฝัะต ะฟัะธะทะฝะฐะบะธ (ัะผ. ะฝะธะถะต), ะฝะพ ะพะฝะธ ะดะพะปะถะฝั ะฒััะธัะปััััั **ะธะท ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ**, ะฐ ะฝะต โัะฝะธะผะบะพะผ ะฒ ะผะพะผะตะฝั T=0โ.

### BlockageSignalsV2 (ะฟัะพะธะทะฒะพะดะฝัะต ะฟัะธะทะฝะฐะบะธ ะธะท ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ)

`BlockageSignalsV2` ะพััะฐัััั ะฒ ะบะพะฝััะฐะบัะต ะบะฐะบ **ััะตะท/ะฐะณัะตะณะฐัะธั** ะฟะพ ะพะบะฝั ะฒัะตะผะตะฝะธ (ะฝะฐะฟัะธะผะตั 30โ60 ัะตะบัะฝะด, ัะผ. Step 0 / Implementation Details) ะฟะพะฒะตัั `SignalSequence`.
ะญัะพ ัะฑะธัะฐะตั ะฟัะพะฑะปะตะผั โT=0 vs T+2s vs T+5sโ: ะฐะดะฐะฟัะตั ะดะพะฟะธััะฒะฐะตั ัะพะฑััะธั, ะฐ ะฐะณัะตะณะฐัะพั ะฟะตัะตััะธััะฒะฐะตั ะฟัะธะทะฝะฐะบะธ.

```csharp
public sealed class BlockageSignalsV2 
{
    public required string HostKey { get; init; }
    public DateTimeOffset CapturedAtUtc { get; init; }
    public TimeSpan AggregationWindow { get; init; }

    // TCP ััะพะฒะตะฝั
    public bool HasTcpReset { get; init; }
    public bool HasTcpTimeout { get; init; }
    public double? RetransmissionRate { get; init; }  // 0.0-1.0 ะธะปะธ null ะตัะปะธ ะดะฐะฝะฝัั ะฝะตั
    
    // RST ะฐะฝะฐะปะธะท
    public int? RstTtlDelta { get; set; }           // null ะตัะปะธ RST ะฝะต ะฑัะปะพ
    public TimeSpan? RstLatency { get; set; }       // null ะตัะปะธ RST ะฝะต ะฑัะปะพ
    
    // DNS ััะพะฒะตะฝั
    public bool HasDnsFailure { get; init; }
    public bool HasFakeIp { get; init; }             // 198.18.x.x
    
    // HTTP ััะพะฒะตะฝั
    public bool HasHttpRedirect { get; set; }
    
    // TLS ััะพะฒะตะฝั
    public bool HasTlsTimeout { get; init; }
    public bool HasTlsAuthFailure { get; init; }
    public bool HasTlsReset { get; init; }
    
    // ะะตัะฐะดะฐะฝะฝัะต
    public int SampleSize { get; init; }

    // ะกะปัะถะตะฑะฝะพะต ะบะฐัะตััะฒะพ ะดะฐะฝะฝัั
    public bool IsUnreliable { get; init; }         // ะตัะปะธ ัะธะณะฝะฐะปั ัะปะฐะฟะฐัั/ะดะฐะฝะฝัั ะผะฐะปะพ
}
```

### DiagnosisResult (ะธะฝัะตัะฟัะตัะฐัะธั)

```csharp
public enum DiagnosisId 
{
    None,                   // ัะตัะฝะธัะตัะบะพะต ะทะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั (ะฝะฐะฟัะธะผะตั, ะดะพ ะฒัะทะพะฒะฐ Diagnose); Diagnose ะตะณะพ ะฝะต ะฒะพะทะฒัะฐัะฐะตั
    Unknown,                // ะฝะตะดะพััะฐัะพัะฝะพ ะดะฐะฝะฝัั / ะฝะต ััะฐะฑะพัะฐะปะพ ะฝะธ ะพะดะฝะพ ะฟัะฐะฒะธะปะพ
    ActiveDpiEdge,          // ะฑัััััะน RST ั TTL ะฐะฝะพะผะฐะปะธะตะน
    StatefulDpi,            // ะผะตะดะปะตะฝะฝัะน RST, stateful ะธะฝัะฟะตะบัะธั
    SilentDrop,             // timeout + ะฒััะพะบะธะต ัะตััะฐะฝัะผะธััะธะธ
    DnsHijack,              // DNS ะฟะพะดะผะตะฝะฐ
    HttpRedirect,           // HTTP ะทะฐะณะปััะบะฐ
    MultiLayerBlock,        // DNS + DPI ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
    NoBlockage              // ะปะตะณะธัะธะผะฝะฐั ะฝะตะดะพัััะฟะฝะพััั
}

public sealed class DiagnosisResult 
{
    public required DiagnosisId DiagnosisId { get; init; }
    public required int Confidence { get; init; }                  // 0-100
    public string? MatchedRuleName { get; init; }                  // ะบะฐะบะพะต ะฟัะฐะฒะธะปะพ ััะฐะฑะพัะฐะปะพ
    public IReadOnlyList<string> ExplanationNotes { get; init; }   // "TCP timeout", "retx-rate=0.30", ...
    public IReadOnlyDictionary<string, string> Evidence { get; init; }
    public required BlockageSignalsV2 InputSignals { get; init; }
    public DateTimeOffset DiagnosedAtUtc { get; init; }
}
```

### BypassPlan (ัะตัะตะฟั)

```csharp
public enum StrategyId 
{
    None,
    TlsDisorder,
    TlsFragment,
    TlsFakeTtl,
    DropRst,
    UseDoh, // TODO: ะฑัะดััะฐั ัััะฐัะตะณะธั; ะฒ MVP ะฝะต ะธัะฟะพะปัะทะพะฒะฐัั ะฒ ะผะฐะฟะฟะธะฝะณะต (ะฒ ัะตะฟะพะทะธัะพัะธะธ ะผะพะถะตั ะพััััััะฒะพะฒะฐัั ัะตะฐะปะธะทะฐัะธั)
    AggressiveFragment
}

public enum RiskLevel { Low, Medium, High }

public sealed class BypassStrategy 
{
    public required StrategyId Id { get; init; }
    public int BasePriority { get; init; }                 // ะธะท ัะฐะฑะปะธัั ะผะฐะฟะฟะธะฝะณะฐ
    public Dictionary<string, object?> Parameters { get; init; } = new();
    public RiskLevel Risk { get; init; }                   // Low/Medium/High
}

public sealed class BypassPlan 
{
    public List<BypassStrategy> Strategies { get; init; } = new();
    public DiagnosisId ForDiagnosis { get; init; }
    public int PlanConfidence { get; init; }
    public string Reasoning { get; init; } = string.Empty;
    public DateTimeOffset PlannedAtUtc { get; init; }
}
```

---

## ๐ ะะปะฐะฝ ะฒะฝะตะดัะตะฝะธั (5 ัะฐะณะพะฒ)

### ะจะฐะณ 0: ะคะธะฝะฐะปะธะทะฐัะธั ะบะพะฝััะฐะบัะฐ

**ะงัะพ:** ะะฐัะธะบัะธัะพะฒะฐัั ะผะพะดะตะปะธ ะดะฐะฝะฝัั ะธ ะธะฝัะตััะตะนัั  
**ะัะตะผั:** 2-3 ัะฐัะฐ  
**ะััะพะด:** ะญัะพั ะดะพะบัะผะตะฝั + C# ะธะฝัะตััะตะนัั

**ะัะธัะตัะธะน ะณะพัะพะฒะฝะพััะธ:**
- โ ะัะต ะผะพะดะตะปะธ ะพะฟัะตะดะตะปะตะฝั (BlockageSignalsV2, DiagnosisResult, BypassPlan)
- โ ะัะฐะฝะธัั ัะปะพัะฒ ะฟะพะฝััะฝั ะธ ะทะฐัะธะบัะธัะพะฒะฐะฝั
- โ ะะตั ะดะฒััะผััะปะตะฝะฝะพััะตะน ะฒ ะบะพะฝััะฐะบัะต

### Implementation Details (ััะพัะฝะตะฝะธั ะบะพะฝััะฐะบัะฐ)

**SignalSequence storage:**
- ะฅัะฐะฝะตะฝะธะต: ะพัะดะตะปัะฝัะน TTL-store `Core/IntelligenceV2/Signals/InMemorySignalSequenceStore.cs` (in-memory).
- ะะปัั: `HostKey` ะดะพะปะถะตะฝ ะฑััั ััะฐะฑะธะปะตะฝ ะธ ะฝะตะฟัััะพะน (ะฝะฐะฟัะธะผะตั IP ะธะปะธ IP:port:proto โ ะทะฐะฒะธัะธั ะพั ะดะพัััะฟะฝัั ะดะฐะฝะฝัั).

**ะะณัะตะณะฐัะธั ะธ ะพะบะฝะฐ:**
- ะะบะฝะพ ะฐะณัะตะณะฐัะธะธ ะฟะพ ัะผะพะปัะฐะฝะธั: **30 ัะตะบัะฝะด**.
- ะะฐััะธัะตะฝะฝะพะต ะพะบะฝะพ (ะดะปั ะฟะพัะตะฝัะธะฐะปัะฝะพ stateful/ะผะตะดะปะตะฝะฝัั ััะตะฝะฐัะธะตะฒ): **60 ัะตะบัะฝะด**.

**ะัะธััะบะฐ ัะพะฑััะธะน (ะทะฐัะธัะฐ ะพั ัะพััะฐ ะฟะฐะผััะธ):**
- TTL ัะพะฑััะธะน: **10 ะผะธะฝัั**.
- ะัะธััะบะฐ ะฒัะฟะพะปะฝัะตััั ะฟัะธ `Append(...)` (ัะดะฐะปัะตะผ ัะพะฑััะธั ััะฐััะต TTL).

**StandardBlockageClassifier:**
- ะ MVP ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัะฐัั ะฟะฐัะฐะปะปะตะปัะฝะพ (ะดะปั legacy-UI/ัะพะฒะผะตััะธะผะพััะธ).
- ะ UI v2-ะดะธะฐะณะฝะพะท ะฟัะธะพัะธัะตัะฝะตะต, legacy ัะฒะฝะพ ะผะฐัะบะธััะตััั ะบะฐะบ "legacy".
- ะะพัะปะต ััะฐะฑะธะปะธะทะฐัะธะธ v2: ะฟะปะฐะฝะธััะตััั ะฟะพะปะฝะพะต ะพัะบะปััะตะฝะธะต legacy-ะบะปะฐััะธัะธะบะฐัะพัะฐ.

**ะะตัะตะฐะปะธะทะพะฒะฐะฝะฝัะต ัััะฐัะตะณะธะธ:**
- ะ ัะตะบััะตะน ัะตะฐะปะธะทะฐัะธะธ `UseDoh` ะฟัะธัััััะฒัะตั ะบะฐะบ ัััะฐัะตะณะธั-ะบะพะฝััะฐะบั ะธ ััะฐััะฒัะตั ะฒ ะผะฐะฟะฟะธะฝะณะต (ัะผ. Step 3).
- ะัะธ ะฟะพะฟััะบะต ะฟัะธะผะตะฝะธัั ะฝะตัะตะฐะปะธะทะพะฒะฐะฝะฝัั ัััะฐัะตะณะธั: `log warning` + `skip` (ะฑะตะท ะธัะบะปััะตะฝะธะน).

**RiskLevel protection:**
- ะกััะฐัะตะณะธะธ ั ัะธัะบะพะผ `High` ะทะฐะฟัะตัะตะฝั ะฟัะธ `confidence < 70`.
- ะคะธะปัััะฐัะธั ัะตะฐะปะธะทัะตััั ะฒ ัะตะปะตะบัะพัะต ัััะฐัะตะณะธะน (`StandardStrategySelectorV2.Select(...)`).

---

### ะจะฐะณ 1: Signals Adapter

**ะงัะพ:** ะกะพะฑัะฐัั ะฒัะตะผะตะฝะฝัะต ัะพะฑััะธั ะธะท ัััะตััะฒัััะธั ัะตัะฒะธัะพะฒ, ะฟะพะดะดะตัะถะธะฒะฐัั `SignalSequence` ะธ ะปะพะณะธัะพะฒะฐัั  
**ะัะตะผั:** 1 ะดะตะฝั  
**ะะพะผะฟะพะฝะตะฝั:**
- `Core/IntelligenceV2/Signals/SignalsAdapterV2.cs`
- `Core/IntelligenceV2/Signals/InMemorySignalSequenceStore.cs`

**ะะตะฐะปะธะทะฐัะธั (ะฒ ัะตะฟะพะทะธัะพัะธะธ):**
- `SignalsAdapterV2.Observe(...)` ะฟัะธะฝะธะผะฐะตั ัะตะทัะปััะฐัั ัะตะบััะธั ะผะพะดัะปะตะน (`HostTested` + legacy `BlockageSignals`) ะธ ะฟะธัะตั ัะพะฑััะธั `SignalEvent` ะฒ TTL-store.
- TTL/ะพัะธััะบะฐ ัััะพะณะพ ะฟัะธ `Append(...)` ะฒะฝัััะธ `InMemorySignalSequenceStore` (ะฑะตะท ัะฐะนะผะตัะพะฒ).
- `SignalsAdapterV2.BuildSnapshot(...)` ัััะพะธั ะฐะณัะตะณะธัะพะฒะฐะฝะฝัะน `BlockageSignalsV2` ะฟะพ ะทะฐะดะฐะฝะฝะพะผั ะพะบะฝั (ะพะฑััะฝะพ 30/60 ัะตะบัะฝะด).
- ะััั ะทะฐัะธัะฐ ะพั ยซัะฐะทะดัะฒะฐะฝะธัยป ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ:
    - debounce ะพะดะธะฝะฐะบะพะฒัั ัะพะฑััะธะน (`SameTypeDebounce`, ัะตะนัะฐั 5 ัะตะบัะฝะด)
    - rate-limit ะปะพะณะพะฒ gate
    - cap ัะฐะทะผะตัะฐ sequence ะฝะฐ ัะพัั (in-memory store ะพะณัะฐะฝะธัะธะฒะฐะตั ัะธัะปะพ ัะพะฑััะธะน)

**ะัะธัะตัะธะน ะณะพัะพะฒะฝะพััะธ (Gate 1โ2 โ ัะตะฐะปะธััะธัะฝัะน ะธ ะฟัะพะฒะตััะตะผัะน):**

โ **ะฃัะฟะตั:**
- ะกะพะฑััะธั `SignalEvent` ะฟะธััััั ะฒ ะปะพะณ/ะฒัะฒะพะด ะฑะตะท ะธัะบะปััะตะฝะธะน (ะฝะตั ะฟะฐะดะตะฝะธะน ะฟัะธ ะพััััััะฒะธะธ ะดะฐะฝะฝัั).
- ะะปั 10 ัะฐะทะฝัั `HostKey`: ะผะธะฝะธะผัะผ 3 **ัะฐะทะฝัั ัะธะฟะฐ** ัะพะฑััะธะน ะฝะฐ ัะพัั (ะฝะต ยซััะธ ะทะฐะฟะธัะธ ะพะดะฝะพะณะพ ัะธะฟะฐยป).
- ะกะพะฑััะธั ะฟะพะบััะฒะฐัั ัะฐะทะฝัะต ัะปะพะธ: ะพะฑัะทะฐัะตะปัะฝะพ `HostTested` + ะผะธะฝะธะผัะผ 2 ัะพะฑััะธั ะธะท ะฝะฐะฑะพัะฐ `{TcpRetransStats, SuspiciousRstObserved, HttpRedirectObserved, UdpHandshakeUnanswered}`.
- `HostKey` ะฝะตะฟัััะพะน ะฒ 100% ัะพะฑััะธะน.
- `Value != null` ัะพัั ะฑั ะฒ ะพะดะฝะพะผ ัะพะฑััะธะธ ะฝะฐ ัะพัั.
- ะงะตะปะพะฒะตะบ ะผะพะถะตั ะฒะพัััะฐะฝะพะฒะธัั ัะตะฟะพัะบั ะธะท ะปะพะณะพะฒ: "HostTested โ (ะฟะพัะพะผ) SuspiciousRst/Redirect/Retx".
- ะัะตะผะตะฝะฝะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตััั: ะดะปั ัะฒะพััะฐ ะธะท ัะพะฑััะธะน ะฒัะฟะพะปะฝัะตััั `event[i].ObservedAtUtc < event[i+1].ObservedAtUtc`.

โ **ะัะพะฒะฐะป:** ะตััั ะธัะบะปััะตะฝะธั/ะฟััััะต ะบะปััะธ/ะฝะตะฒะพะทะผะพะถะฝะพััั ะฒะพัััะฐะฝะพะฒะธัั ัะตะฟะพัะบั โ Step 2 ะทะฐะฟัะตััะฝ.

---

### ะจะฐะณ 2: Diagnosis Engine

**ะงัะพ:** ะะตะฐะปะธะทะพะฒะฐัั ะผะธะฝะธะผะฐะปัะฝัะน ะฝะฐะฑะพั ะฟัะฐะฒะธะป ะดะปั MVP (ะฑะตะท ัะธะบะปะธัะตัะบะธั ะทะฐะฒะธัะธะผะพััะตะน)  
**ะัะตะผั:** 1-2 ะดะฝั  
**ะะพะผะฟะพะฝะตะฝั:** `Core/IntelligenceV2/Diagnosis/StandardDiagnosisEngineV2.cs`

**ะะธะฐะณะฝะพะทั ะดะปั MVP (ะฟะพััะฐะฟะฝะพ, ะฑะตะท ัะธะบะปะธัะตัะบะธั ะทะฐะฒะธัะธะผะพััะตะน):**

ะญัะฐะฟ 1 (ะธัะฟะพะปัะทัะตะผ ัะพะปัะบะพ ัะพ, ััะพ ัะถะต ะตััั ะธ ััะฐะฑะธะปัะฝะพ ัะพะฑะธัะฐะตััั):
1. **DnsHijack** โ ะฟะพ DNS-ัะตะนะปะฐะผ/ะฟะพะดะผะตะฝะต.
2. **SilentDrop / TcpTimeout** โ ะฟะพ ัะฐะนะผะฐััะฐะผ + ะฒััะพะบะพะน ะดะพะปะต ัะตััะฐะฝัะผะธััะธะน.

ะญัะฐะฟ 2 (ะฟะพัะปะต ัะฐััะธัะตะฝะธั ัะตะฝัะพัะพะฒ RST ะธ/ะธะปะธ ะฟะพัะฒะปะตะฝะธั ัััะพะนัะธะฒะพะณะพ ะผะฐัะบะตัะฐ DPI-ะธะฝะถะตะบัะธะธ):
3. **ActiveDpiEdge** โ ะดะพะฑะฐะฒะปัะตะผ ะฟัะฐะฒะธะปะพ ัะพะปัะบะพ ะบะพะณะดะฐ ะดะฐะฝะฝัะต ัะตะฐะปัะฝะพ ะดะพัััะฟะฝั.

**ะะตะฐะปะธะทะฐัะธั (ะฒ ัะตะฟะพะทะธัะพัะธะธ):**
- ะะธะฐะณะฝะพะท ััะฐะฒะธััั ัััะพะณะพ ะฟะพ `BlockageSignalsV2` (ะฑะตะท ะฟะฐัะฐะผะตััะพะฒ ะฑะฐะนะฟะฐัะฐ).
- ะะพะทะฒัะฐัะฐะตััั `DiagnosisResult` ั `ExplanationNotes` ะธ `Evidence` ะดะปั ะพัะปะฐะดะบะธ.
- ะะพะดะดะตัะถะธะฒะฐัััั ะบะฐะบ ะผะธะฝะธะผัะผ: `NoBlockage`, `DnsHijack`, `SilentDrop`, `HttpRedirect`, `MultiLayerBlock`, ะฐ ัะฐะบะถะต `Unknown` ะฟัะธ ะฝะตะดะพััะฐัะบะต ัะปะธะบ.

**ะัะธัะตัะธะน ะณะพัะพะฒะฝะพััะธ (Gate 2โ3 โ ัะตะฐะปะธััะธัะฝัะน):**

ะัะพะฑะปะตะผะฐ ัััะฝะพะน ะบะพะฝัะธะณััะฐัะธะธ ะดะตะนััะฒะธัะตะปัะฝะพ ะตััั: ะฝะฐะฑะพั "5 ะฑะปะพะบะธััะตะผัั" ัะธะปัะฝะพ ะทะฐะฒะธัะธั ะพั ัะตะณะธะพะฝะฐ/ISP.
ะงัะพะฑั ััะพ ะฝะต ะฟัะตะฒัะฐัะฐะปะพัั ะฒ ัััะฝะพะน ะฑะปะพะบะตั ะดะปั CI/CD, ะธัะฟะพะปัะทัะตะผ ะดะฒะฐ ัะตะถะธะผะฐ:

1) **ะะพะบะฐะปัะฝัะน ัะตะถะธะผ (ั ะฟะพะปัะทะพะฒะฐัะตะปั):**
- "ะัะพะฑะปะตะผะฝัะต" ัะบะพัั โ ะธะท `AutoHostlist` (ะตัะปะธ ะตััั ะธััะพัะธั ะฑะปะพะบะธัะพะฒะพะบ/ัะตะนะปะพะฒ), ะธะฝะฐัะต ะทะฐะดะฐัััั ะฒัััะฝัั.
- "ะะฐะฑะพัะธะต" ัะบะพัั โ ัะธะบัะธัะพะฒะฐะฝะฝัะน ัะฟะธัะพะบ ััะฐะฑะธะปัะฝัั ัะตะปะตะน (CDN/DNS), ะบะพัะพััะต ะพะฑััะฝะพ ะดะพัััะฟะฝั.

2) **CI/ะพัะปะฐะนะฝ ัะตะถะธะผ:**
- Gate 2โ3 ะฒะฐะปะธะดะธััะตััั ะฝะต ะถะธะฒะพะน ัะตััั, ะฐ ะดะตัะตัะผะธะฝะธัะพะฒะฐะฝะฝัะผะธ ัะธะบััััะฐะผะธ/ัะธะผัะปััะธะตะน ะฒัะพะดะฝัั `BlockageSignalsV2` (ะฟัะพะฒะตััะตะผ ะฟัะฐะฒะธะปะฐ ะธ ััะฐะฑะธะปัะฝะพััั ะดะธะฐะณะฝะพะทะฐ).

ะะฟัะธะพะฝะฐะปัะฝะพ (ะฝะต ะดะปั CI): ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฒะฝะตัะฝะธะต ะธััะพัะฝะธะบะธ "ะฑะปะพะบะธััะตะผัั" ัะตะปะตะน (ะฟัะฑะปะธัะฝัะต ัะฟะธัะบะธ), ะฝะพ ััะพ ะดะพะปะถะฝะพ ะฑััั ะพัะบะปััะฐะตะผะพ ะธ ะฝะต ะปะพะผะฐัั ะฒะพัะฟัะพะธะทะฒะพะดะธะผะพััั.

โ **ะฃัะฟะตั:**
- ะะปั ะฟัะพะฑะปะตะผะฝัั: ะดะธะฐะณะฝะพะท **ะฝะต** `Unknown` ะธ `Confidence > 30`.
- ะะปั ัะฐะฑะพัะธั: ะดะธะฐะณะฝะพะท `NoBlockage` ะปะธะฑะพ `Unknown` ั ะฝะธะทะบะพะน ัะฒะตัะตะฝะฝะพัััั.
- `ExplanationNotes` ัะธัะฐะตะผ ะธ ัััะปะฐะตััั ะฝะฐ ัะฐะบัั ("DNS fail", "timeout + retx", ...).

โ **ะัะพะฒะฐะป:** ะดะธะฐะณะฝะพััะธะบะฐ ัะฐััะพ `Unknown` ะฝะฐ ะฟัะพะฑะปะตะผะฝัั ะธะปะธ ะดะฐัั ัะฒะตัะตะฝะฝัะต ะดะธะฐะณะฝะพะทั ะฝะฐ ัะฐะฑะพัะธั โ ะดะพัะฐะฑะฐััะฒะฐะตะผ ะฟัะฐะฒะธะปะฐ.

---

### ะจะฐะณ 3: Strategy Selector

**ะงัะพ:** ะขะฐะฑะปะธัะฐ ะผะฐะฟะฟะธะฝะณะฐ ะดะธะฐะณะฝะพะท โ ัััะฐัะตะณะธะธ  
**ะัะตะผั:** 4-6 ัะฐัะพะฒ  
**ะะพะผะฟะพะฝะตะฝั:** `Core/IntelligenceV2/Strategies/StandardStrategySelectorV2.cs`

**ะะตะฐะปะธะทะฐัะธั (ะฒ ัะตะฟะพะทะธัะพัะธะธ):**
- ะกะตะปะตะบัะพั ะฟัะธะฝะธะผะฐะตั ัะตัะตะฝะธะต ัััะพะณะพ ะฟะพ `DiagnosisResult` (id + confidence), ะฝะต ัะธัะฐะตั `InputSignals` ะธ ะฝะต ัะพะดะธั ะฒ ัะตะฝัะพัั.
- ะัััะบะธะต ะทะฐัะธัั:
  - `confidence < 50` โ ะฟัััะพะน ะฟะปะฐะฝ.
  - `RiskLevel.High` ะทะฐะฟัะตััะฝ ะฟัะธ `confidence < 70`.
  - ะะตัะตะฐะปะธะทะพะฒะฐะฝะฝัะต ัััะฐัะตะณะธะธ โ warning + skip (ะฑะตะท ะธัะบะปััะตะฝะธะน).
- ะะพะปะธัะธะบะฐ ะฟะพ DoH ะดะปั DNS-ะดะธะฐะณะฝะพะทะฐ ัะธะบัะธััะตััั ะพัะดะตะปัะฝะพ (ัะผ. ะฝะธะถะต), ััะพะฑั ะฝะต ัะตัะฐัั ะฒ ะฟัะพะดะฐะบัะตะฝ ั ยซะพัะปะพะถะตะฝะฝัะผ ัะตัะตะฝะธะตะผยป.

**ะัะธัะตัะธะน ะณะพัะพะฒะฝะพััะธ (Gate 3โ4):**

- โ ะะปั `Diagnosis=None/Unknown` โ ะฟัััะพะน ะฟะปะฐะฝ
- โ ะะปั ัะปะฐะฑัั ะดะธะฐะณะฝะพะทะพะฒ (confidence <50) โ ะฟัััะพะน ะฟะปะฐะฝ
- โ ะะณัะตััะธะฒะฝัะต ัััะฐัะตะณะธะธ (DROP_RST) ะฝะต ะฟะพัะฒะปััััั ะฟัะธ ะฝะธะทะบะพะน ัะฒะตัะตะฝะฝะพััะธ
- โ ะกััะฐัะตะณะธะธ ั `RiskLevel.High` ัะธะปัััััััั ะฟัะธ confidence <70
- โ ะะปะฐะฝ ะดะตัะตัะผะธะฝะธัะพะฒะฐะฝ (ะพะดะธะฝะฐะบะพะฒัะน ะดะปั ะพะดะฝะพะณะพ ะดะธะฐะณะฝะพะทะฐ)

---

### ะจะฐะณ 4: Executor (MVP โ ัะพะปัะบะพ ะปะพะณะธัะพะฒะฐะฝะธะต)

**ะงัะพ:** ะะพะผะฟะพะฝะตะฝั ะบะพัะพััะน ะะะะ ะขะะะฌะะ ะปะพะณะธััะตั ัะตะบะพะผะตะฝะดะฐัะธะธ  
**ะัะตะผั:** 2-3 ัะฐัะฐ  
**ะะพะผะฟะพะฝะตะฝั:** `Core/IntelligenceV2/Execution/BypassExecutorMvp.cs`

**ะะะะะ:** ะ MVP ะะ ะฟัะธะผะตะฝัะตะผ ัััะฐัะตะณะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ.

ะะพ MVP ะดะพะปะถะตะฝ ะดะฐะฒะฐัั ะฟะพะปัะทั: ะดะพะฟััะบะฐะตััั **ัััะฝะพะต ะฟัะธะผะตะฝะตะฝะธะต** (ะฟะพ ะบะฝะพะฟะบะต ะฟะพะปัะทะพะฒะฐัะตะปั).
ะขะพ ะตััั "auto-apply" ะทะฐะฟัะตััะฝ, ะฐ "one-click apply" (ัะฒะฝะพะต ะดะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั) ัะฐะทัะตััะฝ.

**ะะตะฐะปะธะทะฐัะธั (ะฒ ัะตะฟะพะทะธัะพัะธะธ):**
- Executor v2 ะฝะต ะฟัะธะผะตะฝัะตั ัะตัะฝะธะบะธ ะธ ะฝะต ััะพะณะฐะตั `TrafficEngine`/`TlsBypassService`.
- ะคะพัะผะฐัะธััะตั v2-ะดะธะฐะณะฝะพะท ะธ ัะตะบะพะผะตะฝะดะฐัะธะธ ะฒ ัััะพะบะธ, ะบะพัะพััะต ะดะฐะปััะต ะผะพะณัั ะฑััั ะฟะพะบะฐะทะฐะฝั ะฒ UI.
- ะััั ะดะตะดัะฟะปะธะบะฐัะธั, ััะพะฑั ะฝะต ัะฟะฐะผะธัั ะพะดะธะฝะฐะบะพะฒัะผะธ ัะตะบะพะผะตะฝะดะฐัะธัะผะธ ะฟะพ ะพะดะฝะพะผั ัะพััั.

**ะัะธัะตัะธะน ะณะพัะพะฒะฝะพััะธ (Gate 4โ5):**

- โ ะะพะณะธ ะฟะพะบะฐะทัะฒะฐัั ะฟะพะฝััะฝัะน reasoning
- โ ะะธะบะฐะบะพะณะพ ะฐะฒัะพ-ะฟัะธะผะตะฝะตะฝะธั bypass ะฝะต ะฟัะพะธััะพะดะธั
- โ ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพัะฒะปััััั ัะพะปัะบะพ ะดะปั ัะฒะตัะตะฝะฝัั ะดะธะฐะณะฝะพะทะพะฒ

---

### ะจะฐะณ 5: ะะฝัะตะณัะฐัะธั ะฒ UI

**ะงัะพ:** ะะฐะผะตะฝะธัั ััะฐััะต ัะตะบะพะผะตะฝะดะฐัะธะธ ะฝะฐ v2  
**ะัะตะผั:** 4-6 ัะฐัะพะฒ  
**ะะพะผะฟะพะฝะตะฝั:** `ViewModels/DiagnosticOrchestrator.cs`

**ะะตัะตัะพะดะฝัะน ะฟะตัะธะพะด (ััะพะฑั ะฝะต ะฑัะปะพ ะดะฒัั โะบะพะฝะบััะธััััะธั ะธััะธะฝโ):**
- Legacy-ะดะธะฐะณะฝะพััะธะบะฐ (`StandardBlockageClassifier`) ะพััะฐัััั, ะฝะพ ะฒ UI ัะฒะฝะพ ะฟะพะผะตัะฐะตััั ะบะฐะบ **legacy**.
- V2-ะดะธะฐะณะฝะพะท ะฟะพะบะฐะทัะฒะฐะตััั ะฟัะธะพัะธัะตัะฝะพ (ะธ ะธะผะตะฝะฝะพ ะพะฝ ัะฟัะฐะฒะปัะตั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ v2).
- ะขะตัะฝะธัะตัะบะธ ััะพ ะผะพะถะตั ะฑััั ัะตะฐะปะธะทะพะฒะฐะฝะพ ัะตัะตะท ะพัะดะตะปัะฝัะต ะฟะพะปั/ัััะพะบะธ ะดะปั ะพัะพะฑัะฐะถะตะฝะธั (TODO ะฒ ัะฐะผะบะฐั Step 5).

**ะะตะฐะปะธะทะฐัะธั (ะฒ ัะตะฟะพะทะธัะพัะธะธ):**
- v2 ะบะพะฝััั ะธัะฟะพะปะฝัะตััั ะฒ `Utils/LiveTestingPipeline.cs` ะฟะพัะปะต ะฟะพะปััะตะฝะธั ัะตะทัะปััะฐัะฐ ัะตััะธัะพะฒะฐะฝะธั.
- `ViewModels/DiagnosticOrchestrator.cs` ะฐะณัะตะณะธััะตั/ะฟะพะบะฐะทัะฒะฐะตั ัะตะทัะปััะฐัั ะฒ UI ะธ ะพะฑัะฐะฑะฐััะฒะฐะตั v2-ัััะพะบะธ ัะตะบะพะผะตะฝะดะฐัะธะน.
- Legacy-ะบะปะฐััะธัะธะบะฐัะพั ะพััะฐัััั ะดะปั ัะพะฒะผะตััะธะผะพััะธ/ะบะฐัั ะฟัะพะฑะปะตะผ, ะฝะพ v2-ัะตัะตะฝะธั ะธัะฟะพะปัะทััััั ะดะปั ัะตะบะพะผะตะฝะดะฐัะธะน.

**ะัะธัะตัะธะน ะณะพัะพะฒะฝะพััะธ (ัะธะฝะฐะปัะฝัะน gate):**

- โ ะกัะฐััะต ัะตะบะพะผะตะฝะดะฐัะธะธ ะทะฐะผะตะฝะตะฝั ะฝะฐ v2
- โ UI ะฟะพะบะฐะทัะฒะฐะตั `DiagnosisResult.ExplanationNotes`
- โ ะะตั ัะตะณัะตััะธะน ะฒ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- โ ะะตะณะธัะธะผะฝัะต ัะฐะนัั ะฝะต ะฟะพะปััะฐัั ะฐะณัะตััะธะฒะฝัะต ัะตะบะพะผะตะฝะดะฐัะธะธ

---

## โฑ๏ธ ะะฑัะฐั ะพัะตะฝะบะฐ ะฒัะตะผะตะฝะธ

| ะจะฐะณ | ะะฟะธัะฐะฝะธะต | ะัะตะผั |
|-----|----------|-------|
| 0 | ะะพะฝััะฐะบั (ััะพัะฝะตะฝะธั) | 2-3 ัะฐัะฐ |
| 1 | Signals Adapter | 1 ะดะตะฝั |
| 2 | Diagnosis Engine | 1-2 ะดะฝั |
| 3 | Strategy Selector | 4-6 ัะฐัะพะฒ |
| 4 | Executor MVP | 2-3 ัะฐัะฐ |
| 5 | ะะฝัะตะณัะฐัะธั UI | 4-6 ัะฐัะพะฒ |

ะัะธะผะตัะฐะฝะธะต: ััะพ ะธััะพัะธัะตัะบะฐั ะพัะตะฝะบะฐ ยซั ะฝัะปัยป. ะ ัะตะบััะตะผ ัะตะฟะพะทะธัะพัะธะธ MVP v2 ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝ.

---

## ๐ฏ ะงัะพ ะดะฐะปััะต (ะฟะพัะปะต MVP)

### ะะพัะปะต ััะฐะฑะธะปะธะทะฐัะธะธ MVP:

1. **ะะพะฑะฐะฒะธัั ะพััะฐะปัะฝัะต ะดะธะฐะณะฝะพะทั:**
   - StatefulDpi
    - ActiveDpiEdge

2. **ะะบะปััะธัั ัะตะฐะปัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต:**
    - ะะฐะผะตะฝะธัั `BypassExecutorMvp` ะฝะฐ ัะตะฐะปัะฝัะน executor (ะฝะฐะฟัะธะผะตั `ExecuteAsync(...)`)
    - ะะพะฑะฐะฒะธัั feedback loop (ััะฟะตั/ะฝะตััะฟะตั ัััะฐัะตะณะธะธ)

3. **Feedback Store:**
   - ะะฐะฟะพะผะธะฝะฐัั ััะฟะตัะฝัะต ัััะฐัะตะณะธะธ
   - ะะฒัะพะผะฐัะธัะตัะบะธ ัะฐะฝะถะธัะพะฒะฐัั

4. **ะะฐััะธัะธัั ัััะฐัะตะณะธะธ:**
   - HTTP Host tricks (2.1)
   - QUIC obfuscation (2.3)
   - Bad checksum (2.2, ะฟะพัะปะต ัะฝััะธั ะฑะปะพะบะตัะฐ)

5. **ะะตัะตะฝะธะต ะดะปั MVP (ะพะฑัะทะฐัะตะปัะฝะพ ะดะพ ัะฐะทะฒะธัะธั ัะตะปะตะบัะพัะฐ): DnsHijack โ UseDoh**
- ะัะฑัะฐะฝ ะฒะฐัะธะฐะฝั **C**: `UseDoh` ัะตะบะพะผะตะฝะดัะตััั **ัะพะปัะบะพ** ะฟัะธ `MultiLayerBlock`, ะฝะพ **ะฝะต** ะฟัะธ ัะธััะพะผ `DnsHijack`.
- ะัะธัะธะฝะฐ: ะผะธะฝะธะผะธะทะธัะพะฒะฐัั ะปะพะถะฝัะต ััะฐะฑะฐััะฒะฐะฝะธั ะธ ะฝะต ัะฐัะธัั DoH ะฒ ัะตะบะพะผะตะฝะดะฐัะธะธ ะฟัะธ ยซัะธััะพ DNSยป ััะตะฝะฐัะธัั.
- ะัะปะธ ะฟะพะฝะฐะดะพะฑะธััั ะฒะตัะฝััั DoH ะดะปั `DnsHijack` โ ััะพ ะพัะดะตะปัะฝะพะต ะพัะพะทะฝะฐะฝะฝะพะต ะธะทะผะตะฝะตะฝะธะต UX (ะดะธัะบะปะตะนะผะตั/ัััะฝะฐั ะฝะฐัััะพะนะบะฐ), ะฐ ะฝะต "ะฟะพ ัะผะพะปัะฐะฝะธั".

6. **(ะะฟัะธะพะฝะฐะปัะฝะพ) ะจะฐะณ 4.5: UI Preview / Apply Recommended Strategies**
- ะัะตะผั: 3โ4 ัะฐัะฐ.
- ะงัะพ: ะบะฝะพะฟะบะฐ "ะัะธะผะตะฝะธัั ัะตะบะพะผะตะฝะดะพะฒะฐะฝะฝัะต ัััะฐัะตะณะธะธ".
- ะัะธัะตัะธะธ:
    - ะะฝะพะฟะบะฐ ะฒะธะดะฝะฐ ัะพะปัะบะพ ะฟัะธ `confidence >= 70`.
    - ะัะธะผะตะฝัะตั ัะพะปัะบะพ `Low/Medium` ัะธัะบ.
    - ะะพะณะธััะตั ัะฐะบั ะฟัะธะผะตะฝะตะฝะธั (ะฑัะดััะธะน feedback store).

---

## ๐ ะกััะตััะฒัััะธะต ะฒะพะทะผะพะถะฝะพััะธ (Phase 2, ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ)

ะญัะธ ะบะพะผะฟะพะฝะตะฝัั ัะถะต ัะฐะฑะพัะฐัั ะธ ะฑัะดัั ะธัะฟะพะปัะทะพะฒะฐัััั Executor'ะพะผ:

### โ TLS Fragment/Disorder (2.6)
- ะะตะฐะปะธะทะพะฒะฐะฝะพ ะฒ `TlsBypassService`
- ะะฐัะฐะผะตััั ัะพััะฐะฝััััั ะฒ `bypass_profile.json`
- ะัะตัะตัั: ััะฐะฝะดะฐัั/ัะผะตัะตะฝะฝัะน/ะฐะณัะตััะธะฒะฝัะน

### โ TTL Fake/AutoTTL (2.5)
- ะัะธะผะตะฝัะตััั ัะตัะตะท `TlsBypassService`
- AutoTTL: ะฟะตัะตะฑะพั TTL 2-8 ะฟะพ ะผะตััะธะบะฐะผ
- ะัััะธะน TTL ัะพััะฐะฝัะตััั ะฒ ะฟัะพัะธะปั

### ๐ก Auto-hostlist (2.4)
- ะงะฐััะธัะฝะพ: ัะฑะพั ะบะฐะฝะดะธะดะฐัะพะฒ ัะฐะฑะพัะฐะตั
- ะะ ััะฐััะฒัะตั ะฒ Diagnosis Engine v2
- ะัะฟะพะปัะทัะตััั ัะพะปัะบะพ ะดะปั UI/ะปะพะณะพะฒ

### โธ๏ธ ะัะปะพะถะตะฝะพ ะดะพ MVP v2:
- HTTP Host tricks (2.1)
- Bad checksum (2.2) โ ะฑะปะพะบะตั ะฝะฐ ััะพะฒะฝะต ะดะฒะธะถะบะฐ
- QUIC obfuscation (2.3)

---

## ๐ ะัะฐะฒะธะปะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ

### ะะฐัะธัะฐ ะพั ัะตะณัะตััะธะน:

1. **ะะต ะฟะตัะตัะพะดะธัั ะฝะฐ ัะปะตะดัััะธะน ัะฐะณ ะฑะตะท gate-ะฟัะพะฒะตัะบะธ**
2. **Diagnosis=None/Unknown โ ะฟัััะพะน ะฟะปะฐะฝ**
3. **Confidence <50 โ ะฟัััะพะน ะฟะปะฐะฝ**
4. **ะะณัะตััะธะฒะฝัะต ัััะฐัะตะณะธะธ (DROP_RST) โ ัะพะปัะบะพ ะฟัะธ confidence >70**
5. **ะ MVP ะฝะตั ะฐะฒัะพ-ะฟัะธะผะตะฝะตะฝะธั bypass**

ะะพะฟะพะปะฝะตะฝะธะต:
- ะะพะฟััะบะฐะตััั ัััะฝะพะต ะฟัะธะผะตะฝะตะฝะธะต ัััะฐัะตะณะธะธ (ะฟะพ ะบะฝะพะฟะบะต/ะบะพะผะฐะฝะดะต ะฟะพะปัะทะพะฒะฐัะตะปั) ัะพะปัะบะพ ะฟัะธ ะดะพััะฐัะพัะฝะพะน ัะฒะตัะตะฝะฝะพััะธ.

---

## ๐ ะะปะฐะฝ ะผะธะณัะฐัะธะธ legacy โ v2

ะัะพะฑะปะตะผะฐ "ะดะฒัั ะธััะธะฝ" ัะตัะฐะตััั ะฟะพััะฐะฟะฝัะผ ะฟะตัะตะบะปััะตะฝะธะตะผ (ั ะฒะพะทะผะพะถะฝะพัััั ะพัะบะฐัะฐ):

- Week 1โ2: v2 ัะฐะฑะพัะฐะตั ะฟะฐัะฐะปะปะตะปัะฝะพ, legacy ะพััะฐัััั primary.
- Week 3โ4: v2 ััะฐะฝะพะฒะธััั primary, legacy ะธัะฟะพะปัะทัะตััั ะบะฐะบ fallback (ะฝะฐะฟัะธะผะตั, ะตัะปะธ v2 ะฒะตัะฝัะป `Unknown`).
- Week 5+: legacy ะพัะบะปััะฐะตััั ะฟะพะปะฝะพัััั (ะตัะปะธ ะบัะธัะตัะธะธ ะบะฐัะตััะฒะฐ ะฒัะฟะพะปะฝะตะฝั).

ะัะธัะตัะธะธ ะพัะบะปััะตะฝะธั legacy:
- v2 accuracy โฅ 85% ะฝะฐ ะบะพะฝััะพะปัะฝัั ะฝะฐะฑะพัะฐั.
- ะะตั ะบัะธัะธัะฝัั ะฑะฐะณะพะฒ ะฒ ัะตัะตะฝะธะต 2 ะฝะตะดะตะปั.
- ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ะถะฐะปะพะฑั < 5 ะฒ ะฝะตะดะตะปั.

### ะัะบะฐั ะฟัะธ ะฟัะพะฑะปะตะผะฐั:

- ะัะปะธ Gate ะฝะต ะฟัะพะนะดะตะฝ โ ะดะพัะฐะฑะฐััะฒะฐะตะผ ัะตะบััะธะน ัะฐะณ
- ะัะปะธ ะธะฝัะตะณัะฐัะธั ัะปะพะผะฐะปะฐ ััะพ-ัะพ โ ะพัะบะฐั ะบ ััะฐัะพะน ะฒะตััะธะธ
- ะะพะณะธ ะดะพะปะถะฝั ะฑััั ะฟะพะฝััะฝั ะดะปั ะพัะปะฐะดะบะธ

---

## ๐ ะะปะพััะฐัะธะน

**Signals** โ ััััะต ัะฐะบัั ะธะท ัะตะฝัะพัะพะฒ (RST, timeout, retransmissions)  
**Diagnosis** โ ะธะฝัะตัะฟัะตัะฐัะธั ัะธะณะฝะฐะปะพะฒ (ActiveDpiEdge, DnsHijack ะธ ั.ะด.)  
**Strategy** โ ะบะพะฝะบัะตัะฝะฐั ัะตัะฝะธะบะฐ ะพะฑัะพะดะฐ (TlsFragment, UseDoh ะธ ั.ะด.)  
**Plan** โ ัะฟะพััะดะพัะตะฝะฝัะน ัะฟะธัะพะบ ัััะฐัะตะณะธะน ะดะปั ะฟะพะฟััะบะธ  
**Executor** โ ะบะพะผะฟะพะฝะตะฝั ะบะพัะพััะน ะฟัะธะผะตะฝัะตั ะฟะปะฐะฝ  
**Feedback** โ ะทะฐะฟะธัั ัะตะทัะปััะฐัะพะฒ ะดะปั ะพะฑััะตะฝะธั ัะธััะตะผั  
**Gate** โ ะบะพะฝััะพะปัะฝะฐั ัะพัะบะฐ ะผะตะถะดั ัะฐะณะฐะผะธ (ััะตะฑะพะฒะฐะฝะธั ะบ ะบะฐัะตััะฒั)

---

## โ๏ธ ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน

**16.12.2025** โ ะะตัะฒะฐั ะฒะตััะธั (ะดะธะทะฐะนะฝ ะบะพะฝััะฐะบัะฐ + 5 ัะฐะณะพะฒ MVP)

**19.12.2025** โ ะะบััะฐะปะธะทะฐัะธั ะฟะพะด ัะฐะบัะธัะตัะบัั ัะตะฐะปะธะทะฐัะธั v2 ะฒ ัะตะฟะพะทะธัะพัะธะธ (ะฟััะธ `Core/IntelligenceV2/*`, ัะดะฐะปะตะฝะธะต ะฟัะตะฒะดะพะบะพะดะฐ, ัะธะฝััะพะฝะธะทะฐัะธั ะบะพะฝััะฐะบัะพะฒ)