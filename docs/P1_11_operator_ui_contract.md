# P1.11 — UX‑контракт Operator UI

Цель: операторский режим даёт 1–2 простых действия и понятный результат, без инженерных тумблеров и терминов.

## Термины

- **Источник трафика**:
  - **Быстрая проверка интернета** — встроенный генератор тестового трафика (TestNetworkApp).
  - **Проверка выбранного приложения (.exe)** — анализ трафика выбранного процесса/приложения.
- **Автопилот** — разрешение на автоматическое применение безопасных и обратимых действий (стратегии не выбираются пользователем).
- **Откатить** — отключить применённые воздействия (DisableAll) и вернуть систему в исходное состояние (best‑effort).

## Главные правила Operator UI

1. **Status‑first**: один главный статус (hero) всегда сверху.
2. **Один главный CTA**: на экране всегда есть ровно одна главная кнопка (Primary). Вторичные действия допустимы, но визуально слабее.
3. **Прогрессивное раскрытие**: подробности (технические строки) только в Expander.
4. **Пользователь выбирает только источник трафика** (и, при необходимости, даёт согласие). Он не выбирает DoH/TLS/QUIC/стратегии.

## Таблица операторских состояний

Состояния выводятся из агрегированной семантики MainViewModel:

| Код | Условие (упрощённо) | Заголовок | Подзаголовок | Primary CTA |
|---|---|---|---|---|
| `Idle` | !Running && !Done | Готов к проверке | Выберите источник трафика и нажмите «Проверить» | Проверить |
| `Checking` | Running | Идёт проверка | Пожалуйста, подождите… | Остановить |
| `Ok` | Done && Fail=0 && Warn=0 | Всё в порядке | Сеть выглядит стабильной | Проверить снова |
| `Warn` | Done && Fail=0 && Warn>0 | Есть ограничения | Некоторые сервисы нестабильны | Исправить |
| `Blocked` | Done && Fail>0 | Найдены проблемы | Доступ к части сервисов блокируется | Исправить |
| `Fixing` | ApplyRunning \| PostApplyRetestRunning | Исправляю… | Применяю безопасные действия и перепроверяю | (disabled) |

Примечания:
- `Warn`/`Blocked` показывают «Исправить» только если есть рекомендации (`HasAnyRecommendations`). Если рекомендаций нет — Primary CTA = «Проверить снова».

## Шаги (wizard‑поток)

### Шаг 1 — Выбор источника
- Доступно в `Idle` и после завершения (`Ok/Warn/Blocked`).
- В `Checking/Fixing` элементы выбора источника отключены.

### Шаг 2 — Прогресс
- Видим только в `Checking`.
- Показывать краткий прогресс: «проверено X из Y».

### Шаг 3 — Итог
- Видим только в `Ok/Warn/Blocked`.
- Показать счётчики: OK / нестабильно / блокируется.

### Шаг 4 — Исправление
- Видим в `Fixing` (Apply + post‑apply ретест).
- После завершения пост‑проверки основной статус возвращается в `Ok/Warn/Blocked` (по агрегированной семантике),
  но блок «Шаг 4» может оставаться как «последний итог исправления» до следующей проверки, чтобы оператор увидел результат.

## Тексты (tone)

- Без жаргона в hero‑зоне.
- Технические слова допускаются только в «Подробности».

## Переключение режимов

- Operator → Engineer: отдельная кнопка, с подтверждением.
- Engineer → Operator: кнопка возврата без остановки shared MainViewModel.
