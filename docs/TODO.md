# ISP_Audit ‚Äî TODO

–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏: 10.02.2026
–í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ ‚Üí [CHANGELOG.md](../CHANGELOG.md). –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Üí [ARCHITECTURE_CURRENT.md](../ARCHITECTURE_CURRENT.md). –ê—É–¥–∏—Ç ‚Üí [docs/audit4.md](audit4.md).

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
- üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π: –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ü–∏–∏/–æ–±—Ö–æ–¥–∞ –∏–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–Ω—Ç–∞–π–º–∞
- üü° –í–∞–∂–Ω—ã–π: –ø–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å/–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- üü¢ –ù–∏–∑–∫–∏–π: UX/–ø–æ–ª–∏—à/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏/—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

---

## üî¥ P0 ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

### P0.1 `async void` –Ω–µ-event handler (CRASH RISK)
- `MainViewModel.Helpers.cs:94` ‚Äî `CheckAndRetestFailedTargets` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è event handler. –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ = –∫—Ä—ç—à –ø—Ä–æ—Ü–µ—Å—Å–∞.
- **–§–∏–∫—Å**: `async Task` + `_ = CheckAndRetestFailedTargetsAsync(...)` —Å –æ–±—ë—Ä—Ç–∫–æ–π.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß2.1

### P0.2 Sync-over-async deadlock (App.OnExit)
- `App.xaml.cs` ‚Äî `ShutdownAsync().GetAwaiter().GetResult()` –Ω–∞ UI-–ø–æ—Ç–æ–∫–µ. –ï—Å–ª–∏ —Ü–µ–ø–æ—á–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç `Dispatcher.Invoke` ‚Üí deadlock.
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ: `TrafficEngine.Dispose`, `ConnectionMonitorService.Dispose`, `DnsSnifferService.Dispose`, `PidTrackerService.Dispose`.
- **–§–∏–∫—Å**: `Task.Run(() => ShutdownAsync()).GetAwaiter().GetResult()` –∏–ª–∏ `IAsyncDisposable`.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß2.2

### P0.3 `MessageBox.Show` –≤ ViewModel (MVVM –Ω–∞—Ä—É—à–µ–Ω–∏–µ)
- `DiagnosticOrchestrator.Core.cs` ~L76-81, L407 ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –≤ headless-—Å—Ü–µ–Ω–∞—Ä–∏–∏.
- **–§–∏–∫—Å**: –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `Func<string, string, bool>` callback –∏–ª–∏ event.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß1.4

### P0.4 TrafficEngine ‚Äî –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã
- –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç: ¬±100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞ –≤–æ–∫—Ä—É–≥ –∫—Ä–∞—à–∞ `Collection was modified`.
- –û–ø–∏—Å–∞—Ç—å —Ä—É—á–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (—Ç–æ—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π).
- Stress: ‚â•1000 Apply/Rollback –∑–∞ –º–∏–Ω—É—Ç—É + –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å baseline hot path (latency p50/p95/p99, alloc rate, CPU).
- Unit/—Ä–µ–≥—Ä–µ—Å—Å —Ç–µ—Å—Ç—ã –Ω–∞ concurrent read/write.

### P0.5 Apply timeout ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏—á–∏–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∞–Ω–∏—è—Ö
- –°–æ–±—Ä–∞—Ç—å –ª–æ–≥–∏ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Ç–∞–π–º–∞—É—Ç–µ.
- –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É (WinDivert stop, DNS, deadlock, connectivity check).
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∞–Ω–∏—è `TrafficEngine.StopAsync/StartAsync`, –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã.
- KPI: Apply <3—Å –≤ 95% —Å–ª—É—á–∞–µ–≤.

### P0.6 –ê—É–¥–∏—Ç –≤—Å–µ—Ö try/catch ‚Äî –ø—É—Å—Ç—ã–µ `catch { }`
- 20+ –ø—É—Å—Ç—ã—Ö `catch { }` –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–æ—Å–æ–±–µ–Ω–Ω–æ `FixService` ‚Äî 6 –º–µ—Å—Ç, `DiagnosticOrchestrator`, `DnsSnifferService`).
- **–§–∏–∫—Å**: –≤ –∫–∞–∂–¥—ã–π –ø—É—Å—Ç–æ–π `catch` –¥–æ–±–∞–≤–∏—Ç—å `Debug.WriteLine` / `_progress?.Report`.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß2.3

---

## üü° P1 ‚Äî –í–∞–∂–Ω—ã–µ

### P1.1 `DateTime.UtcNow` –Ω–∞ hot path TrafficEngine
- –î–≤–∞ –≤—ã–∑–æ–≤–∞ `DateTime.UtcNow` –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç ‚Äî syscall.
- **–§–∏–∫—Å**: `Stopwatch.GetTimestamp()` + `Stopwatch.Frequency`.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß3.1

### P1.2 –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –º–∞—Ä—à–∞–ª–∏–Ω–≥–∞ –≤ UI-–ø–æ—Ç–æ–∫
- 20+ –º–µ—Å—Ç `Dispatcher.Invoke` (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π) –∏–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ ‚Äî risk deadlock.
- –ù–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç `Dispatcher.BeginInvoke` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π).
- `IProgress<T>` —Ç–æ–ª—å–∫–æ –≤ pipeline.
- **–§–∏–∫—Å**: —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ `BeginInvoke` –∏–ª–∏ `IProgress<T>`. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `Invoke` ‚Äî —Ç–æ–ª—å–∫–æ –≥–¥–µ –Ω—É–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß7.1

### P1.3 `IDisposable` –¥–ª—è MainViewModel
- –í–ª–∞–¥–µ–µ—Ç `TrafficEngine`, `BypassStateManager`, `NetworkChangeMonitor` (–≤—Å–µ `IDisposable`), –Ω–æ —Å–∞–º –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç `IDisposable`.
- **–§–∏–∫—Å**: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IDisposable`, –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ `App.OnExit`.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß2.4

### P1.4 OperatorViewModel –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
- 1631 —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ: wizard, –∏—Å—Ç–æ—Ä–∏—è, —Å–µ—Å—Å–∏–∏, —Ñ–∏–ª—å—Ç—Ä—ã, escalation.
- **–§–∏–∫—Å**: —Ä–∞–∑–±–∏—Ç—å –Ω–∞ partial-—Ñ–∞–π–ª—ã (OperatorViewModel.Wizard.cs, .History.cs, .Sessions.cs, .Filters.cs).
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß1.3

### P1.5 –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–µ–π Pipeline
- –†–∞–∑–¥–µ–ª–∏—Ç—å –≤—Ö–æ–¥–Ω—É—é –æ—á–µ—Ä–µ–¥—å –Ω–∞ high/low priority (–¥–≤–∞ `Channel<HostDiscovered>`).
- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥—Ä–æ–ø–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ low-–æ—á–µ—Ä–µ–¥–∏.
- ¬´Degrade mode¬ª –ø—Ä–∏ —Ä–æ—Å—Ç–µ `PendingCount`: —Å–Ω–∏–∂–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è low-priority.
- –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–¥–µ—Ä–∂–µ–∫: enqueue‚Üístart test‚Üíclassified.
- Smoke/perf: —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–µ—Ä–µ–≥—Ä—É–∑–∞.

### P1.6 CDN-–ø–æ–¥—Ö–æ—Å—Ç—ã ‚Äî –¥–µ—Ç–∞–ª–∏ –ø–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏—é
- –í –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ √óN –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ –ø–æ–¥—Ö–æ—Å—Ç–∞–º –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏/–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–Ω–µ–ª–∏.

### P1.7 Operator UI ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Operator UI.
- Hero-—ç–ª–µ–º–µ–Ω—Ç: –±–æ–ª—å—à–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä (—â–∏—Ç/—Ä–∞–¥–∞—Ä) + –∫—Ä—É–ø–Ω—ã–π —Å—Ç–∞—Ç—É—Å-—Ç–µ–∫—Å—Ç.
- –ö–æ–º–ø–æ–Ω–æ–≤–∫–∞: Header ‚Üí –°—Ç–∞—Ç—É—Å ‚Üí CTA ‚Üí Expander –¥–µ—Ç–∞–ª–µ–π ‚Üí Footer (bypass toggle).
- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ¬´–ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∞—Ç—É—Å¬ª (—Å–µ—Ä—ã–π/–∑–µ–ª—ë–Ω—ã–π/–∂—ë–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π).
- –ú–µ—Ç–∞—Ñ–æ—Ä–∞ ¬´–∫–æ–º–∞–Ω–¥–Ω—ã–π —Ü–µ–Ω—Ç—Ä/–±–æ—Ä—Ç–æ–≤–æ–π —â–∏—Ç¬ª.

### P1.8 Operator UI ‚Äî –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è/—Ç–µ–∫—Å—Ç—ã
- –°–ª–æ–≤–∞—Ä—å ¬´–∫–æ–¥ ‚Üí —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç¬ª –¥–ª—è DNS/TCP/TLS/QUIC/RST/Redirect.
- –ï–¥–∏–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ CTA –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –±–µ–∑ –∂–∞—Ä–≥–æ–Ω–∞.

### P1.9 Operator UI ‚Äî wins-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- `(host+SNI) ‚Üí –ø–æ–±–µ–¥–∏–≤—à–∏–π –ø–ª–∞–Ω` —Å persist –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π post-apply —Ä–µ—Ç–µ—Å—Ç–æ–º.

### P1.10 Operator UI ‚Äî escalation GUI
- –ü–æ—Å–ª–µ Apply –∏ FAIL/PARTIAL: CTA ¬´–£—Å–∏–ª–∏—Ç—å¬ª ‚Üí `ApplyEscalation` ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–π Post-Apply Retest.
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–¥–∞—Ç–∞/–æ–∫—Ä—É–∂–µ–Ω–∏–µ/–Ω–∞–±–ª—é–¥–µ–Ω–∏—è).

### P1.11 –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è YouTube/Google (—ç—Ç–∞–ª–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å 1‚Äì2 —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (–±—Ä–∞—É–∑–µ—Ä/–ø—Ä–æ–≤–∞–π–¥–µ—Ä/–ø—Ä–æ—Ñ–∏–ª—å).
- –†–µ–≥—Ä–µ—Å—Å-bisect: –Ω–∞–π—Ç–∏ –ø–µ—Ä–∏–æ–¥ ¬´–∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–ª–æ –ª—É—á—à–µ¬ª –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å Bypass/TrafficEngine/DNS.
- –†–µ–∂–∏–º ¬´classic/–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä¬ª (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Ö–Ω–∏–∫) –¥–ª—è baseline.

### P1.12 Policy-driven ‚Äî –Ω–µ–∑–∞–∫—Ä—ã—Ç–æ–µ
- Advanced —Ä–µ–∂–∏–º: —Ä—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FlowPolicy (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏).
- –ò–∑–º–µ—Ä–∏—Ç—å overhead lookup –≤ decision graph –Ω–∞ hot path.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø–∞–º—è—Ç–∏/–∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–ª–∏—Ç–∏–∫ (cap) –∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è.

### P1.13 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ö–æ–¥–∞ ‚Äî –¥–æ–ª–≥–∏
- **BadChecksum**: –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ UX/–¥–æ–∫–∞—Ö –∫—Ä–∏—Ç–µ—Ä–∏–∏/–æ–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–µ–π–∫–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤).
- **QuicObfuscation**: —Ä–µ–∞–ª—å–Ω–∞—è –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è QUIC (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è) –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞.
- **HttpHostTricks**: —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å.
- **Auto-hostlist**: –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –¥–∏–∞–≥–Ω–æ–∑/–ø–ª–∞–Ω.

### P1.14 INTEL ‚Äî –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–≤–µ—Å–∞ –ø–ª–∞–Ω–æ–≤
- –ï—Å–ª–∏ –ø–ª–∞–Ω A –∞–∫—Ç–∏–≤–µ–Ω, –ø–ª–∞–Ω—ã B –≥–¥–µ B ‚äÇ A –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è.
- –†–∞–∑–¥–µ–ª–∏—Ç—å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ strength/cost, —É—á–∏—Ç—ã–≤–∞—Ç—å feedback.

---

## üü¢ P2 ‚Äî –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç / UX / –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

### P2.1 AutoRetest debounce
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ä–µ—Ç–µ—Å—Ç–æ–≤/–∞–≤—Ç–æ-–¥–µ–π—Å—Ç–≤–∏–π.

### P2.2 Early noise filter
- –†–∞–Ω–Ω–µ–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ —à—É–º–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –¥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI.

### P2.3 –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
- –ò—Å—Ç–æ—Ä–∏—è apply/rollback/retest –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è).

### P2.4 Smoke-—Ç–µ—Å—Ç—ã –Ω–∞ fail-path FixService
- DNS/DoH rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ –Ω–∞ fail-path.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß9.10

### P2.5 `HttpClient` –Ω–∞ –∫–∞–∂–¥—ã–π H3 probe
- `StandardHostTester.ProbeHttp3Async` —Å–æ–∑–¥–∞—ë—Ç `new HttpClient()` –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç.
- **–§–∏–∫—Å**: –ø—É–ª –∏–ª–∏ –æ–±—â–∏–π `SocketsHttpHandler` —Å `PooledConnectionLifetime`.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß3.2

### P2.6 Event subscriptions –±–µ–∑ –æ—Ç–ø–∏—Å–∫–∏
- ~8 –ø–æ–¥–ø–∏—Å–æ–∫ –≤ `MainViewModel.Constructor.cs` –Ω–∏–≥–¥–µ –Ω–µ —Å–Ω–∏–º–∞—é—Ç—Å—è.
- –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —É—Ç–µ—á–∫–∏ –Ω–µ—Ç (singleton), –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –¥–µ—Ñ–µ–∫—Ç.
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß2.5

### P2.7 State persistence ‚Äî race conditions
- –ö–∞–∂–¥—ã–π store –ø–∏—à–µ—Ç —Ñ–∞–π–ª—ã –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫. –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º apply/disable ‚Äî —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π race.
- **–§–∏–∫—Å**: `FileAtomicWriter` (write-to-temp + rename) + –µ–¥–∏–Ω—ã–π `IStatePersister<T>`.

---

## Phase 4 ‚Äî –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥–æ–ª–≥)

### 4.1 DI container
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `Microsoft.Extensions.DependencyInjection`, —É—Ö–æ–¥ –æ—Ç —Ä—É—á–Ω–æ–≥–æ wiring.

### 4.2 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `Config.ActiveProfile`, `Program.Targets` ‚Üí —Å–µ—Ä–≤–∏—Å—ã.
- `NoiseHostFilter.Instance` ‚Üí –∏–Ω—ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (–Ω–∞—á–∞—Ç—å —Å —ç—Ç–æ–≥–æ).
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß1.2

### 4.3 –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è DiagnosticOrchestrator
- –í—ã–¥–µ–ª–µ–Ω–∏–µ: Pipeline / Recommendations / CardActions / State.
- –£–±—Ä–∞—Ç—å `MessageBox.Show` –∏ `Dispatcher` –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

### 4.4 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- `ARCHITECTURE_CURRENT.md` ‚Üí —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —á–∞—Å—Ç—å (Architecture Reference) + –¥–µ–ª—å—Ç—ã (Change Log).
- –ò—Å—Ç–æ—á–Ω–∏–∫: audit4 ¬ß1.1

---

## Phase 5 ‚Äî Native Core (Rust DLL)

### 5.0 –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Rust
- MSBuild –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ Rust DLL.
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `isp_audit_native.dll` –≤ output directory.

### 5.1 WinDivert FFI –æ–±—ë—Ä—Ç–∫–∞
- `DivertIpHdr`, `DivertTcpHdr`, `divert_calc_checksums`.
- `WinDivertNativeRust.cs` + feature flag.

### 5.2 Packet parser (zero-copy)
- IP/TCP/UDP —Å bounds checking, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ hot path.

### 5.3 TLS/SNI parser
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ ClientHello + –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ SNI.

### 5.4 Bypass –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è .NET DLL
- –í—ã–¥–µ–ª–∏—Ç—å bypass-–∫–æ–¥ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
