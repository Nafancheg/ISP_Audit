# ะะพะปะฝัะน ะฐัะดะธั ัะตะฟะพะทะธัะพัะธั ISP_Audit v2

**ะะฐัะฐ**: 09.12.2025 (ะพะฑะฝะพะฒะปะตะฝะพ 10.12.2025)  
**ะะตััะธั ะฟัะพะตะบัะฐ**: .NET 9, WPF  
**ะะตะถะธะผ**: GUI-only (WinExe)  

---

## 1. ะะฐััะฐ ะทะฐะฒะธัะธะผะพััะตะน ะฟัะพะตะบัะฐ

### 1.1 ะััะธัะตะบัััะฐ ะฒะตััะฝะตะณะพ ััะพะฒะฝั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ะขะะงะะ ะะฅะะะ                               โ
โ                       Program.cs                                 โ
โ              โ Config.SetActiveProfile("Default")               โ
โ              โ new App().Run()                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     UI LAYER (WPF)                              โ
โ  App.xaml โ MainWindow.xaml โ MainViewModelRefactored           โ
โ                              โ                                  โ
โ  โโโ BypassController (ะฟัะพะบัะธ ะบ TlsBypassService)              โ
โ  โโโ DiagnosticOrchestrator (ะทะฐะฟััะบ ะดะธะฐะณะฝะพััะธะบะธ)               โ
โ  โโโ TestResultsManager (UI ะบะพะปะปะตะบัะธั ัะตะทัะปััะฐัะพะฒ)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ORCHESTRATION LAYER                           โ
โ              DiagnosticOrchestrator                             โ
โ                              โ                                  โ
โ  โโโ TrafficCollector (ัะฑะพั ัะตัะตะฒัั ัะพะตะดะธะฝะตะฝะธะน)                โ
โ  โโโ LiveTestingPipeline (ัะตััะธัะพะฒะฐะฝะธะต ัะพััะพะฒ)                 โ
โ  โโโ TrafficEngine (WinDivert bypass)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     CORE LAYER                                  โ
โ  โโโ Core/Modules/StandardHostTester                            โ
โ  โโโ Core/IntelligenceV2/Diagnosis/StandardDiagnosisEngineV2     โ
โ  โโโ Core/Modules/InMemoryBlockageStateStore                    โ
โ  โโโ Core/Modules/TcpRetransmissionTracker                     โ
โ  โโโ Core/Modules/HttpRedirectDetector                         โ
โ  โโโ Core/Modules/RstInspectionService                         โ
โ  โโโ Core/Modules/UdpInspectionService                         โ
โ  โโโ Core/Traffic/TrafficEngine + Filters                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    SERVICES LAYER                               โ
โ  โโโ ConnectionMonitorService (WinDivert Socket/Polling)       โ
โ  โโโ DnsParserService (SNI/DNS ะฟะฐััะธะฝะณ; ะพัะดะตะปัะฝัะต ะบะตัะธ DNS/SNI; SNI ั ะผะธะฝะธะผะฐะปัะฝัะผ ัะตะฐััะตะผะฑะปะธะฝะณะพะผ ClientHello) โ
โ  โโโ PidTrackerService (ะพััะปะตะถะธะฒะฐะฝะธะต PID)                      โ
โ  โโโ TcpConnectionWatcher (IP Helper API polling)              โ
โ  โโโ NoiseHostFilter (ัะธะปัััะฐัะธั ััะผะฝัั ัะพััะพะฒ)                โ
โ  โโโ FixService (DNS fix ัะตัะตะท netsh)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    BYPASS LAYER                                 โ
โ  โโโ BypassCoordinator (ะฒัะฑะพั ัััะฐัะตะณะธะธ)                       โ
โ  โโโ TlsBypassService (ะฟัะธะผะตะฝะตะฝะธะต ะพะฟัะธะน/ะฟัะตัะตัะพะฒ, ัะพะฑััะธั ะผะตััะธะบ)โ
โ  โโโ BypassFilter (TLS fragment/disorder/fake, ะฟะฐัะฐะผะตััะธะทัะตะผัะต โ
โ      ัะฐะทะผะตัั)                                                  โ
โ  โโโ BypassProfile (ะบะพะฝัะธะณััะฐัะธั)                              โ
โ  โโโ StrategyMapping (ะฑะปะพะบะธัะพะฒะบะฐ โ ัััะฐัะตะณะธั)                  โ
โ  โโโ WinDivertNative (P/Invoke)                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
* ะะฐะฝะตะปั Bypass Control ะฒ UI: ััะผะฑะปะตัั Fragment/Disorder/Fake/Drop RST/DoH, ะฑะตะนะดะถ ััะฐัััะฐ/latency, ะฒัะฟะฐะดะฐััะธะน ัะฟะธัะพะบ ะฟัะตัะตัะพะฒ ััะฐะณะผะตะฝัะฐัะธะธ (ััะฐะฝะดะฐัั/ัะผะตัะตะฝะฝัะน/ะฐะณัะตััะธะฒะฝัะน) ะธ ะผะตััะธะบะธ ััะฐะณะผะตะฝัะฐัะธะธ/RST.

ะะบััะฐะปะธะทะฐัะธั (Design Phase, 16.12.2025):
- ะะฒะตะดัะฝ ะดะธะทะฐะนะฝ-ะฟะปะฐะฝ โDPI Intelligence v2โ ะฒ docs/phase2_plan.md: ัะปะพะน ะผะตะถะดั ะดะธะฐะณะฝะพััะธะบะพะน ะธ ะพะฑัะพะดะพะผ.
- ะะปััะตะฒะพะต ะพัะปะธัะธะต: ัะธะณะฝะฐะปั ัะฐััะผะฐััะธะฒะฐัััั ะบะฐะบ **ัะตะฟะพัะบะธ ัะพะฑััะธะน ะฒะพ ะฒัะตะผะตะฝะธ** (ะฝะต ัะฐะทะพะฒัะน ัะฝะธะผะพะบ), ะฟัะฐะฒะธะปะฐ ะดะธะฐะณะฝะพะทะพะฒ ะฒะฝะตะดัััััั ะฟะพััะฐะฟะฝะพ (ัะฝะฐัะฐะปะฐ ัะพะปัะบะพ ะฟะพ ะดะพัััะฟะฝัะผ ะดะฐะฝะฝัะผ).
- ะ MVP ะทะฐะฟัะตััะฝ auto-apply: ะดะพะฟััะบะฐะตััั ัะพะปัะบะพ ัััะฝะพะต ะฟัะธะผะตะฝะตะฝะธะต ัะตะบะพะผะตะฝะดะฐัะธะน ะฟะพะปัะทะพะฒะฐัะตะปะตะผ.

ะะบััะฐะปะธะทะฐัะธั (Runtime, 16.12.2025):
- Step 1 v2 Signals ัะฐััะธัะฝะพ ะฟะพะดะบะปัััะฝ: `SignalsAdapterV2` ะฟะธัะตั ัะพะฑััะธั ะฒ `InMemorySignalSequenceStore` ะฝะฐ ััะฐะฟะต Classification ะฒ `LiveTestingPipeline`.
- Step 2 v2 Diagnosis ะฟะพะดะบะปัััะฝ: `StandardDiagnosisEngineV2` ััะฐะฒะธั ะดะธะฐะณะฝะพะท ะฟะพ `BlockageSignalsV2` ะธ ะฒะพะทะฒัะฐัะฐะตั ะฟะพััะฝะตะฝะธั, ะพัะฝะพะฒะฐะฝะฝัะต ะฝะฐ ัะฐะบัะฐั (DNS fail, timeout, retx-rate, HTTP redirect) ะฑะตะท ะฟัะธะฒัะทะบะธ ะบ ัััะฐัะตะณะธัะผ/ะพะฑัะพะดั.
- Step 3 v2 Selector ะฟะพะดะบะปัััะฝ: `StandardStrategySelectorV2` ัััะพะธั `BypassPlan` ัััะพะณะพ ะฟะพ `DiagnosisResult` (id + confidence) ะธ ะพัะดะฐัั ะบัะฐัะบัั ัะตะบะพะผะตะฝะดะฐัะธั ะดะปั UI-ะปะพะณะฐ (ะฑะตะท auto-apply).
- Step 4 v2 Executor (MVP) ะฟะพะดะบะปัััะฝ: `BypassExecutorMvp` ัะพัะผะธััะตั ะบะพะผะฟะฐะบัะฝัะน, ัะธัะฐะตะผัะน ะฟะพะปัะทะพะฒะฐัะตะปะตะผ ะฒัะฒะพะด (ะดะธะฐะณะฝะพะท + ัะฒะตัะตะฝะฝะพััั + 1 ะบะพัะพัะบะพะต ะพะฑัััะฝะตะฝะธะต + ัะฟะธัะพะบ ัััะฐัะตะณะธะน) ะธ **ะฝะต** ะฟัะธะผะตะฝัะตั ะพะฑัะพะด.
- ะะปั ะบะพะฝััะพะปั Gate 1โ2 ะฒ UI-ะปะพะณะต ะธัะฟะพะปัะทััััั ัััะพะบะธ ั ะฟัะตัะธะบัะพะผ `[V2][GATE1]` (ะฝะต ัะฐัะต 1 ัะฐะทะฐ ะฒ ะผะธะฝััั ะฝะฐ HostKey).

ะะฐัะบะตั (ะบะฐะบ ะพัะปะธัะธัั v2-ะฒัะฒะพะด ะพั legacy): ัััะพะบะธ ัะตะบะพะผะตะฝะดะฐัะธะน v2 ะฝะฐัะธะฝะฐัััั ั ะฟัะตัะธะบัะฐ `[V2]`.

ะัััะบะธะต ะทะฐัะธัั ัะตะปะตะบัะพัะฐ (MVP):
- `confidence < 50` โ ะฟัััะพะน ะฟะปะฐะฝ.
- `RiskLevel.High` ะทะฐะฟัะตััะฝ ะฟัะธ `confidence < 70`.
- ะะตัะตะฐะปะธะทะพะฒะฐะฝะฝัะต ัััะฐัะตะณะธะธ: warning + skip (ะฑะตะท ะธัะบะปััะตะฝะธะน), ะฑะตะท ะฟะฐะดะตะฝะธั ะฟะฐะนะฟะปะฐะนะฝะฐ.

ะัะธะผะตัะฐะฝะธะต (UI/ะธะดะตะฝัะธัะธะบะฐัะธั ัะพััะพะฒ): ะบะฐััะพัะบะธ ัะตะทัะปััะฐัะพะฒ ะฟัะธะฒัะทะฐะฝั ะบ **IP** (ััะฐะฑะธะปัะฝัะน ะบะปัั), ะฐ ะฒะฐัะธะฐะฝัั ะธะผะตะฝะธ (SNI / ะพะฑัะฐัะฝัะน ัะตะทะพะปะฒ) ะพัะพะฑัะฐะถะฐัััั ะบะฐะบ ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะฟะพะปั.
```

ะะบััะฐะปัะฝัะต ััะพัะฝะตะฝะธั (runtime):
- `Program.cs` ัะตะณะธัััะธััะตั `CodePagesEncodingProvider`, ััะพะฑั ัะฐะฑะพัะฐะปะธ OEM-ะบะพะดะธัะพะฒะบะธ (ะฝะฐะฟัะธะผะตั, CP866 ะดะปั `ipconfig /flushdns` ะธ `tracert` ะฝะฐ ััััะบะพะน Windows).
- `TrafficCollector` ะฝะต ัะพะทะดะฐัั UI-ัะพะฑััะธั ะดะปั loopback ะธ ะฟัะธะผะตะฝัะตั `UnifiedTrafficFilter` ะดะพ ะปะพะณะธัะพะฒะฐะฝะธั, ััะพะฑั ะฝะต ะพััะฐะฒะปััั ยซะฒะตัะฝัะตยป ะบะฐััะพัะบะธ ะดะปั ะพัะฑัะพัะตะฝะฝัั ัะตะปะตะน.

### 1.2 ะะปััะตะฒัะต ัะทะปั ั ะผะฐะบัะธะผะฐะปัะฝัะผ ัะธัะปะพะผ ัะฒัะทะตะน

| ะะพะผะฟะพะฝะตะฝั | ะัะพะดััะธั | ะััะพะดััะธั | ะะพะปั |
|-----------|----------|-----------|------|
| `MainViewModelRefactored` | 1 (MainWindow) | 3 (Bypass, Orchestrator, Results) | **ะะพะพัะดะธะฝะฐัะพั UI** |
| `DiagnosticOrchestrator` | 1 | 12+ | **ะฆะตะฝััะฐะปัะฝัะน ะพัะบะตัััะฐัะพั** |
| `TrafficEngine` | 4 | 3 | **WinDivert ะผะตะฝะตะดะถะตั** |
| `LiveTestingPipeline` | 1 | 6 | **Pipeline ะพะฑัะฐะฑะพัะบะธ** |
| `Config` | 10+ | 2 | **ะะปะพะฑะฐะปัะฝะฐั ะบะพะฝัะธะณััะฐัะธั** |
| `NoiseHostFilter` | 5 | 0 | **Singleton ัะธะปััั** |

### 1.3 ะกะบััััะต/ะณะปะพะฑะฐะปัะฝัะต ะทะฐะฒะธัะธะผะพััะธ

| ะะปะพะฑะฐะปัะฝัะน ัะปะตะผะตะฝั | ะัะฟะพะปัะทัะตััั ะฒ | ะะธัะบ |
|-------------------|----------------|------|
| `NoiseHostFilter.Instance` | TrafficCollector, TestResultsManager, LiveTestingPipeline | Singleton, ัะปะพะถะฝะพ ัะตััะธัะพะฒะฐัั |
| `Program.Targets` | Config.SetActiveProfile | ะกัะฐัะธัะตัะบะธะน ัะปะพะฒะฐัั ัะตะปะตะน |
| `FixService` (ัะฐะนะปั ะฑัะบะฐะฟะฐ) | BypassController | ะกะพััะพัะฝะธะต ะฝะฐ ะดะธัะบะต |
| `Config.ActiveProfile` | ะะฝะพะณะธะต ะบะพะผะฟะพะฝะตะฝัั | ะกัะฐัะธัะตัะบะพะต ัะฒะพะนััะฒะพ |

### 1.4 ะฆะธะบะปะธัะตัะบะธะต ะทะฐะฒะธัะธะผะพััะธ

**ะะฑะฝะฐััะถะตะฝะพ:** ะะะข ัะฒะฝัั ัะธะบะปะพะฒ ะฝะฐ ััะพะฒะฝะต ะบะปะฐััะพะฒ.

**ะะพัะตะฝัะธะฐะปัะฝัะน ัะธัะบ:** `DiagnosticOrchestrator` โ `TestResultsManager` โ ะพัะบะตัััะฐัะพั ะพะฑะฝะพะฒะปัะตั ัะตะทัะปััะฐัั, ัะตะทัะปััะฐัั ะผะพะณัั ััะธะณะณะตัะธัั retest ัะตัะตะท BypassController.

---

## 2. ะัััะฒัะน ะบะพะด

### 2.1 ะะตะธัะฟะพะปัะทัะตะผัะต ัะฐะนะปั (ะบะปะฐััั ะฟะพะปะฝะพัััั ะผัััะฒัะต)

| ะคะฐะนะป | ะัะธัะธะฝะฐ | ะะตะทะพะฟะฐัะฝะพััั ัะดะฐะปะตะฝะธั |
|------|---------|----------------------|
| `TargetCatalog.cs` | ะัััะพะน ัะฐะนะป (ะบะพะผะผะตะฝัะฐัะธะน "ัะดะฐะปัะฝ") | โ ะะตะทะพะฟะฐัะฝะพ |
| `Wpf/ServiceItemViewModel.cs` | 0 usages ะฒ ะบะพะดะต, ัะพะปัะบะพ ะดะพะบัะผะตะฝัะฐัะธั | โ ะะตะทะพะฟะฐัะฝะพ |
| `Windows/CapturedTargetsWindow.xaml(.cs)` | ะะธะณะดะต ะฝะต ะพัะบััะฒะฐะตััั | โ ะะตะทะพะฟะฐัะฝะพ |
| `Utils/GuiProfileStorage.cs` | 0 usages | โ ะะตะทะพะฟะฐัะฝะพ |
| `Utils/DnsFixApplicator.cs` | ะัะฑะปะธััะตั FixService, 0 usages | โ ะะตะทะพะฟะฐัะฝะพ |
| `Utils/BypassStrategyPlanner.cs` | 0 usages, ะทะฐะผะตะฝัะฝ StrategyMapping | โ ะะตะทะพะฟะฐัะฝะพ |
| `Utils/NetworkMonitorService.cs` | ะะฐะผะตะฝัะฝ TrafficEngine, 0 usages | โ ะะตะทะพะฟะฐัะฝะพ |
| `Utils/ProblemClassifier.cs` | 0 usages, ะทะฐะผะตะฝัะฝ StandardBlockageClassifier | โ ะะตะทะพะฟะฐัะฝะพ |

### 2.2 ะัััะฒัะต ัะตััะพะฒัะต ะบะปะฐััั (Tests/)

**ะะะะขะะงะะ:** ะัะต ะบะปะฐััั ะฒ `Tests/` ะะ ะฒัะทัะฒะฐัััั ะธะท ะฟัะพะดะฐะบัะฝ ะบะพะดะฐ!

| ะคะฐะนะป | ะกัะฐััั | ะะฑะพัะฝะพะฒะฐะฝะธะต |
|------|--------|-------------|
| `Tests/DnsTest.cs` | โ ะะะะขะะซะ | `new DnsTest()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/TcpTest.cs` | โ ะะะะขะะซะ | `new TcpTest()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/HttpTest.cs` | โ ะะะะขะะซะ | `new HttpTest()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/TracerouteTest.cs` | โ ะะะะขะะซะ | `new TracerouteTest()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/UdpProbeRunner.cs` | โ ะะะะขะะซะ | `new UdpProbeRunner()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/RstHeuristic.cs` | โ ะะะะขะะซะ | `new RstHeuristic()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/FirewallTest.cs` | โ ะะะะขะะซะ | `new FirewallTest()` ะฝะธะณะดะต ะฝะต ัะพะทะดะฐัััั |
| `Tests/TestProgress.cs` | โ๏ธ ะงะะกะขะะงะะ | `TestKind` enum ะะ ะธัะฟะพะปัะทัะตััั ะฒ ะบะพะดะต |

**ะัะฒะพะด:** ะะพะณะธะบะฐ ัะตััะธัะพะฒะฐะฝะธั ะฟะตัะตะฝะตัะตะฝะฐ ะฒ `Core/Modules/StandardHostTester.cs`. ะกัะฐััะต ัะตััั โ legacy.

### 2.3 ะะตะธัะฟะพะปัะทัะตะผัะต JSON-ัะฐะนะปั

| ะคะฐะนะป | ะกัะฐััั | ะะตะบะพะผะตะฝะดะฐัะธั |
|------|--------|--------------|
| `game_targets.json` | ะัััะพะน (`"targets": []`) | โ ะฃะดะฐะปะธัั |
| `bypass_profile_fshud_google.json` | 0 usages | โ๏ธ ะฃะดะฐะปะธัั ะธะปะธ ะทะฐะดะพะบัะผะตะฝัะธัะพะฒะฐัั |

### 2.4 ะะตะธัะฟะพะปัะทัะตะผัะต ะผะตัะพะดั ะธ ัะฒะพะนััะฒะฐ

| ะะปะฐัั | ะะตัะพะด/ะกะฒะพะนััะฒะพ | ะัะธัะธะฝะฐ |
|-------|---------------|---------|
| `Config` | `NoTrace` | Legacy, ะฝะธะบะพะณะดะฐ ะฝะต ัะธัะฐะตััั |
| `Config` | `Ports` | ะะต ะธัะฟะพะปัะทัะตััั (ะฟะพััั ะฒ ะฟัะพัะธะปะต) |
| `Config` | `UdpProbes` | ะะต ะธัะฟะพะปัะทัะตััั |
| `TargetDefinition` | `Ports`, `Protocols` | ะะฑััะฒะปะตะฝั, ะฝะพ ะฝะต ัะธัะฐัััั |
| `TestKind` (enum) | `FIREWALL, ISP, ROUTER, SOFTWARE` | ะะฝะฐัะตะฝะธั ะฝะธะบะพะณะดะฐ ะฝะต ะธัะฟะพะปัะทััััั |

### 2.5 Unreachable ะบะพะด

| ะคะฐะนะป | ะกััะพะบะธ | ะะฟะธัะฐะฝะธะต |
|------|--------|----------|
| `FirewallTest.cs` | 450+ | Unit-ัะตััั ะฒะฝัััะธ ะบะปะฐััะฐ (ะฝะธะบะพะณะดะฐ ะฝะต ะฒัะทัะฒะฐัััั) |

---

## 3. ะขะตัะฝะธัะตัะบะธะน ะดะพะปะณ

### 3.1 ะัะฑะปะธััััะฐััั ะปะพะณะธะบะฐ

| ะัะพะฑะปะตะผะฐ | ะคะฐะนะปั | ะะตะบะพะผะตะฝะดะฐัะธั |
|----------|-------|--------------|
| DNS ัะตะทะพะปะฒ | `StandardHostTester`, `DnsTest`, `NetUtils` | ะฃะฝะธัะธัะธัะพะฒะฐัั ะฒ `NetUtils` |
| TLS handshake | `StandardHostTester`, `HttpTest` | ะัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ `StandardHostTester` |
| ะะปะฐััะธัะธะบะฐัะธั ะฑะปะพะบะธัะพะฒะพะบ | `StandardBlockageClassifier`, `ProblemClassifier` | ะฃะดะฐะปะธัั `ProblemClassifier` |
| DNS fix | `FixService`, `DnsFixApplicator` | ะฃะดะฐะปะธัั `DnsFixApplicator` |

### 3.2 ะะฐัััะตะฝะธั SRP (Single Responsibility)

| ะะปะฐัั | ะัะพะฑะปะตะผะฐ | ะะฐะทะผะตั |
|-------|----------|--------|
| `DiagnosticOrchestrator` | ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะพะฑัะทะฐะฝะฝะพััะตะน: UI, overlay, ะฟัะพัะตััั, WinDivert | 824 ัััะพะบะธ |
| `TestResultsManager` | ะะฐััะธะฝะณ + ััะฐะฝะตะฝะธะต + ะทะดะพัะพะฒัะต + UI ะพะฑะฝะพะฒะปะตะฝะธั | 717 ัััะพะบ |
| `BypassController` | Bypass + DoH + VPN ะดะตัะตะบั + ัะพะฒะผะตััะธะผะพััั | 647 ัััะพะบ |

### 3.3 ะฅะฐะพัะธัะฝัะต ะทะฐะฒะธัะธะผะพััะธ

| ะัะพะฑะปะตะผะฐ | ะะตัะฐะปะธ |
|----------|--------|
| Namespace ัะผะตัะธะฒะฐะฝะธะต | `IspAudit`, `ISPAudit`, `ISPAudit.ViewModels`, `IspAudit.Utils` |
| ะะปะพะฑะฐะปัะฝะพะต ัะพััะพัะฝะธะต | `Program.Targets`, `Config.ActiveProfile`, `NoiseHostFilter.Instance` |
| ะัะฑะปะธัะพะฒะฐะฝะธะต ะผะพะดะตะปะตะน | `Target` (Models/), `TargetDefinition` (root), `Target` (ISPAudit.Models) |

### 3.4 ะขัะตะฑััั ัะตัะฐะบัะพัะธะฝะณะฐ

| ะคะฐะนะป | ะัะธะพัะธัะตั | ะัะธัะธะฝะฐ |
|------|-----------|---------|
| `DiagnosticOrchestrator.cs` | ๐ด ะััะพะบะธะน | ะะฐะทะดะตะปะธัั ะฝะฐ StartupManager, OverlayManager, ProcessMonitor |
| `TestResultsManager.cs` | ๐ด ะััะพะบะธะน | ะัะดะตะปะธัั ะฟะฐััะตั ัะพะพะฑัะตะฝะธะน ะฒ ะพัะดะตะปัะฝัะน ะบะปะฐัั |
| ะะตัั `Tests/` | ๐ก ะกัะตะดะฝะธะน | ะฃะดะฐะปะธัั ะธะปะธ ะฟะตัะตะฝะตััะธ ะฒ unit-tests |
| `Config.cs` | ๐ก ะกัะตะดะฝะธะน | ะฃะฑัะฐัั ะฝะตะธัะฟะพะปัะทัะตะผัะต ัะฒะพะนััะฒะฐ |

---

## 4. ะฃััะฐัะตะฒัะธะต ัะปะตะผะตะฝัั (Legacy)

### 4.1 ะะพะฝัะธะณััะฐัะธะพะฝะฝัะต ะฟะฐัะฐะผะตััั

| ะะฐัะฐะผะตัั | ะคะฐะนะป | ะกัะฐััั |
|----------|------|--------|
| `Config.NoTrace` | Config.cs | Legacy, ะฝะต ะธัะฟะพะปัะทัะตััั |
| `Config.EnableRst` | Config.cs | ะัะบะปััะตะฝะพ, RST ัะตัะตะท TrafficEngine |
| `TestKind.FIREWALL/ISP/ROUTER/SOFTWARE` | TestProgress.cs | ะะธะบะพะณะดะฐ ะฝะต ะธัะฟะพะปัะทััััั |

### 4.2 ะฃััะฐัะตะฒัะธะต API/ะฟะฐััะตัะฝั

| ะะฐััะตัะฝ | ะะดะต | ะะตะบะพะผะตะฝะดะฐัะธั |
|---------|-----|--------------|
| `.Result` / `.Wait()` ะฝะฐ async | UdpProbeRunner.cs | ะะฐะผะตะฝะธัั ะฝะฐ `await` |
| ะกะผะตัะธะฒะฐะฝะธะต sync/async | FixService | ะะพะปะฝะพัััั async |
| WMI ะดะปั Firewall | FirewallTest | ะะต ะธัะฟะพะปัะทัะตััั ะฒ ะฝะพะฒะพะน ะฐััะธัะตะบัััะต |

### 4.3 ะะพะบัะผะตะฝัะฐัะธั vs ัะตะฐะปัะฝะพััั

| ะะพะบัะผะตะฝั | ะัะพะฑะปะตะผะฐ |
|----------|----------|
| `CLAUDE.md` | ะฃะฟะพะผะธะฝะฐะตั `DnsTest`, `TcpTest` ะธ ะดั. ะบะฐะบ ะฐะบัะธะฒะฝัะต |
| `.github/copilot-instructions.md` | ะกััะปะบะธ ะฝะฐ ะฝะตัััะตััะฒัััะธะน `AuditRunner`, `ReportWriter` |

> โ `ARCHITECTURE_V2.md` ัะดะฐะปัะฝ (10.12.2025), ะฐะบััะฐะปัะฝัะน โ `ARCHITECTURE_CURRENT.md`

---

## 5. ะะพัะตะฝัะธะฐะปัะฝัะต ัะธัะบะธ

### 5.1 ๐ด ะัะธัะธัะตัะบะธะต runtime ะฟัะพะฑะปะตะผั (ะะะะะะะะะ)

#### 5.1.1 `dnsOk=true` ะฒัะตะณะดะฐ ะฒ StandardHostTester

**ะคะฐะนะป:** `Core/Modules/StandardHostTester.cs:24-25`

```csharp
bool dnsOk = true;
string dnsStatus = "OK";
// ะญัะธ ะทะฝะฐัะตะฝะธั ะะะะะะะ ะฝะต ะผะตะฝััััั!
```

**ะัะพะฑะปะตะผะฐ:** ะัะธ ะพัะธะฑะบะต DNS (ัััะพะบะธ 44-60) ะฒัะฟะพะปะฝัะตััั `catch { }` ะฑะตะท ะธะทะผะตะฝะตะฝะธั `dnsOk`. ะะปะฐััะธัะธะบะฐัะพั ะฒัะตะณะดะฐ ะฟะพะปััะฐะตั `dnsOk=true`, ะดะฐะถะต ะตัะปะธ DNS ะฝะต ัะฐะฑะพัะฐะตั.

**ะะปะธัะฝะธะต:** DNS ะฑะปะพะบะธัะพะฒะบะธ ะฝะต ะดะตัะตะบัะธัััััั.

---

#### 5.1.2 `async void` ะฒ InitializeOnStartupAsync

**ะคะฐะนะป:** `ViewModels/BypassController.cs:291`

```csharp
public async void InitializeOnStartupAsync()
{
    // ะะบะปััะฐะตั Disorder + DROP_RST ะฟะพ ัะผะพะปัะฐะฝะธั (ัััะพะบะธ 307-310)
    _isDisorderEnabled = true;
    _isDropRstEnabled = true;
}
```

**ะัะพะฑะปะตะผั:**
- ะัะบะปััะตะฝะธั ะฝะต ะฟัะพะฑัะฐััะฒะฐัััั (ะฟัะพะณะปะฐััะฒะฐัััั runtime)
- ะัะทัะฒะฐััะธะน ะบะพะด ะฝะต ะผะพะถะตั `await`
- Bypass ะฒะบะปััะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฑะตะท ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั

---

#### 5.1.3 ะกะธะฝััะพะฝะฝัะต ะปะพะณะธ ะฝะฐ Desktop

**ะคะฐะนะป:** `App.xaml.cs:7-8, 12, 16, 22, 31, 33-34, 42, 46, 49, 53`

```csharp
var logPath = Path.Combine(Environment.GetFolderPath(SpecialFolder.Desktop), "isp_audit_debug.txt");
File.AppendAllText(logPath, "...");  // ะกะธะฝััะพะฝะฝะพ, 10+ ะฒัะทะพะฒะพะฒ!
```

**ะัะพะฑะปะตะผั:**
- ะะปะพะบะธัะพะฒะบะฐ UI ะฟะพัะพะบะฐ ะฟัะธ ะบะฐะถะดะพะผ ััะฐััะต
- ะััะพั ะฝะฐ ัะฐะฑะพัะตะผ ััะพะปะต ะฟะพะปัะทะพะฒะฐัะตะปั (`isp_audit_debug.txt`)
- ะะพะทะผะพะถะฝัะต ะพัะธะฑะบะธ ะดะพัััะฟะฐ (Desktop ะฝะฐ ัะตัะตะฒะพะผ ะดะธัะบะต, ะฟัะฐะฒะฐ)

---

### 5.2 ๐ก ะกัะตะดะฝะธะต runtime ะฟัะพะฑะปะตะผั

#### 5.2.1 Unbounded channels ะฑะตะท back-pressure

**ะคะฐะนะปั:** `Utils/LiveTestingPipeline.cs:97-99`, `Utils/TrafficCollector.cs:102`

```csharp
_snifferQueue = Channel.CreateUnbounded<HostDiscovered>();
_testerQueue = Channel.CreateUnbounded<HostTested>();
_bypassQueue = Channel.CreateUnbounded<HostBlocked>();
// + TrafficCollector.cs:102
```

**ะะธัะบ:** ะัะธ ะฒัะฟะปะตัะบะต ััะฐัะธะบะฐ (ัััััะธ ัะพะตะดะธะฝะตะฝะธะน) ะฒะพะทะผะพะถะตะฝ OOM.  
**ะะธัะธะณะฐัะธั:** ะะฐ ะฟัะฐะบัะธะบะต ัะตะดะบะพ ะฑะพะปััะต 100-200 ัะพััะพะฒ, ะฝะพ ะปัััะต ะธัะฟะพะปัะทะพะฒะฐัั `BoundedChannel`.

---

#### 5.2.2 TLS ะฑะตะท hostname ััะธัะฐะตััั OK

**ะคะฐะนะป:** `Core/Modules/StandardHostTester.cs:148-150`

```csharp
else if (host.RemotePort == 443)
{
    // ะะต ะผะพะถะตะผ ะฟัะพะฒะตัะธัั TLS ะฑะตะท hostname
    tlsOk = tcpOk;
}
```

**ะัะพะฑะปะตะผะฐ:** TLS DPI ะดะปั IP-only ัะพะตะดะธะฝะตะฝะธะน ะฝะต ะดะตัะตะบัะธััะตััั.  
**ะะฑะพัะฝะพะฒะฐะฝะธะต:** ะะตะท SNI ะฝะตะฒะพะทะผะพะถะฝะพ ะบะพััะตะบัะฝะพ ะฟัะพะฒะตัะธัั TLS โ ัะฐััะธัะฝะพ ะพะฟัะฐะฒะดะฐะฝะพ.

---

### 5.3 Silent failures

| ะะธัะบ | ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|------|----------|
| DNS timeout ะฑะตะท ะปะพะณะฐ | StandardHostTester.cs:48 | `GetHostEntryAsync` ะผะพะถะตั ะผะพะปัะฐ timeout |
| WinDivert errors | TrafficEngine.cs | ะัะธะฑะบะธ ะพัะบัััะธั handle ะฟัะพะณะปะฐััะฒะฐัััั |
| Backup file corruption | FixService | ะะต ะฒะฐะปะธะดะธััะตััั JSON ะฑัะบะฐะฟ |
| ะคะพะฝะพะฒัะต ะธัะบะปััะตะฝะธั | DiagnosticOrchestrator, LiveTestingPipeline | `DispatcherUnhandledException` ะปะพะฒะธั ัะพะปัะบะพ UI-ะฟะพัะพะบ |

### 5.4 ะะฑัะฐะฑะพััะธะบะธ, ะบะพัะพััะต ะฝะต ะฒัะทะพะฒัััั

| Handler | ะัะธัะธะฝะฐ |
|---------|---------|
| `OnDnsLookupFailed` ะฒ DnsParserService | ะะพะดะฟะธัะบะฐ ัะพะทะดะฐัััั, ะฝะพ UI ะฝะต ะพะฑัะฐะฑะฐััะฒะฐะตั |
| `OnHostnameResolved` ะฒ TrafficCollector | ะกะพะฑััะธะต ะพะฑััะฒะปะตะฝะพ, ะฝะพ ะฟะพะดะฟะธััะธะบะพะฒ ะฝะตั |

### 5.5 ะัะบะปััะตะฝะธั, ะบะพัะพััะต ะฝะต ะผะพะณัั ะฒะพะทะฝะธะบะฝััั

| Exception | ะคะฐะนะป | ะัะธัะธะฝะฐ |
|-----------|------|---------|
| `UnauthorizedAccessException` ะฒ FirewallTest | ะะปะฐัั ะฝะต ะฒัะทัะฒะฐะตััั |
| ะัะต try/catch ะฒ Tests/*.cs | ะะพะด ะผัััะฒัะน |

### 5.6 ะะฐััะพะถะดะตะฝะธั ัะธะฟะพะฒ

| ะัะพะฑะปะตะผะฐ | ะะตัะฐะปะธ |
|----------|--------|
| `Target` vs `TargetDefinition` | ะะฒะฐ ัะฐะทะฝัั ัะธะฟะฐ ะดะปั ะพะดะฝะพะณะพ ะธ ัะพะณะพ ะถะต |
| `TransportProtocol` ะดัะฑะปะธัะพะฒะฐะฝะธะต | `Utils/NetworkConnection.cs` ะธ `Bypass/BypassRedirectRule.cs` |
| `BlockageType` ะดัะฑะปะธัะพะฒะฐะฝะธะต | `ProblemClassifier` ะธ `Core/Models` |

---

## 6. ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะพัะธััะบะต

### 6.1 ะะตะผะตะดะปะตะฝะฝะพะต ัะดะฐะปะตะฝะธะต (ะฝะธะทะบะธะน ัะธัะบ)

```
ะฃะดะฐะปะธัั:
โโโ TargetCatalog.cs (ะฟัััะพะน)
โโโ Wpf/ServiceItemViewModel.cs
โโโ Windows/CapturedTargetsWindow.xaml(.cs)
โโโ Utils/GuiProfileStorage.cs
โโโ Utils/DnsFixApplicator.cs
โโโ Utils/BypassStrategyPlanner.cs
โโโ Utils/NetworkMonitorService.cs
โโโ Utils/ProblemClassifier.cs
โโโ game_targets.json
โโโ bypass_profile_fshud_google.json
```

**ะะปะธัะฝะธะต:** ะัะปะตะฒะพะต โ ะบะพะด ะฝะต ะธัะฟะพะปัะทัะตััั.

### 6.2 ะะธะณัะฐัะธั Tests/ (ััะตะดะฝะธะน ัะธัะบ)

```
Tests/ โ ะะฐัะธะฐะฝัั:
1. ะฃะดะฐะปะธัั ะฟะพะปะฝะพัััั (ะปะพะณะธะบะฐ ะฒ Core/Modules)
2. ะะตัะตะฝะตััะธ ะฒ ISP_Audit.Tests/ ะบะฐะบ unit-ัะตััั
3. ะััะฐะฒะธัั ะบะฐะบ "ัะฟัะฐะฒะพัะฝัะต ะฟัะธะผะตัั" ะฒ docs/legacy/
```

**ะะปะธัะฝะธะต:** ะะพัะตัั "ัะฟัะฐะฒะพัะฝะพะณะพ ะบะพะดะฐ", ะฝะพ ะพะฝ ัะถะต ะฝะต ัะฐะฑะพัะฐะตั.

### 6.3 ะะตัะฐะบัะพัะธะฝะณ Config (ะฝะธะทะบะธะน ัะธัะบ)

```csharp
// ะฃะดะฐะปะธัั ะฝะตะธัะฟะพะปัะทัะตะผัะต:
- NoTrace
- UdpProbes (ะตัะปะธ ะฝะต ะฟะปะฐะฝะธััะตััั)
- Ports (ะฟะพััั ะฒ ะฟัะพัะธะปัั)
```

### 6.4 Namespace ัะฝะธัะธะบะฐัะธั (ะฒััะพะบะธะน ัะธัะบ)

```
ะขะตะบััะตะต:
IspAudit, ISPAudit, ISPAudit.ViewModels, IspAudit.Utils

ะะตะบะพะผะตะฝะดะฐัะธั:
IspAudit.* ะฒะตะทะดะต (ะตะดะธะฝัะน ัะตะณะธััั)
```

**ะะธัะบ:** ะขัะตะฑัะตั ะธะทะผะตะฝะตะฝะธั ะฒัะตั ัะฐะนะปะพะฒ.

### 6.5 ะะพะบัะผะตะฝัะฐัะธั

```
ะะฑะฝะพะฒะธัั:
- CLAUDE.md โ ัะฑัะฐัั ัััะปะบะธ ะฝะฐ ะผัััะฒัะน ะบะพะด
- [x] .github/copilot-instructions.md โ ะฐะบััะฐะปะธะทะธัะพะฒะฐัั ะฐััะธัะตะบัััั (ะัะฟะพะปะฝะตะฝะพ 10.12.2025)
- [x] ะะพะฑะฐะฒะธัั ARCHITECTURE_ACTUAL.md ั ัะตะบััะธะผ ัะพััะพัะฝะธะตะผ (ะกะพะทะดะฐะฝ ARCHITECTURE_CURRENT.md 10.12.2025)
```

---

## 7. ะะฐััะฐ ะทะฐะฒะธัะธะผะพััะตะน (ัะตะบััะพะฒะฐั)

```
Program.cs
โโโ Config.SetActiveProfile
    โโโ DiagnosticProfile (Profiles/Default.json)
โโโ App.xaml
    โโโ MainWindow.xaml
        โโโ MainViewModelRefactored
            โโโ BypassController
            โ   โโโ TlsBypassService
            โ   โ   โโโ TrafficEngine
            โ   โ   โ   โโโ BypassFilter
            โ   โโโ FixService
            โโโ DiagnosticOrchestrator
            โ   โโโ TrafficCollector
            โ   โ   โโโ ConnectionMonitorService
            โ   โ   โ   โโโ TcpConnectionWatcher
            โ   โ   โโโ PidTrackerService
            โ   โ   โโโ DnsParserService
            โ   โ       โโโ TrafficMonitorFilter
            โ   โโโ LiveTestingPipeline
            โ   โ   โโโ StandardHostTester
            โ   โ   โโโ StandardBlockageClassifier
            โ   โ   โ   โโโ InMemoryBlockageStateStore
            โ   โ   โ       โโโ TcpRetransmissionTracker
            โ   โ   โ       โโโ HttpRedirectDetector
            โ   โ   โ       โโโ RstInspectionService
            โ   โ   โ       โโโ UdpInspectionService
            โ   โ   โโโ UnifiedTrafficFilter
            โ   โ       โโโ NoiseHostFilter
            โ   โโโ TrafficEngine (shared)
            โโโ TestResultsManager
                โโโ NoiseHostFilter.Instance

ะะะะะะะฌะะซะ:
- Config.ActiveProfile (static)
- Program.Targets (static)
- NoiseHostFilter.Instance (singleton)

ะัะธะผะตัะฐะฝะธะต (16.12.2025):
- ะะพะฑะฐะฒะปะตะฝ ะบะพะฝััะฐะบัะฝัะน ัะปะพะน DPI Intelligence v2: `Core/IntelligenceV2/Contracts` (ะผะพะดะตะปะธ Signals/Diagnosis/Strategy).
- ะญัะพ ะบะพะฝััะฐะบัั (DTO/enum/ะบะพะฝััะฐะฝัั), ะฑะตะท ะทะฐะฒะธัะธะผะพััะตะน ะฝะฐ UI/Bypass/WinDivert; ะฟะพะดะบะปััะตะฝะธะต ะฒ runtime ะฑัะดะตั ะฒัะฟะพะปะฝััััั ะฒ ัะปะตะดัััะธั ัะฐะณะฐั (SignalsAdapter โ Diagnosis โ Selector โ Executor).
```

---

## 8. ะัะพะณะพะฒะฐั ััะฐัะธััะธะบะฐ

| ะะตััะธะบะฐ | ะะฝะฐัะตะฝะธะต |
|---------|----------|
| ะัะตะณะพ .cs ัะฐะนะปะพะฒ | ~86 |
| ะัััะฒัั ัะฐะนะปะพะฒ | **15** (17%) |
| ะัััะฒัั ะบะปะฐััะพะฒ | **18+** |
| ะัะฑะปะธััััะตะนัั ะปะพะณะธะบะธ | **4 ะพะฑะปะฐััะธ** |
| Legacy ะฟะฐัะฐะผะตััะพะฒ | **6+** |
| Runtime ะฟัะพะฑะปะตะผ | **5** (3 ะบัะธัะธัะฝัะต) |
| ะะธัะบะพะฒ silent failure | **3** |

---

## 9. ะัะธะพัะธัะตัั ะธัะฟัะฐะฒะปะตะฝะธะน

### ๐ด ะะะะะะะะะะ (ะฑะปะพะบะธััะตั ััะฝะบัะธะพะฝะฐะป)

| # | ะัะพะฑะปะตะผะฐ | ะคะฐะนะป | ะัะฟัะฐะฒะปะตะฝะธะต |
|---|----------|------|-------------|
| 1 | `dnsOk=true` ะฒัะตะณะดะฐ | StandardHostTester.cs:24-60 | ะะพะฑะฐะฒะธัั `dnsOk=false` ะฒ catch-ะฑะปะพะบ |
| 2 | `async void` | BypassController.cs:291 | ะะทะผะตะฝะธัั ะฝะฐ `async Task`, ัะฑัะฐัั ะฐะฒัะพะฒะบะปััะตะฝะธะต |
| 3 | ะะพะณะธ ะฝะฐ Desktop | App.xaml.cs | ะฃะดะฐะปะธัั ะธะปะธ ะฟะตัะตะผะตััะธัั ะฒ %TEMP%/logs |

### ๐ก ะะซะกะะะะ ะะะะะะะขะะข (1-2 ะดะฝั)

| # | ะัะพะฑะปะตะผะฐ | ะคะฐะนะป | ะัะฟัะฐะฒะปะตะฝะธะต |
|---|----------|------|-------------|
| 4 | Unbounded channels | LiveTestingPipeline.cs | ะะฐะผะตะฝะธัั ะฝะฐ `BoundedChannel` (capacity: 1000) |
| 5 | TLS ะฑะตะท hostname | StandardHostTester.cs:148 | ะะพะฑะฐะฒะธัั `tlsStatus = "SKIPPED (no hostname)"` |

### ะคะฐะทะฐ 1 (2-3 ะดะฝั): ะัะธััะบะฐ ะผัััะฒะพะณะพ ะบะพะดะฐ
1. ะฃะดะฐะปะธัั 100% ะผัััะฒัั ัะฐะนะปะพะฒ ะธะท ัะฐะทะดะตะปะฐ 6.1
2. ะฃะดะฐะปะธัั ะฝะตะธัะฟะพะปัะทัะตะผัะต ัะฒะพะนััะฒะฐ ะฒ `Config`
3. ะะฑะฝะพะฒะธัั `CLAUDE.md`

### ะคะฐะทะฐ 2 (3-5 ะดะฝะตะน): ะะตัะฐะบัะพัะธะฝะณ
1. ะะฐะทะดะตะปะธัั `DiagnosticOrchestrator` ะฝะฐ ะบะพะผะฟะพะฝะตะฝัั
2. ะฃะฝะธัะธัะธัะพะฒะฐัั namespace (`IspAudit` vs `ISPAudit`)
3. ะฃะดะฐะปะธัั ะธะปะธ ะฟะตัะตะฝะตััะธ `Tests/`

### ะคะฐะทะฐ 3 (ะพะฟัะธะพะฝะฐะปัะฝะพ): ะะฟัะธะผะธะทะฐัะธั
1. ะฃัััะฐะฝะธัั ะณะปะพะฑะฐะปัะฝัะต ัะธะฝะณะปัะพะฝั
2. ะะพะฑะฐะฒะธัั DI ะบะพะฝัะตะนะฝะตั
3. ะะพะปะฝะพะต ะฟะพะบัััะธะต unit-ัะตััะฐะผะธ

---

**ะกัะฐััั ะดะพะบัะผะตะฝัะฐ:** ะะบััะฐะปะตะฝ ะฝะฐ 12.12.2025 (TLS bypass Phase2)
**ะัะธััะบะฐ ะดะพะบัะผะตะฝัะฐัะธะธ:** ะัะฟะพะปะฝะตะฝะฐ (79 โ 25 .md ัะฐะนะปะพะฒ)

---

## 10. ะัะฟะพะปะฝะตะฝะฝัะต ัะฐะฑะพัั (10.12.2025)

### ะัะธัะธัะตัะบะธะต ะธัะฟัะฐะฒะปะตะฝะธั (Phase 1)
- [x] ะัะฟัะฐะฒะปะตะฝะฐ ะปะพะณะธะบะฐ DNS ะฒ `StandardHostTester.cs` (ัะตะฟะตัั `dnsOk=false` ะฟัะธ ะพัะธะฑะบะต).
- [x] ะัะฟัะฐะฒะปะตะฝ `async void` ะฒ `BypassController.cs` (ะทะฐะผะตะฝะตะฝ ะฝะฐ `async Task`).
- [x] ะฃะดะฐะปะตะฝะพ ัะธะฝััะพะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฝะฐ ะะฐะฑะพัะธะน ััะพะป ะฒ `App.xaml.cs`.
- [x] ะะณัะฐะฝะธัะตะฝ ัะฐะทะผะตั ะบะฐะฝะฐะปะพะฒ (Channels) ะฒ `LiveTestingPipeline.cs` ะธ `TrafficCollector.cs` (BoundedChannel).

### ะัะธััะบะฐ ะผัััะฒะพะณะพ ะบะพะดะฐ (Phase 2)
- [x] ะฃะดะฐะปะตะฝั ะฝะตะธัะฟะพะปัะทัะตะผัะต ัะฐะนะปั: `TargetCatalog.cs`, `Wpf/ServiceItemViewModel.cs`, `Windows/CapturedTargetsWindow.xaml`, `Utils/GuiProfileStorage.cs`, `Utils/DnsFixApplicator.cs`, `Utils/BypassStrategyPlanner.cs`, `Utils/NetworkMonitorService.cs`, `Utils/ProblemClassifier.cs`.
- [x] ะฃะดะฐะปะตะฝั ะฝะตะธัะฟะพะปัะทัะตะผัะต ัะตััััั: `game_targets.json`, `bypass_profile_fshud_google.json`.
- [x] ะัะธัะตะฝ `Config.cs` (ัะดะฐะปะตะฝั `NoTrace`, `Ports`, `UdpProbes`).
- [x] ะฃะดะฐะปะตะฝะฐ ะฟะฐะฟะบะฐ `Tests/` (ะปะพะณะธะบะฐ ะฟะตัะตะฝะตัะตะฝะฐ ะฒ `Core/Modules`).

### ะะพะบัะผะตะฝัะฐัะธั (Phase 3)
- [x] ะกะพะทะดะฐะฝ `ARCHITECTURE_CURRENT.md` (v3.0 Extended) โ ะฟะพะปะฝะพะต ะพะฟะธัะฐะฝะธะต ัะตะบััะตะน ะฐััะธัะตะบัััั.
- [x] ะะฑะฝะพะฒะปะตะฝ `README.md`:
    - ะะฐะผะตะฝะตะฝะฐ ASCII ััะตะผะฐ ะฝะฐ Mermaid ะดะธะฐะณัะฐะผะผั.
    - ะะฑะฝะพะฒะปะตะฝะฐ ัะฐะฑะปะธัะฐ ะบะปััะตะฒัั ะบะพะผะฟะพะฝะตะฝัะพะฒ.
    - ะัะฟัะฐะฒะปะตะฝะฐ ัะฒัะทั `BypassController` (ะฟะตัะตะฝะตัะตะฝ ะธะท Network Layer ะฒ UI Layer).
- [x] ะะฑะฝะพะฒะปะตะฝ `.github/copilot-instructions.md`:
    - ะะพัะผะฐะปะธะทะพะฒะฐะฝ ัะทัะบ (ััััะบะธะน).
    - ะะฑะฝะพะฒะปะตะฝะฐ ะบัะฐัะบะฐั ะฐััะธัะตะบัััะฐ.
    - ะฃะดะฐะปะตะฝั ัััะฐัะตะฒัะธะต ัะฐะทะดะตะปั.
- [x] ะะตัะธัะธะบะฐัะธั ะฐััะธัะตะบัััั:
    - ะัะพะฒะตัะตะฝะพ ัะพะพัะฒะตัััะฒะธะต ะดะธะฐะณัะฐะผะผั ะบะพะดั (`MainViewModelRefactored`, `DiagnosticOrchestrator`, `LiveTestingPipeline`).
- [x] ะฃะฝะธัะธะบะฐัะธั ะฟัะพัััะฐะฝััะฒ ะธะผะตะฝ (Namespaces):
    - ะัะธะฒะตะดะตะฝะพ ะบ ะตะดะธะฝะพะผั ััะธะปั (ะฒัะฑัะฐะฝ `IspAudit`).

---

## 11. ะะฑะฝะพะฒะปะตะฝะธั TLS bypass (12.12.2025)

- **ะััะธัะตะบัััะฐ**: `TlsBypassService` โ ะตะดะธะฝัะน ะธััะพัะฝะธะบ ะพะฟัะธะน/ะฟัะตัะตัะพะฒ, ัะฐะผ ัะตะณะธัััะธััะตั `BypassFilter`, ะฟัะฑะปะธะบัะตั `MetricsUpdated/VerdictChanged/StateChanged`; `BypassController` ััะฐะป ะฟัะพะบัะธ ะฑะตะท ัะฐะนะผะตัะฐ (ััะผะฑะปะตัั + ัะพััะฐะฝะตะฝะธะต ะฟัะตัะตัะฐ/ะฐะฒัะพะบะพััะตะบัะธะธ).
- **ะัะพัะธะปั**: `bypass_profile.json` ัะฐััะธัะตะฝ TTL-ะฝะฐัััะพะนะบะฐะผะธ (`ttlTrick`/`ttlTrickValue`) ะธ ัะปะฐะณะพะผ `autoTtl`; ัะพััะฐะฝะตะฝะธะต ะฟัะตัะตัะฐ ะฒ UI ะพะฑะฝะพะฒะปัะตั ัะพะปัะบะพ ะฟะพะปั ััะฐะณะผะตะฝัะฐัะธะธ (ััะพะฑั ะฝะต ะฟะตัะตัะธัะฐัั TTL/redirect rules).
- **AutoTTL**: ะฟัะธ ะฒะบะปััะตะฝะฝะพะผ `autoTtl` ัะตัะฒะธั ะฟะตัะตะฑะธัะฐะตั ะฝะตะฑะพะปััะพะน ะฝะฐะฑะพั TTL (2..8) ะฟะพ ะผะตััะธะบะฐะผ bypass ะธ ัะพััะฐะฝัะตั ะปัััะธะน TTL ะพะฑัะฐัะฝะพ ะฒ `bypass_profile.json`.
- **Auto-hostlist (ะบะฐะฝะดะธะดะฐัั)**: ะดะพะฑะฐะฒะปะตะฝ `AutoHostlistService`; `LiveTestingPipeline` ะฝะฐ ััะฐะฟะต ะบะปะฐััะธัะธะบะฐัะธะธ ัะธัะฐะตั `BlockageSignals` (ัะตััะฐะฝัะผะธััะธะธ/HTTP-ัะตะดะธัะตะบัั/RST/UDP) ะธ ะฟะพะฟะพะปะฝัะตั ัะฟะธัะพะบ ะบะฐะฝะดะธะดะฐัะพะฒ, ะบะพัะพััะน ะฟะพะบะฐะทัะฒะฐะตััั ะฒ UI (ะฒะบะปััะฐะตััั/ะฒัะบะปััะฐะตััั ััะผะฑะปะตัะพะผ).
- **ะะตััะธะบะธ**: ัะตัะฒะธั ััะธัะฐะตั ClientHello (ะฒัะต/ะบะพัะพัะบะธะต/ะฝะต 443), ััะฐะณะผะตะฝัะฐัะธะธ, ัะตะปะตะฒะฐะฝัะฝัะต RST, ะฟะปะฐะฝ ััะฐะณะผะตะฝัะพะฒ, ะฐะบัะธะฒะฝัะน ะฟัะตัะตั, ะฟะพัะพะณ ะธ ะผะธะฝะธะผะฐะปัะฝัะน ัะฐะฝะบ, ะฒัะตะผั ะฝะฐัะฐะปะฐ; UI ัะธัะฐะตั ัะพะปัะบะพ ัะพะฑััะธั ัะตัะฒะธัะฐ (ะฟะปะฐะฝ + ัะฐะนะผััะฐะผะฟ ะฒ badge).
- **ะะตัะดะธะบัั/UX**: ะดะพะฑะฐะฒะปะตะฝั ััะฐัััั ยซะฝะตั TLS 443ยป, ยซTLS ะฝะต ะฝะฐ 443ยป, ยซClientHello ะบะพัะพัะต thresholdยป, ยซะพะฑัะพะด ะฐะบัะธะฒะตะฝ, ะฝะพ ะฝะต ะฟัะธะผะตะฝัะฝยป, ยซะผะฐะปะพ ะดะฐะฝะฝััยป; ะบะฐััะพัะบะฐ ะฝะต ััะผะธั ะฝะฐ ัะตััะต ััะฐัััั, tooltip ะดะฐัั next steps (ัะฝะธะทะธัั threshold/ัะผะตะฝะธัั ะฟัะตัะตั/ะฒะบะปััะธัั Drop RST).
- **ะะฒัะพะบะพััะตะบัะธั**: ัะปะฐะณ `AutoAdjustAggressive` (ัะพะปัะบะพ ะฟัะตัะตั ยซะะณัะตััะธะฒะฝัะนยป); ัะฐะฝะฝะธะน ะฒัะฟะปะตัะบ RST -> ะผะธะฝะธะผะฐะปัะฝัะน ัะฐะฝะบ=4; ะทะตะปัะฝัะน >30ั -> ะปัะณะบะพะต ััะธะปะตะฝะธะต (ะฝะต ะฝะธะถะต 4); ะฟะตัะตะฟัะธะผะตะฝะตะฝะธะต ะพะฟัะธะน ะดะตะปะฐะตั ัะตัะฒะธั.
- **ะะธัะบะธ/ะฟัะพะฑะตะปั**: ะฝะตั unit-ัะตััะพะฒ ะฝะฐ `TlsBypassService`/ะฒะตัะดะธะบัั; ัะฐะนะผะตั ะผะตััะธะบ 2ั ะผะพะถะตั ะปะฐะณะฐัั ะฒ UI; ะฐะฒัะพ-ะบะพััะตะบัะธั ะฝะต ัะฑัะฐััะฒะฐะตั ัะปะฐะณ ะฟัะธ ัะผะตะฝะต ะฟัะตัะตัะฐ (ะฟะพะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฟะตัะตะบะปััะธั); ะพะฑัะพะด ะฝะต ะฟัะธะผะตะฝัะตััั ะบ ClientHello ะฑะตะท SNI ะธะปะธ ะฝะต ะฝะฐ 443; preemptive ัะตะถะธะผ ะทะฐะฒะธัะธั ะพั ััะฟะตัะฝะพะณะพ ััะฐััะฐ `TrafficEngine`.
- **ะัะธะผะตัะฐะฝะธะต (SNI vs bypass)**: `TrafficMonitorFilter` ะดะพะปะถะตะฝ ะพะฑัะฐะฑะฐััะฒะฐัั ะฟะฐะบะตั ะดะพ `BypassFilter`, ััะพะฑั ะฟะฐััะตั SNI ะฒะธะดะตะป ะธััะพะดะฝัะน (ะฝะตััะฐะณะผะตะฝัะธัะพะฒะฐะฝะฝัะน/ะฝะตะฟะตัะตััะฐะฒะปะตะฝะฝัะน) ClientHello; ะดะปั ะตััะตััะฒะตะฝะฝะพะน TCP-ัะตะณะผะตะฝัะฐัะธะธ ClientHello ะฒ `DnsParserService` ะธัะฟะพะปัะทัะตััั ะผะธะฝะธะผะฐะปัะฝัะน ัะตะฐััะตะผะฑะปะธะฝะณ ะฟะตัะฒัั ะฑะฐะนั ะฟะพัะพะบะฐ.
- **ะัะธะผะตัะฐะฝะธะต (SNI vs PID)**: WinDivert Network Layer ะฝะต ะดะฐัั PID, ะฟะพััะพะผั ะพัะบะตัััะฐัะพั ะณะตะนัะธั SNI-ััะธะณะณะตัั ัะตัะตะท ะบะพััะตะปััะธั remote endpoint โ PID ะฟะพ ัะพะฑััะธัะผ `ConnectionMonitorService` ะธ ัะฟะธัะบั `PidTrackerService.TrackedPids`. ะะปั Steam/attach ะตััั ะบะพัะพัะบะธะน ะฑััะตั (ะฝะตัะบะพะปัะบะพ ัะตะบัะฝะด), ััะพะฑั SNI, ะฟัะธัะตะดัะธะน ะดะพ ะฟะพัะฒะปะตะฝะธั PID, ะผะพะณ ะฑััั ะพะฑัะฐะฑะพัะฐะฝ ะฟะพะทะถะต.
- **UX-ัะธะดะฑะตะบ**: ััะฐััั auto-bypass ะธ ะฒะตัะดะธะบั ัะตัะฒะธัะฐ ะฟะพะบะฐะทัะฒะฐัััั ะฒ ะพัะบะตัััะฐัะพัะต; ะบะฐััะพัะบะฐ ะพะบัะฐัะธะฒะฐะตััั ะฟะพ ัะฒะตัั ะฒะตัะดะธะบัะฐ (ะทะตะปัะฝัะน ะฝะต ััะธัะฐะตััั ะฟัะพะฑะปะตะผะพะน); badge ะฒะบะปััะฐะตั ะฟะปะฐะฝ ััะฐะณะผะตะฝัะฐัะธะธ + ะฐะบัะธะฒะฝัะน ะฟัะตัะตั.
