# –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ISP_Audit v2

**–î–∞—Ç–∞**: 09.12.2025 (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 10.12.2025)  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: .NET 9, WPF  
**–†–µ–∂–∏–º**: GUI-only (WinExe)  

---

## 1. –ö–∞—Ä—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞

### 1.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –¢–û–ß–ö–ê –í–•–û–î–ê                               ‚îÇ
‚îÇ                       Program.cs                                 ‚îÇ
‚îÇ              ‚Üì Config.SetActiveProfile("Default")               ‚îÇ
‚îÇ              ‚Üì new App().Run()                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     UI LAYER (WPF)                              ‚îÇ
‚îÇ  App.xaml ‚Üí MainWindow.xaml ‚Üí MainViewModelRefactored           ‚îÇ
‚îÇ                              ‚Üì                                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ BypassController (toggle bypass)                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ DiagnosticOrchestrator (–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ TestResultsManager (UI –∫–æ–ª–ª–µ–∫—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   ORCHESTRATION LAYER                           ‚îÇ
‚îÇ              DiagnosticOrchestrator                             ‚îÇ
‚îÇ                              ‚Üì                                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ TrafficCollector (—Å–±–æ—Ä —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ LiveTestingPipeline (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–æ–≤)                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ TrafficEngine (WinDivert bypass)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     CORE LAYER                                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/StandardHostTester                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/StandardBlockageClassifier                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/InMemoryBlockageStateStore                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/TcpRetransmissionTracker                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/HttpRedirectDetector                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/RstInspectionService                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Core/Modules/UdpInspectionService                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Core/Traffic/TrafficEngine + Filters                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SERVICES LAYER                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ ConnectionMonitorService (WinDivert Socket/Polling)       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ DnsParserService (SNI/DNS –ø–∞—Ä—Å–∏–Ω–≥)                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ PidTrackerService (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ PID)                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ TcpConnectionWatcher (IP Helper API polling)              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ NoiseHostFilter (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —à—É–º–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤)                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ FixService (DNS fix —á–µ—Ä–µ–∑ netsh)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BYPASS LAYER                                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ BypassCoordinator (–≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ BypassFilter (TLS fragment/disorder/fake)                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ BypassProfile (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)                              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ StrategyMapping (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Üí —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ WinDivertNative (P/Invoke)                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.2 –ö–ª—é—á–µ–≤—ã–µ —É–∑–ª—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º —Å–≤—è–∑–µ–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í—Ö–æ–¥—è—â–∏—Ö | –ò—Å—Ö–æ–¥—è—â–∏—Ö | –†–æ–ª—å |
|-----------|----------|-----------|------|
| `MainViewModelRefactored` | 1 (MainWindow) | 3 (Bypass, Orchestrator, Results) | **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä UI** |
| `DiagnosticOrchestrator` | 1 | 12+ | **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** |
| `TrafficEngine` | 4 | 3 | **WinDivert –º–µ–Ω–µ–¥–∂–µ—Ä** |
| `LiveTestingPipeline` | 1 | 6 | **Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏** |
| `Config` | 10+ | 2 | **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** |
| `NoiseHostFilter` | 5 | 0 | **Singleton —Ñ–∏–ª—å—Ç—Ä** |

### 1.3 –°–∫—Ä—ã—Ç—ã–µ/–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ | –†–∏—Å–∫ |
|-------------------|----------------|------|
| `NoiseHostFilter.Instance` | TrafficCollector, TestResultsManager, LiveTestingPipeline | Singleton, —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |
| `Program.Targets` | Config.SetActiveProfile | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å —Ü–µ–ª–µ–π |
| `FixService` (—Ñ–∞–π–ª—ã –±—ç–∫–∞–ø–∞) | BypassController | –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ |
| `Config.ActiveProfile` | –ú–Ω–æ–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ |

### 1.4 –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:** –ù–ï–¢ —è–≤–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–æ–≤.

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫:** `DiagnosticOrchestrator` ‚Üî `TestResultsManager` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å retest —á–µ—Ä–µ–∑ BypassController.

---

## 2. –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥

### 2.1 –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã (–∫–ª–∞—Å—Å—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –º—ë—Ä—Ç–≤—ã–µ)

| –§–∞–π–ª | –ü—Ä–∏—á–∏–Ω–∞ | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è |
|------|---------|----------------------|
| `TargetCatalog.cs` | –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "—É–¥–∞–ª—ë–Ω") | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Wpf/ServiceItemViewModel.cs` | 0 usages –≤ –∫–æ–¥–µ, —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Windows/CapturedTargetsWindow.xaml(.cs)` | –ù–∏–≥–¥–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Utils/GuiProfileStorage.cs` | 0 usages | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Utils/DnsFixApplicator.cs` | –î—É–±–ª–∏—Ä—É–µ—Ç FixService, 0 usages | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Utils/BypassStrategyPlanner.cs` | 0 usages, –∑–∞–º–µ–Ω—ë–Ω StrategyMapping | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Utils/NetworkMonitorService.cs` | –ó–∞–º–µ–Ω—ë–Ω TrafficEngine, 0 usages | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Utils/ProblemClassifier.cs` | 0 usages, –∑–∞–º–µ–Ω—ë–Ω StandardBlockageClassifier | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |

### 2.2 –ú—ë—Ä—Ç–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã (Tests/)

**–ö–†–ò–¢–ò–ß–ù–û:** –í—Å–µ –∫–ª–∞—Å—Å—ã –≤ `Tests/` –ù–ï –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏–∑ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–¥–∞!

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|------|--------|-------------|
| `Tests/DnsTest.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new DnsTest()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/TcpTest.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new TcpTest()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/HttpTest.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new HttpTest()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/TracerouteTest.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new TracerouteTest()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/UdpProbeRunner.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new UdpProbeRunner()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/RstHeuristic.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new RstHeuristic()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/FirewallTest.cs` | ‚ùå –ú–Å–†–¢–í–´–ô | `new FirewallTest()` –Ω–∏–≥–¥–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è |
| `Tests/TestProgress.cs` | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û | `TestKind` enum –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ |

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `Core/Modules/StandardHostTester.cs`. –°—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã ‚Äî legacy.

### 2.3 –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ JSON-—Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|------|--------|--------------|
| `game_targets.json` | –ü—É—Å—Ç–æ–π (`"targets": []`) | ‚ùå –£–¥–∞–ª–∏—Ç—å |
| `bypass_profile_fshud_google.json` | 0 usages | ‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å |

### 2.4 –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞

| –ö–ª–∞—Å—Å | –ú–µ—Ç–æ–¥/–°–≤–æ–π—Å—Ç–≤–æ | –ü—Ä–∏—á–∏–Ω–∞ |
|-------|---------------|---------|
| `Config` | `NoTrace` | Legacy, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è |
| `Config` | `Ports` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø–æ—Ä—Ç—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ) |
| `Config` | `UdpProbes` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `TargetDefinition` | `Ports`, `Protocols` | –û–±—ä—è–≤–ª–µ–Ω—ã, –Ω–æ –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è |
| `TestKind` (enum) | `FIREWALL, ISP, ROUTER, SOFTWARE` | –ó–Ω–∞—á–µ–Ω–∏—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è |

### 2.5 Unreachable –∫–æ–¥

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `FirewallTest.cs` | 450+ | Unit-—Ç–µ—Å—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è) |

---

## 3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥

### 3.1 –î—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª—ã | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|-------|--------------|
| DNS —Ä–µ–∑–æ–ª–≤ | `StandardHostTester`, `DnsTest`, `NetUtils` | –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ `NetUtils` |
| TLS handshake | `StandardHostTester`, `HttpTest` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `StandardHostTester` |
| –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ | `StandardBlockageClassifier`, `ProblemClassifier` | –£–¥–∞–ª–∏—Ç—å `ProblemClassifier` |
| DNS fix | `FixService`, `DnsFixApplicator` | –£–¥–∞–ª–∏—Ç—å `DnsFixApplicator` |

### 3.2 –ù–∞—Ä—É—à–µ–Ω–∏—è SRP (Single Responsibility)

| –ö–ª–∞—Å—Å | –ü—Ä–æ–±–ª–µ–º–∞ | –†–∞–∑–º–µ—Ä |
|-------|----------|--------|
| `DiagnosticOrchestrator` | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π: UI, overlay, –ø—Ä–æ—Ü–µ—Å—Å—ã, WinDivert | 824 —Å—Ç—Ä–æ–∫–∏ |
| `TestResultsManager` | –ü–∞—Ä—Å–∏–Ω–≥ + —Ö—Ä–∞–Ω–µ–Ω–∏–µ + –∑–¥–æ—Ä–æ–≤—å–µ + UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | 717 —Å—Ç—Ä–æ–∫ |
| `BypassController` | Bypass + DoH + VPN –¥–µ—Ç–µ–∫—Ç + —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | 647 —Å—Ç—Ä–æ–∫ |

### 3.3 –•–∞–æ—Ç–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–µ—Ç–∞–ª–∏ |
|----------|--------|
| Namespace —Å–º–µ—à–∏–≤–∞–Ω–∏–µ | `IspAudit`, `ISPAudit`, `ISPAudit.ViewModels`, `IspAudit.Utils` |
| –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | `Program.Targets`, `Config.ActiveProfile`, `NoiseHostFilter.Instance` |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π | `Target` (Models/), `TargetDefinition` (root), `Target` (ISPAudit.Models) |

### 3.4 –¢—Ä–µ–±—É—é—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| –§–∞–π–ª | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ü—Ä–∏—á–∏–Ω–∞ |
|------|-----------|---------|
| `DiagnosticOrchestrator.cs` | üî¥ –í—ã—Å–æ–∫–∏–π | –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ StartupManager, OverlayManager, ProcessMonitor |
| `TestResultsManager.cs` | üî¥ –í—ã—Å–æ–∫–∏–π | –í—ã–¥–µ–ª–∏—Ç—å –ø–∞—Ä—Å–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å |
| –í–µ—Å—å `Tests/` | üü° –°—Ä–µ–¥–Ω–∏–π | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ unit-tests |
| `Config.cs` | üü° –°—Ä–µ–¥–Ω–∏–π | –£–±—Ä–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ |

---

## 4. –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã (Legacy)

### 4.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|----------|------|--------|
| `Config.NoTrace` | Config.cs | Legacy, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `Config.EnableRst` | Config.cs | –û—Ç–∫–ª—é—á–µ–Ω–æ, RST —á–µ—Ä–µ–∑ TrafficEngine |
| `TestKind.FIREWALL/ISP/ROUTER/SOFTWARE` | TestProgress.cs | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è |

### 4.2 –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ API/–ø–∞—Ç—Ç–µ—Ä–Ω—ã

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ì–¥–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|-----|--------------|
| `.Result` / `.Wait()` –Ω–∞ async | UdpProbeRunner.cs | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `await` |
| –°–º–µ—à–∏–≤–∞–Ω–∏–µ sync/async | FixService | –ü–æ–ª–Ω–æ—Å—Ç—å—é async |
| WMI –¥–ª—è Firewall | FirewallTest | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ |

### 4.3 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è vs —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å

| –î–æ–∫—É–º–µ–Ω—Ç | –ü—Ä–æ–±–ª–µ–º–∞ |
|----------|----------|
| `CLAUDE.md` | –£–ø–æ–º–∏–Ω–∞–µ—Ç `DnsTest`, `TcpTest` –∏ –¥—Ä. –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–µ |
| `.github/copilot-instructions.md` | –°—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `AuditRunner`, `ReportWriter` |

> ‚úÖ `ARCHITECTURE_V2.md` —É–¥–∞–ª—ë–Ω (10.12.2025), –∞–∫—Ç—É–∞–ª—å–Ω—ã–π ‚Äî `ARCHITECTURE_CURRENT.md`

---

## 5. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏

### 5.1 üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ runtime –ø—Ä–æ–±–ª–µ–º—ã (–ü–†–û–í–ï–†–ï–ù–û)

#### 5.1.1 `dnsOk=true` –≤—Å–µ–≥–¥–∞ –≤ StandardHostTester

**–§–∞–π–ª:** `Core/Modules/StandardHostTester.cs:24-25`

```csharp
bool dnsOk = true;
string dnsStatus = "OK";
// –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ù–ò–ö–û–ì–î–ê –Ω–µ –º–µ–Ω—è—é—Ç—Å—è!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—à–∏–±–∫–µ DNS (—Å—Ç—Ä–æ–∫–∏ 44-60) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `catch { }` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è `dnsOk`. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç `dnsOk=true`, –¥–∞–∂–µ –µ—Å–ª–∏ DNS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–í–ª–∏—è–Ω–∏–µ:** DNS –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è.

---

#### 5.1.2 `async void` –≤ InitializeOnStartupAsync

**–§–∞–π–ª:** `ViewModels/BypassController.cs:291`

```csharp
public async void InitializeOnStartupAsync()
{
    // –í–∫–ª—é—á–∞–µ—Ç Disorder + DROP_RST –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å—Ç—Ä–æ–∫–∏ 307-310)
    _isDisorderEnabled = true;
    _isDropRstEnabled = true;
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è (–ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é—Ç—Å—è runtime)
- –í—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ –Ω–µ –º–æ–∂–µ—Ç `await`
- Bypass –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

#### 5.1.3 –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ª–æ–≥–∏ –Ω–∞ Desktop

**–§–∞–π–ª:** `App.xaml.cs:7-8, 12, 16, 22, 31, 33-34, 42, 46, 49, 53`

```csharp
var logPath = Path.Combine(Environment.GetFolderPath(SpecialFolder.Desktop), "isp_audit_debug.txt");
File.AppendAllText(logPath, "...");  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, 10+ –≤—ã–∑–æ–≤–æ–≤!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –ø–æ—Ç–æ–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—Ç–∞—Ä—Ç–µ
- –ú—É—Å–æ—Ä –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`isp_audit_debug.txt`)
- –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (Desktop –Ω–∞ —Å–µ—Ç–µ–≤–æ–º –¥–∏—Å–∫–µ, –ø—Ä–∞–≤–∞)

---

### 5.2 üü° –°—Ä–µ–¥–Ω–∏–µ runtime –ø—Ä–æ–±–ª–µ–º—ã

#### 5.2.1 Unbounded channels –±–µ–∑ back-pressure

**–§–∞–π–ª—ã:** `Utils/LiveTestingPipeline.cs:97-99`, `Utils/TrafficCollector.cs:102`

```csharp
_snifferQueue = Channel.CreateUnbounded<HostDiscovered>();
_testerQueue = Channel.CreateUnbounded<HostTested>();
_bypassQueue = Channel.CreateUnbounded<HostBlocked>();
// + TrafficCollector.cs:102
```

**–†–∏—Å–∫:** –ü—Ä–∏ –≤—Å–ø–ª–µ—Å–∫–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (—Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π) –≤–æ–∑–º–æ–∂–µ–Ω OOM.  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ä–µ–¥–∫–æ –±–æ–ª—å—à–µ 100-200 —Ö–æ—Å—Ç–æ–≤, –Ω–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `BoundedChannel`.

---

#### 5.2.2 TLS –±–µ–∑ hostname —Å—á–∏—Ç–∞–µ—Ç—Å—è OK

**–§–∞–π–ª:** `Core/Modules/StandardHostTester.cs:148-150`

```csharp
else if (host.RemotePort == 443)
{
    // –ù–µ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TLS –±–µ–∑ hostname
    tlsOk = tcpOk;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** TLS DPI –¥–ª—è IP-only —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è.  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ë–µ–∑ SNI –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TLS ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ.

---

### 5.3 Silent failures

| –†–∏—Å–∫ | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| DNS timeout –±–µ–∑ –ª–æ–≥–∞ | StandardHostTester.cs:48 | `GetHostEntryAsync` –º–æ–∂–µ—Ç –º–æ–ª—á–∞ timeout |
| WinDivert errors | TrafficEngine.cs | –û—à–∏–±–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è handle –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é—Ç—Å—è |
| Backup file corruption | FixService | –ù–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è JSON –±—ç–∫–∞–ø |
| –§–æ–Ω–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | DiagnosticOrchestrator, LiveTestingPipeline | `DispatcherUnhandledException` –ª–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ UI-–ø–æ—Ç–æ–∫ |

### 5.4 –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤—ã–∑–æ–≤—É—Ç—Å—è

| Handler | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|---------|
| `OnDnsLookupFailed` –≤ DnsParserService | –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è, –Ω–æ UI –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç |
| `OnHostnameResolved` –≤ TrafficCollector | –°–æ–±—ã—Ç–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–æ, –Ω–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–µ—Ç |

### 5.5 –ò—Å–∫–ª—é—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å

| Exception | –§–∞–π–ª | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------|------|---------|
| `UnauthorizedAccessException` –≤ FirewallTest | –ö–ª–∞—Å—Å –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è |
| –í—Å–µ try/catch –≤ Tests/*.cs | –ö–æ–¥ –º—ë—Ä—Ç–≤—ã–π |

### 5.6 –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–µ—Ç–∞–ª–∏ |
|----------|--------|
| `Target` vs `TargetDefinition` | –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ |
| `TransportProtocol` –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | `Utils/NetworkConnection.cs` –∏ `Bypass/BypassRedirectRule.cs` |
| `BlockageType` –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | `ProblemClassifier` –∏ `Core/Models` |

---

## 6. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ

### 6.1 –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫)

```
–£–¥–∞–ª–∏—Ç—å:
‚îú‚îÄ‚îÄ TargetCatalog.cs (–ø—É—Å—Ç–æ–π)
‚îú‚îÄ‚îÄ Wpf/ServiceItemViewModel.cs
‚îú‚îÄ‚îÄ Windows/CapturedTargetsWindow.xaml(.cs)
‚îú‚îÄ‚îÄ Utils/GuiProfileStorage.cs
‚îú‚îÄ‚îÄ Utils/DnsFixApplicator.cs
‚îú‚îÄ‚îÄ Utils/BypassStrategyPlanner.cs
‚îú‚îÄ‚îÄ Utils/NetworkMonitorService.cs
‚îú‚îÄ‚îÄ Utils/ProblemClassifier.cs
‚îú‚îÄ‚îÄ game_targets.json
‚îî‚îÄ‚îÄ bypass_profile_fshud_google.json
```

**–í–ª–∏—è–Ω–∏–µ:** –ù—É–ª–µ–≤–æ–µ ‚Äî –∫–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

### 6.2 –ú–∏–≥—Ä–∞—Ü–∏—è Tests/ (—Å—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫)

```
Tests/ ‚Üí –í–∞—Ä–∏–∞–Ω—Ç—ã:
1. –£–¥–∞–ª–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é (–ª–æ–≥–∏–∫–∞ –≤ Core/Modules)
2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ ISP_Audit.Tests/ –∫–∞–∫ unit-—Ç–µ—Å—Ç—ã
3. –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "—Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã" –≤ docs/legacy/
```

**–í–ª–∏—è–Ω–∏–µ:** –ü–æ—Ç–µ—Ä—è "—Å–ø—Ä–∞–≤–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞", –Ω–æ –æ–Ω —É–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

### 6.3 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Config (–Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫)

```csharp
// –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ:
- NoTrace
- UdpProbes (–µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- Ports (–ø–æ—Ä—Ç—ã –≤ –ø—Ä–æ—Ñ–∏–ª—è—Ö)
```

### 6.4 Namespace —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)

```
–¢–µ–∫—É—â–µ–µ:
IspAudit, ISPAudit, ISPAudit.ViewModels, IspAudit.Utils

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
IspAudit.* –≤–µ–∑–¥–µ (–µ–¥–∏–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä)
```

**–†–∏—Å–∫:** –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤.

### 6.5 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```
–û–±–Ω–æ–≤–∏—Ç—å:
- CLAUDE.md ‚Äî —É–±—Ä–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥
- .github/copilot-instructions.md ‚Äî –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –î–æ–±–∞–≤–∏—Ç—å ARCHITECTURE_ACTUAL.md —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
```

---

## 7. –ö–∞—Ä—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Ç–µ–∫—Å—Ç–æ–≤–∞—è)

```
Program.cs
‚îî‚îÄ‚îÄ Config.SetActiveProfile
    ‚îî‚îÄ‚îÄ DiagnosticProfile (Profiles/Default.json)
‚îî‚îÄ‚îÄ App.xaml
    ‚îî‚îÄ‚îÄ MainWindow.xaml
        ‚îî‚îÄ‚îÄ MainViewModelRefactored
            ‚îú‚îÄ‚îÄ BypassController
            ‚îÇ   ‚îú‚îÄ‚îÄ TrafficEngine
            ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BypassFilter
            ‚îÇ   ‚îî‚îÄ‚îÄ FixService
            ‚îú‚îÄ‚îÄ DiagnosticOrchestrator
            ‚îÇ   ‚îú‚îÄ‚îÄ TrafficCollector
            ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConnectionMonitorService
            ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TcpConnectionWatcher
            ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PidTrackerService
            ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DnsParserService
            ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TrafficMonitorFilter
            ‚îÇ   ‚îú‚îÄ‚îÄ LiveTestingPipeline
            ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StandardHostTester
            ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StandardBlockageClassifier
            ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InMemoryBlockageStateStore
            ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TcpRetransmissionTracker
            ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ HttpRedirectDetector
            ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ RstInspectionService
            ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ UdpInspectionService
            ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UnifiedTrafficFilter
            ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ NoiseHostFilter
            ‚îÇ   ‚îî‚îÄ‚îÄ TrafficEngine (shared)
            ‚îî‚îÄ‚îÄ TestResultsManager
                ‚îî‚îÄ‚îÄ NoiseHostFilter.Instance

–ì–õ–û–ë–ê–õ–¨–ù–´–ï:
- Config.ActiveProfile (static)
- Program.Targets (static)
- NoiseHostFilter.Instance (singleton)
```

---

## 8. –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ .cs —Ñ–∞–π–ª–æ–≤ | ~86 |
| –ú—ë—Ä—Ç–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ | **15** (17%) |
| –ú—ë—Ä—Ç–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤ | **18+** |
| –î—É–±–ª–∏—Ä—É—é—â–µ–π—Å—è –ª–æ–≥–∏–∫–∏ | **4 –æ–±–ª–∞—Å—Ç–∏** |
| Legacy –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | **6+** |
| Runtime –ø—Ä–æ–±–ª–µ–º | **5** (3 –∫—Ä–∏—Ç–∏—á–Ω—ã–µ) |
| –†–∏—Å–∫–æ–≤ silent failure | **3** |

---

## 9. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üî¥ –ù–ï–ú–ï–î–õ–ï–ù–ù–û (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|---|----------|------|-------------|
| 1 | `dnsOk=true` –≤—Å–µ–≥–¥–∞ | StandardHostTester.cs:24-60 | –î–æ–±–∞–≤–∏—Ç—å `dnsOk=false` –≤ catch-–±–ª–æ–∫ |
| 2 | `async void` | BypassController.cs:291 | –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `async Task`, —É–±—Ä–∞—Ç—å –∞–≤—Ç–æ–≤–∫–ª—é—á–µ–Ω–∏–µ |
| 3 | –õ–æ–≥–∏ –Ω–∞ Desktop | App.xaml.cs | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ %TEMP%/logs |

### üü° –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (1-2 –¥–Ω—è)

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|---|----------|------|-------------|
| 4 | Unbounded channels | LiveTestingPipeline.cs | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `BoundedChannel` (capacity: 1000) |
| 5 | TLS –±–µ–∑ hostname | StandardHostTester.cs:148 | –î–æ–±–∞–≤–∏—Ç—å `tlsStatus = "SKIPPED (no hostname)"` |

### –§–∞–∑–∞ 1 (2-3 –¥–Ω—è): –û—á–∏—Å—Ç–∫–∞ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞
1. –£–¥–∞–ª–∏—Ç—å 100% –º—ë—Ä—Ç–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 6.1
2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ `Config`
3. –û–±–Ω–æ–≤–∏—Ç—å `CLAUDE.md`

### –§–∞–∑–∞ 2 (3-5 –¥–Ω–µ–π): –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
1. –†–∞–∑–¥–µ–ª–∏—Ç—å `DiagnosticOrchestrator` –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
2. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å namespace (`IspAudit` vs `ISPAudit`)
3. –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ `Tests/`

### –§–∞–∑–∞ 3 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω—ã
2. –î–æ–±–∞–≤–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
3. –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ unit-—Ç–µ—Å—Ç–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** –ê–∫—Ç—É–∞–ª–µ–Ω –Ω–∞ 10.12.2025  
**–û—á–∏—Å—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** –í—ã–ø–æ–ª–Ω–µ–Ω–∞ (79 ‚Üí 25 .md —Ñ–∞–π–ª–æ–≤)
